// https://github.com/arose/ngl/ LICENSE
(function(a){a.console=a.console||{};a=a.console;for(var b,c={},d=function(){},e=["memory"],f="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");b=e.pop();)a[b]||(a[b]=c);for(;b=f.pop();)a[b]||(a[b]=d)})("undefined"===typeof window?this:window);
"function"===typeof importScripts||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){c=window.atob(this.toDataURL(b,c).split(",")[1]);for(var d=c.length,e=d>>2,f=new Uint8Array(d),g=new Uint32Array(f.buffer,0,e),h=0,k=0;h<e;h++)g[h]=c.charCodeAt(k++)|c.charCodeAt(k++)<<8|c.charCodeAt(k++)<<16|c.charCodeAt(k++)<<24;for(d&=3;d--;)f[k]=c.charCodeAt(k++);a(new Blob([f],{type:b||"image/png"}))}});
Number.isInteger||(Number.isInteger=function(a){return"number"===typeof a&&isFinite(a)&&-9007199254740992<a&&9007199254740992>a&&Math.floor(a)===a});Number.isNaN||(Number.isNaN=function(a){return a!==a});
Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(a,b){if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var c=Object(a),d=!1,e,f=1;f<arguments.length;f++){var g=arguments[f];if(void 0!==g&&null!==g){for(var h=Object.keys(Object(g)),k=0,l=h.length;k<l;k++){var m=h[k];try{var n=Object.getOwnPropertyDescriptor(g,m);void 0!==n&&n.enumerable&&(c[m]=g[m])}catch(q){d||(d=!0,e=q)}}if(d)throw e;}}return c}});
String.prototype.startsWith||function(){var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(g){}return c}(),b={}.toString,c=function(a){if(null==this)throw TypeError();var c=String(this);if(a&&"[object RegExp]"==b.call(a))throw TypeError();var f=c.length,g=String(a),h=g.length,k=1<arguments.length?arguments[1]:void 0,k=k?Number(k):0;k!=k&&(k=0);k=Math.min(Math.max(k,0),f);if(h+k>f)return!1;for(f=-1;++f<h;)if(c.charCodeAt(k+f)!=g.charCodeAt(f))return!1;return!0};a?a(String.prototype,
"startsWith",{value:c,configurable:!0,writable:!0}):String.prototype.startsWith=c}();String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();if("number"!==typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)b=c.length;b-=a.length;c=c.indexOf(a,b);return-1!==c&&c===b});
"function"!==typeof importScripts&&function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var f=(new Date).getTime(),g=Math.max(0,16-(f-a)),h=window.setTimeout(function(){b(f+g)},g);a=f+g;return h});window.cancelAnimationFrame||
(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});"function"!==typeof importScripts&&(HTMLElement.prototype.getBoundingClientRect=function(){var a=HTMLElement.prototype.getBoundingClientRect;return function(){try{return a.apply(this,arguments)}catch(b){return{top:0,left:0,width:this.width,height:this.height}}}}());
"function"!==typeof importScripts&&WebGLRenderingContext&&(WebGLRenderingContext.prototype.getShaderParameter=function(){var a=WebGLRenderingContext.prototype.getShaderParameter;return function(){return NGL.debug?a.apply(this,arguments):!0}}(),WebGLRenderingContext.prototype.getShaderInfoLog=function(){var a=WebGLRenderingContext.prototype.getShaderInfoLog;return function(){return NGL.debug?a.apply(this,arguments):""}}(),WebGLRenderingContext.prototype.getProgramParameter=function(){var a=WebGLRenderingContext.prototype.getProgramParameter;
return function(b,c){return NGL.debug||c!==WebGLRenderingContext.prototype.LINK_STATUS?a.apply(this,arguments):!0}}(),WebGLRenderingContext.prototype.getProgramInfoLog=function(){var a=WebGLRenderingContext.prototype.getProgramInfoLog;return function(){return NGL.debug?a.apply(this,arguments):""}}());
var NGL={REVISION:"0.7dev",EPS:1E-7,disableImpostor:!1,useWorker:!0,indexUint16:!1,debug:!1,develop:-1!==self.location.pathname.indexOf("core.js")||-1!==self.location.pathname.indexOf("dev.html"),mainScriptFilePath:"../js/build/ngl.full.min.js",cssDirectory:"../css/",assetsDirectory:"../",documentationUrl:"../doc/index.html"};NGL.log=Function.prototype.bind.call(console.log,console);NGL.info=Function.prototype.bind.call(console.info,console);NGL.warn=Function.prototype.bind.call(console.warn,console);
NGL.error=Function.prototype.bind.call(console.error,console);NGL.time=Function.prototype.bind.call(console.time,console);NGL.timeEnd=Function.prototype.bind.call(console.timeEnd,console);NGL.LeftMouseButton=1;NGL.MiddleMouseButton=2;NGL.RightMouseButton=3;
"function"===typeof importScripts&&NGL.develop&&importScripts("../three/three.js","../three/TypedArrayUtils.js","../three/controls/TrackballControls.js","../three/loaders/OBJLoader.js","../three/loaders/PLYLoader.js","../lib/promise.min.js","../lib/sprintf.min.js","../lib/pako_inflate.min.js","../lib/chroma.min.js","../lib/svd.js","../lib/signals.min.js","../lib/TypedFastBitSet.js","../lib/mmtf-decode.js","../ngl/shims.js","../ngl/worker.js","../ngl/utils.js","../ngl/proxy.js","../ngl/store.js","../ngl/symmetry.js",
"../ngl/alignment.js","../ngl/geometry.js","../ngl/selection.js","../ngl/superposition.js","../ngl/structure.js","../ngl/trajectory.js","../ngl/surface.js","../ngl/script.js","../ngl/streamer.js","../ngl/parser.js","../ngl/writer.js","../ngl/loader.js","../ngl/viewer.js","../ngl/buffer.js","../ngl/representation.js","../ngl/stage.js");NGL.GET=function(a){if(a=(new RegExp(a+"=([^&#=]*)")).exec(window.location.search))return decodeURIComponent(a[1])};
(function(){var a=NGL.GET("debug");void 0!==a&&(NGL.debug=a);a=NGL.GET("useWorker");void 0!==a&&(NGL.useWorker=a);a=NGL.GET("disableImpostor");void 0!==a&&(NGL.disableImpostor=a)})();NGL.PluginRegistry={dict:{},add:function(a,b){this.dict[a]=b},get:function(a){if(a in this.dict)return this.dict[a];throw"NGL.PluginRegistry '"+a+"' not defined";},get names(){return Object.keys(this.dict)},get count(){return this.names.length},load:function(a,b){var c=this.get(a);b.loadFile(c,{name:a+" plugin"})}};
NGL.ExampleRegistry={dict:{},add:function(a,b){this.dict[a]=b},addDict:function(a){Object.keys(a).forEach(function(b){this.add(b,a[b])}.bind(this))},get:function(a){return this.dict[a]},get names(){return Object.keys(this.dict)},get count(){return this.names.length},load:function(a,b){var c=this.get(a);"function"===typeof c?c(b):NGL.warn("NGL.ExampleRegistry.load not available:",a)}};NGL.WorkerRegistry={activeWorkerCount:0,funcDict:{},add:function(a,b){NGL.WorkerRegistry.funcDict[a]=b}};
NGL.Worker=function(a){var b=0,c=0,d={},e={},f=new Worker(NGL.mainScriptFilePath);NGL.WorkerRegistry.activeWorkerCount+=1;f.onmessage=function(c){--b;var h=c.data.__postId;NGL.timeEnd("NGL.Worker.postMessage "+a+" #"+h);d[h]&&d[h].call(f,c);delete d[h];delete e[h]};f.onerror=function(c){--b;var h=c.data.__postId;e[h]?e[h].call(f,c):NGL.error("NGL.Worker.onerror",h,a,c);delete d[h];delete e[h]};this.name=a;this.post=function(g,h,k,l){d[c]=k;e[c]=l;g=g||{};g.__name=a;g.__postId=c;g.__debug=NGL.debug;
NGL.time("NGL.Worker.postMessage "+a+" #"+c);try{f.postMessage.call(f,g,h)}catch(m){NGL.error("NGL.worker.post:",m),f.postMessage.call(f,g)}b+=1;c+=1;return this};this.terminate=function(){f?(f.terminate(),--NGL.WorkerRegistry.activeWorkerCount):console.log("no worker to terminate")};Object.defineProperties(this,{postCount:{get:function(){return c}},pending:{get:function(){return b}}})};NGL.Worker.prototype.constructor=NGL.Worker;
NGL.WorkerPool=function(a,b){b=Math.min(8,b||2);var c=[],d=0;this.name=a;this.maxCount=b;this.post=function(a,b,c,d){this.getNextWorker().post(a,b,c,d);return this};this.terminate=function(){c.forEach(function(a){a.terminate()})};this.getNextWorker=function(){for(var e,f=Infinity,g=0;g<b;++g){if(g>=d){e=new NGL.Worker(a);c.push(e);d+=1;break}var h=c[g];if(0===h.pending){e=h;break}else h.pending<f&&(f=h.pending,e=h)}return e};Object.defineProperties(this,{count:{get:function(){return d}}})};
NGL.WorkerPool.prototype.constructor=NGL.WorkerPool;"function"===typeof importScripts&&(self.onmessage=function(a){var b=a.data.__name,c=a.data.__postId;NGL.debug=a.data.__debug;if(void 0===b)NGL.error("message __name undefined");else if(void 0===NGL.WorkerRegistry.funcDict[b])NGL.error("funcDict[ __name ] undefined",b);else NGL.WorkerRegistry.funcDict[b](a,function(a,b){a=a||{};void 0!==c&&(a.__postId=c);try{self.postMessage(a,b)}catch(f){NGL.error("self.postMessage:",f),self.postMessage(a)}})});
NGL.defaults=function(a,b){return void 0!==a?a:b};NGL.browser=function(){var a=navigator.userAgent;return/Arora/i.test(a)?"Arora":/Opera|OPR/.test(a)?"Opera":/Chrome/i.test(a)?"Chrome":/Epiphany/i.test(a)?"Epiphany":/Firefox/i.test(a)?"Firefox":/Mobile(\/.*)? Safari/i.test(a)?"Mobile Safari":/MSIE/i.test(a)?"Internet Explorer":/Midori/i.test(a)?"Midori":/Safari/i.test(a)?"Safari":!1}();
NGL.getAbsolutePath=function(a){var b=window.location,c=b.pathname,c=c.substring(0,c.lastIndexOf("/")+1);return b.origin+c+a};NGL.createObject=function(a,b){var c=Object.create(a),d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c};NGL.deepCopy=function(a){if("object"!==typeof a)return a;var b=Array.isArray(a)?[]:{},c;for(c in a)b[c]=NGL.deepCopy(a[c]);return b};
NGL.download=function(a,b){if(a){b=b||"download";var c=document.createElement("a");c.style.display="hidden";document.body.appendChild(c);c.href=a instanceof Blob?URL.createObjectURL(a):a;c.download=b;c.target="_blank";c.click();document.body.removeChild(c);a instanceof Blob&&URL.revokeObjectURL(a)}else NGL.warn("NGL.download: no data given.")};
NGL.submit=function(a,b,c,d){if(b instanceof FormData){var e=new XMLHttpRequest;e.open("POST",a);e.addEventListener("load",function(a){200===e.status||304===e.status?c(e.response):"function"===typeof d&&d(e.status)},!1);e.send(b)}else NGL.warn("NGL.submit: type not supported.",b)};
NGL.open=function(a,b){b=b||["*"];var c=document.createElement("input");c.type="file";c.multiple=!0;c.style.display="hidden";document.body.appendChild(c);c.accept="."+b.join(",.");c.addEventListener("change",function(b){a(b.target.files)},!1);c.click()};NGL.unicodeHelper=function(){var a={"{alpha}":"\u03b1","{beta}":"\u03b2","{gamma}":"\u03b3","{dot}":"\u00b7","{bullet}":"\u2022"},b=Object.keys(a).join("|"),c=new RegExp("("+b+")","gi");return function(b){return b.replace(c,function(b,c,d,h,k){return a[String(b)]})}}();
NGL.getFileInfo=function(a){var b,c,d;b=a instanceof File||a instanceof Blob?a.name||"":a;var e=b.replace(/^.*[\\\/]/,""),f=e.substring(0,e.lastIndexOf(".")),g=e.split("."),g=1<g.length?g.pop().toLowerCase():"";if(c=b.match(/^(.+):\/\/(.+)$/))d=c[1].toLowerCase(),b=c[2];var h=b.substring(0,b.lastIndexOf("/")+1);-1!==["gz"].indexOf(g)?(c=g,g=b.substr(0,b.length-g.length-1).split(".").pop().toLowerCase(),f=f.substr(0,f.length-g.length-1)):c=!1;return{path:b,name:e,ext:g,base:f,dir:h,compressed:c,protocol:d,
src:a}};NGL.fromJSON=function(a){return(new NGL[a.metadata.type]).fromJSON(a)};NGL.processArray=function(a,b,c,d){var e=a.length;d=void 0!==d?d:1E6;if("function"===typeof importScripts||d>=e)b(0,e,a),c();else{var f=0,g=d,h=Math.min(g,e),k=function(){b(f,h,a)?f=e:(f+=g,h=Math.min(h+g,e));f>=e?c():setTimeout(k)};k()}};
NGL.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var k=function(){h=!1===c.leading?0:Date.now();g=null;f=a.apply(d,e);g||(d=e=null)};return function(){var l=Date.now();h||!1!==c.leading||(h=l);var m=b-(l-h);d=this;e=arguments;0>=m||m>b?(g&&(clearTimeout(g),g=null),h=l,f=a.apply(d,e),g||(d=e=null)):g||!1===c.trailing||(g=setTimeout(k,m));return f}};
NGL.binarySearchIndexOf=function(){function a(a,c){return a<c?-1:a>c?1:0}return function(b,c,d){var e=0,f=b.length-1;for(d||(d=a);e<=f;){var g=e+f>>1,h=d(c,b[g]);if(0<h)e=g+1;else if(0>h)f=g-1;else return g}return-e-1}}();NGL.dataURItoImage=function(a){if("function"!==typeof importScripts){var b=document.createElement("img");b.src=a;return b}};NGL.Uint8ToString=function(a){for(var b=[],c=0;c<a.length;c+=4096)b.push(String.fromCharCode.apply(null,a.subarray(c,c+4096)));return b.join("")};
NGL.Uint8ToLines=function(a,b,c){NGL.time("NGL.Uint8ToLines");b=void 0!==b?b:10485760;c=void 0!==c?c:"\n";for(var d="",e=[],f=0;f<a.length;f+=b){var g=NGL.Uint8ToString(a.subarray(f,f+b)),h=g.lastIndexOf(c);-1===h?d+=g:(d+=g.substr(0,h),e=e.concat(d.split(c)),d=h===g.length-c.length?"":g.substr(h+c.length))}""!==d&&e.push(d);NGL.timeEnd("NGL.Uint8ToLines");return e};
NGL.decompress=function(a,b,c,d){var e,f;b=NGL.getFileInfo(b).compressed;NGL.time("NGL.decompress "+b);a instanceof ArrayBuffer&&(a=new Uint8Array(a));if("gz"===b)try{e=pako.ungzip(a)}catch(g){NGL.debug&&NGL.warn(g),e=a}else NGL.warn("no decompression method available for '"+b+"'"),f=a;c||void 0!==f||(f=NGL.Uint8ToString(e));NGL.timeEnd("NGL.decompress "+b);a=c?e:f;"function"===typeof d&&d(a);return a};
NGL.WorkerRegistry.add("decompress",function(a,b){var c=a.data,d=NGL.decompress(c.data,c.file,c.asBinary),e=[];c.asBinary&&e.push(d.buffer);b(d,e)});
NGL.decompressWorker=function(a,b,c,d){if(NGL.useWorker&&"undefined"!==typeof Worker&&"function"!==typeof importScripts)var e=(new NGL.Worker("decompress")).post({data:a,file:b,asBinary:c},[a.buffer?a.buffer:a],function(a){e.terminate();d(a.data)},function(f){console.warn("NGL.decompressWorker error - trying without worker",f);e.terminate();NGL.decompress(a,b,c,d)});else NGL.decompress(a,b,c,d)};NGL.Counter=function(){var a=signals;this.count=0;this.signals={countChanged:new a.Signal}};
NGL.Counter.prototype={clear:function(){this.change(-this.count)},change:function(a){this.count+=a;this.signals.countChanged.dispatch(a,this.count);0>this.count&&NGL.warn("NGL.Counter.count below zero",this.count)},increment:function(){this.change(1)},decrement:function(){this.change(-1)},listen:function(a){this.change(a.count);a.signals.countChanged.add(function(a,c){this.change(a)}.bind(this))},onZeroOnce:function(a,b){if(0===this.count)a.call(b,0,0);else{var c=function(){0===this.count&&(this.signals.countChanged.remove(c,
this),a.apply(b,arguments))};this.signals.countChanged.add(c,this)}},dispose:function(){this.clear()}};NGL.Queue=function(a,b){function c(){var b=d.shift();void 0!==b?(e=!0,setTimeout(function(){a(b,c)})):e=!1}var d=[],e=!1;if(b){for(var f=0,g=b.length;f<g;++f)d.push(b[f]);c()}this.push=function(a){d.push(a);e||c()};this.kill=function(a){d.length=0};this.length=function(){return d.length}};
NGL.ElementColors={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578E4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,
RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32E3,AC:7384058,TH:47871,PA:41471,
U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120,"":16777215};
NGL.ResidueColors={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576,DA:10526975,DG:16740464,DI:8454143,DC:16747595,DT:10551200,DU:16744576,"":16711935};
NGL.StructureColors={alphaHelix:16711808,"3_10Helix":10485888,piHelix:6291584,betaStrand:16762880,betaTurn:6324479,coil:16777215,dna:11403518,rna:16580962,carbohydrate:10921722,"":8421504};NGL.HelixTypes={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h","":"h"};
NGL.VdwRadii={H:1.1,HE:1.4,LI:1.81,BE:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,NE:1.54,NA:2.27,MG:1.73,AL:1.84,SI:2.1,P:1.8,S:1.8,CL:1.75,AR:1.88,K:2.75,CA:2.31,SC:2.3,TI:2.15,V:2.05,CR:2.05,MN:2.05,FE:2.05,CO:2,NI:2,CU:2,ZN:2.1,GA:1.87,GE:2.11,AS:1.85,SE:1.9,BR:1.83,KR:2.02,RB:3.03,SR:2.49,Y:2.4,ZR:2.3,NB:2.15,MO:2.1,TC:2.05,RU:2.05,RH:2,PD:2.05,AG:2.1,CD:2.2,IN:2.2,SN:1.93,SB:2.17,TE:2.06,I:1.98,XE:2.16,CS:3.43,BA:2.68,LA:2.5,CE:2.48,PR:2.47,ND:2.45,PM:2.43,SM:2.42,EU:2.4,GD:2.38,TB:2.37,DY:2.35,
HO:2.33,ER:2.32,TM:2.3,YB:2.28,LU:2.27,HF:2.25,TA:2.2,W:2.1,RE:2.05,OS:2,IR:2,PT:2.05,AU:2.1,HG:2.05,TL:1.96,PB:2.02,BI:2.07,PO:1.97,AT:2.02,RN:2.2,FR:3.48,RA:2.83,AC:2,TH:2.4,PA:2,U:2.3,NP:2,PU:2,AM:2,CM:2,BK:2,CF:2,ES:2,FM:2,MD:2,NO:2,LR:2,RF:2,DB:2,SG:2,BH:2,HS:2,MT:2,DS:2,RG:2,CN:2,UUT:2,FL:2,UUP:2,LV:2,UUH:2,"":2};
NGL.CovalentRadii={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,
TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69,BK:1.6,CF:1.6,ES:1.6,FM:1.6,MD:1.6,NO:1.6,LR:1.6,RF:1.6,DB:1.6,SG:1.6,BH:1.6,HS:1.6,MT:1.6,DS:1.6,RG:1.6,CN:1.6,UUT:1.6,FL:1.6,UUP:1.6,LV:1.6,UUH:1.6,"":1.6};
NGL.ResidueRadii={"2QY":6.58,CY0:11.98,"2QZ":2.52,CY1:6.59,HHK:5.11,CXM:4.69,HHI:4.58,CY4:4.57,S12:18.57,CY3:2.79,C5C:5.35,PFX:11.84,"2R3":6.94,"2R1":3.78,ILX:4.99,"32S":5.68,BTK:8.59,"32T":5.72,FAK:9.8,B27:2.78,ILM:3.84,C4R:5.63,"32L":6.75,SYS:3.01,"1MH":5.04,ILE:3.65,YNM:6.39,"2RX":4.91,B3A:2.48,GEE:4.76,"7MN":7.34,B3E:5.4,ARG:6.33,200:6.89,HIP:5.47,HIA:4.64,B3K:5.89,HIC:5.76,B3L:4.96,B3M:5.07,ARM:6.86,ARO:7.35,AR4:8.42,PG1:10.67,YOF:6.44,IML:3.74,SXE:6.65,HIQ:7.98,PFF:6.31,HIS:4.52,"0TD":3.62,
C3Y:5.24,"1OP":11.55,"02Y":4.77,"02V":4.83,ASB:5.59,"30V":8.53,S2P:4.81,ASP:3.55,ASN:3.54,"2OR":6.91,QMM:6.13,"2P0":8.52,ASL:5.36,HFA:5.14,"5PG":5.69,B3X:4.38,AS9:4.1,ARV:7.59,B3U:6.06,S2C:7.54,B3T:3.34,175:5.64,GFT:8.18,HG7:6.8,B3Q:4.48,ASA:3.64,"02K":2.94,B3Y:7.45,PHD:5.35,C6C:6.42,BUC:5.8,HGL:8.07,PHE:5.06,"03Y":2.6,PHA:5.11,OCY:5,"4PH":6.79,"5OH":4.7,"31Q":10.46,BTR:7.98,"3PX":4.7,"1PA":8.07,ASX:3.54,IOR:7.23,"03E":3.38,PHL:5.17,KWS:5.09,PHI:7.12,NAL:7.22,S1H:19.21,"2ML":3.86,"2MR":7.35,GHG:4.83,
TYY:6.54,"2MT":3.67,"56A":13.01,SVA:5.46,TYX:8.31,TYS:8.59,TYR:6.38,TYQ:6.43,HLU:3.99,MYK:19.47,TYO:7.71,HLX:4.98,TYN:9.87,TYJ:6.25,TYI:6.49,LYH:5.13,LYF:12.19,SUN:6.73,LYR:18.28,TYB:6.46,"11W":14.39,LYS:5.54,LYN:4.8,"11Q":4.85,LYO:4.71,LYZ:1.76,TXY:6.44,MYN:4.71,TY5:10.6,HMR:5.09,"01W":8.55,LYX:13.36,TY8:7.22,TY2:6.49,KYN:6.18,KYQ:9.75,CZZ:5.14,IIL:3.81,HNC:10.41,OIC:4.62,LVN:2.89,QIL:3.84,JJL:8.3,VAH:3.88,JJJ:7.5,JJK:7.43,VAD:2.56,CYW:4.65,"0QL":5.72,143:8.22,SVX:7.04,CYJ:11.64,SVY:7.1,SVZ:6.6,
CYG:8.03,CYF:13.54,SVV:5.09,GL3:2.72,"8SP":14.26,CYS:2.78,"004":4.33,CYR:10.33,PLJ:3.71,EXY:7.37,HL2:3.75,A5N:5.21,CYQ:5.67,CZ2:5.16,LWY:4.12,PM3:8.78,OHS:6.98,OHI:5.35,"3TY":8.42,CYD:8.55,DYS:7.87,DAH:6.47,"4IK":11.81,"3EG":3.66,AYA:3.65,"4IN":6.31,DAB:3.48,"4HT":6.03,RGL:7.03,DAM:2.49,NFA:5.04,WFP:6.07,"2JC":2.97,HAR:7.55,"2JG":5.67,MH6:1.72,"2JF":9.13,"3FG":4.96,MGN:4.84,AZH:5.36,AZK:6.03,ZBZ:7.79,TBG:2.58,VAL:2.51,MGG:7.34,AZS:5.61,FHL:9.75,"2JH":4.56,IEL:7.07,FHO:6.75,DA2:7.79,FH7:6.99,ME0:4.52,
"3GL":4.84,MDO:5.03,AZY:7.37,A8E:3.76,ZCL:6.71,MDH:2.58,LA2:14.07,"4FW":6.1,YCM:5.32,MDF:4.95,YCP:3.01,TEF:8.63,FGP:4.34,UF0:19.72,XCN:4.57,FGL:2.56,MF3:6.37,MEQ:5.13,LAA:3.23,IGL:5.52,MET:4.49,NIY:6.81,QCS:5.18,TCQ:8.56,MEN:4.33,"4HL":8.79,MEA:4.95,EFC:5.28,LAL:2.41,"2HF":5.52,KBE:5.64,OCS:3.94,CAF:5.46,NC1:11.4,NBQ:9.82,CAB:4.19,MBQ:9.55,193:7.38,192:2.44,"0WZ":7.61,CAS:5.35,NB8:11.98,OBS:11.71,"1AC":2.42,PCA:3.48,MCL:9.73,LBY:7.75,GAU:4.67,PBF:9.75,MCG:6.46,DDE:6.86,"19W":3.94,MD5:9.33,MD6:6.44,
MD3:8.41,MCS:7.56,OBF:3.64,UAL:4.68,PAT:6.05,IAM:8.88,PAQ:8.77,FDL:9.49,NCB:3.45,LCK:9.81,DDZ:2.52,"2FM":5.54,IAR:6.77,OAS:4.8,HBN:8.8,TA4:5.55,"1C3":7.43,ECX:5.51,PF5:6.28,RE3:5.29,FCL:6.25,ECC:4.79,LDH:7.06,NCY:2.91,CCS:4.58,PEC:6.54,"2CO":4.45,LE1:2.72,HCM:5.53,"07O":8.05,HCL:4.96,NEP:6.94,PE1:8.01,LEF:4.37,FC0:5.18,LED:4.34,HCS:4.09,DBU:2.49,RE0:5.53,LEN:3.82,"1E3":8.71,BB9:2.56,BB8:5.14,PCS:5.05,BB7:4.56,BB6:2.62,LEU:3.83,DBZ:7.08,LET:11.29,DBY:6.46,ICY:7.76,MAA:2.4,CGA:7.91,"5CS":8.34,UGY:3.7,
LGY:11.71,N10:8.96,AAR:6.39,FT6:7.5,MOD:12.62,"5CW":7.21,PVH:4.58,BBC:6.42,YYA:7.3,O12:14.08,NOT:7.15,KGC:9.88,MP4:5.86,"0CS":4.07,MP8:3.75,VLL:2.54,VLM:2.51,BCS:8.03,MNL:4.9,AA4:4.47,SAC:3.49,BCX:2.99,"3CF":6.47,SAH:11.7,NNH:6.86,CGU:4.71,SIB:12.41,TLY:8.78,SIC:4.81,VMS:8.82,TMD:6.76,MMO:6.53,PXU:2.46,"4AW":6.22,OTH:3.6,DLS:6.84,MME:4.99,DM0:6.99,"0FL":2.76,SBL:8.96,CDV:3.72,OTY:6.51,PYA:7.75,"2AS":3.57,DMH:4.92,ELY:7.42,GVL:9.6,FVA:2.9,SAR:2.48,"4BF":6.92,EME:4.69,CDE:2.51,"3AR":7.86,"3AH":9.11,
AC5:2.44,FTR:6.08,MLL:3.76,NPH:11.66,NPI:6.9,DMT:6.67,PYX:11.3,MLE:3.87,PYL:9.67,ZZU:6.94,H5M:3.61,SCH:4.46,DMK:3.52,FTY:9.07,"2AG":3.7,ABA:2.55,ZZJ:2.44,MLZ:6.8,MLY:6.88,KCX:7.28,ZZD:8.16,"3A5":5.37,LHC:7.75,"9AT":2.47,OZT:3.4,THO:2.62,THR:2.5,DFI:3.93,MKD:6.42,"4CY":4.6,SDP:6.07,DFO:3.94,"0A0":3.45,"4DB":9.73,ML3:6.26,BG1:8.02,SD4:4.57,THC:3.8,SCS:5.48,TH5:4.65,BFD:5.33,AEI:6.34,TH6:2.85,SCY:4.53,TIS:4.81,SEE:4.53,BHD:3.48,SEB:8.18,SEC:2.96,SEP:4.8,CLH:7.13,TIH:5.02,CLG:13.62,SEN:6.43,XXA:7.34,
SEL:2.46,SE7:4.19,"4CF":7.72,G8M:3.57,BH2:3.51,UN2:3.22,VR0:10.51,MK8:4.76,DHA:2.32,LMQ:4.69,SFE:5.01,AHB:3.47,OXX:7.05,BIF:9.63,IZO:4.47,NMM:8.25,"0BN":7,HZP:3.12,NMC:4.23,DHL:2.69,"9DS":9.29,SER:2.41,CHG:4.2,MIR:6.54,AGQ:7.79,SET:2.46,MIS:6.32,"4FB":3.08,"0AR":8.46,LME:3.99,FZN:24.42,AGT:9.04,IYR:6.46,"9DN":9.31,CHP:5.75,UNK:1.64,XX1:9.92,AGM:6.57,"0AH":5.78,LLP:10.22,"0AF":6.72,"4DP":9.28,HYP:2.25,DIR:5.8,LLY:8.71,"0AK":6.11,NLE:4.67,OYL:6.42,WVL:4.69,"0A8":8.1,NLY:6.37,MHO:4.89,VOL:2.55,"0A1":7.1,
MHL:3.92,NLP:4.81,NLQ:4.65,MHW:2.74,BIL:4.7,NLO:4.8,MHU:7.51,XW1:9.36,LLO:10.13,SGB:6.88,MHV:3.6,MHS:4.51,"0A9":5.17,"0LF":9.96,HT7:6.82,X2W:6.6,YPZ:9.38,I58:6.73,FLA:2.4,M0H:4.83,HSL:2.46,FLE:6.17,KOR:10.1,"1VR":3.89,HSO:4.56,TTS:9.41,RVX:7.01,TTQ:7.71,H14:5.27,HTI:7.8,ONH:6.14,LP6:8.58,ONL:4.83,AHH:5.06,HS8:7.4,HS9:4.71,BL2:5.82,AHP:5.26,"6HN":7.34,HRP:5.46,POM:3.6,WPA:5.11,"2ZC":4.29,CPC:2.65,AIB:2.4,XSN:3.47,M2S:5.28,GND:6.67,GNC:4.6,MVA:2.56,OLZ:5.32,M2L:6.15,TRF:6.69,NZH:7.66,SRZ:5.27,OLD:10.47,
CME:5.86,CMH:5.3,ALA:2.38,TRQ:7.36,PPN:7.24,TRP:6.07,TRO:5.82,TRN:5.95,NYS:8.1,ALC:5.26,U3X:11.7,HVA:2.58,TS9:3.92,TRX:7.27,TRW:11.8,LPL:7.51,GMA:4.4,OMT:5.07,CMT:3.54,GME:4.66,NYB:6.07,PR3:5.12,LPD:2.48,GLU:4.49,"1X6":6.84,LPG:2.39,GLX:4.52,PR4:4.52,CML:6.16,FME:4.52,HTR:6.48,PR7:4.66,Z3E:7.2,GLZ:2.39,BMT:6.37,WRP:8.16,GLY:2.37,OMY:6.11,MTY:5.46,OMX:6.15,GLN:4.46,"2XA":8.25,"28X":7.84,"7JA":9.46,FLT:9.65,GLJ:3.7,OMH:5.26,TSY:4.26,PRV:4.28,CS4:11.21,DOA:12.33,"23P":5.42,CS3:8.24,"6CL":6.47,PRR:5.58,
KST:11.58,CS1:7.23,PRS:2.63,ZYJ:11.4,IT1:9.75,UU5:4.98,ESB:6.69,UU4:2.49,ESC:5.65,LSO:10.58,ZYK:11.45,"9NV":8.99,"23F":5.27,ORN:4.25,HOX:6.61,CSD:3.95,FP9:3.03,DO2:4.44,SLL:11.53,P3Q:9.54,ORQ:6.04,MSL:5.21,DNP:2.45,CSB:3.51,WLU:4.24,CSA:5.7,MT2:5.51,CSO:3.53,TPO:4.73,MSP:13.11,"23S":6.09,MSO:4.96,PRO:2.41,TPL:5.41,DNS:8.79,CSK:3.91,Z70:7.4,CSJ:7.51,DNW:7.97,PRK:9.15,GSU:11.81,LTA:6.57,HPE:6.63,TPQ:6.48,PRJ:5.26,PSW:4.65,L3O:3.89,CSU:4.89,ALY:7.38,M3L:7.12,CSW:3.68,XPR:7.68,D4P:5.66,FOE:8.17,SLZ:5.69,
CSP:5.26,TQI:7.68,ALT:2.72,CSR:5.42,CSS:3.61,M3R:7.18,ALO:2.57,R4K:4.67,SMF:9,MSA:2.73,SMC:3.39,CSX:3.47,SME:4.8,ETA:2.4,CSZ:3.6,"22G":8.8,MSE:4.62,ALN:6.16,PSH:7.26,CTE:7.27,DON:6.72,CTH:3.45,U2X:11.54,"6CW":7.56,TQZ:6.97,"3YM":6.52,OSE:4.49,"2VA":9.82,TQQ:7.76,NRG:8.35,BPE:7.24,F2F:6.25,"1TQ":8.58,I2M:3.13,NVA:3.76,R1A:8.2,QPA:6.95,C1X:11.63,FRD:5.05,HR7:6.98,SNC:3.93,QPH:5.15,"26B":8.39,DPQ:6.54,DPP:2.51,"2TY":8.65,TNR:6.88,PTH:8.35,DPL:3.58,APK:8.79,"1TY":8.84,HRG:7.36,PTM:8.74,"1U8":3.62,PTR:8.64,
LVG:3.01,"6FL":4.85,SOC:4.05,KPI:9.79,IPG:2.91,P2Y:2.51,N2C:3.55,T0I:7.34,MPH:5.29,R2T:4.71,TOX:6.78,P2Q:9.8,GPL:10.77,MPJ:5.07,F2Y:6.2,T11:8.58,"9NR":9.33,FPR:8.85,"9NF":8.93,KPY:10.17,"9NE":9.77,TOQ:7.5,MPQ:4.2,FPK:3.08,HQA:7.25,SOY:10.94,"":5};
NGL.ResidueHydrophobicity={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],"":[0,0,0]};
NGL.guessElement=function(){var a="HCONSP".split(""),b=["NA","CL"];return function(c){c=c.trim().toUpperCase();parseInt(c.charAt(0))&&(c=c.substr(1));parseInt(c.charAt(0))&&(c=c.substr(1));var d=c.length;if(0===d)return"";if(1===d)return c;if(2===d){if(-1!==b.indexOf(c))return c;if(-1!==a.indexOf(c[0]))return c[0]}return 3<=d&&-1!==a.indexOf(c[0])?c[0]:""}}();NGL.UnknownType=0;NGL.WaterType=1;NGL.IonType=2;NGL.ProteinType=3;NGL.RnaType=4;NGL.DnaType=5;NGL.UnknownBackboneType=0;
NGL.ProteinBackboneType=1;NGL.RnaBackboneType=2;NGL.DnaBackboneType=3;NGL.CgProteinBackboneType=4;NGL.CgRnaBackboneType=5;NGL.CgDnaBackboneType=6;NGL.AA1={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",ASH:"D",GLH:"E",UNK:""};NGL.AA3=Object.keys(NGL.AA1);NGL.RnaBases=["A","C","T","G","U"];NGL.DnaBases="DA DC DT DG DU TCY MCY 5CM".split(" ");NGL.PurinBases=["A","G","DA","DG"];
NGL.WaterNames="SOL WAT HOH H2O W DOD D3O".split(" ");NGL.IonNames="3CO 3NI 4MO 6MO AG AL AU AU3 BA BR CA CD CE CL CO CR CU CU1 CU3 F FE FE2 GA K LI MG MN MN3 NA ND4 NH4 NI OH RB SR V Y1 YT3 ZN".split(" ");NGL.ProteinBackboneAtoms="CA C N O O1 O2 OC1 OC2 H H1 H2 H3 HA BB".split(" ");NGL.NucleicBackboneAtoms="P O3' O5' C5' C4' C3' OP1 OP2 O3* O5* C5* C4* C3*".split(" ");NGL.BondProxy=function(a,b){this.structure=a;this.bondStore=a.bondStore;this.index=b};
NGL.BondProxy.prototype={constructor:NGL.BondProxy,type:"BondProxy",structure:void 0,bondStore:void 0,index:void 0,get atom1(){return this.structure.getAtomProxy(this.atomIndex1)},get atom2(){return this.structure.getAtomProxy(this.atomIndex2)},get atomIndex1(){return this.bondStore.atomIndex1[this.index]},set atomIndex1(a){this.bondStore.atomIndex1[this.index]=a},get atomIndex2(){return this.bondStore.atomIndex2[this.index]},set atomIndex2(a){this.bondStore.atomIndex2[this.index]=a},get bondOrder(){return this.bondStore.bondOrder[this.index]},
set bondOrder(a){this.bondStore.bondOrder[this.index]=a},qualifiedName:function(){return this.atomIndex1+"="+this.atomIndex2},clone:function(){return new this.constructor(this.structure,this.index)},toObject:function(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}};
NGL.AtomProxy=function(a,b){this.structure=a;this.chainStore=a.chainStore;this.residueStore=a.residueStore;this.atomStore=a.atomStore;this.residueMap=a.residueMap;this.atomMap=a.atomMap;this.index=b};
NGL.AtomProxy.prototype={constructor:NGL.AtomProxy,type:"AtomProxy",structure:void 0,chainStore:void 0,residueStore:void 0,atomStore:void 0,index:void 0,get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]},get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]},get residue(){console.warn("residue");return this.structure.getResidueProxy(this.residueIndex,!1)},get residueIndex(){return this.atomStore.residueIndex[this.index]},set residueIndex(a){this.atomStore.residueIndex[this.index]=
a},get sstruc(){return this.residueStore.getSstruc(this.residueIndex)},get resno(){return this.residueStore.resno[this.residueIndex]},get chainname(){return this.chainStore.getChainname(this.chainIndex)},get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])},get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])},get resname(){return this.residueType.resname},get hetero(){return this.residueType.hetero},get atomname(){return this.atomType.atomname},
get element(){return this.atomType.element},get vdw(){return this.atomType.vdw},get covalent(){return this.atomType.covalent},get x(){return this.atomStore.x[this.index]},set x(a){this.atomStore.x[this.index]=a},get y(){return this.atomStore.y[this.index]},set y(a){this.atomStore.y[this.index]=a},get z(){return this.atomStore.z[this.index]},set z(a){this.atomStore.z[this.index]=a},get serial(){return this.atomStore.serial[this.index]},set serial(a){this.atomStore.serial[this.index]=a},get bfactor(){return this.atomStore.bfactor[this.index]},
set bfactor(a){this.atomStore.bfactor[this.index]=a},get altloc(){return this.atomStore.getAltloc(this.index)},set altloc(a){this.atomStore.setAltloc(this.index,a)},isBackbone:function(){var a=this.residueType.backboneIndexList;return 0<a.length?-1!==a.indexOf(this.index-this.residueStore.atomOffset[this.residueIndex]):!1},isPolymer:function(){var a=this.residueType.moleculeType;return a===NGL.ProteinType||a===NGL.RnaType||a===NGL.DnaType||a===NGL.CgType},isSidechain:function(){return this.isPolymer()&&
!this.isBackbone()},isCg:function(){var a=this.residueType.backboneType;return a===NGL.CgProteinBackboneType||a===NGL.CgRnaBackboneType||a===NGL.CgDnaBackboneType},isHetero:function(){return 1===this.residueType.hetero},isProtein:function(){return this.residueType.moleculeType===NGL.ProteinType},isNucleic:function(){var a=this.residueType.moleculeType;return a===NGL.RnaType||a===NGL.DnaType},isRna:function(){return this.residueType.moleculeType===NGL.RnaType},isDna:function(){return this.residueType.moleculeType===
NGL.DnaType},isWater:function(){return this.residueType.moleculeType===NGL.WaterType},isIon:function(){return this.residueType.moleculeType===NGL.IonType},distanceTo:function(a){var b=this.atomStore,c=a.atomStore,d=this.index,e=a.index;a=b.x[d]-c.x[e];var f=b.y[d]-c.y[e],b=b.z[d]-c.z[e];return Math.sqrt(a*a+f*f+b*b)},connectedTo:function(a){var b=this.atomStore,c=a.atomStore,d=this.index,e=a.index,f=b.altloc[d],g=c.altloc[e];if(0!==f&&0!==g&&f!==g)return!1;f=b.x[d]-c.x[e];g=b.y[d]-c.y[e];b=b.z[d]-
c.z[e];b=f*f+g*g+b*b;if(64>b&&this.isCg())return!0;if(isNaN(b))return!1;c=this.covalent+a.covalent;a=c+.3;c-=.3;return b<a*a&&b>c*c},qualifiedName:function(a){var b="";this.resname&&!a&&(b+="["+this.resname+"]");this.resno&&(b+=this.resno);this.chainname&&(b+=":"+this.chainname);this.atomname&&(b+="."+this.atomname);this.modelIndex&&(b+="/"+this.modelIndex);return b},positionFromArray:function(a,b){void 0===b&&(b=0);this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this},positionToArray:function(a,
b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},positionToVector3:function(a){void 0===a&&(a=new THREE.Vector3);a.x=this.x;a.y=this.y;a.z=this.z;return a},positionFromVector3:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(){return new this.constructor(this.structure,this.index)},toObject:function(){return{index:this.index,residueIndex:this.residueIndex,atomno:this.atomno,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,
chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelindex:this.modelindex}}};
NGL.Residue={atomnames:function(){var a={};a[NGL.ProteinBackboneType]={trace:"CA",direction1:"C",direction2:["O","OC1","O1"],backboneStart:"N",backboneEnd:"C"};a[NGL.RnaBackboneType]={trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]};a[NGL.DnaBackboneType]={trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]};a[NGL.CgProteinBackboneType]={trace:["CA","BB"],backboneStart:["CA",
"BB"],backboneEnd:["CA","BB"]};a[NGL.CgRnaBackboneType]={trace:["C4'","C4*"],backboneStart:["C4'","C4*"],backboneEnd:["C4'","C4*"]};a[NGL.CgDnaBackboneType]={trace:["C3'","C3*","C2'"],backboneStart:["C3'","C3*","C2'"],backboneEnd:["C3'","C3*","C2'"]};a[NGL.UnknownBackboneType]={};return a}()};NGL.ResidueProxy=function(a,b){this.structure=a;this.chainStore=a.chainStore;this.residueStore=a.residueStore;this.atomStore=a.atomStore;this.residueMap=a.residueMap;this.atomMap=a.atomMap;this.index=b};
NGL.ResidueProxy.prototype={constructor:NGL.ResidueProxy,type:"ResidueProxy",structure:void 0,chainStore:void 0,residueStore:void 0,atomStore:void 0,index:void 0,get chain(){return this.structure.getChainProxy(this.chainIndex)},get chainIndex(){return this.residueStore.chainIndex[this.index]},set chainIndex(a){this.residueStore.chainIndex[this.index]=a},get atomOffset(){return this.residueStore.atomOffset[this.index]},set atomOffset(a){this.residueStore.atomOffset[this.index]=a},get atomCount(){return this.residueStore.atomCount[this.index]},
set atomCount(a){this.residueStore.atomCount[this.index]=a},get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]},get chainname(){return this.chainStore.getChainname(this.chainIndex)},get resno(){return this.residueStore.resno[this.index]},set resno(a){this.residueStore.resno[this.index]=a},get sstruc(){return this.residueStore.getSstruc(this.index)},set sstruc(a){this.residueStore.setSstruc(this.index,a)},get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])},
get resname(){return this.residueType.resname},get hetero(){return this.residueType.hetero},get moleculeType(){return this.residueType.moleculeType},get backboneType(){return this.residueType.backboneType},get backboneStartType(){return this.residueType.backboneStartType},get backboneEndType(){return this.residueType.backboneEndType},get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset},get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset},get direction2AtomIndex(){return this.residueType.direction2AtomIndex+
this.atomOffset},get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset},get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset},get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset},eachAtom:function(a,b){var c=this.atomCount,d=this.atomOffset,e=this.structure.getAtomProxy(),c=d+c;if(b&&b.atomOnlyTest)for(var f=b.atomOnlyTest;d<c;++d)e.index=d,f(e)&&a(e);else for(;d<c;++d)e.index=d,a(e)},eachAtom2:function(a,
b){var c=this.atomOffset,d=this.structure._ap,e=c+this.atomCount;if(b&&b.atomOnlyTest)for(var f=b.atomOnlyTest;c<e;++c)d.index=c,f(d)&&a(d);else for(;c<e;++c)d.index=c,a(d)},isProtein:function(){return this.residueType.moleculeType===NGL.ProteinType},isNucleic:function(){var a=this.residueType.moleculeType;return a===NGL.RnaType||a===NGL.DnaType},isRna:function(){return this.residueType.moleculeType===NGL.RnaType},isDna:function(){return this.residueType.moleculeType===NGL.DnaType},isCg:function(){var a=
this.residueType.backboneType;return a===NGL.CgProteinBackboneType||a===NGL.CgRnaBackboneType||a===NGL.CgDnaBackboneType},isPolymer:function(){var a=this.residueType.moleculeType;return a===NGL.ProteinType||a===NGL.RnaType||a===NGL.DnaType},isHetero:function(){return 1===this.residueType.hetero},isWater:function(){return this.residueType.moleculeType===NGL.WaterType},isIon:function(){return this.residueType.moleculeType===NGL.IonType},getAtomType:function(a){return this.atomMap.get(this.atomStore.atomTypeId[a])},
getResname1:function(){return NGL.AA1[this.resname.toUpperCase()]||"?"},getBackboneType:function(a){switch(a){case -1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}},getAtomIndexByName:function(a){return this.residueType.getAtomIndexByName(a)},getAtomByName:function(a){return this.residueType.getAtomByName(a)},hasAtomWithName:function(a){return this.residueType.hasAtomWithName(a)},getAtomnameList:function(){console.warn("getAtomnameList");
for(var a=this.atomCount,b=this.atomOffset,c=Array(a),d=0;d<a;++d)c[d]=this.getAtomType(b+d).atomname;return c},connectedTo:function(a){var b=this.structure.getAtomProxy(this.backboneEndAtomIndex);a=this.structure.getAtomProxy(a.backboneStartAtomIndex);return b&&a?b.connectedTo(a):!1},getNextConnectedResidue:function(){var a=this.chainStore.residueOffset[this.chainIndex],b=this.chainStore.residueCount[this.chainIndex],c=this.index+1;if(c<a+b){if(a=this.structure.getResidueProxy(c),this.connectedTo(a))return a}else if(c===
a+b&&(a=this.structure.getResidueProxy(a),this.connectedTo(a)))return a},getPreviousConnectedResidue:function(){var a=this.chainStore.residueOffset[this.chainIndex],b=this.index-1;if(b>=a){if(a=this.structure.getResidueProxy(b),a.connectedTo(this))return a}else if(b===a-1&&(a=this.structure.getResidueProxy(a+this.chainStore.residueCount[this.chainIndex]-1),a.connectedTo(this)))return a},getBonds:function(){return this.residueType.getBonds(this)},qualifiedName:function(a){var b="";this.resname&&!a&&
(b+="["+this.resname+"]");this.resno&&(b+=this.resno);this.chain&&(b+=":"+this.chain.chainname);this.chain&&this.chain.model&&(b+="/"+this.chain.model.index);return b},clone:function(){return new this.constructor(this.structure,this.index)},toObject:function(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}};
NGL.Polymer=function(a,b,c){this.structure=a;this.chainStore=a.chainStore;this.residueStore=a.residueStore;this.atomStore=a.atomStore;this.residueIndexStart=b;this.residueIndexEnd=c;this.residueCount=c-b+1;a=this.structure.getResidueProxy(this.residueIndexStart);b=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=void 0!==a.getPreviousConnectedResidue();c=b.getNextConnectedResidue();this.isNextNextConnected=(this.isNextConnected=void 0!==c)&&void 0!==c.getNextConnectedResidue();
this.isCyclic=b.connectedTo(a);this.__residueProxy=this.structure.getResidueProxy()};
NGL.Polymer.prototype={constructor:NGL.Polymer,type:"Polymer",structure:void 0,residueStore:void 0,atomStore:void 0,residueIndexStart:void 0,residueIndexEnd:void 0,residueCount:void 0,get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]},get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]},get chainname(){return this.chainStore.getChainname(this.chainIndex)},isProtein:function(){this.__residueProxy.index=this.residueIndexStart;return this.__residueProxy.isProtein()},
isCg:function(){this.__residueProxy.index=this.residueIndexStart;return this.__residueProxy.isCg()},isNucleic:function(){this.__residueProxy.index=this.residueIndexStart;return this.__residueProxy.isNucleic()},getMoleculeType:function(){this.__residueProxy.index=this.residueIndexStart;return this.__residueProxy.moleculeType},getBackboneType:function(a){this.__residueProxy.index=this.residueIndexStart;return this.__residueProxy.getBackboneType(a)},getAtomIndexByType:function(a,b){this.isCyclic?-1===
a?a=this.residueCount-1:a===this.residueCount&&(a=0):(-1!==a||this.isPrevConnected||(a+=1),a!==this.residueCount||this.isNextNextConnected||--a);var c=this.__residueProxy;c.index=this.residueIndexStart+a;switch(b){case "trace":c=c.traceAtomIndex;break;case "direction1":c=c.direction1AtomIndex;break;case "direction2":c=c.direction2AtomIndex;break;default:c=(c=c.getAtomByName(b))?c.index:void 0}return c},eachAtom:function(a,b){this.eachResidue(function(b){b.eachAtom(a)},b)},eachAtomN:function(a,b,c){for(var d=
this.residueCount,e=Array(a),f=0;f<a;++f)e[f]=this.structure.getAtomProxy(this.getAtomIndexByType(f,c));b.apply(this,e);for(var g=a;g<d;++g){for(f=1;f<a;++f)e[f-1].index=e[f].index;e[a-1].index=this.getAtomIndexByType(g,c);b.apply(this,e)}},eachAtomN2:function(a,b,c){var d=this.atomOffset,e=this.atomCount,f=d+e;if(!(e<a)){for(var g=Array(a),e=0;e<a;++e)g[e]=this.structure.getAtomProxy();var h=this.structure.atomSetCache["__"+c];void 0===h&&(NGL.warn("no precomputed atomSet for: "+c),h=this.structure.getAtomSet(!1),
this.eachResidue(function(a){a=a.getAtomByName(c);h.add_unsafe(a.index)}));var k=0;h.forEach(function(c){if(c>=d&&c<f){for(var e=1;e<a;++e)g[e-1].index=g[e].index;g[a-1].index=c;k+=1;k>=a&&b.apply(this,g)}})}},eachDirectionAtomsN:function(a,b){var c=2*a,d=this.atomOffset,e=this.atomCount,f=d+e;if(!(e<a)){for(var g=Array(c),e=0;e<c;++e)g[e]=this.structure.getAtomProxy();c=this.structure.atomSetCache.__direction1;e=this.structure.atomSetCache.__direction2;if(void 0===c||void 0===e)NGL.error("no precomputed atomSet for direction1 or direction2");
else{var h=0;TypedFastBitSet.forEach(function(c,e){if(c>=d&&c<f&&e>=d&&e<f){for(var m=1;m<a;++m)g[m-1].index=g[m].index,g[m-1+a].index=g[m+a].index;g[a-1].index=c;g[a-1+a].index=e;h+=1;h>=a&&b.apply(this,g)}},c,e)}}},eachResidue:function(a){for(var b=this.structure.getResidueProxy(),c=this.residueCount,d=this.residueIndexStart,e=0;e<c;++e)b.index=d+e,a(b)},qualifiedName:function(){var a=this.structure.getResidueProxy(this.residueIndexStart),b=this.structure.getResidueProxy(this.residueIndexEnd);return a.qualifiedName()+
" - "+b.qualifiedName()}};NGL.ChainProxy=function(a,b){this.structure=a;this.chainStore=a.chainStore;this.index=b};
NGL.ChainProxy.prototype={constructor:NGL.ChainProxy,type:"ChainProxy",structure:void 0,chainStore:void 0,index:void 0,get model(){return this.structure.getModelProxy(this.modelIndex)},get modelIndex(){return this.chainStore.modelIndex[this.index]},set modelIndex(a){this.chainStore.modelIndex[this.index]=a},get residueOffset(){return this.chainStore.residueOffset[this.index]},set residueOffset(a){this.chainStore.residueOffset[this.index]=a},get residueCount(){return this.chainStore.residueCount[this.index]},
set residueCount(a){this.chainStore.residueCount[this.index]=a},get chainname(){return this.chainStore.getChainname(this.index)},set chainname(a){this.chainStore.setChainname(this.index,a)},eachAtom:function(a,b){var c,d,e,f,g=this.residueCount;if(b&&b.residueOnlyTest)for(d=b.residueOnlyTest,c=0;c<g;++c)f=this.residues[c],d(f)&&f.eachAtom(a,b);else if(b&&(b.atomOnlyTest||""===this.chainname&&b.test))for(c=0;c<g;++c)f=this.residues[c],f.eachAtom(a,b);else for(c=0;c<g;++c)for(f=this.residues[c],e=f.atomCount,
d=0;d<e;++d)a(f.atoms[d])},eachAtom2:function(a,b){this.eachResidue(function(c){c.eachAtom2(a,b)},b)},eachResidue:function(a,b){var c=this.residueOffset,d=this.structure._rp,e=c+this.residueCount;if(b&&b.test){var f=b.residueOnlyTest;if(f)for(;c<e;++c)d.index=c,f(d)&&a(d,b);else for(;c<e;++c)d.index=c,a(d,b)}else for(;c<e;++c)d.index=c,a(d)},eachResidueN:function(a,b){var c=this.residueCount,d=this.residueOffset,e=d+c;if(!(c<a)){for(var c=Array(a),f=0;f<a;++f)c[f]=this.structure.getResidueProxy(d+
f);b.apply(this,c);for(d+=a;d<e;++d){for(f=0;f<a;++f)c[f].index+=1;b.apply(this,c)}}},eachPolymer:function(a,b){for(var c,d,e=b?b.residueOnlyTest:void 0,f=this.model.structure,g=this.residueOffset,h=g+this.residueCount,k=this.structure.getResidueProxy(),l=this.structure.getResidueProxy(g),m=this.structure.getAtomProxy(),n=this.structure.getAtomProxy(),q=!0,g=g+1;g<h;++g){k.index=l.index;l.index=g;q&&(c=k.index,q=!1);d=l.index;var p=q?k.backboneEndType:k.backboneType,r=l.backboneType;p!==NGL.UnknownBackboneType&&
p===r?(m.index=k.backboneEndAtomIndex,n.index=l.backboneStartAtomIndex,m&&n&&m.connectedTo(n)&&(!e||e(k)&&e(l))||(1<k.index-c&&a(new NGL.Polymer(f,c,k.index)),c=d)):(p!==NGL.UnknownBackboneType&&1<k.index-c&&a(new NGL.Polymer(f,c,k.index)),c=d)}1<d-c&&this.structure.getResidueProxy(c).backboneStartType&&a(new NGL.Polymer(f,c,d))},qualifiedName:function(){return":"+this.chainname+"/"+this.modelIndex},clone:function(){return new this.constructor(this.structure,this.index)},toObject:function(){return{index:this.index,
residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}};NGL.ModelProxy=function(a,b){this.structure=a;this.modelStore=a.modelStore;this.index=b};
NGL.ModelProxy.prototype={constructor:NGL.ModelProxy,type:"ModelProxy",structure:void 0,modelStore:void 0,index:void 0,get chainOffset(){return this.modelStore.chainOffset[this.index]},set chainOffset(a){this.modelStore.chainOffset[this.index]=a},get chainCount(){return this.modelStore.chainCount[this.index]},set chainCount(a){this.modelStore.chainCount[this.index]=a},eachAtom:function(a,b){if(b&&b.chainOnlyTest){var c=b.chainOnlyTest;this.chains.forEach(function(d){c(d)&&d.eachAtom(a,b)})}else this.chains.forEach(function(c){c.eachAtom(a,
b)})},eachAtom2:function(a,b){this.eachChain(function(c){c.eachAtom2(a,b)},b)},eachResidue:function(a,b){var c,d,e=this.chainCount;if(b&&b.chainOnlyTest){var f=b.chainOnlyTest;for(c=0;c<e;++c)d=this.chains[c],f(d)&&d.eachResidue(a,b)}else for(c=0;c<e;++c)d=this.chains[c],d.eachResidue(a,b)},eachPolymer:function(a,b){if(b&&b.chainOnlyTest){var c=b.chainOnlyTest;this.eachChain(function(d){c(d)&&d.eachPolymer(a,b)})}else this.eachChain(function(c){c.eachPolymer(a,b)})},eachChain:function(a,b){var c=
this.chainOffset,d=this.structure._cp,e=c+this.chainCount;if(b&&b.test){var f=b.chainOnlyTest;if(f)for(;c<e;++c)d.index=c,f(d)&&a(d,b);else for(;c<e;++c)d.index=c,a(d,b)}else for(;c<e;++c)d.index=c,a(d)},qualifiedName:function(){return"/"+this.index},clone:function(){return new this.constructor(this.structure,this.index)},toObject:function(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}};
NGL.AtomType=function(a,b,c){this.structure=a;c=c||NGL.guessElement(b);this.atomname=b;this.element=c;this.vdw=NGL.VdwRadii[c];this.covalent=NGL.CovalentRadii[c]};NGL.AtomType.prototype={constructor:NGL.AtomType,type:"AtomType",atomname:void 0,element:void 0,vdw:void 0,covalent:void 0,toJSON:function(){return{atomname:this.atomname,element:this.element}}};
NGL.AtomMap=function(a){var b={},c=[];this.add=function(d,e){e=e||NGL.guessElement(d);var f=d+"|"+e,g=b[f];if(void 0===g){var h=new NGL.AtomType(a,d,e),g=c.length;b[f]=g;c.push(h)}return g};this.get=function(a){return c[a]};this.list=c;this.dict=b;this.toJSON=function(){return{metadata:{version:.1,type:"AtomMap",generator:"AtomMapExporter"},idDict:b,typeList:c.map(function(a){return a.toJSON()})}};this.fromJSON=function(d){b=d.idDict;this.list=c=d.typeList.map(function(b){return new NGL.AtomType(a,
b.atomname,b.element)});this.dict=b}};
NGL.ResidueType=function(a,b,c,d){this.structure=a;this.resname=b;this.atomTypeIdList=c;this.hetero=d?1:0;this.atomCount=c.length;this.moleculeType=this.getMoleculeType();this.backboneType=this.getBackboneType(0);this.backboneEndType=this.getBackboneType(-1);this.backboneStartType=this.getBackboneType(1);this.backboneIndexList=this.getBackboneIndexList();c=NGL.Residue.atomnames;d=c[this.backboneType];a=c[this.backboneStartType];c=c[this.backboneEndType];var e=this.getAtomIndexByName(d.trace);this.traceAtomIndex=
void 0!==e?e:-1;e=this.getAtomIndexByName(d.direction1);this.direction1AtomIndex=void 0!==e?e:-1;d=this.getAtomIndexByName(d.direction2);this.direction2AtomIndex=void 0!==d?d:-1;a=this.getAtomIndexByName(a.backboneStart);this.backboneStartAtomIndex=void 0!==a?a:-1;a=this.getAtomIndexByName(c.backboneEnd);this.backboneEndAtomIndex=void 0!==a?a:-1;b=-1!==NGL.PurinBases.indexOf(b)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3");this.rungEndAtomIndex=void 0!==b?b:-1};
NGL.ResidueType.prototype={constructor:NGL.ResidueType,type:"ResidueType",resname:void 0,atomTypeIdList:void 0,atomCount:void 0,getBackboneIndexList:function(){var a=[],b;switch(this.moleculeType){case NGL.ProteinType:b=NGL.ProteinBackboneAtoms;break;case NGL.RnaType:case NGL.DnaType:b=NGL.NucleicBackboneAtoms;break;default:return a}for(var c=this.structure.atomMap,d=this.atomTypeIdList,e=0,f=this.atomCount;e<f;++e){var g=c.get(d[e]);-1!==b.indexOf(g.atomname)&&a.push(e)}return a},getMoleculeType:function(){return this.isProtein()?
NGL.ProteinType:this.isRna()?NGL.RnaType:this.isDna()?NGL.DnaType:this.isWater()?NGL.WaterType:this.isIon()?NGL.IonType:NGL.UnknownType},getBackboneType:function(a){return this.hasProteinBackbone(a)?NGL.ProteinBackboneType:this.hasRnaBackbone(a)?NGL.RnaBackboneType:this.hasDnaBackbone(a)?NGL.DnaBackboneType:this.hasCgProteinBackbone(a)?NGL.CgProteinBackboneType:this.hasCgRnaBackbone(a)?NGL.CgRnaBackboneType:this.hasCgDnaBackbone(a)?NGL.CgDnaBackboneType:NGL.UnknownBackboneType},isProtein:function(){return this.hasAtomWithName("CA",
"C","N")||-1!==NGL.AA3.indexOf(this.resname)},isCg:function(){var a=this.backboneType;return a===NGL.CgProteinBackboneType||a===NGL.CgRnaBackboneType||a===NGL.CgDnaBackboneType},isNucleic:function(){return this.isRna()||this.isDna()},isRna:function(){return-1!==NGL.RnaBases.indexOf(this.resname)},isDna:function(){return-1!==NGL.DnaBases.indexOf(this.resname)},isPolymer:function(){return this.isProtein()||this.isNucleic()},isHetero:function(){return 1===this.hetero},isIon:function(){return-1!==NGL.IonNames.indexOf(this.resname)},
isWater:function(){return-1!==NGL.WaterNames.indexOf(this.resname)},hasBackboneAtoms:function(a,b){var c=NGL.Residue.atomnames[b];return-1===a?this.hasAtomWithName(c.trace,c.backboneEnd,c.direction1,c.direction2):0===a?this.hasAtomWithName(c.trace,c.direction1,c.direction2):1===a?this.hasAtomWithName(c.trace,c.backboneStart,c.direction1,c.direction2):this.hasAtomWithName(c.trace,c.backboneStart,c.backboneEnd,c.direction1,c.direction2)},hasProteinBackbone:function(a){return this.isProtein()&&this.hasBackboneAtoms(a,
NGL.ProteinBackboneType)},hasRnaBackbone:function(a){return this.isRna()&&this.hasBackboneAtoms(a,NGL.RnaBackboneType)},hasDnaBackbone:function(a){return this.isDna()&&this.hasBackboneAtoms(a,NGL.DnaBackboneType)},hasCgProteinBackbone:function(a){return this.isProtein()&&this.hasBackboneAtoms(a,NGL.CgProteinBackboneType)},hasCgRnaBackbone:function(a){return this.isRna()&&this.hasBackboneAtoms(a,NGL.CgRnaBackboneType)},hasCgDnaBackbone:function(a){return this.isDna()&&this.hasBackboneAtoms(a,NGL.CgDnaBackboneType)},
hasBackbone:function(a){return this.hasProteinBackbone(a)||this.hasRnaBackbone(a)||this.hasDnaBackbone(a)||this.hasCgProteinBackbone(a)||this.hasCgRnaBackbone(a)||this.hasCgDnaBackbone(a)},getAtomIndexByName:function(a){var b=this.atomCount,c=this.structure.atomMap,d=this.atomTypeIdList;if(Array.isArray(a))for(var e=0;e<b;++e){var f=d[e];if(-1!==a.indexOf(c.get(f).atomname))return e}else for(e=0;e<b;++e)if(f=d[e],a===c.get(f).atomname)return e},hasAtomWithName:function(a){for(var b=arguments.length,
c=0;c<b;++c)if(void 0!==arguments[c]&&void 0===this.getAtomIndexByName(arguments[c]))return!1;return!0},getBonds:function(a){this.bonds||(this.bonds=NGL.calculateResidueBonds(a));return this.bonds},toJSON:function(){return{resname:this.resname,atomTypeIdList:this.atomTypeIdList,hetero:this.hetero}}};
NGL.ResidueMap=function(a){var b={},c=[];this.add=function(d,e,f){var g;g=d+"|"+e.join(",")+"|"+(f?1:0);var h=b[g];void 0===h&&(d=new NGL.ResidueType(a,d,e,f),h=c.length,b[g]=h,c.push(d));return h};this.get=function(a){return c[a]};this.list=c;this.dict=b;this.toJSON=function(){return{metadata:{version:.1,type:"ResidueMap",generator:"ResidueMapExporter"},idDict:b,typeList:c.map(function(a){return a.toJSON()})}};this.fromJSON=function(d){b=d.idDict;this.list=c=d.typeList.map(function(b){return new NGL.ResidueType(a,
b.resname,b.atomTypeIdList,b.hetero)});this.dict=b}};NGL.Store=function(a){void 0===a?this.init(0):Number.isInteger(a)?this.init(a):this.fromJSON(a)};
NGL.Store.prototype={constructor:NGL.Store,type:"Store",init:function(a){this.length=a;a=this.count=0;for(var b=this.__fields.length;a<b;++a){var c=this.__fields[a][0],d=this.__fields[a][2],e=this.length*this.__fields[a][1];switch(d){case "int8":this[c]=new Int8Array(e);break;case "int16":this[c]=new Int16Array(e);break;case "int32":this[c]=new Int32Array(e);break;case "uint8":this[c]=new Uint8Array(e);break;case "uint16":this[c]=new Uint16Array(e);break;case "uint32":this[c]=new Uint32Array(e);break;
case "float32":this[c]=new Float32Array(e);break;default:NGL.warn("arrayType unknown: "+d)}}},resize:function(a){this.length=Math.round(a||0);this.count=Math.min(this.count,this.length);a=0;for(var b=this.__fields.length;a<b;++a){var c=this.__fields[a][0],d=this.length*this.__fields[a][1],e=new this[c].constructor(d);this[c].length>d?e.set(this[c].subarray(0,d)):e.set(this[c]);this[c]=e}},growIfFull:function(){if(this.count>=this.length){var a=Math.round(1.5*this.length);this.resize(Math.max(256,
a))}},copyFrom:function(a,b,c,d){for(var e=0,f=this.__fields.length;e<f;++e)for(var g=this.__fields[e][0],h=this.__fields[e][1],k=this[g],g=a[g],l=0;l<d;++l)for(var m=h*(b+l),n=h*(c+l),q=0;q<h;++q)k[m+q]=g[n+q]},copyWithin:function(a,b,c){for(var d=0,e=this.__fields.length;d<e;++d)for(var f=this.__fields[d][1],g=this[this.__fields[d][0]],h=0;h<c;++h)for(var k=f*(a+h),l=f*(b+h),m=0;m<f;++m)g[k+m]=g[l+m]},sort:function(a){function b(e,f){if(e<f){var g=Math.floor((e+f)/2),h=e,k=f;do{for(;0>a(h,g);)h+=
1;for(;0<a(k,g);)--k;if(h<=k){h===g?g=k:k===g&&(g=h);var l=h,m=k;l!==m&&(d.copyFrom(c,0,l,1),c.copyWithin(l,m,1),c.copyFrom(d,m,0,1));h+=1;--k}}while(h<=k);b(e,k);b(h,f)}}NGL.time("NGL.Store.sort");var c=this,d=new this.constructor(1);b(0,this.count-1);NGL.timeEnd("NGL.Store.sort")},toJSON:function(){for(var a={metadata:{version:.1,type:this.type,generator:this.type+"Exporter"},length:this.length,count:this.count},b=0,c=this.__fields.length;b<c;++b){var d=this.__fields[b][0];a[d]=this[d]}return a},
fromJSON:function(a){this.length=a.length;this.count=a.count;for(var b=0,c=this.__fields.length;b<c;++b){var d=this.__fields[b][0];this[d]=a[d]}return this},getTransferable:function(){for(var a=[],b=0,c=this.__fields.length;b<c;++b)a.push(this[this.__fields[b][0]].buffer);return a},clear:function(){this.count=0},dispose:function(){delete this.length;delete this.count;for(var a=0,b=this.__fields.length;a<b;++a)delete this[this.__fields[a][0]]}};NGL.BondStore=function(a){NGL.Store.call(this,a)};
NGL.BondStore.prototype=NGL.createObject(NGL.Store.prototype,{constructor:NGL.BondStore,type:"BondStore",__fields:[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]],addBond:function(a,b,c){this.growIfFull();var d=this.count;this.atomIndex1[d]=a.index;this.atomIndex2[d]=b.index;this.bondOrder[d]=c;this.count+=1},addBondIfConnected:function(a,b,c){return a.connectedTo(b)?(this.addBond(a,b,c),!0):!1}});NGL.AtomStore=function(a){NGL.Store.call(this,a)};
NGL.AtomStore.prototype=NGL.createObject(NGL.Store.prototype,{constructor:NGL.AtomStore,type:"AtomStore",__fields:[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"]],setAltloc:function(a,b){this.altloc[a]=b.charCodeAt(0)},getAltloc:function(a){return(a=this.altloc[a])?String.fromCharCode(a):""}});NGL.ResidueStore=function(a){NGL.Store.call(this,a)};
NGL.ResidueStore.prototype=NGL.createObject(NGL.Store.prototype,{constructor:NGL.ResidueStore,type:"ResidueStore",__fields:[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint16"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"]],setSstruc:function(a,b){this.sstruc[a]=b.charCodeAt(0)},getSstruc:function(a){return(a=this.sstruc[a])?String.fromCharCode(a):""}});NGL.ChainStore=function(a){NGL.Store.call(this,a)};
NGL.ChainStore.prototype=NGL.createObject(NGL.Store.prototype,{constructor:NGL.ChainStore,type:"ChainStore",__fields:[["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"]],setChainname:function(a,b){var c=4*a;this.chainname[c]=b.charCodeAt(0);this.chainname[c+1]=b.charCodeAt(1);this.chainname[c+2]=b.charCodeAt(2);this.chainname[c+3]=b.charCodeAt(3)},getChainname:function(a){for(var b="",c=4*a,d=0;4>d;++d)if(a=this.chainname[c+d])b+=String.fromCharCode(a);
else break;return b}});NGL.ModelStore=function(a){NGL.Store.call(this,a)};NGL.ModelStore.prototype=NGL.createObject(NGL.Store.prototype,{constructor:NGL.ModelStore,type:"ModelStore",__fields:[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]});
NGL.Unitcell=function(a,b,c,d,e,f,g,h){this.a=a||1;this.b=b||1;this.c=c||1;this.alpha=d||90;this.beta=e||90;this.gamma=f||90;this.spacegroup=g||"P 1";d=THREE.Math.degToRad(this.alpha);f=THREE.Math.degToRad(this.beta);e=THREE.Math.degToRad(this.gamma);c=Math.cos(d);a=Math.cos(f);b=Math.cos(e);Math.sin(d);d=Math.sin(f);e=Math.sin(e);this.volume=this.a*this.b*this.c*Math.sqrt(1-c*c-a*a-b*b+2*c*a*b);void 0===h?(h=this.a*this.b*e/this.volume,c=(a*b-c)/(d*e),this.fracToCart=(new THREE.Matrix4).set(this.a,
0,0,0,this.b*b,this.b*e,0,0,this.c*a,-this.c*d*c,1/h,0,0,0,0,1).transpose(),this.cartToFrac=(new THREE.Matrix4).getInverse(this.fracToCart)):(this.cartToFrac=h,this.fracToCart=(new THREE.Matrix4).getInverse(this.cartToFrac))};
NGL.Unitcell.prototype={toJSON:function(){return{metadata:{version:.1,type:"Unitcell",generator:"UnitcellExporter"},a:this.a,b:this.b,c:this.c,alpha:this.alpha,beta:this.beta,gamma:this.gamma,spacegroup:this.spacegroup,volume:this.volume,cartToFrac:this.cartToFrac.toArray(),fracToCart:this.fracToCart.toArray()}},fromJSON:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.alpha=a.alpha;this.beta=a.beta;this.gamma=a.gamma;this.spacegroup=a.spacegroup;this.volume=a.volume;this.cartToFrac.fromArray(a.cartToFrac);
this.fracToCart.fromArray(a.fracToCart);return this}};
NGL.getSymmetryOperations=function(a){var b=NGL.SymOp[a],c={};if(void 0===b)return console.warn("NGL.getSymmetryOperations: spacegroup '"+a+"' not found in symop library"),c;var d=/^[1-9]$/;b.forEach(function(a){var b=a.split(","),g=0,h=(new THREE.Matrix4).set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),k=h.elements;c[a]=h;b.forEach(function(a){for(var b=!1,c=!1,e=0,f=a.length;e<f;++e){var h=a[e];"-"===h?b=!0:"+"===h?b=!1:"/"===h?c=!0:"X"===h?k[0+g]=b?-1:1:"Y"===h?k[4+g]=b?-1:1:"Z"===h?k[8+g]=b?-1:1:d.test(h)?
(h=parseInt(h),k[12+g]=c?k[12+g]/h:h):NGL.warn("NGL.getSymmetryOperations: unknown token '"+h+"'")}g+=1})});return c};
NGL.SymOp={"P 1":["X,Y,Z"],"P -1":["X,Y,Z","-X,-Y,-Z"],"P 1 2 1":["X,Y,Z","-X,Y,-Z"],"P 1 21 1":["X,Y,Z","-X,Y+1/2,-Z"],"C 1 2 1":["X,Y,Z","-X,Y,-Z","1/2+X,1/2+Y,Z","1/2-X,1/2+Y,-Z"],"P 1 m 1":["X,Y,Z","X,-Y,Z"],"P 1 c 1":["X,Y,Z","X,-Y,1/2+Z"],"C 1 m 1":["X,Y,Z","X,-Y,Z","1/2+X,1/2+Y,Z","1/2+X,1/2-Y,Z"],"C 1 c 1":["X,Y,Z","X,-Y,1/2+Z","1/2+X,1/2+Y,Z","1/2+X,1/2-Y,1/2+Z"],"P 1 2/m 1":["X,Y,Z","X,-Y,Z","-X,Y,-Z","-X,-Y,-Z"],"P 1 21/m 1":["X,Y,Z","-X,1/2+Y,-Z","-X,-Y,-Z","X,1/2-Y,Z"],"C 1 2/m 1":"X,Y,Z X,-Y,Z -X,Y,-Z -X,-Y,-Z 1/2+X,1/2+Y,Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2-X,1/2-Y,-Z".split(" "),
"P 1 2/c 1":["X,Y,Z","-X,Y,1/2-Z","-X,-Y,-Z","X,-Y,1/2+Z"],"P 1 21/c 1":["X,Y,Z","-X,-Y,-Z","-X,1/2+Y,1/2-Z","X,1/2-Y,1/2+Z"],"C 1 2/c 1":"X,Y,Z -X,Y,1/2-Z -X,-Y,-Z X,-Y,1/2+Z 1/2+X,1/2+Y,Z 1/2-X,1/2+Y,1/2-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2-Y,1/2+Z".split(" "),"P 2 2 2":["X,Y,Z","-X,-Y,Z","-X,Y,-Z","X,-Y,-Z"],"P 2 2 21":["X,Y,Z","-X,-Y,1/2+Z","-X,Y,1/2-Z","X,-Y,-Z"],"P 21 21 2":["X,Y,Z","-X,-Y,Z","1/2-X,1/2+Y,-Z","1/2+X,1/2-Y,-Z"],"P 21 21 21":["X,Y,Z","1/2-X,-Y,1/2+Z","-X,1/2+Y,1/2-Z","1/2+X,1/2-Y,-Z"],
"C 2 2 21":"X,Y,Z -X,-Y,1/2+Z -X,Y,1/2-Z X,-Y,-Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z".split(" "),"C 2 2 2":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z".split(" "),"F 2 2 2":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z".split(" "),"I 2 2 2":"X,Y,Z -X,-Y,Z X,-Y,-Z -X,Y,-Z X+1/2,Y+1/2,Z+1/2 -X+1/2,-Y+1/2,Z+1/2 X+1/2,-Y+1/2,-Z+1/2 -X+1/2,Y+1/2,-Z+1/2".split(" "),
"I 21 21 21":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,Y,-Z X,-Y,1/2-Z".split(" "),"P m m 2":["X,Y,Z","-X,-Y,Z","X,-Y,Z","-X,Y,Z"],"P m c 21":["X,Y,Z","-X,-Y,1/2+Z","X,-Y,1/2+Z","-X,Y,Z"],"P c c 2":["X,Y,Z","-X,-Y,Z","X,-Y,1/2+Z","-X,Y,1/2+Z"],"P m a 2":["X,Y,Z","-X,-Y,Z","1/2+X,-Y,Z","1/2-X,Y,Z"],"P c a 21":["X,Y,Z","-X,-Y,1/2+Z","1/2+X,-Y,Z","1/2-X,Y,1/2+Z"],"P n c 2":["X,Y,Z","-X,-Y,Z","X,1/2-Y,1/2+Z","-X,1/2+Y,1/2+Z"],"P m n 21":["X,Y,Z","1/2-X,-Y,1/2+Z",
"1/2+X,-Y,1/2+Z","-X,Y,Z"],"P b a 2":["X,Y,Z","-X,-Y,Z","1/2+X,1/2-Y,Z","1/2-X,1/2+Y,Z"],"P n a 21":["X,Y,Z","-X,-Y,1/2+Z","1/2+X,1/2-Y,Z","1/2-X,1/2+Y,1/2+Z"],"P n n 2":["X,Y,Z","-X,-Y,Z","1/2+X,1/2-Y,1/2+Z","1/2-X,1/2+Y,1/2+Z"],"C m m 2":"X,Y,Z -X,-Y,Z X,-Y,Z -X,Y,Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z".split(" "),"C m c 21":"X,Y,Z -X,-Y,1/2+Z X,-Y,1/2+Z -X,Y,Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,1/2+Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z".split(" "),"C c c 2":"X,Y,Z -X,-Y,Z X,-Y,1/2+Z -X,Y,1/2+Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),
"A m m 2":"X,Y,Z -X,-Y,Z X,-Y,Z -X,Y,Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z".split(" "),"A b m 2":"X,Y,Z -X,-Y,Z X,1/2-Y,Z -X,1/2+Y,Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z X,-Y,1/2+Z -X,Y,1/2+Z".split(" "),"A m a 2":"X,Y,Z -X,-Y,Z 1/2+X,-Y,Z 1/2-X,Y,Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),"A b a 2":"X,Y,Z -X,-Y,Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z 1/2+X,-Y,1/2+Z 1/2-X,Y,1/2+Z".split(" "),"F m m 2":"X,Y,Z -X,-Y,Z X,-Y,Z -X,Y,Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2+X,-Y,1/2+Z 1/2-X,Y,1/2+Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z".split(" "),
"F d d 2":"X,Y,Z -X,-Y,Z 1/4+X,1/4-Y,1/4+Z 1/4-X,1/4+Y,1/4+Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z 1/4+X,3/4-Y,3/4+Z 1/4-X,3/4+Y,3/4+Z 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 3/4+X,1/4-Y,3/4+Z 3/4-X,1/4+Y,3/4+Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 3/4+X,3/4-Y,1/4+Z 3/4-X,3/4+Y,1/4+Z".split(" "),"I m m 2":"X,Y,Z -X,-Y,Z X,-Y,Z -X,Y,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),"I b a 2":"X,Y,Z -X,-Y,Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z X,-Y,1/2+Z -X,Y,1/2+Z".split(" "),
"I m a 2":"X,Y,Z -X,-Y,Z 1/2+X,-Y,Z 1/2-X,Y,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z".split(" "),"P 2/m 2/m 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z".split(" "),"P 2/n 2/n 2/n":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),"P 2/c 2/c 2/m":"X,Y,Z -X,-Y,Z -X,Y,1/2-Z X,-Y,1/2-Z -X,-Y,-Z X,Y,-Z X,-Y,1/2+Z -X,Y,1/2+Z".split(" "),"P 2/b 2/a 2/n":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z".split(" "),
"P 21/m 2/m 2/a":"X,Y,Z 1/2-X,-Y,Z -X,Y,-Z 1/2+X,-Y,-Z -X,-Y,-Z 1/2+X,Y,-Z X,-Y,Z 1/2-X,Y,Z".split(" "),"P 2/n 21/n 2/a":"X,Y,Z 1/2-X,-Y,Z 1/2-X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z -X,-Y,-Z 1/2+X,Y,-Z 1/2+X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z".split(" "),"P 2/m 2/n 21/a":"X,Y,Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z X,-Y,-Z -X,-Y,-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z -X,Y,Z".split(" "),"P 21/c 2/c 2/a":"X,Y,Z 1/2-X,-Y,Z -X,Y,1/2-Z 1/2+X,-Y,1/2-Z -X,-Y,-Z 1/2+X,Y,-Z X,-Y,1/2+Z 1/2-X,Y,1/2+Z".split(" "),"P 21/b 21/a 2/m":"X,Y,Z -X,-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z -X,-Y,-Z X,Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z".split(" "),
"P 21/c 21/c 2/n":"X,Y,Z 1/2-X,1/2-Y,Z -X,1/2+Y,1/2-Z 1/2+X,-Y,1/2-Z -X,-Y,-Z 1/2+X,1/2+Y,-Z X,1/2-Y,1/2+Z 1/2-X,Y,1/2+Z".split(" "),"P 2/b 21/c 21/m":"X,Y,Z -X,-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,-Z -X,-Y,-Z X,Y,1/2-Z X,1/2-Y,1/2+Z -X,1/2+Y,Z".split(" "),"P 21/n 21/n 2/m":"X,Y,Z -X,-Y,Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z -X,-Y,-Z X,Y,-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),"P 21/m 21/m 2/n":"X,Y,Z -X,-Y,Z 1/2-X,Y+1/2,-Z X+1/2,1/2-Y,-Z 1/2-X,1/2-Y,-Z X+1/2,Y+1/2,-Z X,-Y,Z -X,Y,Z".split(" "),
"P 21/b 2/c 21/n":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -X,Y,1/2-Z 1/2+X,1/2-Y,-Z -X,-Y,-Z 1/2+X,1/2+Y,1/2-Z X,-Y,1/2+Z 1/2-X,1/2+Y,Z".split(" "),"P 21/b 21/c 21/a":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z -X,-Y,-Z 1/2+X,Y,1/2-Z X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z".split(" "),"P 21/n 21/m 21/a":"X,Y,Z -X+1/2,-Y,Z+1/2 -X,Y+1/2,-Z X+1/2,-Y+1/2,-Z+1/2 -X,-Y,-Z X+1/2,Y,-Z+1/2 X,-Y+1/2,Z -X+1/2,Y+1/2,Z+1/2".split(" "),"C 2/m 2/c 21/m":"X,Y,Z -X,-Y,1/2+Z -X,Y,1/2-Z X,-Y,-Z -X,-Y,-Z X,Y,1/2-Z X,-Y,1/2+Z -X,Y,Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z".split(" "),
"C 2/m 2/c 21/a":"X,Y,Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,-Y,-Z -X,-Y,-Z X,1/2+Y,1/2-Z X,1/2-Y,1/2+Z -X,Y,Z 1/2+X,1/2+Y,Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,1/2-Y,-Z 1/2-X,1/2-Y,-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z 1/2-X,1/2+Y,Z".split(" "),"C 2/m 2/m 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z".split(" "),"C 2/c 2/c 2/m":"X,Y,Z -X,-Y,Z -X,Y,1/2-Z X,-Y,1/2-Z -X,-Y,-Z X,Y,-Z X,-Y,1/2+Z -X,Y,1/2+Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),
"C 2/m 2/m 2/a":"X,Y,Z -X,1/2-Y,Z -X,1/2+Y,-Z X,-Y,-Z -X,-Y,-Z X,1/2+Y,-Z X,1/2-Y,Z -X,Y,Z 1/2+X,1/2+Y,Z 1/2-X,-Y,Z 1/2-X,Y,-Z 1/2+X,1/2-Y,-Z 1/2-X,1/2-Y,-Z 1/2+X,Y,-Z 1/2+X,-Y,Z 1/2-X,1/2+Y,Z".split(" "),"C 2/c 2/c 2/a":"X,Y,Z 1/2-X,1/2-Y,Z -X,Y,-Z 1/2+X,1/2-Y,-Z -X,1/2-Y,1/2-Z 1/2+X,Y,1/2-Z X,1/2-Y,1/2+Z 1/2-X,Y,1/2+Z 1/2+X,1/2+Y,Z -X,-Y,Z 1/2-X,1/2+Y,-Z X,-Y,-Z 1/2-X,-Y,1/2-Z X,1/2+Y,1/2-Z 1/2+X,-Y,1/2+Z -X,1/2+Y,1/2+Z".split(" "),"F 2/m 2/m 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z -X,1/2-Y,1/2-Z X,1/2+Y,1/2-Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2-X,-Y,1/2-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z 1/2-X,Y,1/2+Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z".split(" "),
"F 2/d 2/d 2/d":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z 1/4-X,1/4-Y,1/4-Z 1/4+X,1/4+Y,1/4-Z 1/4+X,1/4-Y,1/4+Z 1/4-X,1/4+Y,1/4+Z X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z 1/4-X,3/4-Y,3/4-Z 1/4+X,3/4+Y,3/4-Z 1/4+X,3/4-Y,3/4+Z 1/4-X,3/4+Y,3/4+Z 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 3/4-X,1/4-Y,3/4-Z 3/4+X,1/4+Y,3/4-Z 3/4+X,1/4-Y,3/4+Z 3/4-X,1/4+Y,3/4+Z 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 3/4-X,3/4-Y,1/4-Z 3/4+X,3/4+Y,1/4-Z 3/4+X,3/4-Y,1/4+Z 3/4-X,3/4+Y,1/4+Z".split(" "),
"I 2/m 2/m 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),"I 2/b 2/a 2/m":"X,Y,Z -X,-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z -X,-Y,-Z X,Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z -X,Y,1/2-Z X,-Y,1/2-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z X,-Y,1/2+Z -X,Y,1/2+Z".split(" "),"I 21/b 21/c 21/a":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z -X,-Y,-Z 1/2+X,Y,1/2-Z X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,Y,-Z X,-Y,1/2-Z 1/2-X,1/2-Y,1/2-Z X,1/2+Y,-Z 1/2+X,-Y,Z -X,Y,1/2+Z".split(" "),
"I 21/m 21/m 21/a":"X,Y,Z -X,1/2-Y,Z -X,1/2+Y,-Z X,-Y,-Z -X,-Y,-Z X,1/2+Y,-Z X,1/2-Y,Z -X,Y,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z".split(" "),"P 4":["X,Y,Z","-X,-Y,Z","-Y,X,Z","Y,-X,Z"],"P 41":["X,Y,Z","-X,-Y,1/2+Z","-Y,X,1/4+Z","Y,-X,3/4+Z"],"P 42":["X,Y,Z","-X,-Y,Z","-Y,X,1/2+Z","Y,-X,1/2+Z"],"P 43":["X,Y,Z","-X,-Y,1/2+Z","-Y,X,3/4+Z","Y,-X,1/4+Z"],"I 4":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z".split(" "),
"I 41":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z".split(" "),"P -4":["X,Y,Z","-X,-Y,Z","Y,-X,-Z","-Y,X,-Z"],"I -4":"X,Y,Z -X,-Y,Z Y,-X,-Z -Y,X,-Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z".split(" "),"P 4/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z".split(" "),"P 42/m":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z -X,-Y,-Z X,Y,-Z Y,-X,1/2-Z -Y,X,1/2-Z".split(" "),"P 4/n":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,Z 1/2+Y,1/2-X,Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z Y,-X,-Z -Y,X,-Z".split(" "),
"P 42/n":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z Y,-X,-Z -Y,X,-Z".split(" "),"I 4/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z".split(" "),"I 41/a":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z -X,1/2-Y,1/4-Z 1/2+X,Y,3/4-Z Y,-X,-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z 1/2-X,-Y,3/4-Z X,1/2+Y,1/4-Z 1/2+Y,1/2-X,1/2-Z -Y,X,-Z".split(" "),
"P 4 2 2":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,-Z X,-Y,-Z Y,X,-Z -Y,-X,-Z".split(" "),"P 4 21 2":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,Z 1/2+Y,1/2-X,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z Y,X,-Z -Y,-X,-Z".split(" "),"P 41 2 2":"X,Y,Z -X,-Y,1/2+Z -Y,X,1/4+Z Y,-X,3/4+Z -X,Y,-Z X,-Y,1/2-Z Y,X,3/4-Z -Y,-X,1/4-Z".split(" "),"P 41 21 2":"X,Y,Z -X,-Y,1/2+Z 1/2-Y,1/2+X,1/4+Z 1/2+Y,1/2-X,3/4+Z 1/2-X,1/2+Y,1/4-Z 1/2+X,1/2-Y,3/4-Z Y,X,-Z -Y,-X,1/2-Z".split(" "),"P 42 2 2":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z -X,Y,-Z X,-Y,-Z Y,X,1/2-Z -Y,-X,1/2-Z".split(" "),
"P 42 21 2":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z Y,X,-Z -Y,-X,-Z".split(" "),"P 43 2 2":"X,Y,Z -X,-Y,1/2+Z -Y,X,3/4+Z Y,-X,1/4+Z -X,Y,-Z X,-Y,1/2-Z Y,X,1/4-Z -Y,-X,3/4-Z".split(" "),"P 43 21 2":"X,Y,Z -X,-Y,1/2+Z 1/2-Y,1/2+X,3/4+Z 1/2+Y,1/2-X,1/4+Z 1/2-X,1/2+Y,3/4-Z 1/2+X,1/2-Y,1/4-Z Y,X,-Z -Y,-X,1/2-Z".split(" "),"I 4 2 2":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,-Z X,-Y,-Z Y,X,-Z -Y,-X,-Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z".split(" "),
"I 41 2 2":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z 1/2-X,Y,3/4-Z X,1/2-Y,1/4-Z 1/2+Y,1/2+X,1/2-Z -Y,-X,-Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z -X,1/2+Y,1/4-Z 1/2+X,-Y,3/4-Z Y,X,-Z 1/2-Y,1/2-X,1/2-Z".split(" "),"P 4 m m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z X,-Y,Z -X,Y,Z -Y,-X,Z Y,X,Z".split(" "),"P 4 b m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),"P 42 c m":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z X,-Y,1/2+Z -X,Y,1/2+Z -Y,-X,Z Y,X,Z".split(" "),
"P 42 n m":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z -Y,-X,Z Y,X,Z".split(" "),"P 4 c c":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z X,-Y,1/2+Z -X,Y,1/2+Z -Y,-X,1/2+Z Y,X,1/2+Z".split(" "),"P 4 n c":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"P 42 m c":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z X,-Y,Z -X,Y,Z -Y,-X,1/2+Z Y,X,1/2+Z".split(" "),"P 42 b c":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),
"I 4 m m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z X,-Y,Z -X,Y,Z -Y,-X,Z Y,X,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"I 4 c m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z X,-Y,1/2+Z -X,Y,1/2+Z -Y,-X,1/2+Z Y,X,1/2+Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),"I 41 m d":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z X,-Y,Z 1/2-X,1/2+Y,1/2+Z -Y,1/2-X,1/4+Z 1/2+Y,X,3/4+Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z 1/2+X,1/2-Y,1/2+Z -X,Y,Z 1/2-Y,-X,3/4+Z Y,1/2+X,1/4+Z".split(" "),
"I 41 c d":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z X,-Y,1/2+Z 1/2-X,1/2+Y,Z -Y,1/2-X,3/4+Z 1/2+Y,X,1/4+Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z 1/2+X,1/2-Y,Z -X,Y,1/2+Z 1/2-Y,-X,1/4+Z Y,1/2+X,3/4+Z".split(" "),"P -4 2 m":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z -X,Y,-Z X,-Y,-Z -Y,-X,Z Y,X,Z".split(" "),"P -4 2 c":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z -X,Y,1/2-Z X,-Y,1/2-Z -Y,-X,1/2+Z Y,X,1/2+Z".split(" "),"P -4 21 m":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),
"P -4 21 c":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"P -4 m 2":"X,Y,Z -X,-Y,Z Y,-X,-Z -Y,X,-Z X,-Y,Z -X,Y,Z Y,X,-Z -Y,-X,-Z".split(" "),"P -4 c 2":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z X,-Y,1/2+Z -X,Y,1/2+Z Y,X,1/2-Z -Y,-X,1/2-Z".split(" "),"P -4 b 2":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z".split(" "),"P -4 n 2":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z".split(" "),
"I -4 m 2":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z X,-Y,Z -X,Y,Z Y,X,-Z -Y,-X,-Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z".split(" "),"I -4 c 2":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z X,-Y,1/2+Z -X,Y,1/2+Z Y,X,1/2-Z -Y,-X,1/2-Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z".split(" "),"I -4 2 m":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z -X,Y,-Z X,-Y,-Z -Y,-X,Z Y,X,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),
"I -4 2 d":"X,Y,Z -X,-Y,Z -Y,X,-Z Y,-X,-Z 1/2-X,Y,3/4-Z 1/2+X,-Y,3/4-Z 1/2-Y,-X,3/4+Z 1/2+Y,X,3/4+Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z -X,1/2+Y,1/4-Z X,1/2-Y,1/4-Z -Y,1/2-X,1/4+Z Y,1/2+X,1/4+Z".split(" "),"P 4/m 2/m 2/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,-Z X,-Y,-Z Y,X,-Z -Y,-X,-Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z X,-Y,Z -X,Y,Z -Y,-X,Z Y,X,Z".split(" "),"P 4/m 2/c 2/c":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,1/2-Z X,-Y,1/2-Z Y,X,1/2-Z -Y,-X,1/2-Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z X,-Y,1/2+Z -X,Y,1/2+Z -Y,-X,1/2+Z Y,X,1/2+Z".split(" "),
"P 4/n 2/b 2/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,-Z X,-Y,-Z Y,X,-Z -Y,-X,-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+Y,1/2-X,-Z 1/2-Y,1/2+X,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),"P 4/n 2/n 2/c":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,-Z X,-Y,-Z Y,X,-Z -Y,-X,-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"P 4/m 21/b 2/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),
"P 4/m 21/n 2/c":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"P 4/n 21/m 2/m":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,Z 1/2+Y,1/2-X,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z Y,X,-Z -Y,-X,-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z Y,-X,-Z -Y,X,-Z X,-Y,Z -X,Y,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),"P 4/n 2/c 2/c":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,Z 1/2+Y,1/2-X,Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z Y,X,1/2-Z -Y,-X,1/2-Z 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z Y,-X,-Z -Y,X,-Z X,-Y,1/2+Z -X,Y,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),
"P 42/m 2/m 2/c":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z -X,Y,-Z X,-Y,-Z Y,X,1/2-Z -Y,-X,1/2-Z -X,-Y,-Z X,Y,-Z Y,-X,1/2-Z -Y,X,1/2-Z X,-Y,Z -X,Y,Z -Y,-X,1/2+Z Y,X,1/2+Z".split(" "),"P 42/m 2/c 2/m":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z -X,Y,1/2-Z X,-Y,1/2-Z Y,X,-Z -Y,-X,-Z -X,-Y,-Z X,Y,-Z Y,-X,1/2-Z -Y,X,1/2-Z X,-Y,1/2+Z -X,Y,1/2+Z -Y,-X,Z Y,X,Z".split(" "),"P 42/n 2/b 2/c":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z -X,Y,1/2-Z X,-Y,1/2-Z 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z Y,-X,-Z -Y,X,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z -Y,-X,1/2+Z Y,X,1/2+Z".split(" "),
"P 42/n 2/n 2/m":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z -X,Y,-Z X,-Y,-Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z Y,-X,-Z -Y,X,-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z -Y,-X,Z Y,X,Z".split(" "),"P 42/m 21/b 2/c":"X,Y,Z -X,-Y,Z -Y,X,1/2+Z Y,-X,1/2+Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z -X,-Y,-Z X,Y,-Z Y,-X,1/2-Z -Y,X,1/2-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"P 42/m 21/n 2/m":"X,Y,Z -X,-Y,Z 1/2-Y,X+1/2,Z+1/2 Y+1/2,1/2-X,Z+1/2 1/2-X,Y+1/2,1/2-Z X+1/2,1/2-Y,1/2-Z Y,X,-Z -Y,-X,-Z -X,-Y,-Z X,Y,-Z Y+1/2,1/2-X,1/2-Z 1/2-Y,X+1/2,1/2-Z X+1/2,1/2-Y,Z+1/2 1/2-X,Y+1/2,Z+1/2 -Y,-X,Z Y,X,Z".split(" "),
"P 42/n 21/m 2/c":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z Y,X,-Z -Y,-X,-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z Y,-X,-Z -Y,X,-Z X,-Y,Z -X,Y,Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),"P 42/n 21/c 2/m":"X,Y,Z -X,-Y,Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z Y,X,1/2-Z -Y,-X,1/2-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z Y,-X,-Z -Y,X,-Z X,-Y,1/2+Z -X,Y,1/2+Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),"I 4/m 2/m 2/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,-Z X,-Y,-Z Y,X,-Z -Y,-X,-Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z X,-Y,Z -X,Y,Z -Y,-X,Z Y,X,Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z".split(" "),
"I 4/m 2/c 2/m":"X,Y,Z -X,-Y,Z -Y,X,Z Y,-X,Z -X,Y,1/2-Z X,-Y,1/2-Z Y,X,1/2-Z -Y,-X,1/2-Z -X,-Y,-Z X,Y,-Z Y,-X,-Z -Y,X,-Z X,-Y,1/2+Z -X,Y,1/2+Z -Y,-X,1/2+Z Y,X,1/2+Z 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+Y,1/2-X,1/2+Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z".split(" "),"I 41/a 2/m 2/d":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z 1/2-X,Y,3/4-Z X,1/2-Y,1/4-Z 1/2+Y,1/2+X,1/2-Z -Y,-X,-Z -X,1/2-Y,1/4-Z 1/2+X,Y,3/4-Z Y,-X,-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2-Y,1/2+Z -X,Y,Z 1/2-Y,-X,3/4+Z Y,1/2+X,1/4+Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z -X,1/2+Y,1/4-Z 1/2+X,-Y,3/4-Z Y,X,-Z 1/2-Y,1/2-X,1/2-Z 1/2-X,-Y,3/4-Z X,1/2+Y,1/4-Z 1/2+Y,1/2-X,1/2-Z -Y,X,-Z X,-Y,Z 1/2-X,1/2+Y,1/2+Z -Y,1/2-X,1/4+Z 1/2+Y,X,3/4+Z".split(" "),
"I 41/a 2/c 2/d":"X,Y,Z 1/2-X,1/2-Y,1/2+Z -Y,1/2+X,1/4+Z 1/2+Y,-X,3/4+Z 1/2-X,Y,1/4-Z X,1/2-Y,3/4-Z 1/2+Y,1/2+X,-Z -Y,-X,1/2-Z -X,1/2-Y,1/4-Z 1/2+X,Y,3/4-Z Y,-X,-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2-Y,Z -X,Y,1/2+Z 1/2-Y,-X,1/4+Z Y,1/2+X,3/4+Z 1/2+X,1/2+Y,1/2+Z -X,-Y,Z 1/2-Y,X,3/4+Z Y,1/2-X,1/4+Z -X,1/2+Y,3/4-Z 1/2+X,-Y,1/4-Z Y,X,1/2-Z 1/2-Y,1/2-X,-Z 1/2-X,-Y,3/4-Z X,1/2+Y,1/4-Z 1/2+Y,1/2-X,1/2-Z -Y,X,-Z X,-Y,1/2+Z 1/2-X,1/2+Y,Z -Y,1/2-X,3/4+Z 1/2+Y,X,1/4+Z".split(" "),"P 3":["X,Y,Z","-Y,X-Y,Z","Y-X,-X,Z"],
"P 31":["X,Y,Z","-Y,X-Y,Z+1/3","Y-X,-X,Z+2/3"],"P 32":["X,Y,Z","-Y,X-Y,Z+2/3","Y-X,-X,Z+1/3"],"H 3":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z X+2/3,Y+1/3,Z+1/3 -Y+2/3,X-Y+1/3,Z+1/3 Y-X+2/3,-X+1/3,Z+1/3 X+1/3,Y+2/3,Z+2/3 -Y+1/3,X-Y+2/3,Z+2/3 Y-X+1/3,-X+2/3,Z+2/3".split(" "),"R 3":["X,Y,Z","Z,X,Y","Y,Z,X"],"P -3":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z".split(" "),"H -3":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z 2/3+X,1/3+Y,1/3+Z 2/3-Y,1/3+X-Y,1/3+Z 2/3+Y-X,1/3-X,1/3+Z 2/3-X,1/3-Y,1/3-Z 2/3+Y,1/3+Y-X,1/3-Z 2/3+X-Y,1/3+X,1/3-Z 1/3+X,2/3+Y,2/3+Z 1/3-Y,2/3+X-Y,2/3+Z 1/3+Y-X,2/3-X,2/3+Z 1/3-X,2/3-Y,2/3-Z 1/3+Y,2/3+Y-X,2/3-Z 1/3+X-Y,2/3+X,2/3-Z".split(" "),
"R -3":"X,Y,Z Z,X,Y Y,Z,X -X,-Y,-Z -Z,-X,-Y -Y,-Z,-X".split(" "),"P 3 1 2":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z".split(" "),"P 3 2 1":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z".split(" "),"P 31 1 2":"X,Y,Z -Y,X-Y,1/3+Z Y-X,-X,2/3+Z -Y,-X,2/3-Z Y-X,Y,1/3-Z X,X-Y,-Z".split(" "),"P 31 2 1":"X,Y,Z -Y,X-Y,Z+1/3 Y-X,-X,Z+2/3 Y,X,-Z X-Y,-Y,2/3-Z -X,Y-X,1/3-Z".split(" "),"P 32 1 2":"X,Y,Z -Y,X-Y,2/3+Z Y-X,-X,1/3+Z -Y,-X,1/3-Z Y-X,Y,2/3-Z X,X-Y,-Z".split(" "),"P 32 2 1":"X,Y,Z -Y,X-Y,Z+2/3 Y-X,-X,Z+1/3 Y,X,-Z X-Y,-Y,1/3-Z -X,Y-X,2/3-Z".split(" "),
"H 3 2":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z 2/3+X,1/3+Y,1/3+Z 2/3-Y,1/3+X-Y,1/3+Z 2/3+Y-X,1/3-X,1/3+Z 2/3+Y,1/3+X,1/3-Z 2/3+X-Y,1/3-Y,1/3-Z 2/3-X,1/3+Y-X,1/3-Z 1/3+X,2/3+Y,2/3+Z 1/3-Y,2/3+X-Y,2/3+Z 1/3+Y-X,2/3-X,2/3+Z 1/3+Y,2/3+X,2/3-Z 1/3+X-Y,2/3-Y,2/3-Z 1/3-X,2/3+Y-X,2/3-Z".split(" "),"R 3 2":"X,Y,Z Z,X,Y Y,Z,X -Y,-X,-Z -X,-Z,-Y -Z,-Y,-X".split(" "),"P 3 m 1":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z".split(" "),"P 3 1 m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),
"P 3 c 1":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z".split(" "),"P 3 1 c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),"H 3 m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z 2/3+X,1/3+Y,1/3+Z 2/3-Y,1/3+X-Y,1/3+Z 2/3+Y-X,1/3-X,1/3+Z 2/3-Y,1/3-X,1/3+Z 2/3+Y-X,1/3+Y,1/3+Z 2/3+X,1/3+X-Y,1/3+Z 1/3+X,2/3+Y,2/3+Z 1/3-Y,2/3+X-Y,2/3+Z 1/3+Y-X,2/3-X,2/3+Z 1/3-Y,2/3-X,2/3+Z 1/3+Y-X,2/3+Y,2/3+Z 1/3+X,2/3+X-Y,2/3+Z".split(" "),"R 3 m":"X,Y,Z Z,X,Y Y,Z,X Y,X,Z X,Z,Y Z,Y,X".split(" "),
"H 3 c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z 2/3+X,1/3+Y,1/3+Z 2/3-Y,1/3+X-Y,1/3+Z 2/3+Y-X,1/3-X,1/3+Z 2/3-Y,1/3-X,5/6+Z 2/3+Y-X,1/3+Y,5/6+Z 2/3+X,1/3+X-Y,5/6+Z 1/3+X,2/3+Y,2/3+Z 1/3-Y,2/3+X-Y,2/3+Z 1/3+Y-X,2/3-X,2/3+Z 1/3-Y,2/3-X,1/6+Z 1/3+Y-X,2/3+Y,1/6+Z 1/3+X,2/3+X-Y,1/6+Z".split(" "),"R 3 c":"X,Y,Z Z,X,Y Y,Z,X Y+1/2,X+1/2,Z+1/2 X+1/2,Z+1/2,Y+1/2 Z+1/2,Y+1/2,X+1/2".split(" "),"P -3 1 2/m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),
"P -3 1 2/c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -Y,-X,1/2-Z Y-X,Y,1/2-Z X,X-Y,1/2-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),"P -3 2/m 1":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z".split(" "),"P -3 2/c 1":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,1/2-Z X-Y,-Y,1/2-Z -X,Y-X,1/2-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z".split(" "),"H -3 2/m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z 2/3+X,1/3+Y,1/3+Z 2/3-Y,1/3+X-Y,1/3+Z 2/3+Y-X,1/3-X,1/3+Z 2/3+Y,1/3+X,1/3-Z 2/3+X-Y,1/3-Y,1/3-Z 2/3-X,1/3+Y-X,1/3-Z 2/3-X,1/3-Y,1/3-Z 2/3+Y,1/3+Y-X,1/3-Z 2/3+X-Y,1/3+X,1/3-Z 2/3-Y,1/3-X,1/3+Z 2/3+Y-X,1/3+Y,1/3+Z 2/3+X,1/3+X-Y,1/3+Z 1/3+X,2/3+Y,2/3+Z 1/3-Y,2/3+X-Y,2/3+Z 1/3+Y-X,2/3-X,2/3+Z 1/3+Y,2/3+X,2/3-Z 1/3+X-Y,2/3-Y,2/3-Z 1/3-X,2/3+Y-X,2/3-Z 1/3-X,2/3-Y,2/3-Z 1/3+Y,2/3+Y-X,2/3-Z 1/3+X-Y,2/3+X,2/3-Z 1/3-Y,2/3-X,2/3+Z 1/3+Y-X,2/3+Y,2/3+Z 1/3+X,2/3+X-Y,2/3+Z".split(" "),
"R -3 2/m":"X,Y,Z Z,X,Y Y,Z,X -Y,-X,-Z -X,-Z,-Y -Z,-Y,-X -X,-Y,-Z -Z,-X,-Y -Y,-Z,-X Y,X,Z X,Z,Y Z,Y,X".split(" "),"H -3 2/c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z Y,X,1/2-Z X-Y,-Y,1/2-Z -X,Y-X,1/2-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z 2/3+X,1/3+Y,1/3+Z 2/3-Y,1/3+X-Y,1/3+Z 2/3+Y-X,1/3-X,1/3+Z 2/3+Y,1/3+X,5/6-Z 2/3+X-Y,1/3-Y,5/6-Z 2/3-X,1/3+Y-X,5/6-Z 2/3-X,1/3-Y,1/3-Z 2/3+Y,1/3+Y-X,1/3-Z 2/3+X-Y,1/3+X,1/3-Z 2/3-Y,1/3-X,5/6+Z 2/3+Y-X,1/3+Y,5/6+Z 2/3+X,1/3+X-Y,5/6+Z 1/3+X,2/3+Y,2/3+Z 1/3-Y,2/3+X-Y,2/3+Z 1/3+Y-X,2/3-X,2/3+Z 1/3+Y,2/3+X,1/6-Z 1/3+X-Y,2/3-Y,1/6-Z 1/3-X,2/3+Y-X,1/6-Z 1/3-X,2/3-Y,2/3-Z 1/3+Y,2/3+Y-X,2/3-Z 1/3+X-Y,2/3+X,2/3-Z 1/3-Y,2/3-X,1/6+Z 1/3+Y-X,2/3+Y,1/6+Z 1/3+X,2/3+X-Y,1/6+Z".split(" "),
"R -3 2/c":"X,Y,Z Z,X,Y Y,Z,X -Y+1/2,-X+1/2,-Z+1/2 -X+1/2,-Z+1/2,-Y+1/2 -Z+1/2,-Y+1/2,-X+1/2 -X,-Y,-Z -Z,-X,-Y -Y,-Z,-X Y+1/2,X+1/2,Z+1/2 X+1/2,Z+1/2,Y+1/2 Z+1/2,Y+1/2,X+1/2".split(" "),"P 6":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z".split(" "),"P 61":"X,Y,Z -Y,X-Y,Z+1/3 Y-X,-X,Z+2/3 -X,-Y,Z+1/2 Y,Y-X,Z+5/6 X-Y,X,Z+1/6".split(" "),"P 65":"X,Y,Z -Y,X-Y,Z+2/3 Y-X,-X,Z+1/3 -X,-Y,Z+1/2 Y,Y-X,Z+1/6 X-Y,X,Z+5/6".split(" "),"P 62":"X,Y,Z -Y,X-Y,2/3+Z Y-X,-X,1/3+Z -X,-Y,Z Y,Y-X,2/3+Z X-Y,X,1/3+Z".split(" "),
"P 64":"X,Y,Z -Y,X-Y,1/3+Z Y-X,-X,2/3+Z -X,-Y,Z Y,Y-X,1/3+Z X-Y,X,2/3+Z".split(" "),"P 63":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z".split(" "),"P -6":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z X,Y,-Z -Y,X-Y,-Z Y-X,-X,-Z".split(" "),"P 6/m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z X,Y,-Z -Y,X-Y,-Z Y-X,-X,-Z".split(" "),"P 63/m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z X,Y,1/2-Z -Y,X-Y,1/2-Z Y-X,-X,1/2-Z".split(" "),
"P 6 2 2":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z".split(" "),"P 61 2 2":"X,Y,Z -Y,X-Y,1/3+Z Y-X,-X,2/3+Z -X,-Y,1/2+Z Y,Y-X,5/6+Z X-Y,X,1/6+Z Y,X,1/3-Z X-Y,-Y,-Z -X,Y-X,2/3-Z -Y,-X,5/6-Z Y-X,Y,1/2-Z X,X-Y,1/6-Z".split(" "),"P 65 2 2":"X,Y,Z -Y,X-Y,2/3+Z Y-X,-X,1/3+Z -X,-Y,1/2+Z Y,Y-X,1/6+Z X-Y,X,5/6+Z Y,X,2/3-Z X-Y,-Y,-Z -X,Y-X,1/3-Z -Y,-X,1/6-Z Y-X,Y,1/2-Z X,X-Y,5/6-Z".split(" "),"P 62 2 2":"X,Y,Z -Y,X-Y,2/3+Z Y-X,-X,1/3+Z -X,-Y,Z Y,Y-X,2/3+Z X-Y,X,1/3+Z Y,X,2/3-Z X-Y,-Y,-Z -X,Y-X,1/3-Z -Y,-X,2/3-Z Y-X,Y,-Z X,X-Y,1/3-Z".split(" "),
"P 64 2 2":"X,Y,Z -Y,X-Y,1/3+Z Y-X,-X,2/3+Z -X,-Y,Z Y,Y-X,1/3+Z X-Y,X,2/3+Z Y,X,1/3-Z X-Y,-Y,-Z -X,Y-X,2/3-Z -Y,-X,1/3-Z Y-X,Y,-Z X,X-Y,2/3-Z".split(" "),"P 63 2 2":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z -Y,-X,1/2-Z Y-X,Y,1/2-Z X,X-Y,1/2-Z".split(" "),"P 6 m m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),"P 6 c c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),
"P 63 c m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),"P 63 m c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),"P -6 m 2":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z X,Y,-Z -Y,X-Y,-Z Y-X,-X,-Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z".split(" "),"P -6 c 2":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z X,Y,1/2-Z -Y,X-Y,1/2-Z Y-X,-X,1/2-Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z".split(" "),
"P -6 2 m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z X,Y,-Z -Y,X-Y,-Z Y-X,-X,-Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),"P -6 2 c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z X,Y,1/2-Z -Y,X-Y,1/2-Z Y-X,-X,1/2-Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),"P 6/m 2/m 2/m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z X,Y,-Z Y-X,-X,-Z -Y,X-Y,-Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),
"P 6/m 2/c 2/c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,Z Y,Y-X,Z X-Y,X,Z Y,X,1/2-Z X-Y,-Y,1/2-Z -X,Y-X,1/2-Z -Y,-X,1/2-Z Y-X,Y,1/2-Z X,X-Y,1/2-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z X,Y,-Z Y-X,-X,-Z -Y,X-Y,-Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),"P 63/m 2/c 2/m":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z Y,X,1/2-Z X-Y,-Y,1/2-Z -X,Y-X,1/2-Z -Y,-X,-Z Y-X,Y,-Z X,X-Y,-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z X,Y,1/2-Z Y-X,-X,1/2-Z -Y,X-Y,1/2-Z -Y,-X,1/2+Z Y-X,Y,1/2+Z X,X-Y,1/2+Z Y,X,Z X-Y,-Y,Z -X,Y-X,Z".split(" "),
"P 63/m 2/m 2/c":"X,Y,Z -Y,X-Y,Z Y-X,-X,Z -X,-Y,1/2+Z Y,Y-X,1/2+Z X-Y,X,1/2+Z Y,X,-Z X-Y,-Y,-Z -X,Y-X,-Z -Y,-X,1/2-Z Y-X,Y,1/2-Z X,X-Y,1/2-Z -X,-Y,-Z Y,Y-X,-Z X-Y,X,-Z X,Y,1/2-Z Y-X,-X,1/2-Z -Y,X-Y,1/2-Z -Y,-X,Z Y-X,Y,Z X,X-Y,Z Y,X,1/2+Z X-Y,-Y,1/2+Z -X,Y-X,1/2+Z".split(" "),"P 2 3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X".split(" "),"F 2 3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X".split(" "),
"I 2 3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y 1/2+Z,1/2-X,1/2-Y 1/2-Z,1/2-X,1/2+Y 1/2-Z,1/2+X,1/2-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,1/2-X 1/2-Y,1/2-Z,1/2+X".split(" "),"P 21 3":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X".split(" "),
"I 21 3":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,Y,-Z X,-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y Z,-X,1/2-Y -Z,1/2-X,Y 1/2-Z,X,-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,Z,-X Y,-Z,1/2-X -Y,1/2-Z,X".split(" "),"P 2/m -3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X".split(" "),
"P 2/n -3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Z,1/2-X,1/2-Y 1/2-Z,1/2+X,1/2+Y 1/2+Z,1/2+X,1/2-Y 1/2+Z,1/2-X,1/2+Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,1/2+X 1/2+Y,1/2+Z,1/2-X".split(" "),"F 2/m -3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X -X,1/2-Y,1/2-Z X,1/2+Y,1/2-Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z -Z,1/2-X,1/2-Y -Z,1/2+X,1/2+Y Z,1/2+X,1/2-Y Z,1/2-X,1/2+Y -Y,1/2-Z,1/2-X Y,1/2-Z,1/2+X -Y,1/2+Z,1/2+X Y,1/2+Z,1/2-X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X 1/2-X,-Y,1/2-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z 1/2-X,Y,1/2+Z 1/2-Z,-X,1/2-Y 1/2-Z,X,1/2+Y 1/2+Z,X,1/2-Y 1/2+Z,-X,1/2+Y 1/2-Y,-Z,1/2-X 1/2+Y,-Z,1/2+X 1/2-Y,Z,1/2+X 1/2+Y,Z,1/2-X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Z,1/2-X,-Y 1/2-Z,1/2+X,Y 1/2+Z,1/2+X,-Y 1/2+Z,1/2-X,Y 1/2-Y,1/2-Z,-X 1/2+Y,1/2-Z,X 1/2-Y,1/2+Z,X 1/2+Y,1/2+Z,-X".split(" "),
"F 2/d -3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/4-X,1/4-Y,1/4-Z 1/4+X,1/4+Y,1/4-Z 1/4+X,1/4-Y,1/4+Z 1/4-X,1/4+Y,1/4+Z 1/4-Z,1/4-X,1/4-Y 1/4-Z,1/4+X,1/4+Y 1/4+Z,1/4+X,1/4-Y 1/4+Z,1/4-X,1/4+Y 1/4-Y,1/4-Z,1/4-X 1/4+Y,1/4-Z,1/4+X 1/4-Y,1/4+Z,1/4+X 1/4+Y,1/4+Z,1/4-X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X 1/4-X,3/4-Y,3/4-Z 1/4+X,3/4+Y,3/4-Z 1/4+X,3/4-Y,3/4+Z 1/4-X,3/4+Y,3/4+Z 1/4-Z,3/4-X,3/4-Y 1/4-Z,3/4+X,3/4+Y 1/4+Z,3/4+X,3/4-Y 1/4+Z,3/4-X,3/4+Y 1/4-Y,3/4-Z,3/4-X 1/4+Y,3/4-Z,3/4+X 1/4-Y,3/4+Z,3/4+X 1/4+Y,3/4+Z,3/4-X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X 3/4-X,1/4-Y,3/4-Z 3/4+X,1/4+Y,3/4-Z 3/4+X,1/4-Y,3/4+Z 3/4-X,1/4+Y,3/4+Z 3/4-Z,1/4-X,3/4-Y 3/4-Z,1/4+X,3/4+Y 3/4+Z,1/4+X,3/4-Y 3/4+Z,1/4-X,3/4+Y 3/4-Y,1/4-Z,3/4-X 3/4+Y,1/4-Z,3/4+X 3/4-Y,1/4+Z,3/4+X 3/4+Y,1/4+Z,3/4-X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X 3/4-X,3/4-Y,1/4-Z 3/4+X,3/4+Y,1/4-Z 3/4+X,3/4-Y,Z+1/4 3/4-X,3/4+Y,Z+1/4 3/4-Z,3/4-X,1/4-Y 3/4-Z,3/4+X,1/4+Y 3/4+Z,3/4+X,1/4-Y 3/4+Z,3/4-X,1/4+Y 3/4-Y,3/4-Z,1/4-X 3/4+Y,3/4-Z,1/4+X 3/4-Y,3/4+Z,1/4+X 3/4+Y,3/4+Z,1/4-X".split(" "),
"I 2/m -3":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y 1/2+Z,1/2-X,1/2-Y 1/2-Z,1/2-X,1/2+Y 1/2-Z,1/2+X,1/2-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,1/2-X 1/2-Y,1/2-Z,1/2+X 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Z,1/2-X,1/2-Y 1/2-Z,1/2+X,1/2+Y 1/2+Z,1/2+X,1/2-Y 1/2+Z,1/2-X,1/2+Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,1/2+X 1/2+Y,1/2+Z,1/2-X".split(" "),
"P 21/a -3":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X -X,-Y,-Z 1/2+X,Y,1/2-Z X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z -Z,-X,-Y 1/2-Z,1/2+X,Y 1/2+Z,X,1/2-Y Z,1/2-X,1/2+Y -Y,-Z,-X Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,X 1/2+Y,Z,1/2-X".split(" "),"I 21/a -3":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X -X,-Y,-Z 1/2+X,Y,1/2-Z X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z -Z,-X,-Y 1/2-Z,1/2+X,Y 1/2+Z,X,1/2-Y Z,1/2-X,1/2+Y -Y,-Z,-X Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,X 1/2+Y,Z,1/2-X 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,+Y,-Z X,-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y Z,-X,1/2-Y -Z,1/2-X,Y 1/2-Z,X,-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,Z,-X Y,-Z,1/2-X -Y,1/2-Z,X 1/2-X,1/2-Y,1/2-Z X,1/2+Y,-Z 1/2+X,-Y,Z -X,Y,1/2+Z 1/2-Z,1/2-X,1/2-Y -Z,X,1/2+Y Z,1/2+X,-Y 1/2+Z,-X,Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,-Z,X -Y,Z,1/2+X Y,1/2+Z,-X".split(" "),
"P 4 3 2":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X".split(" "),"P 42 3 2":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2+Y,1/2-X,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+X,1/2+Z,1/2-Y 1/2-X,1/2+Z,1/2+Y 1/2-X,1/2-Z,1/2-Y 1/2+X,1/2-Z,1/2+Y 1/2+Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2+X 1/2-Z,1/2-Y,1/2-X".split(" "),
"F 4 3 2":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X Y,1/2+X,1/2-Z -Y,1/2-X,1/2-Z Y,1/2-X,1/2+Z -Y,1/2+X,1/2+Z X,1/2+Z,1/2-Y -X,1/2+Z,1/2+Y -X,1/2-Z,1/2-Y X,1/2-Z,1/2+Y Z,1/2+Y,1/2-X Z,1/2-Y,1/2+X -Z,1/2+Y,1/2+X -Z,1/2-Y,1/2-X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X 1/2+Y,X,1/2-Z 1/2-Y,-X,1/2-Z 1/2+Y,-X,1/2+Z 1/2-Y,X,1/2+Z 1/2+X,Z,1/2-Y 1/2-X,Z,1/2+Y 1/2-X,-Z,1/2-Y 1/2+X,-Z,1/2+Y 1/2+Z,Y,1/2-X 1/2+Z,-Y,1/2+X 1/2-Z,Y,1/2+X 1/2-Z,-Y,1/2-X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z 1/2+Y,1/2-X,Z 1/2-Y,1/2+X,Z 1/2+X,1/2+Z,-Y 1/2-X,1/2+Z,Y 1/2-X,1/2-Z,-Y 1/2+X,1/2-Z,Y 1/2+Z,1/2+Y,-X 1/2+Z,1/2-Y,X 1/2-Z,1/2+Y,X 1/2-Z,1/2-Y,-X".split(" "),
"F 41 3 2":"X,Y,Z -X,1/2-Y,1/2+Z 1/2-X,1/2+Y,-Z 1/2+X,-Y,1/2-Z Z,X,Y 1/2+Z,-X,1/2-Y -Z,1/2-X,1/2+Y 1/2-Z,1/2+X,-Y Y,Z,X 1/2-Y,1/2+Z,-X 1/2+Y,-Z,1/2-X -Y,1/2-Z,1/2+X 3/4+Y,1/4+X,3/4-Z 1/4-Y,1/4-X,1/4-Z 1/4+Y,3/4-X,3/4+Z 3/4-Y,3/4+X,1/4+Z 3/4+X,1/4+Z,3/4-Y 3/4-X,3/4+Z,1/4+Y 1/4-X,1/4-Z,1/4-Y 1/4+X,3/4-Z,3/4+Y 3/4+Z,1/4+Y,3/4-X 1/4+Z,3/4-Y,3/4+X 3/4-Z,3/4+Y,1/4+X 1/4-Z,1/4-Y,1/4-X X,1/2+Y,1/2+Z -X,-Y,Z 1/2-X,Y,1/2-Z 1/2+X,1/2-Y,-Z Z,1/2+X,1/2+Y 1/2+Z,1/2-X,-Y -Z,-X,Y 1/2-Z,X,1/2-Y Y,1/2+Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,1/2-Z,-X -Y,-Z,X 3/4+Y,3/4+X,1/4-Z 1/4-Y,3/4-X,3/4-Z 1/4+Y,1/4-X,1/4+Z 3/4-Y,1/4+X,3/4+Z 3/4+X,3/4+Z,1/4-Y 3/4-X,1/4+Z,3/4+Y 1/4-X,3/4-Z,3/4-Y 1/4+X,1/4-Z,1/4+Y 3/4+Z,3/4+Y,1/4-X 1/4+Z,1/4-Y,1/4+X 3/4-Z,1/4+Y,3/4+X 1/4-Z,3/4-Y,3/4-X 1/2+X,Y,1/2+Z 1/2-X,1/2-Y,Z -X,1/2+Y,1/2-Z X,-Y,-Z 1/2+Z,X,1/2+Y Z,-X,-Y 1/2-Z,1/2-X,Y -Z,1/2+X,1/2-Y 1/2+Y,Z,1/2+X -Y,1/2+Z,1/2-X Y,-Z,-X 1/2-Y,1/2-Z,X 1/4+Y,1/4+X,1/4-Z 3/4-Y,1/4-X,3/4-Z 3/4+Y,3/4-X,1/4+Z 1/4-Y,3/4+X,3/4+Z 1/4+X,1/4+Z,1/4-Y 1/4-X,3/4+Z,3/4+Y 3/4-X,1/4-Z,3/4-Y 3/4+X,3/4-Z,1/4+Y 1/4+Z,1/4+Y,1/4-X 3/4+Z,3/4-Y,1/4+X 1/4-Z,3/4+Y,3/4+X 3/4-Z,1/4-Y,3/4-X 1/2+X,1/2+Y,Z 1/2-X,-Y,1/2+Z -X,Y,-Z X,1/2-Y,1/2-Z 1/2+Z,1/2+X,Y Z,1/2-X,1/2-Y 1/2-Z,-X,1/2+Y -Z,X,-Y 1/2+Y,1/2+Z,X -Y,Z,-X Y,1/2-Z,1/2-X 1/2-Y,-Z,1/2+X 1/4+Y,3/4+X,3/4-Z 3/4-Y,3/4-X,1/4-Z 3/4+Y,1/4-X,3/4+Z 1/4-Y,1/4+X,1/4+Z 1/4+X,3/4+Z,3/4-Y 1/4-X,1/4+Z,1/4+Y 3/4-X,3/4-Z,1/4-Y 3/4+X,1/4-Z,3/4+Y 1/4+Z,3/4+Y,3/4-X 3/4+Z,1/4-Y,3/4+X 1/4-Z,1/4+Y,1/4+X 3/4-Z,3/4-Y,1/4-X".split(" "),
"I 4 3 2":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y 1/2+Z,1/2-X,1/2-Y 1/2-Z,1/2-X,1/2+Y 1/2-Z,1/2+X,1/2-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,1/2-X 1/2-Y,1/2-Z,1/2+X 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2+Y,1/2-X,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+X,1/2+Z,1/2-Y 1/2-X,1/2+Z,1/2+Y 1/2-X,1/2-Z,1/2-Y 1/2+X,1/2-Z,1/2+Y 1/2+Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2+X 1/2-Z,1/2-Y,1/2-X".split(" "),
"P 43 3 2":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X 1/4+Y,3/4+X,3/4-Z 1/4-Y,1/4-X,1/4-Z 3/4+Y,3/4-X,1/4+Z 3/4-Y,1/4+X,3/4+Z 1/4+X,3/4+Z,3/4-Y 3/4-X,1/4+Z,3/4+Y 1/4-X,1/4-Z,1/4-Y 3/4+X,3/4-Z,1/4+Y 1/4+Z,3/4+Y,3/4-X 3/4+Z,3/4-Y,1/4+X 3/4-Z,1/4+Y,3/4+X 1/4-Z,1/4-Y,1/4-X".split(" "),"P 41 3 2":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X 3/4+Y,1/4+X,1/4-Z 3/4-Y,3/4-X,3/4-Z 1/4+Y,1/4-X,3/4+Z 1/4-Y,3/4+X,1/4+Z 3/4+X,1/4+Z,1/4-Y 1/4-X,3/4+Z,1/4+Y 3/4-X,3/4-Z,3/4-Y 1/4+X,1/4-Z,3/4+Y 3/4+Z,1/4+Y,1/4-X 1/4+Z,1/4-Y,3/4+X 1/4-Z,3/4+Y,1/4+X 3/4-Z,3/4-Y,3/4-X".split(" "),
"I 41 3 2":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X 3/4+Y,1/4+X,1/4-Z 3/4-Y,3/4-X,3/4-Z 1/4+Y,1/4-X,3/4+Z 1/4-Y,3/4+X,1/4+Z 3/4+X,1/4+Z,1/4-Y 1/4-X,3/4+Z,1/4+Y 3/4-X,3/4-Z,3/4-Y 1/4+X,1/4-Z,3/4+Y 3/4+Z,1/4+Y,1/4-X 1/4+Z,1/4-Y,3/4+X 1/4-Z,3/4+Y,1/4+X 3/4-Z,3/4-Y,3/4-X 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,Y,-Z X,-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y Z,-X,1/2-Y -Z,1/2-X,Y 1/2-Z,X,-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,Z,-X Y,-Z,1/2-X -Y,1/2-Z,X 1/4+Y,3/4+X,3/4-Z 1/4-Y,1/4-X,1/4-Z 3/4+Y,3/4-X,1/4+Z 3/4-Y,1/4+X,3/4+Z 1/4+X,3/4+Z,3/4-Y 3/4-X,1/4+Z,3/4+Y 1/4-X,1/4-Z,1/4-Y 3/4+X,3/4-Z,1/4+Y 1/4+Z,3/4+Y,3/4-X 3/4+Z,3/4-Y,1/4+X 3/4-Z,1/4+Y,3/4+X 1/4-Z,1/4-Y,1/4-X".split(" "),
"P -4 3 m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,Z -Y,-X,Z Y,-X,-Z -Y,X,-Z X,Z,Y -X,Z,-Y -X,-Z,Y X,-Z,-Y Z,Y,X Z,-Y,-X -Z,Y,-X -Z,-Y,X".split(" "),"F -4 3 m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,Z -Y,-X,Z Y,-X,-Z -Y,X,-Z X,Z,Y -X,Z,-Y -X,-Z,Y X,-Z,-Y Z,Y,X Z,-Y,-X -Z,Y,-X -Z,-Y,X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X Y,1/2+X,1/2+Z -Y,1/2-X,1/2+Z Y,1/2-X,1/2-Z -Y,1/2+X,1/2-Z X,1/2+Z,1/2+Y -X,1/2+Z,1/2-Y -X,1/2-Z,1/2+Y X,1/2-Z,1/2-Y Z,1/2+Y,1/2+X Z,1/2-Y,1/2-X -Z,1/2+Y,1/2-X -Z,1/2-Y,1/2+X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X 1/2+Y,X,1/2+Z 1/2-Y,-X,1/2+Z 1/2+Y,-X,1/2-Z 1/2-Y,X,1/2-Z 1/2+X,Z,1/2+Y 1/2-X,Z,1/2-Y 1/2-X,-Z,1/2+Y 1/2+X,-Z,1/2-Y 1/2+Z,Y,1/2+X 1/2+Z,-Y,1/2-X 1/2-Z,Y,1/2-X 1/2-Z,-Y,1/2+X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X 1/2+Y,1/2+X,Z 1/2-Y,1/2-X,Z 1/2+Y,1/2-X,-Z 1/2-Y,1/2+X,-Z 1/2+X,1/2+Z,Y 1/2-X,1/2+Z,-Y 1/2-X,1/2-Z,Y 1/2+X,1/2-Z,-Y 1/2+Z,1/2+Y,X 1/2+Z,1/2-Y,-X 1/2-Z,1/2+Y,-X 1/2-Z,1/2-Y,X".split(" "),
"I -4 3 m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,Z -Y,-X,Z Y,-X,-Z -Y,X,-Z X,Z,Y -X,Z,-Y -X,-Z,Y X,-Z,-Y Z,Y,X Z,-Y,-X -Z,Y,-X -Z,-Y,X 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y 1/2+Z,1/2-X,1/2-Y 1/2-Z,1/2-X,1/2+Y 1/2-Z,1/2+X,1/2-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,1/2-X 1/2-Y,1/2-Z,1/2+X 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+Z,1/2+Y,1/2+X 1/2+Z,1/2-Y,1/2-X 1/2-Z,1/2+Y,1/2-X 1/2-Z,1/2-Y,1/2+X".split(" "),
"P -4 3 n":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+Z,1/2+Y,1/2+X 1/2+Z,1/2-Y,1/2-X 1/2-Z,1/2+Y,1/2-X 1/2-Z,1/2-Y,1/2+X".split(" "),"F -4 3 c":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2-X,1/2-Z 1/2-Y,1/2+X,1/2-Z 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+Z,1/2+Y,1/2+X 1/2+Z,1/2-Y,1/2-X 1/2-Z,1/2+Y,1/2-X 1/2-Z,1/2-Y,1/2+X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X 1/2+Y,X,Z 1/2-Y,-X,Z 1/2+Y,-X,-Z 1/2-Y,X,-Z 1/2+X,Z,Y 1/2-X,Z,-Y 1/2-X,-Z,Y 1/2+X,-Z,-Y 1/2+Z,Y,X 1/2+Z,-Y,-X 1/2-Z,Y,-X 1/2-Z,-Y,X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X Y,1/2+X,Z -Y,1/2-X,Z Y,1/2-X,-Z -Y,1/2+X,-Z X,1/2+Z,Y -X,1/2+Z,-Y -X,1/2-Z,Y X,1/2-Z,-Y Z,1/2+Y,X Z,1/2-Y,-X -Z,1/2+Y,-X -Z,1/2-Y,X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X Y,X,1/2+Z -Y,-X,1/2+Z Y,-X,1/2-Z -Y,X,1/2-Z X,Z,1/2+Y -X,Z,1/2-Y -X,-Z,1/2+Y X,-Z,1/2-Y Z,Y,1/2+X Z,-Y,1/2-X -Z,Y,1/2-X -Z,-Y,1/2+X".split(" "),
"I -4 3 d":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X 1/4+Y,1/4+X,1/4+Z 1/4-Y,3/4-X,3/4+Z 3/4+Y,1/4-X,3/4-Z 3/4-Y,3/4+X,1/4-Z 1/4+X,1/4+Z,1/4+Y 3/4-X,3/4+Z,1/4-Y 1/4-X,3/4-Z,3/4+Y 3/4+X,1/4-Z,3/4-Y 1/4+Z,1/4+Y,1/4+X 3/4+Z,1/4-Y,3/4-X 3/4-Z,3/4+Y,1/4-X 1/4-Z,3/4-Y,3/4+X 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,Y,-Z X,-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y Z,-X,1/2-Y -Z,1/2-X,Y 1/2-Z,X,-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,Z,-X Y,-Z,1/2-X -Y,1/2-Z,X 3/4+Y,3/4+X,3/4+Z 3/4-Y,1/4-X,1/4+Z 1/4+Y,3/4-X,1/4-Z 1/4-Y,1/4+X,3/4-Z 3/4+X,3/4+Z,3/4+Y 1/4-X,1/4+Z,3/4-Y 3/4-X,1/4-Z,1/4+Y 1/4+X,3/4-Z,1/4-Y 3/4+Z,3/4+Y,3/4+X 1/4+Z,3/4-Y,1/4-X 1/4-Z,1/4+Y,3/4-X 3/4-Z,1/4-Y,1/4+X".split(" "),
"P 4/m -3 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X -Y,-X,Z Y,X,Z -Y,X,-Z Y,-X,-Z -X,-Z,Y X,-Z,-Y X,Z,Y -X,Z,-Y -Z,-Y,X -Z,Y,-X Z,-Y,-X Z,Y,X".split(" "),"P 4/n -3 2/n":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Z,1/2-X,1/2-Y 1/2-Z,1/2+X,1/2+Y 1/2+Z,1/2+X,1/2-Y 1/2+Z,1/2-X,1/2+Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,1/2+X 1/2+Y,1/2+Z,1/2-X 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2-X 1/2+Z,1/2+Y,1/2+X".split(" "),
"P 42/m -3 2/n":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2+Y,1/2-X,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+X,1/2+Z,1/2-Y 1/2-X,1/2+Z,1/2+Y 1/2-X,1/2-Z,1/2-Y 1/2+X,1/2-Z,1/2+Y 1/2+Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2+X 1/2-Z,1/2-Y,1/2-X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2-X 1/2+Z,1/2+Y,1/2+X".split(" "),
"P 42/n -3 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2+Y,1/2-X,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+X,1/2+Z,1/2-Y 1/2-X,1/2+Z,1/2+Y 1/2-X,1/2-Z,1/2-Y 1/2+X,1/2-Z,1/2+Y 1/2+Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2+X 1/2-Z,1/2-Y,1/2-X 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Z,1/2-X,1/2-Y 1/2-Z,1/2+X,1/2+Y 1/2+Z,1/2+X,1/2-Y 1/2+Z,1/2-X,1/2+Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,1/2+X 1/2+Y,1/2+Z,1/2-X -Y,-X,Z Y,X,Z -Y,X,-Z Y,-X,-Z -X,-Z,Y X,-Z,-Y X,Z,Y -X,Z,-Y -Z,-Y,X -Z,Y,-X Z,-Y,-X Z,Y,X".split(" "),
"F 4/m -3 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X -Y,-X,Z Y,X,Z -Y,X,-Z Y,-X,-Z -X,-Z,Y X,-Z,-Y X,Z,Y -X,Z,-Y -Z,-Y,X -Z,Y,-X Z,-Y,-X Z,Y,X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X Y,1/2+X,1/2-Z -Y,1/2-X,1/2-Z Y,1/2-X,1/2+Z -Y,1/2+X,1/2+Z X,1/2+Z,1/2-Y -X,1/2+Z,1/2+Y -X,1/2-Z,1/2-Y X,1/2-Z,1/2+Y Z,1/2+Y,1/2-X Z,1/2-Y,1/2+X -Z,1/2+Y,1/2+X -Z,1/2-Y,1/2-X -X,1/2-Y,1/2-Z X,1/2+Y,1/2-Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z -Z,1/2-X,1/2-Y -Z,1/2+X,1/2+Y Z,1/2+X,1/2-Y Z,1/2-X,1/2+Y -Y,1/2-Z,1/2-X Y,1/2-Z,1/2+X -Y,1/2+Z,1/2+X Y,1/2+Z,1/2-X -Y,1/2-X,1/2+Z Y,1/2+X,1/2+Z -Y,1/2+X,1/2-Z Y,1/2-X,1/2-Z -X,1/2-Z,1/2+Y X,1/2-Z,1/2-Y X,1/2+Z,1/2+Y -X,1/2+Z,1/2-Y -Z,1/2-Y,1/2+X -Z,1/2+Y,1/2-X Z,1/2-Y,1/2-X Z,1/2+Y,1/2+X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X 1/2+Y,X,1/2-Z 1/2-Y,-X,1/2-Z 1/2+Y,-X,1/2+Z 1/2-Y,X,1/2+Z 1/2+X,Z,1/2-Y 1/2-X,Z,1/2+Y 1/2-X,-Z,1/2-Y 1/2+X,-Z,1/2+Y 1/2+Z,Y,1/2-X 1/2+Z,-Y,1/2+X 1/2-Z,Y,1/2+X 1/2-Z,-Y,1/2-X 1/2-X,-Y,1/2-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z 1/2-X,Y,1/2+Z 1/2-Z,-X,1/2-Y 1/2-Z,X,1/2+Y 1/2+Z,X,1/2-Y 1/2+Z,-X,1/2+Y 1/2-Y,-Z,1/2-X 1/2+Y,-Z,1/2+X 1/2-Y,Z,1/2+X 1/2+Y,Z,1/2-X 1/2-Y,-X,1/2+Z 1/2+Y,X,1/2+Z 1/2-Y,X,1/2-Z 1/2+Y,-X,1/2-Z 1/2-X,-Z,1/2+Y 1/2+X,-Z,1/2-Y 1/2+X,Z,1/2+Y 1/2-X,Z,1/2-Y 1/2-Z,-Y,1/2+X 1/2-Z,Y,1/2-X 1/2+Z,-Y,1/2-X 1/2+Z,Y,1/2+X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X 1/2+Y,1/2+X,-Z 1/2-Y,1/2-X,-Z 1/2+Y,1/2-X,Z 1/2-Y,1/2+X,Z 1/2+X,1/2+Z,-Y 1/2-X,1/2+Z,Y 1/2-X,1/2-Z,-Y 1/2+X,1/2-Z,Y 1/2+Z,1/2+Y,-X 1/2+Z,1/2-Y,X 1/2-Z,1/2+Y,X 1/2-Z,1/2-Y,-X 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Z,1/2-X,-Y 1/2-Z,1/2+X,Y 1/2+Z,1/2+X,-Y 1/2+Z,1/2-X,Y 1/2-Y,1/2-Z,-X 1/2+Y,1/2-Z,X 1/2-Y,1/2+Z,X 1/2+Y,1/2+Z,-X 1/2-Y,1/2-X,Z 1/2+Y,1/2+X,Z 1/2-Y,1/2+X,-Z 1/2+Y,1/2-X,-Z 1/2-X,1/2-Z,Y 1/2+X,1/2-Z,-Y 1/2+X,1/2+Z,Y 1/2-X,1/2+Z,-Y 1/2-Z,1/2-Y,X 1/2-Z,1/2+Y,-X 1/2+Z,1/2-Y,-X 1/2+Z,1/2+Y,X".split(" "),
"F 4/m -3 2/c":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2+Y,1/2-X,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+X,1/2+Z,1/2-Y 1/2-X,1/2+Z,1/2+Y 1/2-X,1/2-Z,1/2-Y 1/2+X,1/2-Z,1/2+Y 1/2+Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2+X 1/2-Z,1/2-Y,1/2-X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2-X 1/2+Z,1/2+Y,1/2+X X,1/2+Y,1/2+Z -X,1/2-Y,1/2+Z -X,1/2+Y,1/2-Z X,1/2-Y,1/2-Z Z,1/2+X,1/2+Y Z,1/2-X,1/2-Y -Z,1/2-X,1/2+Y -Z,1/2+X,1/2-Y Y,1/2+Z,1/2+X -Y,1/2+Z,1/2-X Y,1/2-Z,1/2-X -Y,1/2-Z,1/2+X 1/2+Y,X,-Z 1/2-Y,-X,-Z 1/2+Y,-X,Z 1/2-Y,X,Z 1/2+X,Z,-Y 1/2-X,Z,Y 1/2-X,-Z,-Y 1/2+X,-Z,Y 1/2+Z,Y,-X 1/2+Z,-Y,X 1/2-Z,Y,X 1/2-Z,-Y,-X -X,1/2-Y,1/2-Z X,1/2+Y,1/2-Z X,1/2-Y,1/2+Z -X,1/2+Y,1/2+Z -Z,1/2-X,1/2-Y -Z,1/2+X,1/2+Y Z,1/2+X,1/2-Y Z,1/2-X,1/2+Y -Y,1/2-Z,1/2-X Y,1/2-Z,1/2+X -Y,1/2+Z,1/2+X Y,1/2+Z,1/2-X 1/2-Y,-X,Z 1/2+Y,X,Z 1/2-Y,X,-Z 1/2+Y,-X,-Z 1/2-X,-Z,Y 1/2+X,-Z,-Y 1/2+X,Z,Y 1/2-X,Z,-Y 1/2-Z,-Y,X 1/2-Z,Y,-X 1/2+Z,-Y,-X 1/2+Z,Y,X 1/2+X,Y,1/2+Z 1/2-X,-Y,1/2+Z 1/2-X,Y,1/2-Z 1/2+X,-Y,1/2-Z 1/2+Z,X,1/2+Y 1/2+Z,-X,1/2-Y 1/2-Z,-X,1/2+Y 1/2-Z,X,1/2-Y 1/2+Y,Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,-Z,1/2-X 1/2-Y,-Z,1/2+X Y,1/2+X,-Z -Y,1/2-X,-Z Y,1/2-X,Z -Y,1/2+X,Z X,1/2+Z,-Y -X,1/2+Z,Y -X,1/2-Z,-Y X,1/2-Z,Y Z,1/2+Y,-X Z,1/2-Y,X -Z,1/2+Y,X -Z,1/2-Y,-X 1/2-X,-Y,1/2-Z 1/2+X,Y,1/2-Z 1/2+X,-Y,1/2+Z 1/2-X,Y,1/2+Z 1/2-Z,-X,1/2-Y 1/2-Z,X,1/2+Y 1/2+Z,X,1/2-Y 1/2+Z,-X,1/2+Y 1/2-Y,-Z,1/2-X 1/2+Y,-Z,1/2+X 1/2-Y,Z,1/2+X 1/2+Y,Z,1/2-X -Y,1/2-X,Z Y,1/2+X,Z -Y,1/2+X,-Z Y,1/2-X,-Z -X,1/2-Z,Y X,1/2-Z,-Y X,1/2+Z,Y -X,1/2+Z,-Y -Z,1/2-Y,X -Z,1/2+Y,-X Z,1/2-Y,-X Z,1/2+Y,X 1/2+X,1/2+Y,Z 1/2-X,1/2-Y,Z 1/2-X,1/2+Y,-Z 1/2+X,1/2-Y,-Z 1/2+Z,1/2+X,Y 1/2+Z,1/2-X,-Y 1/2-Z,1/2-X,Y 1/2-Z,1/2+X,-Y 1/2+Y,1/2+Z,X 1/2-Y,1/2+Z,-X 1/2+Y,1/2-Z,-X 1/2-Y,1/2-Z,X Y,X,1/2-Z -Y,-X,1/2-Z Y,-X,1/2+Z -Y,X,1/2+Z X,Z,1/2-Y -X,Z,1/2+Y -X,-Z,1/2-Y X,-Z,1/2+Y Z,Y,1/2-X Z,-Y,1/2+X -Z,Y,1/2+X -Z,-Y,1/2-X 1/2-X,1/2-Y,-Z 1/2+X,1/2+Y,-Z 1/2+X,1/2-Y,Z 1/2-X,1/2+Y,Z 1/2-Z,1/2-X,-Y 1/2-Z,1/2+X,Y 1/2+Z,1/2+X,-Y 1/2+Z,1/2-X,Y 1/2-Y,1/2-Z,-X 1/2+Y,1/2-Z,X 1/2-Y,1/2+Z,X 1/2+Y,1/2+Z,-X -Y,-X,1/2+Z Y,X,1/2+Z -Y,X,1/2-Z Y,-X,1/2-Z -X,-Z,1/2+Y X,-Z,1/2-Y X,Z,1/2+Y -X,Z,1/2-Y -Z,-Y,1/2+X -Z,Y,1/2-X Z,-Y,1/2-X Z,Y,1/2+X".split(" "),
"F 41/d -3 2/m":"X,Y,Z -X,1/2-Y,1/2+Z 1/2-X,1/2+Y,-Z 1/2+X,-Y,1/2-Z Z,X,Y 1/2+Z,-X,1/2-Y -Z,1/2-X,1/2+Y 1/2-Z,1/2+X,-Y Y,Z,X 1/2-Y,1/2+Z,-X 1/2+Y,-Z,1/2-X -Y,1/2-Z,1/2+X 3/4+Y,1/4+X,3/4-Z 1/4-Y,1/4-X,1/4-Z 1/4+Y,3/4-X,3/4+Z 3/4-Y,3/4+X,1/4+Z 3/4+X,1/4+Z,3/4-Y 3/4-X,3/4+Z,1/4+Y 1/4-X,1/4-Z,1/4-Y 1/4+X,3/4-Z,3/4+Y 3/4+Z,1/4+Y,3/4-X 1/4+Z,3/4-Y,3/4+X 3/4-Z,3/4+Y,1/4+X 1/4-Z,1/4-Y,1/4-X 1/4-X,1/4-Y,1/4-Z 1/4+X,3/4+Y,3/4-Z 3/4+X,3/4-Y,1/4+Z 3/4-X,1/4+Y,3/4+Z 1/4-Z,1/4-X,1/4-Y 3/4-Z,1/4+X,3/4+Y 1/4+Z,3/4+X,3/4-Y 3/4+Z,3/4-X,1/4+Y 1/4-Y,1/4-Z,1/4-X 3/4+Y,3/4-Z,1/4+X 3/4-Y,1/4+Z,3/4+X 1/4+Y,3/4+Z,3/4-X 1/2-Y,-X,1/2+Z Y,X,Z -Y,1/2+X,1/2-Z 1/2+Y,1/2-X,-Z 1/2-X,-Z,1/2+Y 1/2+X,1/2-Z,-Y X,Z,Y -X,1/2+Z,1/2-Y 1/2-Z,-Y,1/2+X -Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,-X Z,Y,X X,1/2+Y,1/2+Z -X,-Y,Z 1/2-X,Y,1/2-Z 1/2+X,1/2-Y,-Z Z,1/2+X,1/2+Y 1/2+Z,1/2-X,-Y -Z,-X,Y 1/2-Z,X,1/2-Y Y,1/2+Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,1/2-Z,-X -Y,-Z,X 3/4+Y,3/4+X,1/4-Z 1/4-Y,3/4-X,3/4-Z 1/4+Y,1/4-X,1/4+Z 3/4-Y,1/4+X,3/4+Z 3/4+X,3/4+Z,1/4-Y 3/4-X,1/4+Z,3/4+Y 1/4-X,3/4-Z,3/4-Y 1/4+X,1/4-Z,1/4+Y 3/4+Z,3/4+Y,1/4-X 1/4+Z,1/4-Y,1/4+X 3/4-Z,1/4+Y,3/4+X 1/4-Z,3/4-Y,3/4-X 1/4-X,3/4-Y,3/4-Z 1/4+X,1/4+Y,1/4-Z 3/4+X,1/4-Y,3/4+Z 3/4-X,3/4+Y,1/4+Z 1/4-Z,3/4-X,3/4-Y 3/4-Z,3/4+X,1/4+Y 1/4+Z,1/4+X,1/4-Y 3/4+Z,1/4-X,3/4+Y 1/4-Y,3/4-Z,3/4-X 3/4+Y,1/4-Z,3/4+X 3/4-Y,3/4+Z,1/4+X 1/4+Y,1/4+Z,1/4-X 1/2-Y,1/2-X,Z Y,1/2+X,1/2+Z -Y,X,-Z 1/2+Y,-X,1/2-Z 1/2-X,1/2-Z,Y 1/2+X,-Z,1/2-Y X,1/2+Z,1/2+Y -X,Z,-Y 1/2-Z,1/2-Y,X -Z,Y,-X 1/2+Z,-Y,1/2-X Z,1/2+Y,1/2+X 1/2+X,Y,1/2+Z 1/2-X,1/2-Y,Z -X,1/2+Y,1/2-Z X,-Y,-Z 1/2+Z,X,1/2+Y Z,-X,-Y 1/2-Z,1/2-X,Y -Z,1/2+X,1/2-Y 1/2+Y,Z,1/2+X -Y,1/2+Z,1/2-X Y,-Z,-X 1/2-Y,1/2-Z,X 1/4+Y,1/4+X,1/4-Z 3/4-Y,1/4-X,3/4-Z 3/4+Y,3/4-X,1/4+Z 1/4-Y,3/4+X,3/4+Z 1/4+X,1/4+Z,1/4-Y 1/4-X,3/4+Z,3/4+Y 3/4-X,1/4-Z,3/4-Y 3/4+X,3/4-Z,1/4+Y 1/4+Z,1/4+Y,1/4-X 3/4+Z,3/4-Y,1/4+X 1/4-Z,3/4+Y,3/4+X 3/4-Z,1/4-Y,3/4-X 3/4-X,1/4-Y,3/4-Z 3/4+X,3/4+Y,1/4-Z 1/4+X,3/4-Y,3/4+Z 1/4-X,1/4+Y,1/4+Z 3/4-Z,1/4-X,3/4-Y 1/4-Z,1/4+X,1/4+Y 3/4+Z,3/4+X,1/4-Y 1/4+Z,3/4-X,3/4+Y 3/4-Y,1/4-Z,3/4-X 1/4+Y,3/4-Z,3/4+X 1/4-Y,1/4+Z,1/4+X 3/4+Y,3/4+Z,1/4-X -Y,-X,Z 1/2+Y,X,1/2+Z 1/2-Y,1/2+X,-Z Y,1/2-X,1/2-Z -X,-Z,Y X,1/2-Z,1/2-Y 1/2+X,Z,1/2+Y 1/2-X,1/2+Z,-Y -Z,-Y,X 1/2-Z,1/2+Y,-X Z,1/2-Y,1/2-X 1/2+Z,Y,1/2+X 1/2+X,1/2+Y,Z 1/2-X,-Y,1/2+Z -X,Y,-Z X,1/2-Y,1/2-Z 1/2+Z,1/2+X,Y Z,1/2-X,1/2-Y 1/2-Z,-X,1/2+Y -Z,X,-Y 1/2+Y,1/2+Z,X -Y,Z,-X Y,1/2-Z,1/2-X 1/2-Y,-Z,1/2+X 1/4+Y,3/4+X,3/4-Z 3/4-Y,3/4-X,1/4-Z 3/4+Y,1/4-X,3/4+Z 1/4-Y,1/4+X,1/4+Z 1/4+X,3/4+Z,3/4-Y 1/4-X,1/4+Z,1/4+Y 3/4-X,3/4-Z,1/4-Y 3/4+X,1/4-Z,3/4+Y 1/4+Z,3/4+Y,3/4-X 3/4+Z,1/4-Y,3/4+X 1/4-Z,1/4+Y,1/4+X 3/4-Z,3/4-Y,1/4-X 3/4-X,3/4-Y,1/4-Z 3/4+X,1/4+Y,3/4-Z 1/4+X,1/4-Y,1/4+Z 1/4-X,3/4+Y,3/4+Z 3/4-Z,3/4-X,1/4-Y 1/4-Z,3/4+X,3/4+Y 3/4+Z,1/4+X,3/4-Y 1/4+Z,1/4-X,1/4+Y 3/4-Y,3/4-Z,1/4-X 1/4+Y,1/4-Z,1/4+X 1/4-Y,3/4+Z,3/4+X 3/4+Y,1/4+Z,3/4-X -Y,1/2-X,1/2+Z 1/2+Y,1/2+X,Z 1/2-Y,X,1/2-Z Y,-X,-Z -X,1/2-Z,1/2+Y X,-Z,-Y 1/2+X,1/2+Z,Y 1/2-X,Z,1/2-Y -Z,1/2-Y,1/2+X 1/2-Z,Y,1/2-X Z,-Y,-X 1/2+Z,1/2+Y,X".split(" "),
"F 41/d -3 2/c":"X,Y,Z -X,1/2-Y,1/2+Z 1/2-X,1/2+Y,-Z 1/2+X,-Y,1/2-Z Z,X,Y 1/2+Z,-X,1/2-Y -Z,1/2-X,1/2+Y 1/2-Z,1/2+X,-Y Y,Z,X 1/2-Y,1/2+Z,-X 1/2+Y,-Z,1/2-X -Y,1/2-Z,1/2+X 3/4+Y,1/4+X,3/4-Z 1/4-Y,1/4-X,1/4-Z 1/4+Y,3/4-X,3/4+Z 3/4-Y,3/4+X,1/4+Z 3/4+X,1/4+Z,3/4-Y 3/4-X,3/4+Z,1/4+Y 1/4-X,1/4-Z,1/4-Y 1/4+X,3/4-Z,3/4+Y 3/4+Z,1/4+Y,3/4-X 1/4+Z,3/4-Y,3/4+X 3/4-Z,3/4+Y,1/4+X 1/4-Z,1/4-Y,1/4-X 3/4-X,3/4-Y,3/4-Z 3/4+X,1/4+Y,1/4-Z 1/4+X,1/4-Y,3/4+Z 1/4-X,3/4+Y,1/4+Z 3/4-Z,3/4-X,3/4-Y 1/4-Z,3/4+X,1/4+Y 3/4+Z,1/4+X,1/4-Y 1/4+Z,1/4-X,3/4+Y 3/4-Y,3/4-Z,3/4-X 1/4+Y,1/4-Z,3/4+X 1/4-Y,3/4+Z,1/4+X 3/4+Y,1/4+Z,1/4-X -Y,1/2-X,Z 1/2+Y,1/2+X,1/2+Z 1/2-Y,X,-Z Y,-X,1/2-Z -X,1/2-Z,Y X,-Z,1/2-Y 1/2+X,1/2+Z,1/2+Y 1/2-X,Z,-Y -Z,1/2-Y,X 1/2-Z,Y,-X Z,-Y,1/2-X 1/2+Z,1/2+Y,1/2+X X,1/2+Y,1/2+Z -X,-Y,Z 1/2-X,Y,1/2-Z 1/2+X,1/2-Y,-Z Z,1/2+X,1/2+Y 1/2+Z,1/2-X,-Y -Z,-X,Y 1/2-Z,X,1/2-Y Y,1/2+Z,1/2+X 1/2-Y,Z,1/2-X 1/2+Y,1/2-Z,-X -Y,-Z,X 3/4+Y,3/4+X,1/4-Z 1/4-Y,3/4-X,3/4-Z 1/4+Y,1/4-X,1/4+Z 3/4-Y,1/4+X,3/4+Z 3/4+X,3/4+Z,1/4-Y 3/4-X,1/4+Z,3/4+Y 1/4-X,3/4-Z,3/4-Y 1/4+X,1/4-Z,1/4+Y 3/4+Z,3/4+Y,1/4-X 1/4+Z,1/4-Y,1/4+X 3/4-Z,1/4+Y,3/4+X 1/4-Z,3/4-Y,3/4-X 3/4-X,1/4-Y,1/4-Z 3/4+X,3/4+Y,3/4-Z 1/4+X,3/4-Y,1/4+Z 1/4-X,1/4+Y,3/4+Z 3/4-Z,1/4-X,1/4-Y 1/4-Z,1/4+X,3/4+Y 3/4+Z,3/4+X,3/4-Y 1/4+Z,3/4-X,1/4+Y 3/4-Y,1/4-Z,1/4-X 1/4+Y,3/4-Z,1/4+X 1/4-Y,1/4+Z,3/4+X 3/4+Y,3/4+Z,3/4-X -Y,-X,1/2+Z 1/2+Y,X,Z 1/2-Y,1/2+X,1/2-Z Y,1/2-X,-Z -X,-Z,1/2+Y X,1/2-Z,-Y 1/2+X,Z,Y 1/2-X,1/2+Z,1/2-Y -Z,-Y,1/2+X 1/2-Z,1/2+Y,1/2-X Z,1/2-Y,-X 1/2+Z,Y,X 1/2+X,Y,1/2+Z 1/2-X,1/2-Y,Z -X,1/2+Y,1/2-Z X,-Y,-Z 1/2+Z,X,1/2+Y Z,-X,-Y 1/2-Z,1/2-X,Y -Z,1/2+X,1/2-Y 1/2+Y,Z,1/2+X -Y,1/2+Z,1/2-X Y,-Z,-X 1/2-Y,1/2-Z,X 1/4+Y,1/4+X,1/4-Z 3/4-Y,1/4-X,3/4-Z 3/4+Y,3/4-X,1/4+Z 1/4-Y,3/4+X,3/4+Z 1/4+X,1/4+Z,1/4-Y 1/4-X,3/4+Z,3/4+Y 3/4-X,1/4-Z,3/4-Y 3/4+X,3/4-Z,1/4+Y 1/4+Z,1/4+Y,1/4-X 3/4+Z,3/4-Y,1/4+X 1/4-Z,3/4+Y,3/4+X 3/4-Z,1/4-Y,3/4-X 1/4-X,3/4-Y,1/4-Z 1/4+X,1/4+Y,3/4-Z 3/4+X,1/4-Y,1/4+Z 3/4-X,3/4+Y,3/4+Z 1/4-Z,3/4-X,1/4-Y 3/4-Z,3/4+X,3/4+Y 1/4+Z,1/4+X,3/4-Y 3/4+Z,1/4-X,1/4+Y 1/4-Y,3/4-Z,1/4-X 3/4+Y,1/4-Z,1/4+X 3/4-Y,3/4+Z,3/4+X 1/4+Y,1/4+Z,3/4-X 1/2-Y,1/2-X,1/2+Z Y,1/2+X,Z -Y,X,1/2-Z 1/2+Y,-X,-Z 1/2-X,1/2-Z,1/2+Y 1/2+X,-Z,-Y X,1/2+Z,Y -X,Z,1/2-Y 1/2-Z,1/2-Y,1/2+X -Z,Y,1/2-X 1/2+Z,-Y,-X Z,1/2+Y,X 1/2+X,1/2+Y,Z 1/2-X,-Y,1/2+Z -X,Y,-Z X,1/2-Y,1/2-Z 1/2+Z,1/2+X,Y Z,1/2-X,1/2-Y 1/2-Z,-X,1/2+Y -Z,X,-Y 1/2+Y,1/2+Z,X -Y,Z,-X Y,1/2-Z,1/2-X 1/2-Y,-Z,1/2+X 1/4+Y,3/4+X,3/4-Z 3/4-Y,3/4-X,1/4-Z 3/4+Y,1/4-X,3/4+Z 1/4-Y,1/4+X,1/4+Z 1/4+X,3/4+Z,3/4-Y 1/4-X,1/4+Z,1/4+Y 3/4-X,3/4-Z,1/4-Y 3/4+X,1/4-Z,3/4+Y 1/4+Z,3/4+Y,3/4-X 3/4+Z,1/4-Y,3/4+X 1/4-Z,1/4+Y,1/4+X 3/4-Z,3/4-Y,1/4-X 1/4-X,1/4-Y,3/4-Z 1/4+X,3/4+Y,1/4-Z 3/4+X,3/4-Y,3/4+Z 3/4-X,1/4+Y,1/4+Z 1/4-Z,1/4-X,3/4-Y 3/4-Z,1/4+X,1/4+Y 1/4+Z,3/4+X,1/4-Y 3/4+Z,3/4-X,3/4+Y 1/4-Y,1/4-Z,3/4-X 3/4+Y,3/4-Z,3/4+X 3/4-Y,1/4+Z,1/4+X 1/4+Y,3/4+Z,1/4-X 1/2-Y,-X,Z Y,X,1/2+Z -Y,1/2+X,-Z 1/2+Y,1/2-X,1/2-Z 1/2-X,-Z,Y 1/2+X,1/2-Z,1/2-Y X,Z,1/2+Y -X,1/2+Z,-Y 1/2-Z,-Y,X -Z,1/2+Y,-X 1/2+Z,1/2-Y,1/2-X Z,Y,1/2+X".split(" "),
"I 4/m -3 2/m":"X,Y,Z -X,-Y,Z -X,Y,-Z X,-Y,-Z Z,X,Y Z,-X,-Y -Z,-X,Y -Z,X,-Y Y,Z,X -Y,Z,-X Y,-Z,-X -Y,-Z,X Y,X,-Z -Y,-X,-Z Y,-X,Z -Y,X,Z X,Z,-Y -X,Z,Y -X,-Z,-Y X,-Z,Y Z,Y,-X Z,-Y,X -Z,Y,X -Z,-Y,-X -X,-Y,-Z X,Y,-Z X,-Y,Z -X,Y,Z -Z,-X,-Y -Z,X,Y Z,X,-Y Z,-X,Y -Y,-Z,-X Y,-Z,X -Y,Z,X Y,Z,-X -Y,-X,Z Y,X,Z -Y,X,-Z Y,-X,-Z -X,-Z,Y X,-Z,-Y X,Z,Y -X,Z,-Y -Z,-Y,X -Z,Y,-X Z,-Y,-X Z,Y,X 1/2+X,1/2+Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y 1/2+Z,1/2-X,1/2-Y 1/2-Z,1/2-X,1/2+Y 1/2-Z,1/2+X,1/2-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,1/2-X 1/2-Y,1/2-Z,1/2+X 1/2+Y,1/2+X,1/2-Z 1/2-Y,1/2-X,1/2-Z 1/2+Y,1/2-X,1/2+Z 1/2-Y,1/2+X,1/2+Z 1/2+X,1/2+Z,1/2-Y 1/2-X,1/2+Z,1/2+Y 1/2-X,1/2-Z,1/2-Y 1/2+X,1/2-Z,1/2+Y 1/2+Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2+X 1/2-Z,1/2-Y,1/2-X 1/2-X,1/2-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z 1/2+X,1/2-Y,1/2+Z 1/2-X,1/2+Y,1/2+Z 1/2-Z,1/2-X,1/2-Y 1/2-Z,1/2+X,1/2+Y 1/2+Z,1/2+X,1/2-Y 1/2+Z,1/2-X,1/2+Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,1/2+X 1/2+Y,1/2+Z,1/2-X 1/2-Y,1/2-X,1/2+Z 1/2+Y,1/2+X,1/2+Z 1/2-Y,1/2+X,1/2-Z 1/2+Y,1/2-X,1/2-Z 1/2-X,1/2-Z,1/2+Y 1/2+X,1/2-Z,1/2-Y 1/2+X,1/2+Z,1/2+Y 1/2-X,1/2+Z,1/2-Y 1/2-Z,1/2-Y,1/2+X 1/2-Z,1/2+Y,1/2-X 1/2+Z,1/2-Y,1/2-X 1/2+Z,1/2+Y,1/2+X".split(" "),
"I 41/a -3 2/d":"X,Y,Z 1/2-X,-Y,1/2+Z -X,1/2+Y,1/2-Z 1/2+X,1/2-Y,-Z Z,X,Y 1/2+Z,1/2-X,-Y 1/2-Z,-X,1/2+Y -Z,1/2+X,1/2-Y Y,Z,X -Y,1/2+Z,1/2-X 1/2+Y,1/2-Z,-X 1/2-Y,-Z,1/2+X 3/4+Y,1/4+X,1/4-Z 3/4-Y,3/4-X,3/4-Z 1/4+Y,1/4-X,3/4+Z 1/4-Y,3/4+X,1/4+Z 3/4+X,1/4+Z,1/4-Y 1/4-X,3/4+Z,1/4+Y 3/4-X,3/4-Z,3/4-Y 1/4+X,1/4-Z,3/4+Y 3/4+Z,1/4+Y,1/4-X 1/4+Z,1/4-Y,3/4+X 1/4-Z,3/4+Y,1/4+X 3/4-Z,3/4-Y,3/4-X -X,-Y,-Z 1/2+X,Y,1/2-Z X,1/2-Y,1/2+Z 1/2-X,1/2+Y,Z -Z,-X,-Y 1/2-Z,1/2+X,Y 1/2+Z,X,1/2-Y Z,1/2-X,1/2+Y -Y,-Z,-X Y,1/2-Z,1/2+X 1/2-Y,1/2+Z,X 1/2+Y,Z,1/2-X 1/4-Y,3/4-X,3/4+Z 1/4+Y,1/4+X,1/4+Z 3/4-Y,3/4+X,1/4-Z 3/4+Y,1/4-X,3/4-Z 1/4-X,3/4-Z,3/4+Y 3/4+X,1/4-Z,3/4-Y 1/4+X,1/4+Z,1/4+Y 3/4-X,3/4+Z,1/4-Y 1/4-Z,3/4-Y,3/4+X 3/4-Z,3/4+Y,1/4-X 3/4+Z,1/4-Y,3/4-X 1/4+Z,1/4+Y,1/4+X 1/2+X,1/2+Y,1/2+Z -X,1/2-Y,Z 1/2-X,Y,-Z X,-Y,1/2-Z 1/2+Z,1/2+X,1/2+Y Z,-X,1/2-Y -Z,1/2-X,Y 1/2-Z,X,-Y 1/2+Y,1/2+Z,1/2+X 1/2-Y,Z,-X Y,-Z,1/2-X -Y,1/2-Z,X 1/4+Y,3/4+X,3/4-Z 1/4-Y,1/4-X,1/4-Z 3/4+Y,3/4-X,1/4+Z 3/4-Y,1/4+X,3/4+Z 1/4+X,3/4+Z,3/4-Y 3/4-X,1/4+Z,3/4+Y 1/4-X,1/4-Z,1/4-Y 3/4+X,3/4-Z,1/4+Y 1/4+Z,3/4+Y,3/4-X 3/4+Z,3/4-Y,1/4+X 3/4-Z,1/4+Y,3/4+X 1/4-Z,1/4-Y,1/4-X 1/2-X,1/2-Y,1/2-Z X,1/2+Y,-Z 1/2+X,-Y,Z -X,Y,1/2+Z 1/2-Z,1/2-X,1/2-Y -Z,X,1/2+Y Z,1/2+X,-Y 1/2+Z,-X,Y 1/2-Y,1/2-Z,1/2-X 1/2+Y,-Z,X -Y,Z,1/2+X Y,1/2+Z,-X 3/4-Y,1/4-X,1/4+Z 3/4+Y,3/4+X,3/4+Z 1/4-Y,1/4+X,3/4-Z 1/4+Y,3/4-X,1/4-Z 3/4-X,1/4-Z,1/4+Y 1/4+X,3/4-Z,1/4-Y 3/4+X,3/4+Z,3/4+Y 1/4-X,1/4+Z,3/4-Y 3/4-Z,1/4-Y,1/4+X 1/4-Z,1/4+Y,3/4-X 1/4+Z,3/4-Y,1/4-X 3/4+Z,3/4+Y,3/4+X".split(" "),
"P 1 1 2":["X,Y,Z","-X,-Y,Z"],"P 1 1 21":["X,Y,Z","-X,-Y,1/2+Z"],"B 1 1 2":["X,Y,Z","-X,-Y,Z","1/2+X,+Y,1/2+Z","1/2-X,-Y,1/2+Z"],"A 1 2 1":["X,Y,Z","-X,Y,-Z","X,1/2+Y,1/2+Z","-X,1/2+Y,1/2-Z"],"C 1 21 1":["X,Y,Z","-X,1/2+Y,-Z","1/2+X,1/2+Y,Z","1/2-X,Y,-Z"],"I 1 2 1":["X,Y,Z","-X,Y,-Z","X+1/2,Y+1/2,Z+1/2","-X+1/2,Y+1/2,-Z+1/2"],"I 1 21 1":["X,Y,Z","-X,1/2+Y,-Z","X+1/2,Y+1/2,Z+1/2","-X+1/2,Y,1/2-Z"],"P 1 1 m":["X,Y,Z","X,Y,-Z"],"P 1 1 b":["X,Y,Z","X,1/2+Y,-Z"],"B 1 1 m":["X,Y,Z","X,Y,-Z","1/2+X,Y,1/2+Z",
"1/2+X,Y,1/2-Z"],"B 1 1 b":["X,Y,Z","X,1/2+Y,-Z","1/2+X,Y,1/2+Z","1/2+X,1/2+Y,1/2-Z"],"P 1 1 2/m":["X,Y,Z","X,Y,-Z","-X,-Y,Z","-X,-Y,-Z"],"P 1 1 21/m":["X,Y,Z","-X,-Y,1/2+Z","-X,-Y,-Z","X,Y,1/2-Z"],"B 1 1 2/m":"X,Y,Z X,Y,-Z -X,-Y,Z -X,-Y,-Z 1/2+X,Y,1/2+Z 1/2+X,Y,1/2-Z 1/2-X,-Y,1/2+Z 1/2-X,-Y,1/2-Z".split(" "),"P 1 1 2/b":["X,Y,Z","-X,1/2-Y,Z","-X,-Y,-Z","X,1/2+Y,-Z"],"P 1 1 21/b":["X,Y,Z","-X,-Y,-Z","-X,1/2-Y,1/2+Z","X,1/2+Y,1/2-Z"],"B 1 1 2/b":"X,Y,Z -X,1/2-Y,Z -X,-Y,-Z X,1/2+Y,-Z 1/2+X,Y,1/2+Z 1/2-X,1/2-Y,1/2+Z 1/2-X,-Y,1/2-Z 1/2+X,1/2+Y,1/2-Z".split(" "),
"P 21 2 2":["X,Y,Z","-X,Y,-Z","1/2+X,-Y,-Z","1/2-X,-Y,Z"],"P 2 21 2":["X,Y,Z","X,1/2-Y,-Z","-X,1/2+Y,-Z","-X,-Y,Z"],"P 21 21 2 (a)":["X,Y,Z","1/2-X,1/2-Y,Z","X+1/2,-Y,-Z","-X,Y+1/2,-Z"],"P 21 2 21":["X,Y,Z","-X,Y,-Z","1/2+X,-Y,1/2-Z","1/2-X,-Y,1/2+Z"],"P 2 21 21":["X,Y,Z","X,-Y,-Z","-X,1/2+Y,1/2-Z","-X,1/2-Y,1/2+Z"],"C 2 2 21a)":"X,Y,Z 1/2-X,-Y,1/2+Z 1/2+X,1/2-Y,-Z -X,1/2+Y,1/2-Z 1/2+X,1/2+Y,Z -X,1/2-Y,1/2+Z X,-Y,-Z 1/2-X,Y,1/2-Z".split(" "),"C 2 2 2a":"X,Y,Z;1/2-X,1/2-Y,Z;X+1/2,-Y,-Z;-X,Y+1/2,-Z;1/2+ X,1/2+Y,Z;-X,-Y,Z;X,1/2-Y,-Z;1/2-X,Y,-Z".split(";"),
"F 2 2 2a":"X,Y,Z 1/2-X,1/2-Y,Z X+1/2,-Y,-Z -X,Y+1/2,-Z X,Y+1/2,Z+1/2 1/2-X,-Y,Z+1/2 X+1/2,-Y+1/2,-Z+1/2 -X,Y,-Z+1/2 X+1/2,Y,Z+1/2 -X,1/2-Y,Z+1/2 X,-Y,-Z+1/2 -X+1/2,Y+1/2,-Z+1/2 X+1/2,Y+1/2,Z -X,-Y,Z X,-Y+1/2,-Z -X+1/2,Y,-Z".split(" "),"I 2 2 2a":"X,Y,Z 1/2-X,1/2-Y,Z X+1/2,-Y,-Z -X,Y+1/2,-Z 1/2+X,1/2+Y,1/2+Z -X,-Y,1/2+Z 1/2-X,Y,1/2-Z X,1/2-Y,1/2-Z".split(" "),"P 21/m 21/m 2/n a":"X,Y,Z 1/2-X,1/2-Y,Z -X,1/2+Y,-Z 1/2+X,-Y,-Z -X,-Y,-Z X+1/2,Y+1/2,-Z X,1/2-Y,Z 1/2-X,Y,Z".split(" "),"P 42 21 2a":"X,Y,Z 1/2-X,1/2-Y,Z -Y,X+1/2,1/2+Z Y+1/2,-X,1/2+Z -X,Y+1/2,-Z X+1/2,-Y,-Z Y,X,1/2-Z 1/2-Y,1/2-X,1/2-Z".split(" "),
"I 2 3a":"X,Y,Z 1/2-X,1/2-Y,Z X+1/2,-Y,-Z -X,Y+1/2,-Z Y,Z,X 1/2-Y,1/2-Z,X Y+1/2,-Z,-X -Y,Z+1/2,-X Z,X,Y 1/2-Z,1/2-X,Y Z+1/2,-X,-Y -Z,X+1/2,-Y 1/2+X,1/2+Y,1/2+Z -X,-Y,1/2+Z X,1/2-Y,1/2-Z 1/2-X,Y,1/2-Z 1/2+Y,1/2+Z,1/2+X -Y,-Z,1/2+X Y,1/2-Z,1/2-X 1/2-Y,Z,1/2-X 1/2+Z,1/2+X,1/2+Y -Z,-X,1/2+Y Z,1/2-X,1/2-Y 1/2-Z,X,1/2-Y".split(" ")};
NGL.SubstitutionMatrices=function(){function a(a,c){var d,e=0,f={};c.forEach(function(c){d=0;var h={};c.forEach(function(c){h[a[d++]]=c});f[a[e++]]=h});return f}return{blosum62:a("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,
-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,
-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,
3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:a("ACDEFGHIKLMNPQRSTVWY",[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,
3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,
-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]])}}();
NGL.Alignment=function(a,b,c,d,e){this.seq1=a;this.seq2=b;this.gapPenalty=c||-10;this.gapExtensionPenalty=d||-1;this.substMatrix=e||"blosum62",this.substMatrix=NGL.SubstitutionMatrices[this.substMatrix]};
NGL.Alignment.prototype={constructor:NGL.Alignment,initMatrices:function(){this.n=this.seq1.length;this.m=this.seq2.length;this.score=void 0;this.ali="";this.S=[];this.V=[];this.H=[];for(var a=0;a<=this.n;++a){this.S[a]=[];this.V[a]=[];this.H[a]=[];for(var b=0;b<=this.m;++b)this.S[a][b]=0,this.V[a][b]=0,this.H[a][b]=0}for(a=0;a<=this.n;++a)this.S[a][0]=this.gap(0),this.H[a][0]=-Infinity;for(b=0;b<=this.m;++b)this.S[0][b]=this.gap(0),this.V[0][b]=-Infinity;this.S[0][0]=0},gap:function(a){return this.gapPenalty+
a*this.gapExtensionPenalty},makeScoreFn:function(){var a=this.seq1,b=this.seq2,c=this.substMatrix,d,e;if(c)return function(f,g){d=a[f];e=b[g];try{return c[d][e]}catch(h){return-4}};NGL.warn("NGL.Alignment: no subst matrix");return function(c,g){d=a[c];e=b[g];return d===e?5:-3}},calc:function(){NGL.time("NGL.Alignment.calc");this.initMatrices();var a=this.gap(0),b=this.makeScoreFn(),c=this.gapExtensionPenalty,d=this.V,e=this.H,f=this.S,g=this.n,h=this.m,k,l,m,n,q,p,r;for(p=1;p<=g;++p)for(l=f[p-1],
k=d[p-1],m=d[p],n=e[p],q=f[p],r=1;r<=h;++r)m[r]=Math.max(l[r]+a,k[r]+c),n[r]=Math.max(q[r-1]+a,n[r-1]+c),q[r]=Math.max(l[r-1]+b(p-1,r-1),m[r],n[r]);NGL.timeEnd("NGL.Alignment.calc")},trace:function(){this.ali2=this.ali1="";var a=this.makeScoreFn(),b=this.n,c=this.m,d="S";this.S[b][c]>=this.V[b][c]&&this.S[b][c]>=this.V[b][c]?(d="S",this.score=this.S[b][c]):this.V[b][c]>=this.H[b][c]?(d="V",this.score=this.V[b][c]):(d="H",this.score=this.H[b][c]);for(;0<b&&0<c;)"S"==d?this.S[b][c]==this.S[b-1][c-1]+
a(b-1,c-1)?(this.ali1=this.seq1[b-1]+this.ali1,this.ali2=this.seq2[c-1]+this.ali2,--b,--c,d="S"):this.S[b][c]==this.V[b][c]?d="V":this.S[b][c]==this.H[b][c]?d="H":(NGL.error("NGL.Alignment: S"),--b,--c):"V"==d?this.V[b][c]==this.V[b-1][c]+this.gapExtensionPenalty?(this.ali1=this.seq1[b-1]+this.ali1,this.ali2="-"+this.ali2,--b,d="V"):this.V[b][c]==this.S[b-1][c]+this.gap(0)?(this.ali1=this.seq1[b-1]+this.ali1,this.ali2="-"+this.ali2,--b,d="S"):(NGL.error("NGL.Alignment: V"),--b):"H"==d?this.H[b][c]==
this.H[b][c-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[c-1]+this.ali2,--c,d="H"):this.H[b][c]==this.S[b][c-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[c-1]+this.ali2,--c,d="S"):(NGL.error("NGL.Alignment: H"),--c):NGL.error("NGL.Alignment: no matrix");for(;0<b;)this.ali1=this.seq1[b-1]+this.ali1,this.ali2="-"+this.ali2,--b;for(;0<c;)this.ali1="-"+this.ali1,this.ali2=this.seq2[c-1]+this.ali2,--c}};
NGL.Spline=function(a,b){this.arrows=b||!1;this.polymer=a;this.size=a.residueCount;this.tension=this.polymer.isNucleic()?.5:.9};
NGL.Spline.prototype={constructor:NGL.Spline,interpolate:function(a,b,c,d,e,f){a=(c-a)*f;d=(d-b)*f;f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b},getSubdividedColor:function(a,b){var c=this.polymer,d=c.structure,e=c.residueIndexStart,f=c.residueCount-1,g=f*a*3+3;c.isCyclic&&(g+=3*a);var h=new Float32Array(g),k=new Float32Array(g),l=b||{};l.structure=d;var m=NGL.ColorMakerRegistry.getScheme(l),l=NGL.ColorMakerRegistry.getPickingScheme(l),n=0,q=d.getResidueProxy();q.index=e;for(var p=d.getAtomProxy(),
d=d.getAtomProxy(q.traceAtomIndex),r=0;r<f;++r){q.index=e+r+1;p.index=d.index;d.index=q.traceAtomIndex;for(var s=Math.ceil(a/2),u=0;u<s;++u){var v=n+3*u;m.atomColorToArray(p,h,v);l.atomColorToArray(p,k,v)}for(u=s;u<a;++u)v=n+3*u,m.atomColorToArray(d,h,v),l.atomColorToArray(d,k,v);n+=3*a}if(c.isCyclic){q.index=e;p.index=d.index;d.index=q.traceAtomIndex;s=Math.ceil(a/2);for(u=0;u<s;++u)v=n+3*u,m.atomColorToArray(p,h,v),l.atomColorToArray(p,k,v);for(u=s;u<a;++u)v=n+3*u,m.atomColorToArray(d,h,v),l.atomColorToArray(d,
k,v)}h[g-3]=h[g-6];h[g-2]=h[g-5];h[g-1]=h[g-4];k[g-3]=k[g-6];k[g-2]=k[g-5];k[g-1]=k[g-4];return{color:h,pickingColor:k}},getSubdividedPosition:function(a,b){isNaN(b)&&(b=this.tension);return{position:this.getPosition(a,b)}},getSubdividedOrientation:function(a,b){isNaN(b)&&(b=this.tension);var c=this.getTangent(a,b),d=this.getNormals(a,b,c);return{tangent:c,normal:d.normal,binormal:d.binormal}},getSubdividedSize:function(a,b,c){var d=this.polymer,e=d.structure,f=d.residueIndexStart,g=d.residueCount-
1,h=g*a+1;d.isCyclic&&(h+=a);var k=this.arrows,h=new Float32Array(h);b=new NGL.RadiusFactory(b,c);c=0;var l=e.getResidueProxy();l.index=f;for(var m=e.getAtomProxy(),e=e.getAtomProxy(l.traceAtomIndex),n=0;n<g;++n){l.index=f+n+1;m.index=e.index;e.index=l.traceAtomIndex;var q=b.atomRadius(m),p=b.atomRadius(e);if(k&&("e"===m.sstruc&&"e"!==e.sstruc||"b"===m.sstruc&&"b"!==e.sstruc||"h"===m.sstruc&&"h"!==e.sstruc||"g"===m.sstruc&&"g"!==e.sstruc||"i"===m.sstruc&&"i"!==e.sstruc)){for(var q=1.7*q,r=Math.ceil(a/
2),s=0;s<r;++s){var u=s/r;h[c+s]=(1-u)*q+u*p}for(s=r;s<a;++s)h[c+s]=p}else for(s=0;s<a;++s)u=s/a,h[c+s]=(1-u)*q+u*p;c+=a}if(d.isCyclic){l.index=f;m.index=e.index;e.index=l.traceAtomIndex;q=b.atomRadius(m);p=b.atomRadius(e);if(k&&("e"===m.sstruc&&"e"!==e.sstruc||"b"===m.sstruc&&"b"!==e.sstruc||"h"===m.sstruc&&"h"!==e.sstruc||"g"===m.sstruc&&"g"!==e.sstruc||"i"===m.sstruc&&"i"!==e.sstruc)){q*=1.7;r=Math.ceil(a/2);for(s=0;s<r;++s)u=s/r,h[c+s]=(1-u)*q+u*p;for(s=r;s<a;++s)h[c+s]=p}else for(s=0;s<a;++s)u=
s/a,h[c+s]=(1-u)*q+u*p;c+=a}h[c]=h[c-1];return{size:h}},getPosition:function(a,b,c){isNaN(b)&&(b=this.tension);var d=this.interpolate,e=this.polymer,f=this.polymer.structure,g=e.residueCount-1,h=g*a*3+3;e.isCyclic&&(h+=3*a);var h=new Float32Array(h),k=0,l=1/a;c=c||"trace";for(var m=f.getAtomProxy(),n=f.getAtomProxy(e.getAtomIndexByType(-1,c)),q=f.getAtomProxy(e.getAtomIndexByType(0,c)),f=f.getAtomProxy(e.getAtomIndexByType(1,c)),p=0;p<g;++p){m.index=n.index;n.index=q.index;q.index=f.index;f.index=
e.getAtomIndexByType(p+2,c);for(var r=0;r<a;++r){var s=k+3*r,u=l*r;h[s+0]=d(m.x,n.x,q.x,f.x,u,b);h[s+1]=d(m.y,n.y,q.y,f.y,u,b);h[s+2]=d(m.z,n.z,q.z,f.z,u,b)}k+=3*a}if(e.isCyclic){m.index=e.getAtomIndexByType(e.residueCount-2,c);n.index=e.getAtomIndexByType(e.residueCount-1,c);q.index=e.getAtomIndexByType(0,c);f.index=e.getAtomIndexByType(1,c);for(r=0;r<a;++r)s=k+3*r,u=l*r,h[s+0]=d(m.x,n.x,q.x,f.x,u,b),h[s+1]=d(m.y,n.y,q.y,f.y,u,b),h[s+2]=d(m.z,n.z,q.z,f.z,u,b);k+=3*a}q.positionToArray(h,k);return h},
getTangent:function(a,b,c){isNaN(b)&&(b=this.tension);var d=this.interpolate,e=this.polymer,f=this.polymer.structure,g=new THREE.Vector3,h=new THREE.Vector3,k=this.size-1,l=k*a*3+3;e.isCyclic&&(l+=3*a);var l=new Float32Array(l),m=0,n=1/a;c=c||"trace";for(var q=f.getAtomProxy(),p=f.getAtomProxy(e.getAtomIndexByType(-1,c)),r=f.getAtomProxy(e.getAtomIndexByType(0,c)),f=f.getAtomProxy(e.getAtomIndexByType(1,c)),s=0;s<k;++s){q.index=p.index;p.index=r.index;r.index=f.index;f.index=e.getAtomIndexByType(s+
2,c);for(var u=0;u<a;++u){var v=n*u,w=v-1E-4,v=v+1E-4,x=m+3*u;0>w&&(w=0);1<v&&(v=1);g.x=d(q.x,p.x,r.x,f.x,w,b);g.y=d(q.y,p.y,r.y,f.y,w,b);g.z=d(q.z,p.z,r.z,f.z,w,b);h.x=d(q.x,p.x,r.x,f.x,v,b);h.y=d(q.y,p.y,r.y,f.y,v,b);h.z=d(q.z,p.z,r.z,f.z,v,b);h.sub(g).normalize();h.toArray(l,x)}m+=3*a}if(e.isCyclic){q.index=e.getAtomIndexByType(e.residueCount-2,c);p.index=e.getAtomIndexByType(e.residueCount-1,c);r.index=e.getAtomIndexByType(0,c);f.index=e.getAtomIndexByType(1,c);for(u=0;u<a;++u)v=n*u,w=v-1E-4,
v+=1E-4,x=m+3*u,0>w&&(w=0),1<v&&(v=1),g.x=d(q.x,p.x,r.x,f.x,w,b),g.y=d(q.y,p.y,r.y,f.y,w,b),g.z=d(q.z,p.z,r.z,f.z,w,b),h.x=d(q.x,p.x,r.x,f.x,v,b),h.y=d(q.y,p.y,r.y,f.y,v,b),h.z=d(q.z,p.z,r.z,f.z,v,b),h.sub(g).normalize(),h.toArray(l,x);m+=3*a}h.toArray(l,m);return l},getNormals:function(a,b,c){var d=this.interpolate,e=this.polymer,f=e.isCg(),g=e.isProtein(),h=e.structure,k=this.size-1,l=k*a*3+3;e.isCyclic&&(l+=3*a);var m=new Float32Array(l),l=new Float32Array(l),n=new THREE.Vector3,q=new THREE.Vector3,
p=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=(new THREE.Vector3).set(0,0,1),t=new THREE.Vector3;new THREE.Vector3;var z=new THREE.Vector3,y=new THREE.Vector3,A=new THREE.Vector3,B=new THREE.Vector3,L=new THREE.Vector3,C=new THREE.Vector3,P=new THREE.Vector3,M=new THREE.Vector3,W=0,K=1/a,aa=!0,I=Math.ceil(a/2);if(!f)var R=h.getAtomProxy(),E=h.getAtomProxy(e.getAtomIndexByType(-1,"direction1")),Y=h.getAtomProxy(e.getAtomIndexByType(0,
"direction1")),X=h.getAtomProxy(e.getAtomIndexByType(1,"direction1")),O=h.getAtomProxy(),Z=h.getAtomProxy(e.getAtomIndexByType(-1,"direction2")),$=h.getAtomProxy(e.getAtomIndexByType(0,"direction2")),J=h.getAtomProxy(e.getAtomIndexByType(1,"direction2"));for(h=0;h<k;++h){f||(R.index=E.index,E.index=Y.index,Y.index=X.index,X.index=e.getAtomIndexByType(h+2,"direction1"),O.index=Z.index,Z.index=$.index,$.index=J.index,J.index=e.getAtomIndexByType(h+2,"direction2"),aa?(aa=!1,z.copy(R),y.copy(E),A.copy(Y),
L.copy(O),C.copy(Z),P.copy($),p.subVectors(L,z),r.subVectors(C,y),0>p.dot(r)&&(r.multiplyScalar(-1),C.addVectors(y,r)),s.subVectors(P,A),0>r.dot(s)&&(s.multiplyScalar(-1),P.addVectors(A,s))):(z.copy(y),y.copy(A),A.copy(B),L.copy(C),C.copy(P),P.copy(M),s.copy(u)),B.copy(X),M.copy(J),u.subVectors(M,B),0>s.dot(u)&&(u.multiplyScalar(-1),M.addVectors(B,u)));for(var N=0;N<a;++N){var T=W+3*N;if(f)v.copy(x);else{g&&(T+=3*I);var U=K*N;n.x=d(z.x,y.x,A.x,B.x,U,b);n.y=d(z.y,y.y,A.y,B.y,U,b);n.z=d(z.z,y.z,A.z,
B.z,U,b);q.x=d(L.x,C.x,P.x,M.x,U,b);q.y=d(L.y,C.y,P.y,M.y,U,b);q.z=d(L.z,C.z,P.z,M.z,U,b);v.subVectors(q,n).normalize()}w.fromArray(c,T);t.crossVectors(v,w).normalize();t.toArray(l,T);x.crossVectors(w,t).normalize();x.toArray(m,T)}W+=3*a}if(e.isCyclic){f||(R.index=e.getAtomIndexByType(e.residueCount-2,"direction1"),E.index=e.getAtomIndexByType(e.residueCount-1,"direction1"),Y.index=e.getAtomIndexByType(0,"direction1"),X.index=e.getAtomIndexByType(1,"direction1"),O.index=e.getAtomIndexByType(e.residueCount-
2,"direction2"),Z.index=e.getAtomIndexByType(e.residueCount-1,"direction2"),$.index=e.getAtomIndexByType(0,"direction2"),J.index=e.getAtomIndexByType(1,"direction2"),aa?(z.copy(R),y.copy(E),A.copy(Y),L.copy(O),C.copy(Z),P.copy($),p.subVectors(L,z),r.subVectors(C,y),0>p.dot(r)&&(r.multiplyScalar(-1),C.addVectors(y,r)),s.subVectors(P,A),0>r.dot(s)&&(s.multiplyScalar(-1),P.addVectors(A,s))):(z.copy(y),y.copy(A),A.copy(B),L.copy(C),C.copy(P),P.copy(M),s.copy(u)),B.copy(X),M.copy(J),u.subVectors(M,B),
0>s.dot(u)&&(u.multiplyScalar(-1),M.addVectors(B,u)));for(N=0;N<a;++N)T=W+3*N,f?v.copy(x):(g&&(T+=3*I),U=K*N,n.x=d(z.x,y.x,A.x,B.x,U,b),n.y=d(z.y,y.y,A.y,B.y,U,b),n.z=d(z.z,y.z,A.z,B.z,U,b),q.x=d(L.x,C.x,P.x,M.x,U,b),q.y=d(L.y,C.y,P.y,M.y,U,b),q.z=d(L.z,C.z,P.z,M.z,U,b),v.subVectors(q,n).normalize()),w.fromArray(c,T),t.crossVectors(v,w).normalize(),t.toArray(l,T),x.crossVectors(w,t).normalize(),x.toArray(m,T);W+=3*a}if(g)for(t.fromArray(l,3*I),x.fromArray(m,3*I),N=0;N<I;++N)t.toArray(l,3*N),x.toArray(m,
3*N);else t.toArray(l,W),x.toArray(m,W);return{normal:m,binormal:l}}};NGL.Helixorient=function(a){this.polymer=a;this.size=a.residueCount};
NGL.Helixorient.prototype={constructor:NGL.Helixorient,getPolymer:function(a,b){var c=this.getPosition().center,d,e,f,g,h,k=[],l=c.length/3,m=this.fiber;m.computedAtoms.trace||m.computeAtom("trace");var n=m.computedAtoms.trace;for(d=0;d<l;++d){h=n[d];e=h.residue;g=new NGL.Residue;f=new NGL.Atom(g);g.atoms.push(f);g.atomCount+=1;g.resname=e.resname;g.index=e.index;g.chain=e.chain;e=3*d;f.positionFromArray(c,e);if(a){var q,p,r,s=Math.min(a,d,l-d-1);for(p=1;p<=s;++p)q=3*p,r=(s+1-p)/(s+1),f.x+=r*c[e-
q+0]+r*c[e+q+0],f.y+=r*c[e-q+1]+r*c[e+q+1],f.z+=r*c[e-q+2]+r*c[e+q+2];f.x/=s+1;f.y/=s+1;f.z/=s+1}f.atomname=h.atomname;f.index=h.index;f.resname=h.resname;f.chainname=h.chainname;f.bfactor=h.bfactor;f.ss=h.ss;k.push(g);!b||0!==d&&d!==l-1||k.push(g)}return new NGL.Fiber(k,m.structure)},getColor:function(a){var b=this.polymer,c=b.structure,d=b.residueCount,b=b.residueIndexStart,e=new Float32Array(3*d),f=new Float32Array(3*d),g=a||{};g.structure=c;a=NGL.ColorMakerRegistry.getScheme(g);for(var g=NGL.ColorMakerRegistry.getPickingScheme(g),
h=c.getResidueProxy(),c=c.getAtomProxy(),k=0;k<d;++k){h.index=b+k;c.index=h.traceAtomIndex;var l=3*k;a.atomColorToArray(c,e,l);g.atomColorToArray(c,f,l)}return{color:e,pickingColor:f}},getSize:function(a,b){for(var c=this.polymer,d=c.structure,e=c.residueCount,c=c.residueIndexStart,f=new Float32Array(e),g=new NGL.RadiusFactory(a,b),h=d.getResidueProxy(),d=d.getAtomProxy(),k=0;k<e;++k)h.index=c+k,d.index=h.traceAtomIndex,f[k]=g.atomRadius(d);return{size:f}},getPosition:function(){var a=this.polymer,
b=a.structure,c=a.residueCount,d=c-3,e=new Float32Array(3*c),f=new Float32Array(3*c),g=new Float32Array(c),h=new Float32Array(c),k=new Float32Array(c),l=new Float32Array(c),m=new Float32Array(3*c),n,q,p,r,s=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,t=new THREE.Vector3,z=new THREE.Vector3,y=new THREE.Vector3,A=new THREE.Vector3,B=new THREE.Vector3;new THREE.Vector3;for(var L=new THREE.Vector3(0,0,0),C=b.getAtomProxy(),P=b.getAtomProxy(a.getAtomIndexByType(0,
"trace")),M=b.getAtomProxy(a.getAtomIndexByType(1,"trace")),W=b.getAtomProxy(a.getAtomIndexByType(2,"trace")),b=0;b<d;++b)C.index=P.index,P.index=M.index,M.index=W.index,W.index=a.getAtomIndexByType(b+3,"trace"),q=3*b,s.subVectors(P,C),u.subVectors(M,P),v.subVectors(W,M),w.subVectors(s,u),x.subVectors(u,v),y.crossVectors(w,x).normalize(),y.toArray(f,q),0<b&&(g[b]=y.angleTo(A)),n=Math.cos(w.angleTo(x)),l[b]=180/Math.PI*Math.acos(n),p=w.length(),r=x.length(),h[b]=Math.sqrt(r*p)/Math.max(2,2*(1-n)),
k[b]=Math.abs(u.dot(y)),t.copy(w).multiplyScalar(h[b]/p),z.copy(x).multiplyScalar(h[b]/r),t.subVectors(P,t),z.subVectors(M,z),t.toArray(e,q+3),z.toArray(e,q+6),B.subVectors(C,L),B.toArray(m,q),A.copy(y),L.copy(t);t.fromArray(e,3);z.fromArray(e,6);y.subVectors(t,z).normalize();C.index=a.getAtomIndexByType(0,"trace");L.copy(C);t=NGL.Utils.pointVectorIntersection(L,t,y);t.toArray(e,0);B.subVectors(L,t);B.toArray(m,0);t.fromArray(e,3*c-6);z.fromArray(e,3*c-9);y.subVectors(t,z).normalize();C.index=a.getAtomIndexByType(c-
1,"trace");L.copy(C);t=NGL.Utils.pointVectorIntersection(L,t,y);t.toArray(e,3*c-3);for(b=c-3;b<c;++b)t.fromArray(e,3*b),C.index=a.getAtomIndexByType(b,"trace"),L.copy(C),B.subVectors(L,t),B.toArray(m,3*b);a=new Float32Array(c);d=new Float32Array(c);g=new Float32Array(c);s=new Float32Array(c);a[1]=h[0];d[1]=l[0];g[1]=h[0];for(b=2;b<c-2;++b)a[b]=.5*(h[b-2]+h[b-1]),d[b]=.5*(l[b-2]+l[b-1]),g[b]=.5*(k[b-2]+k[b-1]),t.fromArray(f,3*(b-2)),z.fromArray(f,3*(b-1)),s[b]=180/Math.PI*Math.acos(Math.cos(t.angleTo(z)));
a[c-2]=h[c-4];d[c-2]=l[c-4];g[c-2]=k[c-4];h=new Float32Array(3*c);NGL.Utils.copyArray(f,h,0,0,3);NGL.Utils.copyArray(f,h,0,3,3);for(b=2;b<c-2;++b)t.fromArray(f,3*(b-2)),z.fromArray(f,3*(b-1)),y.addVectors(z,t).multiplyScalar(.5).normalize(),y.toArray(h,3*b);NGL.Utils.copyArray(f,h,3*c-12,3*c-6,3);NGL.Utils.copyArray(f,h,3*c-12,3*c-3,3);return{center:e,axis:h,bending:s,radius:a,rise:g,twist:d,resdir:m}}};
NGL.Helix=function(){this.begin=new THREE.Vector3;this.end=new THREE.Vector3;this.axis=new THREE.Vector3;this.center=new THREE.Vector3;this.length=0;this.residues=[];this.size=0};
NGL.Helix.prototype={constructor:NGL.Helix,fromHelixbundleAxis:function(){var a=new THREE.Vector3;return function(b,c){this.begin.fromArray(b.begin,3*c);this.end.fromArray(b.end,3*c);this.axis.fromArray(b.axis,3*c);this.center.fromArray(b.center,3*c);this.length=a.subVectors(this.begin,this.end).length();this.residues=b.residue[c];this.size=this.residues.length;return this}}(),angleTo:function(){var a=new THREE.Vector3;return function(b){var c=a.crossVectors(this.axis,b.axis).length();b=this.axis.dot(b.axis);
c=Math.atan2(c,b);return 0>b?-c:c}}(),distanceTo:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d){this.crossingPoints(d,a,b);c.subVectors(b,a);return c.length()}}(),crossingPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g){f||(f=new THREE.Vector3);g||(g=new THREE.Vector3);a.crossVectors(this.axis,e.axis);b.subVectors(e.begin,this.begin);var h=a.dot(a),k=c.crossVectors(b,e.axis).dot(a),
l=d.crossVectors(b,this.axis).dot(a);f.copy(this.axis).multiplyScalar(k/h).add(this.begin);g.copy(e.axis).multiplyScalar(l/h).add(e.begin);return[f,g]}}(),crossing:function(a){var b={},c=this.angleTo(a)/(Math.PI/180),d=this.crossingPoints(a),e=NGL.Utils.isPointOnSegment(d[0],this.begin,this.end)&&NGL.Utils.isPointOnSegment(d[1],a.begin,a.end),f=NGL.Utils.pointVectorIntersection(this.begin,a.begin,a.axis),g=NGL.Utils.pointVectorIntersection(this.end,a.begin,a.axis),h=NGL.Utils.pointVectorIntersection(a.begin,
this.begin,this.axis),k=NGL.Utils.pointVectorIntersection(a.end,this.begin,this.axis),l=NGL.Utils.isPointOnSegment(f,a.begin,a.end),m=NGL.Utils.isPointOnSegment(g,a.begin,a.end),n=NGL.Utils.isPointOnSegment(h,this.begin,this.end),q=NGL.Utils.isPointOnSegment(k,this.begin,this.end),p=[0,0,0,0];l&&m&&(p[0]=f.distanceTo(g));n&&q&&(p[1]=h.distanceTo(k));l&&!m&&(g.distanceTo(a.begin)<g.distanceTo(a.end)?p[2]=f.distanceTo(a.begin):p[2]=f.distanceTo(a.end));!l&&m&&(f.distanceTo(a.begin)<f.distanceTo(a.end)?
p[2]=g.distanceTo(a.begin):p[2]=g.distanceTo(a.end));n&&!q&&(k.distanceTo(this.begin)<k.distanceTo(this.end)?p[3]=h.distanceTo(this.begin):p[3]=h.distanceTo(this.end));!n&&q&&(h.distanceTo(this.begin)<h.distanceTo(this.end)?p[3]=k.distanceTo(this.begin):p[3]=k.distanceTo(this.end));var r=Math.max.apply(null,p),s=[l,m,n,q];if(e)b={distance:this.distanceTo(a),contact:!0,p1:d[0],p2:d[1]};else{d=[];if(120<c||60>c)d.push({distance:this.begin.distanceTo(f),contact:l,p1:this.begin,p2:f}),d.push({distance:this.end.distanceTo(g),
contact:m,p1:this.end,p2:g}),d.push({distance:a.begin.distanceTo(h),contact:n,p1:a.begin,p2:h}),d.push({distance:a.end.distanceTo(k),contact:q,p1:a.end,p2:k});0<r&&(120<c||60>c)&&(d.push({distance:this.begin.distanceTo(a.begin),contact:!0,p1:this.begin,p2:a.begin}),d.push({distance:this.begin.distanceTo(a.end),contact:!0,p1:this.begin,p2:a.end}),d.push({distance:this.end.distanceTo(a.begin),contact:!0,p1:this.end,p2:a.begin}),d.push({distance:this.end.distanceTo(a.end),contact:!0,p1:this.end,p2:a.end}));
b.distance=Infinity;d.forEach(function(a){a.contact&&a.distance<b.distance&&(b=a)})}return Object.assign({distance:Infinity,contact:!1,angle:c,onSegment:s,overlap:p,maxOverlap:r,lineContact:e},b)}};NGL.Helixbundle=function(a){this.polymer=a;this.helixorient=new NGL.Helixorient(a);this.position=this.helixorient.getPosition()};
NGL.Helixbundle.prototype={constructor:NGL.Helixbundle,getAxis:function(a,b,c,d,e,f){a=a||30;b=b||2.5;c=void 0===c?!1:c;var g=this.polymer,h=g.structure,k=g.residueCount,g=g.residueIndexStart,l=this.position,m=d||{};m.structure=h;d=NGL.ColorMakerRegistry.getScheme(m);m=NGL.ColorMakerRegistry.getPickingScheme(m);e=new NGL.RadiusFactory(e,f);for(var n=f=0,q=[],p=[],r=[],s=[],u=[],v=[],w=[],x=[],t=[],z=[],y=[],A,B=new THREE.Vector3,L=new THREE.Vector3,C=h.getResidueProxy(),P=h.getResidueProxy(),h=h.getAtomProxy(),
M=new THREE.Vector3,W=new THREE.Vector3,y=!1,K=0;K<k;++K)C.index=g+K,M.fromArray(l.center,3*K),K===k-1?y=!0:(P.index=g+K+1,W.fromArray(l.center,3*K+3),c&&C.sstruc!==P.sstruc?y=!0:M.distanceTo(W)>b?y=!0:l.bending[K]>a&&(y=!0)),y&&(4>K-f||(h.index=C.traceAtomIndex,z=l.axis.subarray(3*f+3,3*K),y=l.center.subarray(3*f,3*K+3),z=NGL.Utils.calculateMeanVector3(z).normalize(),A=NGL.Utils.calculateMeanVector3(y),B.fromArray(y),B=NGL.Utils.pointVectorIntersection(B,A,z),L.fromArray(y,y.length-3),L=NGL.Utils.pointVectorIntersection(L,
A,z),z.subVectors(L,B),z.toArray(q,n),A.toArray(p,n),B.toArray(r,n),L.toArray(s,n),d.atomColorToArray(h,u,n),m.atomColorToArray(h,v,n),w.push(e.atomRadius(h)),x.push(g+f),t.push(g+K+1-f),n+=3),f=K,y=!1);return{axis:new Float32Array(q),center:new Float32Array(p),begin:new Float32Array(r),end:new Float32Array(s),color:new Float32Array(u),pickingColor:new Float32Array(v),size:new Float32Array(w),residueOffset:x,residueCount:t}}};NGL.HelixCrossing=function(a){this.helices=a};
NGL.HelixCrossing.prototype={constructor:NGL.HelixCrossing,getCrossing:function(a){a=a||12;for(var b=this.helices,c=[],d=[],e=[],f=[],g=[],h=0,k=0;k<b.length;++k){var l=b[k];c.push("H"+(k+1));l.center.toArray(d,3*k);for(var m=k+1;m<b.length;++m){var n=l.crossing(b[m]);n.contact&&n.distance<a&&(g.push({helix1:k+1,helix2:m+1,angle:n.angle,distance:n.distance,overlap:n.maxOverlap}),n.p1.toArray(e,3*h),n.p2.toArray(f,3*h),h+=1)}}return{helixLabel:c,helixCenter:d,begin:e,end:f,info:g}}};
NGL.Kdtree=function(a,b){var c=b?function(a,b){var c=a[0]-b[0],d=a[1]-b[1],e=a[2]-b[2];return c*c+d*d+e*e}:function(a,b){var c=a[0]-b[0],d=a[1]-b[1],e=a[2]-b[2];return Math.sqrt(c*c+d*d+e*e)},d=new Float32Array(4*a.atomCount),e=0;a.eachAtom(function(a){var b=4*e;d[b+0]=a.x;d[b+1]=a.y;d[b+2]=a.z;d[b+3]=a.index;e+=1});this.points=d;this.kdtree=new THREE.TypedArrayUtils.Kdtree(d,c,4,3)};
NGL.Kdtree.prototype={nearest:function(){var a=new Float32Array(3);return function(b,c,d){b instanceof THREE.Vector3?b.toArray(a):b instanceof NGL.AtomProxy&&b.positionToArray(a);b=this.kdtree.nearest(a,c,d);c=this.points;d=[];for(var e=0,f=b.length;e<f;++e){var g=b[e];d.push({index:c[g[0].pos+3],distance:g[1]})}return d}}()};NGL.Contact=function(a,b){this.atomSet1=a;this.atomSet2=b;this.kdtree1=new NGL.Kdtree(a);this.kdtree2=new NGL.Kdtree(b)};
NGL.Contact.prototype={within:function(a,b){NGL.time("NGL.Contact within");for(var c=new NGL.AtomSet,d=new NGL.BondSet,e=this.kdtree2,f=this.atomSet1.atoms,g=0,h=f.length;g<h;++g){for(var k=f[g],l=!1,m=e.nearest(k,Infinity,a),n=0,q=m.length;n<q;++n){var p=m[n],r=p.atom,p=p.distance;k.residue!==r.residue&&(!b||p>b)&&(l=!0,c.addAtom(r),d.addBond(k,r,!0))}l&&c.addAtom(k)}NGL.timeEnd("NGL.Contact within");return{atomSet:c,bondSet:d}}};
NGL.polarContacts=function(a,b,c){b=b||3.5;c=c||40;var d=new NGL.Selection("( ARG and ( .NE or .NH1 or .NH2 ) ) or ( ASP and .ND2 ) or ( GLN and .NE2 ) or ( HIS and ( .ND1 or .NE2 ) ) or ( LYS and .NZ ) or ( SER and .OG ) or ( THR and .OG1 ) or ( TRP and .NE1 ) or ( TYR and .OH ) or ( PROTEIN and .N )"),e=new NGL.Selection("( ASN and .OD1 ) or ( ASP and ( OD1 or .OD2 ) ) or ( GLN and .OE1 ) or ( GLU and ( .OE1 or .OE2 ) ) or ( HIS and ( .ND1 or .NE2 ) ) or ( SER and .OG ) or ( THR and .OG1 ) or ( TYR and .OH ) or ( PROTEIN and .O )"),
d=new NGL.AtomSet(a,d),e=new NGL.AtomSet(a,e);b=(new NGL.Contact(d,e)).within(b);b.atomSet.structure=a;b.bondSet.structure=a;var f=new NGL.BondSet,g=new THREE.Vector3,h=new THREE.Vector3;b.bondSet.eachBond(function(a){var b=a.atom1;a=a.atom2;if(!("O"===b.atomname&&"N"===a.atomname||"N"===b.atomname&&"O"===a.atomname))if("N"===b.atomname||"N"===a.atomname){var d,e;"N"===b.atomname?(d=b,e=a):(d=a,e=b);var q=d.residue.getAtomByName("CA");if(q){var p=d.residue.getPreviousConnectedResidue();p&&(p=p.getAtomByName("C"))&&
(g.subVectors(d,p),h.subVectors(d,q),g.add(h).multiplyScalar(.5),h.subVectors(e,d),THREE.Math.radToDeg(g.angleTo(h))<c&&f.addBond(b,a,!0))}}else"OH"===b.atomname&&"TYR"===b.resname||"OH"===a.atomname&&"TYR"===a.resname?("OH"===b.atomname?(d=b,e=a):(d=a,e=b),q=d.residue.getAtomByName("CZ"),g.subVectors(q,d),h.subVectors(q,e),THREE.Math.radToDeg(g.angleTo(h))<c&&f.addBond(b,a,!0)):f.addBond(b,a,!0)});f.structure=a;b.bondSet.dispose();d.dispose();e.dispose();return{atomSet:b.atomSet,bondSet:f}};
NGL.polarBackboneContacts=function(a,b,c){b=b||3.5;c=c||40;var d=new NGL.Selection("( PROTEIN and .N )"),e=new NGL.Selection("( PROTEIN and .O )"),d=new NGL.AtomSet(a,d),e=new NGL.AtomSet(a,e);b=(new NGL.Contact(d,e)).within(b);b.atomSet.structure=a;b.bondSet.structure=a;var f=new NGL.BondSet,g=new THREE.Vector3,h=new THREE.Vector3;b.bondSet.eachBond(function(a){var b=a.atom1;a=a.atom2;var d,e;"N"===b.atomname?(d=b,e=a):(d=a,e=b);var q=d.residue.getAtomByName("CA");if(q){var p=d.residue.getPreviousConnectedResidue();
p&&(p=p.getAtomByName("C"))&&(g.subVectors(d,p),h.subVectors(d,q),g.add(h).multiplyScalar(.5),h.subVectors(e,d),THREE.Math.radToDeg(g.angleTo(h))<c&&f.addBond(b,a,!0))}});f.structure=a;b.bondSet.dispose();d.dispose();e.dispose();return{atomSet:b.atomSet,bondSet:f}};NGL.Selection=function(a){this.signals={stringChanged:new signals.Signal};this.setString(a)};NGL.Selection.Keywords={PROTEIN:1,NUCLEIC:2,RNA:3,DNA:4,POLYMER:5,WATER:6,HELIX:7,SHEET:8,BACKBONE:9,SIDECHAIN:10,ALL:11,HETERO:12,ION:13};
NGL.Selection.prototype={constructor:NGL.Selection,setString:function(a,b){void 0===a&&(a=this.string||"");if(a!==this.string){try{this.parse(a)}catch(c){this.selection={error:c.message}}this.string=a;this.test=this.makeAtomTest();this.residueTest=this.makeResidueTest();this.chainTest=this.makeChainTest();this.modelTest=this.makeModelTest();this.atomOnlyTest=this.makeAtomTest(!0);this.residueOnlyTest=this.makeResidueTest(!0);this.chainOnlyTest=this.makeChainTest(!0);this.modelOnlyTest=this.makeModelTest(!0);
b||this.signals.stringChanged.dispatch(this.string)}},parse:function(a){this.selection={operator:void 0,rules:[]};if(a){var b=this,c=NGL.Selection.Keywords,d=this.selection,e=[],f,g;a=a.replace(/\(/g," ( ").replace(/\)/g," ) ").trim();"("===a.charAt(0)&&")"===a.substr(-1)&&(a=a.slice(1,-1).trim());a=a.split(/\s+/);var h=["*","","ALL"],k,l,m,n,q=function(a){f={operator:a,rules:[]};void 0===d?(d=f,b.selection=f):(d.rules.push(f),e.push(d),d=f)},p=function(a){g=d;d=e.pop();void 0===d&&(q(a),r(g))},r=
function(a){d.rules.push(a)};for(m=0;m<a.length;++m)if(k=a[m],"("===k)n=!1,q();else if(")"===k)p(),d.negate&&p();else{if(0<n)if("NOT"===k.toUpperCase())n=1;else if(1===n)n=2;else if(2===n)n=!1,p();else throw Error("something went wrong with 'not'");if("AND"===k.toUpperCase())"OR"===d.operator?(l=d.rules.pop(),q("AND"),r(l)):d.operator="AND";else if("OR"===k.toUpperCase())"AND"===d.operator?p("OR"):d.operator="OR";else if("NOT"===k.toUpperCase())n=1,q(),d.negate=!0;else if(l={},"HETERO"===k.toUpperCase())l.keyword=
c.HETERO,r(l);else if("WATER"===k.toUpperCase())l.keyword=c.WATER,r(l);else if("PROTEIN"===k.toUpperCase())l.keyword=c.PROTEIN,r(l);else if("NUCLEIC"===k.toUpperCase())l.keyword=c.NUCLEIC,r(l);else if("RNA"===k.toUpperCase())l.keyword=c.RNA,r(l);else if("DNA"===k.toUpperCase())l.keyword=c.DNA,r(l);else if("POLYMER"===k.toUpperCase())l.keyword=c.POLYMER,r(l);else if("ION"===k.toUpperCase())l.keyword=c.ION,r(l);else if("HYDROGEN"===k.toUpperCase())l.element="H",r(l);else if("SMALL"===k.toUpperCase())l=
{operator:"OR",rules:[{resname:"GLY"},{resname:"ALA"}]},r(l);else if("NUCLEOPHILIC"===k.toUpperCase())l={operator:"OR",rules:[{resname:"SER"},{resname:"THR"},{resname:"CYS"}]},r(l);else if("HYDROPHOBIC"===k.toUpperCase())l={operator:"OR",rules:[{resname:"VAL"},{resname:"LEU"},{resname:"ILE"},{resname:"MET"},{resname:"PRO"}]},r(l);else if("AROMATIC"===k.toUpperCase())l={operator:"OR",rules:[{resname:"PHE"},{resname:"TYR"},{resname:"TRP"}]},r(l);else if("AMIDE"===k.toUpperCase())l={operator:"OR",rules:[{resname:"ASN"},
{resname:"GLN"}]},r(l);else if("ACIDIC"===k.toUpperCase())l={operator:"OR",rules:[{resname:"ASP"},{resname:"GLU"}]},r(l);else if("BASIC"===k.toUpperCase())l={operator:"OR",rules:[{resname:"HIS"},{resname:"LYS"},{resname:"ARG"}]},r(l);else if("CHARGED"===k.toUpperCase())l={operator:"OR",rules:[{resname:"ASP"},{resname:"GLU"},{resname:"HIS"},{resname:"LYS"},{resname:"ARG"}]},r(l);else if("POLAR"===k.toUpperCase())l={operator:"OR",rules:[{resname:"ASP"},{resname:"GLU"},{resname:"HIS"},{resname:"LYS"},
{resname:"ARG"},{resname:"ASN"},{resname:"GLN"},{resname:"SER"},{resname:"THR"},{resname:"TYR"}]},r(l);else if("NONPOLAR"===k.toUpperCase())l={operator:"OR",rules:[{resname:"ALA"},{resname:"CYS"},{resname:"GLY"},{resname:"ILE"},{resname:"LEU"},{resname:"MET"},{resname:"PHE"},{resname:"PRO"},{resname:"VAL"},{resname:"TRP"}]},r(l);else if("HELIX"===k.toUpperCase())l.keyword=c.HELIX,r(l);else if("SHEET"===k.toUpperCase())l.keyword=c.SHEET,r(l);else if("TURN"===k.toUpperCase())l={operator:"AND",rules:[{operator:"OR",
negate:!0,rules:[{keyword:c.HELIX},{keyword:c.SHEET}]},{operator:"OR",rules:[{keyword:c.PROTEIN},{sstruc:"s"},{sstruc:"t"},{sstruc:"l"}]}]},r(l);else if("BACKBONE"===k.toUpperCase())l.keyword=c.BACKBONE,r(l);else if("SIDECHAIN"===k.toUpperCase())l.keyword=c.SIDECHAIN,r(l);else if("SIDECHAINATTACHED"===k.toUpperCase())l={operator:"OR",rules:[{keyword:c.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:c.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",
negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:c.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"C5'"},{atomname:"C5*"}]}]}]},r(l);else if(-1!==h.indexOf(k.toUpperCase()))l.keyword=c.ALL,r(l);else if("@"===k.charAt(0)){k=k.substr(1).split(",");for(var s=0,u=k.length;s<u;++s)k[s]=parseInt(k[s]);k.sort(function(a,b){return a-b});l.atomindex=
k;r(l)}else if("#"===k.charAt(0))l.element=k.substr(1).toUpperCase(),r(l);else if("~"===k.charAt(0))l.altloc=k.substr(1),r(l);else if("["===k[0]&&"]"===k[k.length-1])l.resname=k.substr(1,k.length-2).toUpperCase(),r(l);else if(1<=k.length&&4>=k.length&&":"!==k[0]&&"."!==k[0]&&"/"!==k[0]&&isNaN(parseInt(k)))l.resname=k.toUpperCase(),r(l);else{l={operator:"AND",rules:[]};k=k.split("/");if(1<k.length&&k[1]){if(isNaN(parseInt(k[1])))throw Error("model must be an integer");l.rules.push({model:parseInt(k[1])})}k=
k[0].split(".");if(1<k.length&&k[1]){if(4<k[1].length)throw Error("atomname must be one to four characters");l.rules.push({atomname:k[1].substring(0,4).toUpperCase()})}k=k[0].split(":");1<k.length&&k[1]&&l.rules.push({chainname:k[1]});if(k[0])if(k=k[0].split("-"),1===k.length){k=parseInt(k[0]);if(isNaN(k))throw Error("resi must be an integer");l.rules.push({resno:k})}else if(2===k.length)l.rules.push({resno:[parseInt(k[0]),parseInt(k[1])]});else throw Error("resi range must contain one '-'");if(1===
l.rules.length)r(l.rules[0]);else if(1<l.rules.length)r(l);else throw Error("empty selection chunk");}}void 0===this.selection.operator&&1===this.selection.rules.length&&this.selection.rules[0].hasOwnProperty("operator")&&(this.selection=this.selection.rules[0])}},_makeTest:function(a,b){void 0===b&&(b=this.selection);if(null===b||b.error)return!1;var c=b.rules.length;if(0===c)return!1;for(var d=b.negate?!1:!0,e=b.negate?!0:!1,f=NGL.Selection.Keywords,g,h,k,l,m=[],n=0;n<c;++n)g=b.rules[n],g.hasOwnProperty("operator")&&
(m[n]=this._makeTest(a,g));return function(n){h="AND"===b.operator;l=!1;for(var p=0;p<c;++p){g=b.rules[p];if(g.hasOwnProperty("operator"))k=m[p]?m[p](n):-1;else{if(g.keyword===f.ALL)if(h)continue;else return d;k=a(n,g)}if(-1===k)l=!0;else if(!0===k){if(!h)return d}else if(h)return e}return l?-1:h?d:e}},_filter:function(a,b){void 0===b&&(b=this.selection);if(b.error)return b;var c=b.rules.length;if(0===c)return b;var d=[];b.hasOwnProperty("negate");for(var e=0;e<c;++e){var f=b.rules[e];f.hasOwnProperty("operator")?
(f=this._filter(a,f),null!==f&&d.push(f)):a(f)||d.push(f)}return 0<d.length?b:null},makeAtomTest:function(a){var b=["h","g","i"],c=["e","b"],d=NGL.Selection.Keywords;a=a?this._filter(function(a){return void 0!==a.keyword&&a.keyword!==d.BACKBONE&&a.keyword!==d.SIDECHAIN||void 0!==a.model||void 0!==a.chainname||void 0!==a.resname||void 0!==a.resno||void 0!==a.sstruc?!0:!1}):this.selection;return this._makeTest(function(a,f){if(void 0===f.atomname&&void 0===f.element&&void 0===f.altloc&&void 0===f.atomindex&&
void 0===f.keyword&&void 0===f.resname&&void 0===f.sstruc&&void 0===f.resno&&void 0===f.chainname&&void 0===f.model)return-1;if(void 0!==f.keyword&&(f.keyword===d.BACKBONE&&!a.isBackbone()||f.keyword===d.SIDECHAIN&&!a.isSidechain()||f.keyword===d.HETERO&&!a.isHetero()||f.keyword===d.PROTEIN&&!a.isProtein()||f.keyword===d.NUCLEIC&&!a.isNucleic()||f.keyword===d.RNA&&!a.isRna()||f.keyword===d.DNA&&!a.isDna()||f.keyword===d.POLYMER&&!a.isPolymer()||f.keyword===d.WATER&&!a.isWater()||f.keyword===d.HELIX&&
-1===b.indexOf(a.sstruc)||f.keyword===d.SHEET&&-1===c.indexOf(a.sstruc)||f.keyword===d.ION&&!a.isIon())||void 0!==f.atomname&&f.atomname!==a.atomname||void 0!==f.element&&f.element!==a.element||void 0!==f.altloc&&f.altloc!==a.altloc||void 0!==f.atomindex&&0>NGL.binarySearchIndexOf(f.atomindex,a.index)||void 0!==f.resname&&f.resname!==a.resname||void 0!==f.sstruc&&f.sstruc!==a.sstruc)return!1;if(void 0!==f.resno)if(Array.isArray(f.resno)&&2===f.resno.length){if(f.resno[0]>a.resno||f.resno[1]<a.resno)return!1}else if(f.resno!==
a.resno)return!1;return void 0!==f.chainname&&f.chainname!==a.chainname||void 0!==f.model&&f.model!==a.modelIndex?!1:!0},a)},makeResidueTest:function(a){var b=["h","g","i"],c=["e","b"],d=NGL.Selection.Keywords;a=a?this._filter(function(a){return a.keyword===d.BACKBONE||a.keyword===d.SIDECHAIN||void 0!==a.model||void 0!==a.chainname||void 0!==a.atomname||void 0!==a.element||void 0!==a.altloc||void 0!==a.atomindex?!0:!1}):this.selection;return this._makeTest(function(a,f){if(void 0===f.resname&&void 0===
f.resno&&void 0===f.sstruc&&void 0===f.model&&void 0===f.chainname&&(void 0===f.keyword||f.keyword===d.BACKBONE||f.keyword===d.SIDECHAIN))return-1;if(void 0!==f.keyword&&(f.keyword===d.HETERO&&!a.isHetero()||f.keyword===d.PROTEIN&&!a.isProtein()||f.keyword===d.NUCLEIC&&!a.isNucleic()||f.keyword===d.RNA&&!a.isRna()||f.keyword===d.DNA&&!a.isDna()||f.keyword===d.POLYMER&&!a.isPolymer()||f.keyword===d.WATER&&!a.isWater()||f.keyword===d.HELIX&&-1===b.indexOf(a.sstruc)||f.keyword===d.SHEET&&-1===c.indexOf(a.sstruc)||
f.keyword===d.ION&&!a.isIon())||void 0!==f.resname&&f.resname!==a.resname||void 0!==f.sstruc&&f.sstruc!==a.sstruc)return!1;if(void 0!==f.resno)if(Array.isArray(f.resno)&&2===f.resno.length){if(f.resno[0]>a.resno||f.resno[1]<a.resno)return!1}else if(f.resno!==a.resno)return!1;return void 0!==f.chainname&&f.chainname!==a.chainname||void 0!==f.model&&f.model!==a.modelIndex?!1:!0},a)},makeChainTest:function(a){a=a?this._filter(function(a){return void 0!==a.keyword||void 0!==a.resname||void 0!==a.resno||
void 0!==a.atomname||void 0!==a.element||void 0!==a.altloc||void 0!==a.sstruc||void 0!==a.atomindex?!0:!1}):this.selection;return this._makeTest(function(a,c){return void 0===c.chainname&&void 0===c.model?-1:void 0!==c.chainname&&c.chainname!==a.chainname||void 0!==c.model&&c.model!==a.modelIndex?!1:!0},a)},makeModelTest:function(a){a=a?this._filter(function(a){return void 0!==a.keyword||void 0!==a.chainname||void 0!==a.resname||void 0!==a.resno||void 0!==a.atomname||void 0!==a.element||void 0!==
a.altloc||void 0!==a.sstruc||void 0!==a.atomindex?!0:!1}):this.selection;return this._makeTest(function(a,c){return void 0===c.model?-1:void 0!==c.model&&c.model!==a.index?!1:!0},a)}};NGL.Matrix=function(a,b){return new jsfeat.matrix_t(a,b,jsfeat.F32_t|jsfeat.C1_t)};
NGL.Superposition=function(a,b){var c;"function"===typeof a.eachAtom?c=a.atomCount:a instanceof Float32Array&&(c=a.length/3);var d=new NGL.Matrix(3,c),e=new NGL.Matrix(3,c);this.coords1t=new NGL.Matrix(c,3);this.coords2t=new NGL.Matrix(c,3);this.A=new NGL.Matrix(3,3);this.W=new NGL.Matrix(1,3);this.U=new NGL.Matrix(3,3);this.V=new NGL.Matrix(3,3);this.VH=new NGL.Matrix(3,3);this.R=new NGL.Matrix(3,3);this.tmp=new NGL.Matrix(3,3);this.c=new NGL.Matrix(3,3);this.c.data.set([1,0,0,0,1,0,0,0,-1]);this.prepCoords(a,
d);this.prepCoords(b,e);this._superpose(d,e)};
NGL.Superposition.prototype={constructor:NGL.Superposition,_superpose:function(a,b){this.mean1=jsfeat.matmath.mean_rows(a);this.mean2=jsfeat.matmath.mean_rows(b);jsfeat.matmath.sub_rows(a,this.mean1);jsfeat.matmath.sub_rows(b,this.mean2);jsfeat.matmath.transpose(this.coords1t,a);jsfeat.matmath.transpose(this.coords2t,b);jsfeat.matmath.multiply_ABt(this.A,this.coords2t,this.coords1t);jsfeat.linalg.svd_decompose(this.A,this.W,this.U,this.V);jsfeat.matmath.invert_3x3(this.V,this.VH);jsfeat.matmath.multiply_3x3(this.R,
this.U,this.VH);0>jsfeat.matmath.mat3x3_determinant(this.R)&&(NGL.log("R not a right handed system"),jsfeat.matmath.multiply_3x3(this.tmp,this.c,this.VH),jsfeat.matmath.multiply_3x3(this.R,this.U,this.tmp))},prepCoords:function(a,b){var c=0,d=b.data;"function"===typeof a.eachAtom?a.eachAtom(function(a){d[c+0]=a.x;d[c+1]=a.y;d[c+2]=a.z;c+=3}):a instanceof Float32Array?d.set(a):NGL.warn("prepCoords: input type unknown")},transform:function(a){var b;"function"===typeof a.eachAtom?b=a.atomCount:a instanceof
Float32Array&&(b=a.length/3);var c=new NGL.Matrix(3,b),d=new NGL.Matrix(b,3);this.prepCoords(a,c);jsfeat.matmath.sub_rows(c,this.mean1);jsfeat.matmath.multiply_ABt(d,this.R,c);jsfeat.matmath.transpose(c,d);jsfeat.matmath.add_rows(c,this.mean2);var e=0,f=c.data;"function"===typeof a.eachAtom?a.eachAtom(function(a){a.x=f[e+0];a.y=f[e+1];a.z=f[e+2];e+=3}):a instanceof Float32Array?a.set(f.subarray(0,3*b)):NGL.warn("transform: input type unknown")}};
NGL.superpose=function(a,b,c,d,e,f,g){d=d||"";e=e||"";f=f||"";g=g||"";var h,k;if(c){c=a;var l=b;d&&e&&(c=new NGL.StructureSubset(a,new NGL.Selection(d)),l=new NGL.StructureSubset(b,new NGL.Selection(e)));b=c.getSequence();d=l.getSequence();d=new NGL.Alignment(b.join(""),d.join(""));d.calc();d.trace();var m,n,q,p,r=0,s=0;b=d.ali1.length;var u=[],v=[];for(e=0;e<b;++e)q=d.ali1[e],p=d.ali2[e],n=m=0,"-"===q?v[s]=!1:(v[s]=!0,m=1),"-"===p?u[r]=!1:(u[r]=!0,n=1),r+=m,s+=n;h=new NGL.AtomSet;k=new NGL.AtomSet;
r=0;c.eachResidue(function(a){a.getResname1()&&a.getAtomByName("CA")&&(u[r]&&h.addAtom(a.getAtomByName("CA")),r+=1)});r=0;l.eachResidue(function(a){a.getResname1()&&a.getAtomByName("CA")&&(v[r]&&k.addAtom(a.getAtomByName("CA")),r+=1)})}else h=new NGL.AtomSet(a,new NGL.Selection(d+" and .CA")),k=new NGL.AtomSet(b,new NGL.Selection(e+" and .CA"));if(f&&g){c=new NGL.AtomSet;l=new NGL.AtomSet;f=new NGL.Selection(f);b=new NGL.Selection(g);g=f.test;f=b.test;b=h.atomCount;for(r=0;r<b;++r)d=h.atoms[r],e=
k.atoms[r],g(d)&&f(e)&&(c.addAtom(d),l.addAtom(e));h=c;k=l}g=new NGL.Superposition(h,k);f=new NGL.AtomSet(a,new NGL.Selection("*"));g.transform(f);a.center=a.atomCenter()};
NGL.GidPool={nextGid:1,objectList:[],rangeList:[],getBaseObject:function(a){"StructureView"===a.type&&(a=a.getStructure());return a},addObject:function(a){a=this.getBaseObject(a);NGL.GidPool.objectList.push(a);NGL.GidPool.rangeList.push(NGL.GidPool.allocateGidRange(a));return NGL.GidPool},removeObject:function(a){a=this.getBaseObject(a);a=NGL.GidPool.objectList.indexOf(a);-1!==a&&(NGL.GidPool.objectList.splice(a,1),NGL.GidPool.rangeList.splice(a,1),0===NGL.GidPool.objectList.length&&(NGL.GidPool.nextGid=
1));return NGL.GidPool},updateObject:function(a,b){a=this.getBaseObject(a);var c=NGL.GidPool.objectList.indexOf(a);if(-1!==c){var d=NGL.GidPool.rangeList[c];d[1]===NGL.GidPool.nextGid?(c=NGL.GidPool.getGidCount(a),NGL.GidPool.nextGid+=c-(d[1]-d[0]),d[1]=NGL.GidPool.nextGid):NGL.GidPool.rangeList[c]=NGL.GidPool.allocateGidRange(a)}else b||NGL.warn("NGL.GidPool.updateObject: object not found.");return NGL.GidPool},getGidCount:function(a){a=this.getBaseObject(a);var b=0;"Structure"===a.type?b=a.atomStore.count+
a.bondStore.count+a.backboneBondStore.count+a.rungBondStore.count:"Volume"===a.type?b=a.__data.length:NGL.warn("NGL.GidPool.getGidCount: unknown object type");return b},allocateGidRange:function(a){a=this.getBaseObject(a);var b=NGL.GidPool.nextGid;NGL.GidPool.nextGid+=NGL.GidPool.getGidCount(a);NGL.GidPool.nextGid>Math.pow(2,24)&&NGL.error("NGL.GidPool.allocateGidRange: GidPool overflown");return[b,NGL.GidPool.nextGid]},freeGidRange:function(a){this.getBaseObject(a)},getNextGid:function(){return NGL.GidPool.nextGid++},
getGid:function(a,b){a=this.getBaseObject(a);b=b||0;var c=0,d=NGL.GidPool.objectList.indexOf(a);-1!==d?c=NGL.GidPool.rangeList[d][0]+b:NGL.warn("NGL.GidPool.getGid: object not found.");return c},getByGid:function(a){var b;NGL.GidPool.objectList.forEach(function(c,d){var e=NGL.GidPool.rangeList[d];a<e[0]||a>=e[1]||(e=a-e[0],"Structure"===c.type?e<=c.atomStore.count?b=c.getAtomProxy(e):e<=c.atomStore.count+c.bondStore.count?(e-=c.atomStore.count,b=c.getBondProxy(e)):e<=c.atomStore.count+c.bondStore.count+
c.backboneBondStore.count?(e-=c.atomStore.count+c.bondStore.count,b=c.getBondProxy(e),b.bondStore=c.backboneBondStore):e<=c.atomStore.count+c.bondStore.count+c.backboneBondStore.count+c.rungBondStore.count?(e-=c.atomStore.count+c.bondStore.count+c.backboneBondStore.count,b=c.getBondProxy(e),b.bondStore=c.rungBondStore):NGL.warn("NGL.GidPool.getByGid: invalid Structure gid",a):"Volume"===c.type?b={volume:c,index:e,value:c.data[e],x:c.dataPosition[3*e],y:c.dataPosition[3*e+1],z:c.dataPosition[3*e+2]}:
NGL.warn("NGL.GidPool.getByGid: unknown object type for gid",a))});return b}};
NGL.ColorMakerRegistry={signals:{},scales:{"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",
RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",roygb:"[?] Rainbow",rwb:"[?] Red-White-Blue"},modes:{"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",
hcl:"Hue Chroma Lightness"},types:{},userSchemes:{},getScheme:function(a){var b=(a||{}).scheme||"";return new (b in NGL.ColorMakerRegistry.types?NGL.ColorMakerRegistry.types[b]:b in NGL.ColorMakerRegistry.userSchemes?NGL.ColorMakerRegistry.userSchemes[b]:NGL.ColorMaker)(a)},getPickingScheme:function(a){a=Object.assign(a||{});a.scheme="picking";return NGL.ColorMakerRegistry.getScheme(a)},getTypes:function(){var a={};Object.keys(NGL.ColorMakerRegistry.types).forEach(function(b){a[b]=b});Object.keys(NGL.ColorMakerRegistry.userSchemes).forEach(function(b){a[b]=
b.split("|")[1]});return a},getScales:function(){return NGL.ColorMakerRegistry.scales},getModes:function(){return NGL.ColorMakerRegistry.modes},addScheme:function(a,b){a instanceof NGL.ColorMaker||(a=NGL.ColorMakerRegistry.createScheme(a,b));b=b||"";var c=""+THREE.Math.generateUUID()+"|"+b;NGL.ColorMakerRegistry.userSchemes[c]=a;return c},removeScheme:function(a){delete NGL.ColorMakerRegistry.userSchemes[a]},createScheme:function(a,b){var c=function(c){NGL.ColorMaker.call(this,c);this.label=b||"";
a.call(this,c)};c.prototype=NGL.ColorMaker.prototype;return c.prototype.constructor=c},addSelectionScheme:function(a,b){return NGL.ColorMakerRegistry.addScheme(function(b){var d=[],e=[];a.forEach(function(a){d.push((new THREE.Color(a[0])).getHex());e.push(new NGL.Selection(a[1]))});var f=a.length;this.atomColor=function(a){for(var b=0;b<f;++b)if(e[b].test(a))return d[b];return 16777215}},b)}};
NGL.ColorMaker=function(a){a=a||{};this.scale=a.scale||"uniform";this.mode=a.mode||"hcl";this.domain=a.domain||[0,1];this.value=(new THREE.Color(a.value||16777215)).getHex();this.structure=a.structure;this.volume=a.volume;this.surface=a.surface;this.structure&&(this.atomProxy=this.structure.getAtomProxy())};
NGL.ColorMaker.prototype={constructor:NGL.ColorMaker,getScale:function(a){a=a||{};var b=a.scale||this.scale;"rainbow"===b||"roygb"===b?b=["red","orange","yellow","green","blue"]:"rwb"===b&&(b=["red","white","blue"]);return chroma.scale(b).mode(a.mode||this.mode).domain(a.domain||this.domain).out("num")},colorToArray:function(a,b,c){void 0===b&&(b=[]);void 0===c&&(c=0);b[c+0]=(a>>16&255)/255;b[c+1]=(a>>8&255)/255;b[c+2]=(a&255)/255;return b},atomColor:function(a){return 16777215},atomColorToArray:function(a,
b,c){return this.colorToArray(this.atomColor(a),b,c)},bondColor:function(a,b){this.atomProxy.index=b?a.atomIndex1:a.atomIndex2;return this.atomColor(this.atomProxy)},bondColorToArray:function(a,b,c,d){return this.colorToArray(this.bondColor(a,b),c,d)},volumeColor:function(a){return 16777215},volumeColorToArray:function(a,b,c){return this.colorToArray(this.volumeColor(a),b,c)},positionColor:function(a){return 16777215},positionColorToArray:function(a,b,c){return this.colorToArray(this.positionColor(a),
b,c)}};NGL.VolumeColorMaker=function(a){NGL.ColorMaker.call(this,a);var b=this.getScale();a=this.volume;var c=a.inverseMatrix,d=a.__data,e=a.nx,f=a.ny,g=new THREE.Vector3;this.positionColor=function(a){g.copy(a);g.applyMatrix4(c);g.round();return b(d[(g.z*f+g.y)*e+g.x])}};NGL.VolumeColorMaker.prototype=NGL.ColorMaker.prototype;NGL.VolumeColorMaker.prototype.constructor=NGL.VolumeColorMaker;NGL.ValueColorMaker=function(a){NGL.ColorMaker.call(this,a);var b=this.getScale();this.volumeColor=function(a){return b(this.volume.data[a])}};
NGL.ValueColorMaker.prototype=NGL.ColorMaker.prototype;NGL.ValueColorMaker.prototype.constructor=NGL.ValueColorMaker;
NGL.PickingColorMaker=function(a){NGL.ColorMaker.call(this,a);var b;this.structure&&(b=this.structure.atomStore.count,a.backbone?b+=this.structure.bondStore.count:a.rung&&(b+=this.structure.bondStore.count,b+=this.structure.backboneBondStore.count));this.atomColor=function(a){return NGL.GidPool.getGid(this.structure,a.index)};this.bondColor=function(a,d){return NGL.GidPool.getGid(this.structure,b+a.index)};this.volumeColor=function(a){return NGL.GidPool.getGid(this.volume,a)}};
NGL.PickingColorMaker.prototype=NGL.ColorMaker.prototype;NGL.PickingColorMaker.prototype.constructor=NGL.PickingColorMaker;NGL.RandomColorMaker=function(a){NGL.ColorMaker.call(this,a);this.atomColor=function(a){return 16777215*Math.random()}};NGL.RandomColorMaker.prototype=NGL.ColorMaker.prototype;NGL.RandomColorMaker.prototype.constructor=NGL.RandomColorMaker;
NGL.UniformColorMaker=function(a){NGL.ColorMaker.call(this,a);var b=this.value;this.atomColor=function(){return b};this.bondColor=function(){return b};this.valueColor=function(){return b}};NGL.UniformColorMaker.prototype=NGL.ColorMaker.prototype;NGL.UniformColorMaker.prototype.constructor=NGL.UniformColorMaker;
NGL.AtomindexColorMaker=function(a){NGL.ColorMaker.call(this,a);a.scale||(this.scale="roygb");a.domain||(this.domain=[0,this.structure.atomStore.count]);var b=this.getScale();this.atomColor=function(a){return b(a.index)}};NGL.AtomindexColorMaker.prototype=NGL.ColorMaker.prototype;NGL.AtomindexColorMaker.prototype.constructor=NGL.AtomindexColorMaker;
NGL.ResidueindexColorMaker=function(a){NGL.ColorMaker.call(this,a);a.scale||(this.scale="roygb");a.domain||(this.domain=[0,this.structure.residueStore.count]);var b=this.getScale();this.atomColor=function(a){return b(a.residueIndex)}};NGL.ResidueindexColorMaker.prototype=NGL.ColorMaker.prototype;NGL.ResidueindexColorMaker.prototype.constructor=NGL.ResidueindexColorMaker;
NGL.ChainindexColorMaker=function(a){NGL.ColorMaker.call(this,a);a.scale||(this.scale="Spectral");a.domain||(this.domain=[0,this.structure.chainStore.count]);var b=this.getScale();this.atomColor=function(a){return b(a.chainIndex)}};NGL.ChainindexColorMaker.prototype=NGL.ColorMaker.prototype;NGL.ChainindexColorMaker.prototype.constructor=NGL.ChainindexColorMaker;
NGL.ModelindexColorMaker=function(a){NGL.ColorMaker.call(this,a);a.scale||(this.scale="roygb");a.domain||(this.domain=[0,this.structure.modelStore.count]);var b=this.getScale();this.atomColor=function(a){return b(a.modelIndex)}};NGL.ModelindexColorMaker.prototype=NGL.ColorMaker.prototype;NGL.ModelindexColorMaker.prototype.constructor=NGL.ModelindexColorMaker;
NGL.SstrucColorMaker=function(a){NGL.ColorMaker.call(this,a);var b=NGL.StructureColors,c=NGL.StructureColors[""],d=this.structure.getResidueProxy();this.atomColor=function(a){var f=a.sstruc;if("h"===f)return b.alphaHelix;if("g"===f)return b["3_10Helix"];if("i"===f)return b.piHelix;if("e"===f||"b"===f)return b.betaStrand;d.index=a.residueIndex;return d.isNucleic()?b.dna:d.isProtein()||"s"===f||"t"===f||"l"===f?b.coil:c}};NGL.SstrucColorMaker.prototype=NGL.ColorMaker.prototype;
NGL.SstrucColorMaker.prototype.constructor=NGL.SstrucColorMaker;NGL.ElementColorMaker=function(a){NGL.ColorMaker.call(this,a);var b=NGL.ElementColors,c=NGL.ElementColors[""],d=this.value;void 0===a.value&&(d=NGL.ElementColors.C);this.atomColor=function(a){a=a.element;return"C"===a?d:b[a]||c}};NGL.ElementColorMaker.prototype=NGL.ColorMaker.prototype;NGL.ElementColorMaker.prototype.constructor=NGL.ElementColorMaker;
NGL.ResnameColorMaker=function(a){NGL.ColorMaker.call(this,a);var b=NGL.ResidueColors,c=NGL.ResidueColors[""];this.atomColor=function(a){return b[a.resname]||c}};NGL.ResnameColorMaker.prototype=NGL.ColorMaker.prototype;NGL.ResnameColorMaker.prototype.constructor=NGL.ResnameColorMaker;
NGL.BfactorColorMaker=function(a){NGL.ColorMaker.call(this,a);a.scale||(this.scale="OrRd");if(!a.domain){var b,c=Infinity,d=-Infinity;a.sele&&(b=new NGL.Selection(a.sele));this.structure.eachAtom(function(a){a=a.bfactor;c=Math.min(c,a);d=Math.max(d,a)},b);this.domain=[c,d]}var e=this.getScale();this.atomColor=function(a){return e(a.bfactor)}};NGL.BfactorColorMaker.prototype=NGL.ColorMaker.prototype;NGL.BfactorColorMaker.prototype.constructor=NGL.BfactorColorMaker;
NGL.HydrophobicityColorMaker=function(a){NGL.ColorMaker.call(this,a);a.scale||(this.scale="RdYlGn");var b={},c;for(c in NGL.ResidueHydrophobicity)b[c]=NGL.ResidueHydrophobicity[c][0];var d=b[""];if(!a.domain){var e=Infinity,f=-Infinity;for(c in b)a=b[c],e=Math.min(e,a),f=Math.max(f,a);this.domain=[e,0,f]}var g=this.getScale();this.atomColor=function(a){return g(b[a.resname]||d)}};NGL.HydrophobicityColorMaker.prototype=NGL.ColorMaker.prototype;NGL.HydrophobicityColorMaker.prototype.constructor=NGL.HydrophobicityColorMaker;
NGL.ColorMakerRegistry.types={"":NGL.ColorMaker,picking:NGL.PickingColorMaker,random:NGL.RandomColorMaker,uniform:NGL.UniformColorMaker,atomindex:NGL.AtomindexColorMaker,residueindex:NGL.ResidueindexColorMaker,chainindex:NGL.ChainindexColorMaker,modelindex:NGL.ModelindexColorMaker,sstruc:NGL.SstrucColorMaker,element:NGL.ElementColorMaker,resname:NGL.ResnameColorMaker,bfactor:NGL.BfactorColorMaker,hydrophobicity:NGL.HydrophobicityColorMaker,value:NGL.ValueColorMaker,volume:NGL.VolumeColorMaker};
NGL.RadiusFactory=function(a,b){this.type=a;this.scale=b||1;this.max=10};NGL.RadiusFactory.types={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size"};
NGL.RadiusFactory.prototype={constructor:NGL.RadiusFactory,atomRadius:function(a){var b=this.type,c=this.scale,d=NGL.VdwRadii,e=NGL.CovalentRadii,f=NGL.VdwRadii[""],g=NGL.CovalentRadii[""],h=["C3'","C3*","C4'","C4*","P"];switch(b){case "vdw":a=d[a.element]||f;break;case "covalent":a=e[a.element]||g;break;case "bfactor":a=a.bfactor||1;break;case "sstruc":b=a.sstruc;a="h"===b?.25:"g"===b?.25:"i"===b?.25:"e"===b?.25:"b"===b?.25:-1!==h.indexOf(a.atomname)?.4:.1;break;default:a=b||1}return Math.min(a*
c,this.max)}};NGL.LabelFactory=function(a,b){this.type=a;this.text=b||{}};NGL.LabelFactory.types={"":"",atomname:"atom name",atomindex:"atom index",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"residue name + no",text:"text"};
NGL.LabelFactory.prototype={constructor:NGL.LabelFactory,atomLabel:function(a){switch(this.type){case "atomname":a=a.atomname;break;case "atomindex":a=""+a.index;break;case "atom":a=a.atomname+"|"+a.index;break;case "resname":a=a.resname;break;case "resno":a=""+a.resno;break;case "res":a=(NGL.AA1[a.resname.toUpperCase()]||"")+a.resno;break;case "text":a=this.text[a.index];break;default:a=a.qualifiedName()}return void 0===a?"":a}};
NGL.Structure=function(a,b){this.signals={refreshed:new signals.Signal};this.name=a;this.path=b;this.id=this.title="";this.atomSetCache={};this.atomSetDict={};this.biomolDict={};this.defaultAssembly="BU1";this.helices=[];this.sheets=[];this.unitcell=new NGL.Unitcell;this.selection=void 0;this.frames=[];this.boxes=[];this.bondStore=new NGL.BondStore(0);this.backboneBondStore=new NGL.BondStore(0);this.rungBondStore=new NGL.BondStore(0);this.atomStore=new NGL.AtomStore(0);this.residueStore=new NGL.ResidueStore(0);
this.chainStore=new NGL.ChainStore(0);this.modelStore=new NGL.ModelStore(0);this.atomMap=new NGL.AtomMap(this);this.residueMap=new NGL.ResidueMap(this);this.atomSet=this.getAtomSet(this.selection);this.bondSet=this.getBondSet();this.center=new THREE.Vector3;this.boundingBox=new THREE.Box3;NGL.GidPool.addObject(this);this._ap=this.getAtomProxy();this._rp=this.getResidueProxy();this._cp=this.getChainProxy()};
NGL.Structure.prototype={constructor:NGL.Structure,type:"Structure",refresh:function(){NGL.debug&&NGL.time("NGL.Structure.refresh");this.atomSetCache={};this.atomSet=this.getAtomSet2(this.selection);this.bondSet=this.getBondSet();for(var a in this.atomSetDict){var b=this.atomSetDict[a],c=this.getAtomSet2(!1);this.atomSetCache["__"+a]=c.intersection(b)}this.boundingBox=this.getBoundingBox();this.center=this.boundingBox.center();NGL.GidPool.updateObject(this);NGL.debug&&NGL.timeEnd("NGL.Structure.refresh");
this.signals.refreshed.dispatch()},getBondProxy:function(a){return new NGL.BondProxy(this,a)},getAtomProxy:function(a,b){return b?(void 0===this.__tmpAtomProxy&&(this.__tmpAtomProxy=new NGL.AtomProxy(this,a)),this.__tmpAtomProxy):new NGL.AtomProxy(this,a)},getResidueProxy:function(a,b){return b?(void 0===this.__tmpResidueProxy&&(this.__tmpResidueProxy=new NGL.ResidueProxy(this,a)),this.__tmpResidueProxy):new NGL.ResidueProxy(this,a)},getChainProxy:function(a){return new NGL.ChainProxy(this,a)},getModelProxy:function(a){return new NGL.ModelProxy(this,
a)},getBondSet:function(a){NGL.debug&&NGL.time("NGL.Structure.getBondSet");a=this.bondStore.count;var b=new TypedFastBitSet(a),c=this.atomSet;if(c)for(var d=this.getBondProxy(),e=0;e<a;++e)d.index=e,c.has(d.atomIndex1)&&c.has(d.atomIndex2)&&b.add_unsafe(d.index);else b.set_all(!0);NGL.debug&&NGL.timeEnd("NGL.Structure.getBondSet");return b},getBackboneBondSet:function(a){NGL.debug&&NGL.time("NGL.Structure.getBackboneBondSet");a=this.backboneBondStore.count;var b=new TypedFastBitSet(a),c=this.atomSetCache.__backbone;
if(c){var d=this.getBondProxy();d.bondStore=this.backboneBondStore;for(var e=0;e<a;++e)d.index=e,c.has(d.atomIndex1)&&c.has(d.atomIndex2)&&b.add_unsafe(d.index)}else b.set_all(!0);NGL.debug&&NGL.timeEnd("NGL.Structure.getBackboneBondSet");return b},getRungBondSet:function(a){NGL.debug&&NGL.time("NGL.Structure.getRungBondSet");a=this.rungBondStore.count;var b=new TypedFastBitSet(a),c=this.atomSetCache.__rung;if(c){var d=this.getBondProxy();d.bondStore=this.rungBondStore;for(var e=0;e<a;++e)d.index=
e,c.has(d.atomIndex1)&&c.has(d.atomIndex2)&&b.add_unsafe(d.index)}else b.set_all(!0);NGL.debug&&NGL.timeEnd("NGL.Structure.getRungBondSet");return b},getAtomSet:function(a){NGL.debug&&NGL.time("NGL.Structure.getAtomSet");var b,c=this.atomStore.count;if(!1===a)b=new TypedFastBitSet(c);else if(!0===a)b=new TypedFastBitSet(c),b.set_all(!0);else if(a&&a.test){var d=a.string;b=this.atomSetCache[d];d||console.warn("empty seleString");if(void 0===b){b=new TypedFastBitSet(c);var e=this.getAtomProxy();a=a.test;
for(var f=0;f<c;++f)e.index=f,a(e)&&b.add_unsafe(e.index);this.atomSetCache[d]=b}}else b=new TypedFastBitSet(c),b.set_all(!0);NGL.debug&&NGL.timeEnd("NGL.Structure.getAtomSet");return b},getAtomSet2:function(a){NGL.debug&&NGL.time("NGL.Structure.getAtomSet2");var b,c=this.atomStore.count;if(!1===a)b=new TypedFastBitSet(c);else if(!0===a)b=new TypedFastBitSet(c),b.set_all(!0);else if(a&&a.test){var d=a.string;b=this.atomSetCache[d];d||console.warn("empty seleString");void 0===b&&(b=new TypedFastBitSet(c),
this.eachAtom2(function(a){b.add_unsafe(a.index)},a),this.atomSetCache[d]=b)}else b=new TypedFastBitSet(c),b.set_all(!0);NGL.debug&&NGL.timeEnd("NGL.Structure.getAtomSet2");return b},setSelection:function(a){this.selection=a;this.refresh()},getSelection:function(){return this.selection},getStructure:function(){return this},setDefaultAssembly:function(a){this.defaultAssembly=a},eachBond:function(a,b){var c=this.getBondProxy(),d=this.bondSet;b&&b.test&&(d=d?d.new_intersection(this.getBondSet(b)):this.getBondSet(b));
if(d)d.forEach(function(b){c.index=b;a(c)});else for(var d=this.bondStore.count,e=0;e<d;++e)c.index=e,a(c)},getAtomSet3:function(a){NGL.debug&&NGL.time("NGL.Structure.getAtomSet3");var b=this.atomSet;a&&a.test&&(b=b?b.new_intersection(this.getAtomSet2(a)):this.getAtomSet2(a));NGL.debug&&NGL.timeEnd("NGL.Structure.getAtomSet3");return b},eachAtom:function(a,b){var c=this.getAtomProxy(),d=this.getAtomSet3(b),e=this.atomStore.count;if(d&&d.size()<e)d.forEach(function(b){c.index=b;a(c)});else for(d=0;d<
e;++d)c.index=d,a(c)},eachAtom2:function(a,b){if(b&&b.test)this.eachModel(function(c){c.eachAtom2(a,b)},b);else for(var c=this.atomStore.count,d=this.getAtomProxy(),e=0;e<c;++e)d.index=e,a(d)},eachResidue:function(a,b){if(b&&b.test){var c=this.modelStore.count,d=this.getModelProxy();if(b.modelOnlyTest)for(var e=b.modelOnlyTest,f=0;f<c;++f)d.index=f,e(d)&&d.eachResidue(a,b);else for(f=0;f<c;++f)d.index=f,d.eachResidue(a,b)}else for(c=this.residueStore.count,d=this.getResidueProxy(),f=0;f<c;++f)d.index=
f,a(d)},eachResidueN:function(a,b){var c=this.residueStore.count;if(!(c<a)){for(var d=Array(a),e=0;e<a;++e)d[e]=this.getResidueProxy(e);b.apply(this,d);for(var f=a;f<c;++f){for(e=0;e<a;++e)d[e].index+=1;b.apply(this,d)}}},eachPolymer:function(a,b){if(b&&b.modelOnlyTest){var c=b.modelOnlyTest;this.eachModel(function(d){c(d)&&d.eachPolymer(a,b)})}else this.eachModel(function(c){c.eachPolymer(a,b)})},eachChain:function(a,b){if(b&&b.test)this.eachModel(function(c){c.eachChain(a,b)});else for(var c=this.chainStore.count,
d=this.getChainProxy(),e=0;e<c;++e)d.index=e,a(d)},eachModel:function(a,b){var c=this.modelStore.count,d=this.getModelProxy();if(b&&b.test){var e=b.modelOnlyTest;if(e)for(var f=0;f<c;++f)d.index=f,e(d)&&a(d,b);else for(f=0;f<c;++f)d.index=f,a(d,b)}else for(f=0;f<c;++f)d.index=f,a(d)},getAtomData:function(a){a=Object.assign({},a);a.colorParams&&(a.colorParams.structure=this.getStructure());var b=a.what,c=a.atomSet||this.atomSet,d,e,f,g,h,k,l,m={},n=this.getAtomProxy(),q=c.size();if(!b||b.position)g=
new Float32Array(3*q),m.position=g;if(!b||b.color)h=new Float32Array(3*q),m.color=h,e=NGL.ColorMakerRegistry.getScheme(a.colorParams);if(!b||b.pickingColor){k=new Float32Array(3*q);m.pickingColor=k;var p=Object.assign(a.colorParams,{scheme:"picking"});f=NGL.ColorMakerRegistry.getScheme(p)}if(!b||b.radius)l=new Float32Array(q),m.radius=l,d=new NGL.RadiusFactory(a.radiusParams.radius,a.radiusParams.scale);c.forEach(function(a,b){var c=3*b;n.index=a;g&&n.positionToArray(g,c);h&&e.atomColorToArray(n,
h,c);k&&f.atomColorToArray(n,k,c);l&&(l[b]=d.atomRadius(n))});return m},getBondData:function(a){a=Object.assign({},a);a.colorParams&&(a.colorParams.structure=this.getStructure());var b=a.what,c=a.bondSet||this.bondSet,d,e,f,g,h,k,l,m,n,q,p,r={},s=this.getBondProxy();a.bondStore&&(s.bondStore=a.bondStore);var u=this.getAtomProxy(),v=this.getAtomProxy(),w=c.size();if(!b||b.position)g=new Float32Array(3*w),h=new Float32Array(3*w),r.position1=g,r.position2=h;if(!b||b.color)k=new Float32Array(3*w),l=new Float32Array(3*
w),r.color1=k,r.color2=l,e=NGL.ColorMakerRegistry.getScheme(a.colorParams);if(!b||b.pickingColor){m=new Float32Array(3*w);n=new Float32Array(3*w);r.pickingColor1=m;r.pickingColor2=n;var x=Object.assign(a.colorParams,{scheme:"picking"});f=NGL.ColorMakerRegistry.getScheme(x)}if(!b||b.radius)d=new NGL.RadiusFactory(a.radiusParams.radius,a.radiusParams.scale);if(!b||b.radius)q=new Float32Array(w),a.radius2?(p=new Float32Array(w),r.radius1=q,r.radius2=p):r.radius=q;c.forEach(function(a,b){var c=3*b;s.index=
a;u.index=s.atomIndex1;v.index=s.atomIndex2;g&&(u.positionToArray(g,c),v.positionToArray(h,c));k&&(e.bondColorToArray(s,1,k,c),e.bondColorToArray(s,0,l,c));m&&(f.bondColorToArray(s,1,m,c),f.bondColorToArray(s,0,n,c));q&&(q[b]=d.atomRadius(u));p&&(p[b]=d.atomRadius(v))});return r},getBackboneAtomData:function(a){a=Object.assign({atomSet:this.atomSetCache.__backbone},a);return this.getAtomData(a)},getBackboneBondData:function(a){a=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},
a);return this.getBondData(a)},getRungAtomData:function(a){a=Object.assign({atomSet:this.atomSetCache.__rung},a);return this.getAtomData(a)},getRungBondData:function(a){a=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},a);return this.getBondData(a)},getView:function(a){return new NGL.StructureView(this,a)},getBoundingBox:function(a){NGL.debug&&console.time("getBoundingBox");var b=new THREE.Box3,c=Infinity,d=Infinity,e=Infinity,f=-Infinity,g=-Infinity,h=-Infinity;this.eachAtom(function(a){var b=
a.x,m=a.y;a=a.z;b<c&&(c=b);m<d&&(d=m);a<e&&(e=a);b>f&&(f=b);m>g&&(g=m);a>h&&(h=a)},a);b.min.set(c,d,e);b.max.set(f,g,h);NGL.debug&&console.timeEnd("getBoundingBox");return b},atomCenter:function(a){return a?this.getBoundingBox(a).center():this.center.clone()},getSequence:function(){var a=[];this.eachResidue(function(b){b.getAtomByName("CA")&&a.push(b.getResname1())});return a},getAtomIndices:function(a){var b=[];this.eachAtom2(function(a){b.push(a.index)},a);return b},atomIndex:function(){var a=new Float32Array(this.atomCount);
this.eachAtom(function(b){a[0]=b.index});return a},updatePosition:function(a){var b=0;this.eachAtom(function(c){c.positionFromArray(a,b);b+=3})},toJSON:function(){NGL.debug&&NGL.time("NGL.Structure.toJSON");var a={metadata:{version:.1,type:"Structure",generator:"StructureExporter"},name:this.name,path:this.path,title:this.title,id:this.id,biomolDict:{},helices:this.helices,sheets:this.sheets,unitcell:this.unitcell.toJSON(),frames:this.frames,boxes:this.boxes,center:this.center.toArray(),boundingBox:[this.boundingBox.min.toArray(),
this.boundingBox.max.toArray()],bondStore:this.bondStore.toJSON(),backboneBondStore:this.backboneBondStore.toJSON(),rungBondStore:this.rungBondStore.toJSON(),atomStore:this.atomStore.toJSON(),residueStore:this.residueStore.toJSON(),chainStore:this.chainStore.toJSON(),modelStore:this.modelStore.toJSON(),bondSet:this.bondSet.toJSON(),atomSet:this.atomSet.toJSON(),atomSetDict:{},atomSetCache:{},atomMap:this.atomMap.toJSON(),residueMap:this.residueMap.toJSON()},b;for(b in this.biomolDict)a.biomolDict[b]=
this.biomolDict[b].toJSON();for(b in this.atomSetDict)a.atomSetDict[b]=this.atomSetDict[b].toJSON();for(b in this.atomSetCache)a.atomSetCache[b]=this.atomSetCache[b].toJSON();NGL.debug&&NGL.timeEnd("NGL.Structure.toJSON");return a},fromJSON:function(a){NGL.debug&&NGL.time("NGL.Structure.fromJSON");this.name=a.name;this.path=a.path;this.title=a.title;this.id=a.id;this.biomolDict=a.biomolDict;this.helices=a.helices;this.sheets=a.sheets;this.unitcell=(new NGL.Unitcell).fromJSON(a.unitcell);this.frames=
a.frames;this.boxes=a.boxes;this.center=(new THREE.Vector3).fromArray(a.center);this.boundingBox=new THREE.Box3((new THREE.Vector3).fromArray(a.boundingBox[0]),(new THREE.Vector3).fromArray(a.boundingBox[1]));this.bondStore.fromJSON(a.bondStore);this.backboneBondStore.fromJSON(a.backboneBondStore);this.rungBondStore.fromJSON(a.rungBondStore);this.atomStore.fromJSON(a.atomStore);this.residueStore.fromJSON(a.residueStore);this.chainStore.fromJSON(a.chainStore);this.modelStore.fromJSON(a.modelStore);
this.bondSet.fromJSON(a.bondSet);this.atomSet.fromJSON(a.atomSet);this.biomolDict={};for(var b in a.biomolDict){var c=new NGL.Assembly;this.biomolDict[b]=c.fromJSON(a.biomolDict[b])}this.atomSetDict={};for(b in a.atomSetDict)c=new TypedFastBitSet,this.atomSetDict[b]=c.fromJSON(a.atomSetDict[b]);this.atomSetCache={};for(b in a.atomSetCache)c=new TypedFastBitSet,this.atomSetCache[b]=c.fromJSON(a.atomSetCache[b]);this.atomMap.fromJSON(a.atomMap);this.residueMap.fromJSON(a.residueMap);NGL.GidPool.updateObject(this);
NGL.debug&&NGL.timeEnd("NGL.Structure.fromJSON");return this},getTransferable:function(){var a=[];a.concat(this.bondStore.getTransferable());a.concat(this.backboneBondStore.getTransferable());a.concat(this.rungBondStore.getTransferable());a.concat(this.atomStore.getTransferable());a.concat(this.residueStore.getTransferable());a.concat(this.chainStore.getTransferable());a.concat(this.modelStore.getTransferable());if(this.frames)for(var b=this.frames,c=this.frames.length,d=0;d<c;++d)a.push(b[d].buffer);
if(this.boxes)for(b=this.boxes,c=this.boxes.length,d=0;d<c;++d)a.push(b[d].buffer);a.concat(this.bondSet.getTransferable());a.concat(this.atomSet.getTransferable());for(var e in this.atomSetDict)a.concat(this.atomSetDict[e].getTransferable());for(e in this.atomSetCache)a.concat(this.atomSetCache[e].getTransferable());return a},dispose:function(){NGL.GidPool.removeObject(this);this.frames&&(this.frames.length=0);this.boxes&&(this.boxes.length=0);this.bondStore.dispose();this.backboneBondStore.dispose();
this.rungBondStore.dispose();this.atomStore.dispose();this.residueStore.dispose();this.chainStore.dispose();this.modelStore.dispose();delete this.bondStore;delete this.atomStore;delete this.residueStore;delete this.chainStore;delete this.modelStore;delete this.frames;delete this.boxes;delete this.cif;delete this.bondSet;delete this.atomSet}};
NGL.StructureView=function(a,b){this.signals={refreshed:new signals.Signal};this.structure=a;this.selection=b;this.center=new THREE.Vector3;this.boundingBox=new THREE.Box3;if(a||b)this.init(),this.refresh()};
NGL.StructureView.prototype=NGL.createObject(NGL.Structure.prototype,{constructor:NGL.StructureView,type:"StructureView",init:function(){Object.defineProperties(this,{atomSetDict:{get:function(){return this.structure.atomSetDict}},bondStore:{get:function(){return this.structure.bondStore}},backboneBondStore:{get:function(){return this.structure.backboneBondStore}},rungBondStore:{get:function(){return this.structure.rungBondStore}},atomStore:{get:function(){return this.structure.atomStore}},residueStore:{get:function(){return this.structure.residueStore}},
chainStore:{get:function(){return this.structure.chainStore}},modelStore:{get:function(){return this.structure.modelStore}},atomMap:{get:function(){return this.structure.atomMap}},residueMap:{get:function(){return this.structure.residueMap}}});this._ap=this.getAtomProxy();this._rp=this.getResidueProxy();this._cp=this.getChainProxy();this.selection&&this.selection.signals.stringChanged.add(function(a){this.refresh()},this);this.structure.signals.refreshed.add(this.refresh,this)},refresh:function(){NGL.debug&&
NGL.time("NGL.StructureView.refresh");this.atomSetCache={};this.atomSet=this.getAtomSet2(this.selection);this.structure.atomSet&&(NGL.debug&&NGL.time("NGL.StructureView.refresh#atomSet.intersection"),this.atomSet=this.atomSet.intersection(this.structure.atomSet),NGL.debug&&NGL.timeEnd("NGL.StructureView.refresh#atomSet.intersection"));this.bondSet=this.getBondSet();NGL.debug&&NGL.time("NGL.StructureView.refresh#atomSetDict.new_intersection");for(var a in this.atomSetDict)this.atomSetCache["__"+a]=
this.atomSetDict[a].new_intersection(this.atomSet);NGL.debug&&NGL.timeEnd("NGL.StructureView.refresh#atomSetDict.new_intersection");NGL.debug&&NGL.time("NGL.StructureView.refresh#size");this.atomCount=this.atomSet.size();this.bondCount=this.bondSet.size();NGL.debug&&NGL.timeEnd("NGL.StructureView.refresh#size");this.boundingBox=this.getBoundingBox();this.center=this.boundingBox.center();NGL.debug&&NGL.timeEnd("NGL.StructureView.refresh");this.signals.refreshed.dispatch()},getSelection:function(){var a=
this.structure.getSelection();return a?a.string&&this.selection.string?new NGL.Selection("( "+a.string+" ) AND ( "+this.selection.string+" )"):a.string?new NGL.Selection(a.string):this.selection.string?new NGL.Selection(this.selection.string):new NGL.Selection(""):this.selection},getStructure:function(){return this.structure.getStructure()},toJSON:function(){var a={metadata:{version:.1,type:"StructureView",generator:"StructureViewExporter"},structure:this.structure.toJSON(),atomSet:this.atomSet.toJSON(),
bondSet:this.bondSet.toJSON(),atomCount:this.atomCount,bondCount:this.bondCount,atomSetCache:{}},b;for(b in this.atomSetCache)a.atomSetCache[b]=this.atomSetCache[b].toJSON();return a},fromJSON:function(a){"Structure"===a.structure.metadata.type?this.structure=(new NGL.Structure).fromJSON(a.structure):"StructureView"===a.structure.metadata.type&&(this.structure=(new NGL.StructureView).fromJSON(a.structure));this.atomSet=(new TypedFastBitSet).fromJSON(a.atomSet);this.bondSet=(new TypedFastBitSet).fromJSON(a.bondSet);
this.atomCount=a.atomCount;this.bondCount=a.bondCount;this.atomSetCache={};for(var b in a.atomSetCache){var c=new TypedFastBitSet;this.atomSetCache[b]=c.fromJSON(a.atomSetCache[b])}this.init();return this},getTransferable:function(){var a=[];a.concat(this.structure.getTransferable());a.concat(this.bondSet.getTransferable());a.concat(this.atomSet.getTransferable());for(var b in this.atomSetCache)a.concat(this.atomSetCache[b].getTransferable());return a},dispose:function(){delete this.structure;delete this.atomSet;
delete this.bondSet;delete this.atomCount;delete this.bondCount}});NGL.makeTrajectory=function(a,b,c){return a instanceof NGL.Frames||a instanceof Promise?new NGL.FramesTrajectory(a,b,c):!a&&b.frames?new NGL.StructureTrajectory(a,b,c):new NGL.RemoteTrajectory(a,b,c)};NGL.Frames=function(a,b){this.name=a;this.path=b;this.coordinates=[];this.boxes=[]};
NGL.Frames.prototype={constructor:NGL.Frames,toJSON:function(){return{metadata:{version:.1,type:"Frames",generator:"FramesExporter"},name:this.name,path:this.path,coordinates:this.coordinates,boxes:this.boxes}},fromJSON:function(a){this.name=a.name;this.path=a.path;this.coordinates=a.coordinates;this.boxes=a.boxes},getTransferable:function(){for(var a=[],b=this.coordinates,c=b.length,d=0;d<c;++d)a.push(b[d].buffer);return a}};
NGL.Trajectory=function(a,b,c){var d=signals;this.signals={gotNumframes:new d.Signal,frameChanged:new d.Signal,selectionChanged:new d.Signal,playerChanged:new d.Signal};this.params={centerPbc:!0,removePbc:!0,superpose:!0};this.name=a.replace(/^.*[\\\/]/,"");this.selection=new NGL.Selection(c||"backbone and not hydrogen");this.selection.signals.stringChanged.add(function(a){this.makeIndices();this.resetCache()},this);this.setStructure(b);this.trajPath=a;this.numframes=void 0;this.getNumframes()};
NGL.Trajectory.prototype={constructor:NGL.Trajectory,setStructure:function(a){this.structure=a;this.atomCount=a.atomCount;this.makeAtomIndices();this.saveInitialStructure();this.backboneIndices=this.structure.atomIndex(new NGL.Selection("backbone and not hydrogen"));this.makeIndices();this.frameCache=[];this.boxCache=[];this.pathCache=[];this.frameCacheSize=0;this.currentFrame=-1},saveInitialStructure:function(){var a=0,b=new Float32Array(3*this.atomCount);this.structure.eachAtom(function(c){b[a+
0]=c.x;b[a+1]=c.y;b[a+2]=c.z;a+=3});this.initialStructure=b},setSelection:function(a){this.selection.setString(a);return this},makeIndices:function(){this.indices=this.structure.atomIndex(this.selection);var a,b,c=3*this.indices.length;this.coords1=new Float32Array(c);this.coords2=new Float32Array(c);var d=this.initialStructure,e=this.coords2;for(a=0;a<c;a+=3)b=3*this.indices[a/3],e[a+0]=d[b+0],e[a+1]=d[b+1],e[a+2]=d[b+2]},makeAtomIndices:function(){NGL.error("Trajectory.makeAtomIndices not implemented")},
getNumframes:function(){NGL.error("Trajectory.loadFrame not implemented")},resetCache:function(){this.frameCache=[];this.boxCache=[];this.pathCache=[];this.frameCacheSize=0;this.setFrame(this.currentFrame);return this},setParameters:function(a){var b=this.params,c=!1;void 0!==a.centerPbc&&a.centerPbc!==b.centerPbc&&(b.centerPbc=a.centerPbc,c=!0);void 0!==a.removePbc&&a.removePbc!==b.removePbc&&(b.removePbc=a.removePbc,c=!0);void 0!==a.superpose&&a.superpose!==b.superpose&&(b.superpose=a.superpose,
c=!0);c&&this.resetCache()},setFrame:function(a,b){if(void 0===a)return this;this.inProgress=!0;a=parseInt(a);-1===a||this.frameCache[a]?this.updateStructure(a,b):this.loadFrame(a,function(){this.updateStructure(a,b)}.bind(this));return this},interpolate:function(){var a=function(a,c,d,e,f,g){a=(d-a)*g;e=(e-c)*g;g=f*f;return(2*c-2*d+a+e)*f*g+(-3*c+3*d-2*a-e)*g+a*f+c};return function(b,c,d,e,f,g,h){var k=this.frameCache,l=k[b];c=k[c];d=k[d];var m=k[e];e=l.length;k=new Float32Array(e);if("spline"===
g)for(g=0;g<e;g+=3)k[g+0]=a(m[g+0],d[g+0],c[g+0],l[g+0],f,1),k[g+1]=a(m[g+1],d[g+1],c[g+1],l[g+1],f,1),k[g+2]=a(m[g+2],d[g+2],c[g+2],l[g+2],f,1);else for(g=0;g<e;g+=3)d=c[g+0],k[g+0]=d+(l[g+0]-d)*f,d=c[g+1],k[g+1]=d+(l[g+1]-d)*f,d=c[g+2],k[g+2]=d+(l[g+2]-d)*f;this.structure.updatePosition(k);this.currentFrame=b;this.signals.frameChanged.dispatch(b);"function"===typeof h&&h()}}(),setFrameInterpolated:function(a,b,c,d,e,f,g){if(void 0===a)return this;var h=this.frameCache,k=[];h[d]||k.push(d);h[c]||
k.push(c);h[b]||k.push(b);h[a]||k.push(a);k.length?this.loadFrame(k,function(){this.interpolate(a,b,c,d,e,f,g)}.bind(this)):this.interpolate(a,b,c,d,e,f,g);return this},loadFrame:function(a,b){if(Array.isArray(a)){var c,d=function(a,d){this._loadFrame(a,d);0===c.length()&&"function"===typeof b&&b()}.bind(this);c=new NGL.Queue(d,a)}else this._loadFrame(a,b)},_loadFrame:function(a,b){NGL.error("Trajectory._loadFrame not implemented")},updateStructure:function(a,b){this._disposed||(-1===a?this.structure.updatePosition(this.initialStructure):
this.structure.updatePosition(this.frameCache[a]),this.structure.trajectory={name:this.trajPath,frame:a},"function"===typeof b&&b(),this.currentFrame=a,this.inProgress=!1,this.signals.frameChanged.dispatch(a))},getCircularMean:function(a,b,c){return[NGL.Utils.circularMean(b,c[0],3,0,a),NGL.Utils.circularMean(b,c[1],3,1,a),NGL.Utils.circularMean(b,c[2],3,2,a)]},centerPbc:function(a,b,c){if(0!==c[0]&&0!==c[8]&&0!==c[4]){var d=a.length,e=c[0],f=c[1];c=c[2];var g=-b[0]+e+e/2,h=-b[1]+f+f/2,k=-b[2]+c+c/
2;for(b=0;b<d;b+=3)a[b+0]=(a[b+0]+g)%e,a[b+1]=(a[b+1]+h)%f,a[b+2]=(a[b+2]+k)%c}},removePbc:function(a,b){if(0!==b[0]&&0!==b[8]&&0!==b[4]){var c,d,e,f=a.length;for(c=3;c<f;c+=3)for(d=0;3>d;++d)if(e=a[c+d]-a[c-3+d],Math.abs(e)>.9*b[3*d+d])if(0<e)for(e=0;3>e;++e)a[c+e]-=b[3*d+e];else for(e=0;3>e;++e)a[c+e]+=b[3*d+e];return a}},superpose:function(a){var b,c,d=3*this.indices.length,e=this.coords1,f=this.coords2;for(b=0;b<d;b+=3)c=3*this.indices[b/3],e[b+0]=a[c+0],e[b+1]=a[c+1],e[b+2]=a[c+2];(new NGL.Superposition(e,
f)).transform(a)},process:function(a,b,c,d){this.setNumframes(d);if(b){if(0<this.backboneIndices.length&&this.params.centerPbc){d=[b[0],b[4],b[8]];var e=this.getCircularMean(this.backboneIndices,c,d);this.centerPbc(c,e,d)}this.params.removePbc&&this.removePbc(c,b)}0<this.indices.length&&this.params.superpose&&this.superpose(c);this.frameCache[a]=c;this.boxCache[a]=b;this.frameCacheSize+=1},setNumframes:function(a){a!==this.numframes&&(this.numframes=a,this.signals.gotNumframes.dispatch(a))},dispose:function(){this.frameCache=
[];this._disposed=!0;this.player&&this.player.stop()},setPlayer:function(a){this.player=a;this.signals.playerChanged.dispatch(a)},getPath:function(a,b){NGL.error("Trajectory.getPath not implemented")},download:function(a){for(var b=this,c=this.numframes,d=Math.ceil(c/a),e=0,f=new Float32Array(d*(9+3*this.atomCount)),g=0;g<c;g+=a)this.loadFrame(g,function(){var a=g,c=e,l=c*(9+3*b.atomCount);f.set(b.boxCache[a],l);f.set(b.frameCache[a],l+9);c===d-1&&(a=new Blob([f],{type:"application/octet-binary"}),
NGL.download(a,"traj.bbt"))}),e+=1}};NGL.RemoteTrajectory=function(a,b,c){NGL.Trajectory.call(this,a,b,c)};
NGL.RemoteTrajectory.prototype=NGL.createObject(NGL.Trajectory.prototype,{constructor:NGL.RemoteTrajectory,type:"remote",makeAtomIndices:function(){var a=this.structure,b=[];if(a instanceof NGL.StructureSubset){var a=a.structure.atomIndex(a.selection),c,d,e=a[0],f=a[0],g=a.length;for(c=1;c<g;++c)d=a[c],f+1<d&&(b.push([e,f+1]),e=d),f=d;b.push([e,f+1])}else b.push([0,this.atomCount]);this.atomIndices=b},_loadFrame:function(a,b){var c=new XMLHttpRequest,d=NGL.DatasourceRegistry.trajectory,e=d.getFrameUrl(this.trajPath,
a),d=d.getFrameParams(this.trajPath,this.atomIndices);c.open("POST",e,!0);c.responseType="arraybuffer";c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.addEventListener("load",function(d){var g=c.response;if(g){d=(new Int32Array(g,0,1))[0];new Float32Array(g,4,1);var h=new Float32Array(g,8,9),g=new Float32Array(g,44);this.process(a,h,g,d);"function"===typeof b&&b()}else NGL.error("empty arrayBuffer for '"+e+"'")}.bind(this),!1);c.send(d)},getNumframes:function(){var a=new THREE.XHRLoader,
b=NGL.DatasourceRegistry.trajectory.getNumframesUrl(this.trajPath);a.load(b,function(a){this.setNumframes(parseInt(a))}.bind(this))},getPath:function(a,b){if(this.pathCache[a])b(this.pathCache[a]);else{NGL.time("loadPath");var c=new XMLHttpRequest,d=NGL.DatasourceRegistry.trajectory.getPathUrl(this.trajPath,a);c.open("POST",d,!0);c.responseType="arraybuffer";c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.addEventListener("load",function(e){NGL.timeEnd("loadPath");(e=c.response)?
(e=new Float32Array(e),this.pathCache[a]=e,b(e)):NGL.error("empty arrayBuffer for '"+d+"'")}.bind(this),!1);c.send("")}}});NGL.StructureTrajectory=function(a,b,c){NGL.Trajectory.call(this,"",b,c)};
NGL.StructureTrajectory.prototype=NGL.createObject(NGL.Trajectory.prototype,{constructor:NGL.StructureTrajectory,type:"structure",makeAtomIndices:function(){var a=this.structure,b=a.atomSet,c=b.size();if(c<a.atomStore.count){var d=new Int32Array(c);b.forEach(function(a,b){d[b]=a});this.atomIndices=d}else this.atomIndices=null},_loadFrame:function(a,b){var c,d=this.structure.frames[a];if(this.atomIndices){var e=this.atomIndices,f=e.length;c=new Float32Array(3*f);for(var g=0;g<f;++g){var h=3*g,k=3*
e[g];c[h+0]=d[k+0];c[h+1]=d[k+1];c[h+2]=d[k+2]}}else c=new Float32Array(d);this.process(a,this.structure.boxes[a],c,this.structure.frames.length);"function"===typeof b&&b()},getNumframes:function(){this.setNumframes(this.structure.frames.length)},getPath:function(a,b){var c,d,e,f=this.numframes,g=3*a,h=new Float32Array(3*f);for(c=0;c<f;++c)d=3*c,e=this.structure.frames[c],h[d+0]=e[g+0],h[d+1]=e[g+1],h[d+2]=e[g+2];b(h)}});
NGL.FramesTrajectory=function(a,b,c){a instanceof Promise?a.then(function(a){this.setFrames(a);this.getNumframes()}.bind(this)):this.setFrames(a);NGL.Trajectory.call(this,"",b,c)};
NGL.FramesTrajectory.prototype=NGL.createObject(NGL.Trajectory.prototype,{constructor:NGL.FramesTrajectory,type:"frames",setFrames:function(a){this.name=a.name;this.path=a.path;this.frames=a.coordinates;this.boxes=a.boxes},makeAtomIndices:function(){var a=this.structure;this.atomIndices=a instanceof NGL.StructureView?a.structure.atomIndex(a.selection):null},_loadFrame:function(a,b){var c,d=this.frames[a];if(this.atomIndices){var e=this.atomIndices,f=e.length;c=new Float32Array(3*f);for(var g=0;g<
f;++g){var h=3*g,k=3*e[g];c[h+0]=d[k+0];c[h+1]=d[k+1];c[h+2]=d[k+2]}}else c=new Float32Array(d);this.process(a,this.boxes[a],c,this.frames.length);"function"===typeof b&&b()},getNumframes:function(){this.frames&&this.setNumframes(this.frames.length)},getPath:function(a,b){var c,d,e,f=this.numframes,g=3*a,h=new Float32Array(3*f);for(c=0;c<f;++c)d=3*c,e=this.frames[c],h[d+0]=e[g+0],h[d+1]=e[g+1],h[d+2]=e[g+2];b(h)}});
NGL.TrajectoryPlayer=function(a,b,c,d,e){var f=signals;this.signals={startedRunning:new f.Signal,haltedRunning:new f.Signal};var g=this;a.signals.playerChanged.add(function(a){a!==g&&g.pause()});this.traj=a;this.step=b||Math.ceil((a.numframes+1)/100);this.timeout=c||50;this.start=d||0;this.end=e||a.numframes-1;this.end=Math.min(this.end,a.numframes-1);this.interpolateType="";this.interpolateStep=5;this.mode="loop";this.direction="forward";this._running=this._stopFlag=!1};
NGL.TrajectoryPlayer.prototype={constructor:NGL.TrajectoryPlayer,_animate:function(){var a;this._running=!0;if(!this.traj.inProgress&&!this._stopFlag){a="forward"===this.direction?this.traj.currentFrame+this.step:this.traj.currentFrame-this.step;if(a>=this.end||a<this.start)"once"===this.mode?(this.pause(),a="forward"===this.direction?this.end:this.start):a="forward"===this.direction?this.start:this.end;this.interpolateType||this.traj.setFrame(a)}if(this._stopFlag)this._running=!1;else if(!this.traj.inProgress&&
this.interpolateType){var b,c,d;"forward"===this.direction?(b=Math.max(this.start,a-this.step),c=Math.max(this.start,a-2*this.step),d=Math.max(this.start,a-3*this.step)):(b=Math.min(this.end,a+this.step),c=Math.min(this.end,a+2*this.step),d=Math.min(this.end,a+3*this.step));this._interpolate(a,b,c,d,1/this.interpolateStep,0)}else setTimeout(this._animate.bind(this),this.timeout)},_interpolate:function(a,b,c,d,e,f){f+=e;if(1>=f){var g=Math.round(this.timeout*e);this.traj.setFrameInterpolated(a,b,c,
d,f,this.interpolateType,function(){setTimeout(function(){this._interpolate(a,b,c,d,e,f)}.bind(this),g)}.bind(this))}else setTimeout(this._animate.bind(this),0)},toggle:function(){this._running?this.pause():this.play()},play:function(){if(!this._running){this.traj.player!==this&&this.traj.setPlayer(this);var a=this.traj.currentFrame,b=Math.ceil(a/this.step)*this.step;"forward"===this.direction&&a>=this.end?b=this.start:"backward"===this.direction&&a<=this.start&&(b=this.end);this.traj.setFrame(b);
this._stopFlag=!1;this._animate();this.signals.startedRunning.dispatch()}},pause:function(){this._running&&(this._stopFlag=!0,this.signals.haltedRunning.dispatch())},stop:function(){this.traj.setFrame(this.start);this.pause()}};
NGL.Surface=function(a,b,c){this.name=a;this.path=b;this.info={};this.center=new THREE.Vector3;this.boundingBox=new THREE.Box3;c instanceof THREE.Geometry||c instanceof THREE.BufferGeometry||c instanceof THREE.Group?this.fromGeometry(c):c&&this.set(c.position,c.index,c.normal,c.color,c.atomindex)};
NGL.Surface.prototype={constructor:NGL.Surface,type:"Surface",set:function(a,b,c,d,e){this.position=a;this.index=b;this.normal=c;this.color=d;this.atomindex=e;this.size=a.length/3},fromGeometry:function(a){NGL.debug&&NGL.time("NGL.GeometrySurface.fromGeometry");a instanceof THREE.Geometry?(a.computeFaceNormals(!0),a.computeVertexNormals(!0)):a=a instanceof THREE.BufferGeometry?a:a.children[0].geometry;a.computeBoundingSphere();a.computeBoundingBox();this.center.copy(a.boundingSphere.center);this.boundingBox.copy(a.boundingBox);
var b,c;if(a instanceof THREE.BufferGeometry){var d=a.attributes;b=d.normal?d.normal.array:!1;(!b||0===b[0]&&0===b[1]&&0===b[2])&&a.computeVertexNormals();b=d.position.array;c=d.index?d.index.array:null;a=d.normal.array}else NGL.log("TODO non BufferGeometry surface"),b=NGL.Utils.positionFromGeometry(a),c=NGL.Utils.indexFromGeometry(a),a=NGL.Utils.normalFromGeometry(a);this.set(b,c,a,void 0,void 0);NGL.debug&&NGL.timeEnd("NGL.GeometrySurface.setGeometry")},getPosition:function(){return this.position},
getColor:function(a){var b=a||{};a=this.size;var c;if("volume"===b.scheme){var d=new THREE.Vector3,e=this.position,f=NGL.ColorMakerRegistry.getScheme(b);c=new Float32Array(3*a);for(b=0;b<a;++b){var g=3*b;d.set(e[g],e[g+1],e[g+2]);f.positionColorToArray(d,c,g)}}else if(this.atomindex)for(b.surface=this,c=new Float32Array(3*a),f=NGL.ColorMakerRegistry.getScheme(b),d=b.structure.getAtomProxy(),e=this.atomindex,b=0;b<a;++b)d.index=e[b],f.atomColorToArray(d,c,3*b);else c=new THREE.Color(b.value),c=NGL.Utils.uniformArray3(a,
c.r,c.g,c.b);return c},getPickingColor:function(a){a=Object.assign(a||{});a.scheme="picking";return this.getColor(a)},getNormal:function(){return this.normal},getSize:function(a){return NGL.Utils.uniformArray(this.size,a)},getIndex:function(){return this.index},getFilteredIndex:function(a,b){if(a&&this.atomindex){var c=new NGL.Selection(a),c=b.getAtomSet(c),d=[],e=this.atomindex,f=this.index,g=f.length,h=0;b.getAtomProxy();b.getAtomProxy();b.getAtomProxy();for(var k=0;k<g;k+=3){var l=f[k],m=f[k+1],
n=f[k+2],q=e[m],p=e[n];c.has(e[l])&&c.has(q)&&c.has(p)&&(d[h]=l,d[h+1]=m,d[h+2]=n,h+=3)}return new (65535<this.position.length/3?Uint32Array:Uint16Array)(d)}return this.index},getAtomindex:function(){return this.atomindex},toJSON:function(){return{metadata:{version:.1,type:"Surface",generator:"SurfaceExporter"},name:this.name,path:this.path,info:this.info,position:this.position,index:this.index,normal:this.normal,color:this.color,atomindex:this.atomindex,size:this.size,center:this.center.toArray(),
boundingBox:{min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}}},fromJSON:function(a){this.name=a.name;this.path=a.path;this.info=a.info;this.position=a.position;this.index=a.index;this.normal=a.normal;this.color=a.color;this.atomindex=a.atomindex;this.size=a.size;this.center.fromArray(a.center);this.boundingBox.set(a.boundingBox.min,a.boundingBox.max);return this},getTransferable:function(){var a=[];this.position&&a.push(this.position.buffer);this.index&&a.push(this.index.buffer);
this.normal&&a.push(this.normal.buffer);this.color&&a.push(this.color.buffer);this.atomindex&&a.push(this.atomindex.buffer);return a},dispose:function(){}};
NGL.Grid=function(a,b,c,d,e){function f(a,d,f){return((a*b+d)*c+f)*e}d=d||Int32Array;e=e||1;var g,h=new d(a*b*c*e);this.data=h;this.index=f;this.set=function(a,b,c){var d=f(a,b,c);for(g=0;g<e;++g)h[d+g]=arguments[3+g]};this.toArray=function(a,b,c,d,q){a=f(a,b,c);void 0===d&&(d=[]);for(g=0;g<e;++g)d[g]=h[a+g]};this.fromArray=function(a,b,c,d,q){a=f(a,b,c);void 0===q&&(q=0);for(g=0;g<e;++g)h[a+g]=d[q+g]};this.copy=function(a){this.data.set(a.data)};this.clone=function(){return(new NGL.Grid(a,b,c,d,
e)).copy(this)}};NGL.WorkerRegistry.add("surf",function(a,b){NGL.debug&&NGL.time("WORKER surf");void 0===self.vol&&(self.vol=new NGL.Volume);var c=self.vol,d=a.data,e=d.params;d.vol&&c.fromJSON(d.vol);if(e)var f=c.getSurface(e.isolevel,e.smooth,e.center,e.size);NGL.debug&&NGL.timeEnd("WORKER surf");e?b(f.toJSON(),f.getTransferable()):b()});
NGL.Volume=function(a,b,c,d,e,f,g){this.name=a;this.path=b;this.matrix=new THREE.Matrix4;this.normalMatrix=new THREE.Matrix3;this.inverseMatrix=new THREE.Matrix4;this.center=new THREE.Vector3;this.boundingBox=new THREE.Box3;this.setData(c,d,e,f,g);this.__data.length<=Math.pow(10,7)&&NGL.GidPool.addObject(this)};
NGL.Volume.prototype={constructor:NGL.Volume,type:"Volume",setData:function(a,b,c,d,e){this.nx=b||1;this.ny=c||1;this.nz=d||1;this.__data=this.data=a||new Float32Array(1);this.setDataAtomindex(e);delete this.mc;delete this.__isolevel;delete this.__smooth;delete this.__minValue;delete this.__maxValue;delete this.__dataPositionBuffer;delete this.__dataPosition;delete this.__dataBuffer;delete this.__dataMin;delete this.__dataMax;delete this.__dataMean;delete this.__dataRms;this.worker&&this.worker.terminate();
this.__data.length<=Math.pow(10,7)?NGL.GidPool.updateObject(this,!0):(NGL.warn("Volume too large (>10^7), not adding to GidPool"),NGL.GidPool.removeObject(this))},setMatrix:function(a){this.matrix.copy(a);a=this.boundingBox;var b=this.center,c=this.nx-1,d=this.ny-1,e=this.nz-1;a.makeEmpty();a.expandByPoint(b.set(c,d,e));a.expandByPoint(b.set(c,d,0));a.expandByPoint(b.set(c,0,e));a.expandByPoint(b.set(c,0,0));a.expandByPoint(b.set(0,d,e));a.expandByPoint(b.set(0,0,e));a.expandByPoint(b.set(0,d,0));
a.expandByPoint(b.set(0,0,0));a.applyMatrix4(this.matrix);a.center(this.center);c=this.matrix.elements;a=new THREE.Vector3(c[0],c[1],c[2]);b=new THREE.Vector3(c[4],c[5],c[6]);c=new THREE.Vector3(c[8],c[9],c[10]);d=new THREE.Vector3;e=this.normalMatrix.elements;d.crossVectors(b,c);e[0]=d.x;e[1]=d.y;e[2]=d.z;d.crossVectors(c,a);e[3]=d.x;e[4]=d.y;e[5]=d.z;d.crossVectors(a,b);e[6]=d.x;e[7]=d.y;e[8]=d.z;this.inverseMatrix.getInverse(this.matrix)},setDataAtomindex:function(a){this.__dataAtomindex=this.dataAtomindex=
a;delete this.__dataAtomindexBuffer},getBox:function(a,b,c){c||(c=new THREE.Box3);c.set(a,a);c.expandByScalar(b);c.applyMatrix4(this.inverseMatrix);c.min.round();c.max.round();return c},getSurface:function(a,b,c,d){a=isNaN(a)?this.getValueForSigma(2):a;b=b||0;void 0===this.mc&&(this.mc=new NGL.MarchingCubes2(this.__data,this.nx,this.ny,this.nz,this.__dataAtomindex));var e;c&&d&&(this.__box||(this.__box=new THREE.Box3),e=this.__box,this.getBox(c,d,e));b?(c=this.mc.triangulate(a,!0,e),NGL.laplacianSmooth(c.position,
c.index,b,!0),d=new THREE.BufferGeometry,d.addAttribute("position",new THREE.BufferAttribute(c.position,3)),d.setIndex(new THREE.BufferAttribute(c.index,1)),d.computeVertexNormals(),c.normal=d.attributes.normal.array,d.dispose()):c=this.mc.triangulate(a,!1,e);this.matrix.applyToVector3Array(c.position);c.normal&&this.normalMatrix.applyToVector3Array(c.normal);c=new NGL.Surface("","",c);c.info.isolevel=a;c.info.smooth=b;return c},getSurfaceWorker:function(a,b,c,d,e){a=isNaN(a)?this.getValueForSigma(2):
a;b=b||0;if(NGL.useWorker&&"undefined"!==typeof Worker&&"function"!==typeof importScripts){void 0===this.workerPool&&(this.workerPool=new NGL.WorkerPool("surf",2));var f=this.workerPool.getNextWorker();f.post({vol:0===f.postCount?this.toJSON():null,params:{isolevel:a,smooth:b,center:c,size:d}},void 0,function(a){a=NGL.fromJSON(a.data);e(a)},function(f){console.warn("NGL.Volume.generateSurfaceWorker error - trying without worker",f);f=this.getSurface(a,b,c,d);e(f)}.bind(this))}else f=this.getSurface(a,
b,c,d),e(f)},getValueForSigma:function(a){a=void 0!==a?a:2;return this.getDataMean()+a*this.getDataRms()},getSigmaForValue:function(a){return((void 0!==a?a:0)-this.getDataMean())/this.getDataRms()},filterData:function(a,b,c){isNaN(a)&&this.header&&(a=this.header.DMEAN+2*this.header.ARMS);a=void 0===a||isNaN(a)?-Infinity:a;b=void 0!==b?b:Infinity;c=c||!1;this.dataPosition||this.makeDataPosition();var d=this.__dataPosition,e=this.__data;if(a!==this.__minValue||b!=this.__maxValue||c!==this.__outside){if(-Infinity===
a&&Infinity===b)this.dataPosition=d,this.data=e;else{var f=e.length;this.__dataBuffer||(this.__dataPositionBuffer=new ArrayBuffer(12*f),this.__dataBuffer=new ArrayBuffer(4*f));for(var g=new Float32Array(this.__dataPositionBuffer),h=new Float32Array(this.__dataBuffer),k=0,l=0;l<f;++l){var m=3*l,n=e[l];if(!c&&n>=a&&n<=b||c&&(n<a||n>b)){var q=3*k;g[q+0]=d[m+0];g[q+1]=d[m+1];g[q+2]=d[m+2];h[k]=n;k+=1}}this.dataPosition=new Float32Array(this.__dataPositionBuffer,0,3*k);this.data=new Float32Array(this.__dataBuffer,
0,k)}this.__minValue=a;this.__maxValue=b;this.__outside=c}},makeDataPosition:function(){for(var a=this.nz,b=this.ny,c=this.nx,d=new Float32Array(c*b*a*3),e=0,f=0;f<a;++f)for(var g=0;g<b;++g)for(var h=0;h<c;++h)d[e+0]=h,d[e+1]=g,d[e+2]=f,e+=3;this.matrix.applyToVector3Array(d);this.__dataPosition=this.dataPosition=d},getDataAtomindex:function(){return this.dataAtomindex},getDataPosition:function(){return this.dataPosition},getDataColor:function(a){a=a||{};a.volume=this;a.scale=a.scale||"Spectral";
a.domain=a.domain||[this.getDataMin(),this.getDataMax()];a=NGL.ColorMakerRegistry.getScheme(a);for(var b=this.dataPosition.length/3,c=new Float32Array(3*b),d=0;d<b;++d)a.volumeColorToArray(d,c,3*d);return c},getPickingDataColor:function(a){a=Object.assign(a||{});a.scheme="picking";return this.getDataColor(a)},getDataSize:function(a,b){var c=this.dataPosition.length/3,d;switch(a){case "value":d=new Float32Array(this.data);break;case "abs-value":d=new Float32Array(this.data);for(var e=0;e<c;++e)d[e]=
Math.abs(d[e]);break;case "value-min":d=new Float32Array(this.data);for(var f=this.getDataMin(),e=0;e<c;++e)d[e]-=f;break;case "deviation":d=new Float32Array(this.data);break;default:d=NGL.Utils.uniformArray(c,a)}if(1!==b)for(e=0;e<c;++e)d[e]*=b;return d},getDataMin:function(){if(void 0===this.__dataMin){for(var a=this.__data,b=a.length,c=Infinity,d=0;d<b;++d)c=Math.min(c,a[d]);this.__dataMin=c}return this.__dataMin},getDataMax:function(){if(void 0===this.__dataMax){for(var a=this.__data,b=a.length,
c=-Infinity,d=0;d<b;++d)c=Math.max(c,a[d]);this.__dataMax=c}return this.__dataMax},getDataMean:function(){if(void 0===this.__dataMean){for(var a=this.__data,b=a.length,c=0,d=0;d<b;++d)c+=a[d];this.__dataMean=c/b}return this.__dataMean},getDataRms:function(){if(void 0===this.__dataRms){var a=this.__data,b=a.length,c=0,d,e;for(e=0;e<b;++e)d=a[e],c+=d*d;this.__dataRms=Math.sqrt(c/b)}return this.__dataRms},clone:function(){var a=new NGL.Volume(this.name,this.path,this.__data,this.nx,this.ny,this.nz,this.__dataAtomindex);
a.matrix.copy(this.matrix);this.header&&(a.header=Object.assign({},this.header));return a},toJSON:function(){var a={metadata:{version:.1,type:"Volume",generator:"VolumeExporter"},name:this.name,path:this.path,data:this.__data,nx:this.nx,ny:this.ny,nz:this.nz,dataAtomindex:this.__dataAtomindex,matrix:this.matrix.toArray(),normalMatrix:this.normalMatrix.toArray(),inverseMatrix:this.inverseMatrix.toArray(),center:this.center.toArray(),boundingBox:{min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}};
this.header&&(a.header=Object.assign({},this.header));return a},fromJSON:function(a){this.name=a.name;this.path=a.path;this.setData(a.data,a.nx,a.ny,a.nz,a.dataAtomindex);this.matrix.fromArray(a.matrix);this.normalMatrix.fromArray(a.normalMatrix);this.inverseMatrix.fromArray(a.inverseMatrix);a.header&&(this.header=Object.assign({},a.header));this.center.fromArray(a.center);this.boundingBox.set(a.boundingBox.min,a.boundingBox.max);return this},getTransferable:function(){var a=[this.__data.buffer];
this.__dataAtomindex&&a.push(this.__dataAtomindex.buffer);return a},dispose:function(){this.workerPool&&this.workerPool.terminate();NGL.GidPool.removeObject(this)}};
NGL.MarchingCubes=function(a,b,c,d,e){NGL.debug&&NGL.time("NGL.MarchingCubes");d=new Int32Array([b,c,d]);var f=NGL.MarchingCubes.edgeTable,g=NGL.MarchingCubes.triTable,h=NGL.MarchingCubes.cubeVerts,k=NGL.MarchingCubes.edgeIndex;b=[];c=[];var l=0,m=0,n=0,q=new Float32Array(8),p=new Int32Array(12),r=new Int32Array(3);for(r[2]=0;r[2]<d[2]-1;++r[2],n+=d[0])for(r[1]=0;r[1]<d[1]-1;++r[1],++n)for(r[0]=0;r[0]<d[0]-1;++r[0],++n){for(var s=0,u=0;8>u;++u){var v=h[u],v=a[n+v[0]+d[0]*(v[1]+d[1]*v[2])]-e;q[u]=
v;s|=0<v?1<<u:0}v=f[s];if(0!==v){for(u=0;12>u;++u)if(0!==(v&1<<u)){p[u]=l/3;var w=k[u],x=h[w[0]],t=h[w[1]],z=q[w[0]],w=z-q[w[1]],y=0;1E-6<Math.abs(w)&&(y=z/w);b[l+0]=r[0]+x[0]+y*(t[0]-x[0]);b[l+1]=r[1]+x[1]+y*(t[1]-x[1]);b[l+2]=r[2]+x[2]+y*(t[2]-x[2]);l+=3}s=g[s];for(u=0;u<s.length;u+=3)c[m+0]=p[s[u+0]],c[m+1]=p[s[u+1]],c[m+2]=p[s[u+2]],m+=3}}NGL.debug&&NGL.timeEnd("NGL.MarchingCubes");a=65535<b.length/3?Uint32Array:Uint16Array;return{position:new Float32Array(b),normal:void 0,index:new a(c)}};
NGL.MarchingCubes2=function(a,b,c,d,e){function f(a,b,c){return a+(b-a)*c}function g(a,b,c,d,g,h,k){if(0>x[a]){h=(p-h)/(k-h);k=w;var l=3*t;A[l+0]=c+h;A[l+1]=d;A[l+2]=g;r||(c=3*a,B[l]=-f(k[c],k[c+3],h),B[l+1]=-f(k[c+1],k[c+4],h),B[l+2]=-f(k[c+2],k[c+5],h));e&&(C[t]=e[a+h]);x[a]=t;y[b]=t;t+=1}else y[b]=x[a]}function h(a,b,c,d,g,h,k){if(0>x[a]){h=(p-h)/(k-h);k=w;var l=3*t;A[l]=c;A[l+1]=d+h;A[l+2]=g;r||(c=3*a,d=c+3*u,B[l]=-f(k[c],k[d],h),B[l+1]=-f(k[c+1],k[d+1],h),B[l+2]=-f(k[c+2],k[d+2],h));e&&(C[t]=
e[a+h*u]);x[a]=t;y[b]=t;t+=1}else y[b]=x[a]}function k(a,b,c,d,g,h,k){if(0>x[a]){h=(p-h)/(k-h);k=w;var l=3*t;A[l]=c;A[l+1]=d;A[l+2]=g+h;r||(c=3*a,d=c+3*v,B[l]=-f(k[c],k[d],h),B[l+1]=-f(k[c+1],k[d+1],h),B[l+2]=-f(k[c+2],k[d+2],h));e&&(C[t]=e[a+h*v]);x[a]=t;y[b]=t;t+=1}else y[b]=x[a]}function l(b){var c=3*b;0===w[c]&&(w[c]=a[b-1]-a[b+1],w[c+1]=a[b-u]-a[b+u],w[c+2]=a[b-v]-a[b+v])}function m(e,f,m,s,t,w){var B,E,C,A,O,Z;e=void 0!==e?e:0;f=void 0!==f?f:0;m=void 0!==m?m:0;s=void 0!==s?s:b-1;t=void 0!==
t?t:c-1;w=void 0!==w?w:d-1;r?(e=Math.max(0,e),f=Math.max(0,f),m=Math.max(0,m),s=Math.min(b-1,s),t=Math.min(c-1,t),w=Math.min(d-1,w)):(e=Math.max(1,e),f=Math.max(1,f),m=Math.max(1,m),s=Math.min(b-2,s),t=Math.min(c-2,t),w=Math.min(d-2,w));var $=Math.max(0,e-2),J=Math.max(0,f-2);E=Math.max(0,m-2);var N=Math.min(b,s+2),T=Math.min(c,t+2),U=Math.min(d,w+2);for(A=E;A<U;++A)for(Z=v*A,C=J;C<T;++C)for(O=Z+u*C,E=$;E<N;++E)B=O+E,x[B]=-1;Z=e;$=f;J=m;N=s;T=t;U=w;O=!1;for(A=m;A<w;++A){for(C=f;C<t;++C){for(E=e;E<
s;++E)if(B=b*c*A+b*C+E,a[B]>=p){J=A;O=!0;break}if(O)break}if(O)break}O=!1;for(C=f;C<t;++C){for(A=J;A<w;++A){for(E=e;E<s;++E)if(B=b*c*A+b*C+E,a[B]>=p){$=C;O=!0;break}if(O)break}if(O)break}O=!1;for(E=e;E<s;++E){for(C=$;C<t;++C){for(A=J;A<w;++A)if(B=b*c*A+b*C+E,a[B]>=p){Z=E;O=!0;break}if(O)break}if(O)break}O=!1;for(A=w;A>=m;--A){for(C=t;C>=f;--C){for(E=s;E>=e;--E)if(B=b*c*A+b*C+E,a[B]>=p){U=A;O=!0;break}if(O)break}if(O)break}O=!1;for(C=t;C>=f;--C){for(A=U;A>=m;--A){for(E=s;E>=e;--E)if(B=b*c*A+b*C+E,
a[B]>=p){T=C;O=!0;break}if(O)break}if(O)break}O=!1;for(E=s;E>=e;--E){for(C=T;C>=f;--C){for(A=U;A>=m;--A)if(B=b*c*A+b*C+E,a[B]>=p){N=E;O=!0;break}if(O)break}if(O)break}r?(e=Math.max(0,Z-1),f=Math.max(0,$-1),m=Math.max(0,J-1),s=Math.min(b-1,N+1),t=Math.min(c-1,T+1),w=Math.min(d-1,U+1)):(e=Math.max(1,Z-1),f=Math.max(1,$-1),m=Math.max(1,J-1),s=Math.min(b-2,N+1),t=Math.min(c-2,T+1),w=Math.min(d-2,U+1));for(A=m;A<w;++A)for(Z=v*A,C=f;C<t;++C)for(O=Z+u*C,E=e;E<s;++E){B=O+E;m=E;var $=C,J=A,N=B,T=N+1,U=N+u,
S=N+v,ca=T+u,H=T+v,G=N+u+v,D=T+u+v;B=0;var F=a[N],Q=a[T],V=a[U],ba=a[ca],ea=a[S],fa=a[H],ga=a[G],ha=a[D];F<p&&(B|=1);Q<p&&(B|=2);V<p&&(B|=8);ba<p&&(B|=4);ea<p&&(B|=16);fa<p&&(B|=32);ga<p&&(B|=128);ha<p&&(B|=64);var da=n[B];if(0!==da){var ia=m+1,ja=$+1,ka=J+1;da&1&&(r||(l(N),l(T)),g(N,0,m,$,J,F,Q));da&2&&(r||(l(T),l(ca)),h(T,1,ia,$,J,Q,ba));da&4&&(r||(l(U),l(ca)),g(U,2,m,ja,J,V,ba));da&8&&(r||(l(N),l(U)),h(N,3,m,$,J,F,V));da&16&&(r||(l(S),l(H)),g(S,4,m,$,ka,ea,fa));da&32&&(r||(l(H),l(D)),h(H,5,ia,
$,ka,fa,ha));da&64&&(r||(l(G),l(D)),g(G,6,m,ja,ka,ga,ha));da&128&&(r||(l(S),l(G)),h(S,7,m,$,ka,ea,ga));da&256&&(r||(l(N),l(S)),k(N,8,m,$,J,F,ea));da&512&&(r||(l(T),l(H)),k(T,9,ia,$,J,Q,fa));da&1024&&(r||(l(ca),l(D)),k(ca,10,ia,ja,J,ba,ha));da&2048&&(r||(l(U),l(G)),k(U,11,m,ja,J,V,ga));B<<=4;J=$=m=void 0;for(N=0;-1!=q[B+N];)m=B+N,$=m+1,J=m+2,L[z]=y[q[$]],L[z+1]=y[q[m]],L[z+2]=y[q[J]],z+=3,N+=3}}}var n=NGL.MarchingCubes.edgeTable,q=NGL.MarchingCubes.triTable,p=0,r=!1,s=b*c*d,u=b,v=b*c,w,x,t,z,y=new Int32Array(12),
A=[],B=[],L=[],C=[];this.triangulate=function(a,b,c){NGL.debug&&NGL.time("NGL.MarchingCubes2.triangulate");p=a;(r=b)||w||(w=new Float32Array(3*s));x||(x=new Int32Array(s));z=t=0;void 0!==c?(c.min.round(),c.max.round(),m(c.min.x,c.min.y,c.min.z,c.max.x,c.max.y,c.max.z)):m();A.length=3*t;r||(B.length=3*t);L.length=z;e&&(C.length=t);NGL.debug&&NGL.timeEnd("NGL.MarchingCubes2.triangulate");a=65535<A.length/3?Uint32Array:Uint16Array;return{position:new Float32Array(A),normal:r?void 0:new Float32Array(B),
index:new a(L),atomindex:e?new Int32Array(C):void 0}}};
NGL.MarchingCubes.edgeTable=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,
1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,
1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
NGL.MarchingCubes.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,
9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,
-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,
-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,
2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,
-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,
-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,
-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,
1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,
-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,
2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,
3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,
6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,
5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,
0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,
1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,
-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);NGL.MarchingCubes.cubeVerts=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]];NGL.MarchingCubes.edgeIndex=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];
NGL.laplacianSmooth=function(a,b,c,d){NGL.debug&&NGL.time("NGL.laplacianSmooth");c=c||1;d=d||!0;var e=a.length/3,f=b.length/3;if(d){var g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.BufferAttribute(a,3));g.setIndex(new THREE.BufferAttribute(b,1))}for(var h=new Float32Array(3*e),k=Array(20),l=0;20>l;++l)k[l]=new Uint32Array(e);for(l=0;l<e;++l)k[0][l]=0;for(var m,n,q,l=0;l<f;++l){var p=3*l,r=3*l+1,s=3*l+2;q=!0;m=0;for(n=k[0][b[p]];m<n;++m)if(b[r]==k[m+1][b[p]]){q=!1;break}q&&(k[0][b[p]]++,
k[k[0][b[p]]][b[p]]=b[r]);q=!0;m=0;for(n=k[0][b[p]];m<n;++m)if(b[s]==k[m+1][b[p]]){q=!1;break}q&&(k[0][b[p]]++,k[k[0][b[p]]][b[p]]=b[s]);q=!0;m=0;for(n=k[0][b[r]];m<n;++m)if(b[p]==k[m+1][b[r]]){q=!1;break}q&&(k[0][b[r]]++,k[k[0][b[r]]][b[r]]=b[p]);q=!0;m=0;for(n=k[0][b[r]];m<n;++m)if(b[s]==k[m+1][b[r]]){q=!1;break}q&&(k[0][b[r]]++,k[k[0][b[r]]][b[r]]=b[s]);q=!0;for(m=0;m<k[0][b[s]];++m)if(b[p]==k[m+1][b[s]]){q=!1;break}q&&(k[0][b[s]]++,k[k[0][b[s]]][b[s]]=b[p]);q=!0;m=0;for(n=k[0][b[s]];m<n;++m)if(b[r]==
k[m+1][b[s]]){q=!1;break}q&&(k[0][b[s]]++,k[k[0][b[s]]][b[s]]=b[r])}f=.75/4.5;for(n=0;n<c;++n){for(l=0;l<e;++l)if(b=3*l,p=k[0][l],3>p)h[b]=a[b],h[b+1]=a[b+1],h[b+2]=a[b+2];else{if(3===p||4===p){h[b]=0;h[b+1]=0;for(m=h[b+2]=0;m<p;++m)q=3*k[m+1][l],h[b]+=a[q],h[b+1]+=a[q+1],h[b+2]+=a[q+2];h[b]+=.5*a[b];h[b+1]+=.5*a[b+1];h[b+2]+=.5*a[b+2];m=.5+p}else{h[b]=0;h[b+1]=0;for(m=h[b+2]=0;m<p;++m)q=3*k[m+1][l],h[b]+=a[q],h[b+1]+=a[q+1],h[b+2]+=a[q+2];h[b]+=1*a[b];h[b+1]+=1*a[b+1];h[b+2]+=1*a[b+2];m=1+p}h[b]/=
m;h[b+1]/=m;h[b+2]/=m}a.set(h);if(d)for(g.computeVertexNormals(),l=g.attributes.normal.array,m=3*e,b=0;b<m;b+=3)a[b]+=-1*f*l[b],a[b+1]+=-1*f*l[b+1],a[b+2]+=-1*f*l[b+2]}d&&g.dispose();NGL.debug&&NGL.timeEnd("NGL.laplacianSmooth")};
NGL.WorkerRegistry.add("molsurf",function(a,b){NGL.debug&&NGL.time("WORKER molsurf");var c=a.data,d=c.params;c.structure&&("Structure"===c.structure.metadata.type?self.molsurf=new NGL.MolecularSurface((new NGL.Structure).fromJSON(c.structure)):"StructureView"===c.structure.metadata.type?self.molsurf=new NGL.MolecularSurface((new NGL.StructureView).fromJSON(c.structure)):console.error("wrong type"));c=self.molsurf.getSurface(d);NGL.debug&&NGL.timeEnd("WORKER molsurf");b(c.toJSON(),c.getTransferable())});
NGL.MolecularSurface=function(a){this.structure=a};
NGL.MolecularSurface.prototype={getSurface:function(a){a=a||{};var b=(new NGL.EDTSurface(this.structure)).getVolume(a.type,a.probeRadius,a.scaleFactor,a.lowRes,a.cutoff),c=b.getSurface(1,a.smooth);c.info.type=a.type;c.info.probeRadius=a.probeRadius;c.info.scaleFactor=a.scaleFactor;c.info.smooth=a.smooth;c.info.lowRes=a.lowRes;c.info.cutoff=a.cutoff;b.dispose();return c},getSurfaceWorker:function(a,b){var c=Object.assign({},a);if(NGL.useWorker&&"undefined"!==typeof Worker&&"function"!==typeof importScripts){var d=
void 0;void 0===this.worker&&(d=this.structure.toJSON(),this.worker=new NGL.Worker("molsurf"));this.worker.post({structure:d,params:c},void 0,function(a){a=NGL.fromJSON(a.data);b(a)}.bind(this),function(a){console.warn("NGL.MolecularSurface.generateSurfaceWorker error - trying without worker",a);this.worker.terminate();this.worker=void 0;a=this.getSurface(c);b(a)}.bind(this))}else d=this.getSurface(c),b(d)},dispose:function(){this.worker&&this.worker.terminate()}};
NGL.EDTSurface=function(a){function b(a){var b,c,d,e,f,g,l,m;for(m in B)if(b=B[m],!u[m]){c=a?(b+h)*k+.5:b*k+.5;b=c*c;f=Math.floor(c)+1;g=new Int32Array(f*f);for(c=l=0;c<f;++c)for(d=0;d<f;++d)e=c*c+d*d,e>b?g[l]=-1:(e=Math.sqrt(b-e),g[l]=Math.floor(e)),++l;v[m]=f;u[m]=g}}function c(b){NGL.debug&&NGL.time("NGL.EDTSurface fillvoxels");var c,d;c=0;for(d=t.length;c<d;++c)t[c]=0,b&&(z[c]=-1),x&&(y[c]=-1);a.eachAtom(function(a){a=a.index;var b,c,d,e,h,l,m,r,w,B,C,z,M,W,P;f.index=a;if(!L||L.test(f)){b=Math.floor(.5+
k*(f.x+s.x));c=Math.floor(.5+k*(f.y+s.y));d=Math.floor(.5+k*(f.z+s.z));m=f[A];var H=u[m],G=0,D=q*p,F=v[m],Q;for(B=0;B<F;++B)for(C=0;C<F;++C){Q=H[G];if(-1!=Q)for(M=-1;2>M;++M)for(W=-1;2>W;++W)for(P=-1;2>P;++P)if(0!==M&&0!==W&&0!==P)for(m=M*B,w=P*C,z=0;z<=Q;++z)if(r=z*W,e=b+m,h=c+r,l=d+w,!(0>e||0>h||0>l||e>=n||h>=q||l>=p)){var V=e*D+h*p+l;x?t[V]&1?t[V]&1&&(g.index=y[V],g.index!==f.index&&(e=b+m-Math.floor(.5+k*(g.x+s.x)),h=c+r-Math.floor(.5+k*(g.y+s.y)),l=d+w-Math.floor(.5+k*(g.z+s.z)),m*m+r*r+w*w<
e*e+h*h+l*l&&(y[V]=a))):(t[V]|=1,y[V]=a):t[V]|=1}G++}}});c=0;for(d=t.length;c<d;++c)t[c]&1&&(t[c]|=2);NGL.debug&&NGL.timeEnd("NGL.EDTSurface fillvoxels")}function d(){var b,c;b=0;for(c=t.length;b<c;++b)t[b]&=-3;a.eachAtom(function(a){var b,c,d,e,h,l=0,m,r,w,B,C,z,M,P,S,ca;f.index=a.index;if(!L||L.test(f)){a=Math.floor(.5+k*(f.x+s.x));b=Math.floor(.5+k*(f.y+s.y));c=Math.floor(.5+k*(f.z+s.z));var H=f[A],G=q*p;B=0;for(ca=v[H];B<ca;++B)for(C=0;C<ca;++C){if(-1!=u[H][l])for(M=-1;2>M;++M)for(P=-1;2>P;++P)for(S=
-1;2>S;++S)if(0!==M&&0!==P&&0!==S)for(m=M*B,w=S*C,z=0;z<=u[H][l];++z)if(r=z*P,d=a+m,e=b+r,h=c+w,!(0>d||0>e||0>h||d>=n||e>=q||h>=p)){var D=d*G+e*p+h;t[D]&2?x&&(g.index=y[D],d=Math.floor(.5+k*(g.x+s.x)),e=Math.floor(.5+k*(g.y+s.y)),h=Math.floor(.5+k*(g.z+s.z)),m*m+r*r+w*w<d*d+e*e+h*h&&(y[D]=f.index)):(t[D]|=2,x&&(y[D]=f.index))}l++}}})}var e=a.getBoundingBox(),f=a.getAtomProxy(),g=a.getAtomProxy(),h,k,l,m,n,q,p,r,s,u,v,w,x,t,z,y,A,B,L,C=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,
1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),
new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getVolume=function(a,f,g,K,aa,I){NGL.debug&&NGL.time("NGL.EDTSurface.getVolume");I="vws"!==a;h=f||1.4;k=g||2;m=K||!1;x=!0;m?(A="resname",B=NGL.ResidueRadii,L=new NGL.Selection(".CA")):(A="element",B=NGL.VdwRadii,L=void 0);f=0;for(var R in B)f=Math.max(f,B[R]);R=NGL.getSurfaceGrid(e,f,k,I?h:0);n=R.dim.x;q=R.dim.y;p=R.dim.z;r=R.matrix;s=R.tran;k=R.scaleFactor;u={};v={};b(I);w=h*k;l=aa?aa:Math.max(.1,-1.2+k*h);t=new Uint8Array(n*
q*p);I&&(z=new Float64Array(n*q*p));x&&(y=new Int32Array(n*q*p));c(I);f=q*p;for(aa=0;aa<n;++aa)for(I=0;I<p;++I)for(R=0;R<q;++R)if(g=aa*f+R*p+I,t[g]&1)for(K=0;26>K;){var E=aa+C[K][0],Y=I+C[K][2],X=R+C[K][1];if(-1<E&&E<n&&-1<X&&X<q&&-1<Y&&Y<p&&!(t[E*f+X*p+Y]&1)){t[g]|=4;break}else K++}if("ms"===a||"ses"===a){NGL.debug&&NGL.time("NGL.EDTSurface fastdistancemap");aa=new NGL.Grid(n,q,p,Uint16Array,3);I=q*p;R=w*w;f=g=0;NGL.debug&&console.log("l, w, h",n,q,p);for(K=0;K<n;++K)for(Y=0;Y<q;++Y)for(X=0;X<p;++X)E=
K*I+Y*p+X,t[E]&=-3,t[E]&1&&(t[E]&4?(aa.set(K,Y,X,K,Y,X),z[E]=0,t[E]|=2,g+=1):f+=1);NGL.debug&&console.log("totalsurfacevox",g);NGL.debug&&console.log("totalinnervox",f);f=new Int32Array(3*g);var O=0;g=new Int32Array(3*g);for(K=E=0;K<n;++K)for(Y=0;Y<q;++Y)for(X=0;X<p;++X)E=K*I+Y*p+X,t[E]&4&&(f[O]=K,f[O+1]=Y,f[O+2]=X,O+=3,t[E]&=-5);do{K=f;E=aa;Y=O;X=g;NGL.debug&&console.log("positin",Y/3);var Z=O=void 0,$=void 0,J=void 0,N=void 0,T=void 0,U=void 0,S=void 0,ca=void 0,H=J=void 0,H=void 0,G=new Uint16Array(3),
D=0;if(0!==Y){for(var F=-1,Q=-1,V=-1,ba=q*p,U=0,ca=Y;U<ca;U+=3)for(O=K[U],Z=K[U+1],$=K[U+2],E.toArray(O,Z,$,G),S=0;6>S;++S)H=C[S],F=O+H[0],Q=Z+H[1],V=$+H[2],F<n&&-1<F&&Q<q&&-1<Q&&V<p&&-1<V&&(H=F*ba+p*Q+V,t[H]&1&&!(t[H]&2)?(E.fromArray(F,Q,V,G),J=F-G[0],N=Q-G[1],T=V-G[2],J=J*J+N*N+T*T,z[H]=J,t[H]|=2,t[H]|=4,X[D]=F,X[D+1]=Q,X[D+2]=V,D+=3):t[H]&1&&t[H]&2&&(J=F-G[0],N=Q-G[1],T=V-G[2],J=J*J+N*N+T*T,J<z[H]&&(E.fromArray(F,Q,V,G),z[H]=J,t[H]&4||(t[H]|=4,X[D]=F,X[D+1]=Q,X[D+2]=V,D+=3))));U=0;for(ca=Y;U<ca;U+=
3)for(O=K[U],Z=K[U+1],$=K[U+2],E.toArray(O,Z,$,G),S=6;18>S;S++)H=C[S],F=O+H[0],Q=Z+H[1],V=$+H[2],F<n&&-1<F&&Q<q&&-1<Q&&V<p&&-1<V&&(H=F*ba+p*Q+V,t[H]&1&&!(t[H]&2)?(E.fromArray(F,Q,V,G),J=F-G[0],N=Q-G[1],T=V-G[2],J=J*J+N*N+T*T,z[H]=J,t[H]|=2,t[H]|=4,X[D]=F,X[D+1]=Q,X[D+2]=V,D+=3):t[H]&1&&t[H]&2&&(J=F-G[0],N=Q-G[1],T=V-G[2],J=J*J+N*N+T*T,J<z[H]&&(E.fromArray(F,Q,V,G),z[H]=J,t[H]&4||(t[H]|=4,X[D]=F,X[D+1]=Q,X[D+2]=V,D+=3))));U=0;for(ca=Y;U<ca;U+=3)for(O=K[U],Z=K[U+1],$=K[U+2],E.toArray(O,Z,$,G),S=18;26>
S;S++)H=C[S],F=O+H[0],Q=Z+H[1],V=$+H[2],F<n&&-1<F&&Q<q&&-1<Q&&V<p&&-1<V&&(H=F*ba+p*Q+V,t[H]&1&&!(t[H]&2)?(E.fromArray(F,Q,V,G),J=F-G[0],N=Q-G[1],T=V-G[2],J=J*J+N*N+T*T,z[H]=J,t[H]|=2,t[H]|=4,X[D]=F,X[D+1]=Q,X[D+2]=V,D+=3):t[H]&1&&t[H]&2&&(J=F-G[0],N=Q-G[1],T=V-G[2],J=J*J+N*N+T*T,J<z[H]&&(E.fromArray(F,Q,V,G),z[H]=J,t[H]&4||(t[H]|=4,X[D]=F,X[D+1]=Q,X[D+2]=V,D+=3))))}E=D;O=0;NGL.debug&&console.log("positout",E/3);K=0;for(Y=E;K<Y;K+=3)E=I*g[K]+p*g[K+1]+g[K+2],t[E]&=-5,z[E]<=1.0404*R&&(f[O]=g[K],f[O+
1]=g[K+1],f[O+2]=g[K+2],O+=3)}while(0<O);R=l*l;g=new Uint16Array(3);for(K=0;K<n;++K)for(Y=0;Y<q;++Y)for(X=0;X<p;++X)E=K*I+Y*p+X,t[E]&=-5,t[E]&1&&(!(t[E]&2)||t[E]&2&&z[E]>=R)&&(t[E]|=4,x&&t[E]&2&&(aa.toArray(K,Y,X,g),f=g[0]*I+g[1]*p+g[2],y[E]=y[f]));NGL.debug&&NGL.timeEnd("NGL.EDTSurface fastdistancemap")}"ses"===a&&(b(!1),d());aa=t.length;if("vws"===a)for(I=0;I<aa;++I)t[I]&=-5,t[I]=t[I]&2?1:0;else if("ms"===a)for(I=0;I<aa;++I)t[I]&=-3,t[I]&4&&(t[I]|=2),t[I]&=-5,t[I]=t[I]&2?1:0;else if("ses"===a)for(I=
0;I<aa;++I)t[I]&4&&t[I]&2?t[I]&=-5:t[I]&4&&!(t[I]&2)&&(t[I]|=2),t[I]=t[I]&2?1:0;else if("sas"===a)for(I=0;I<aa;++I)t[I]&=-5,t[I]=t[I]&2?1:0;a=new NGL.Volume(a,"",t,p,q,n,y);a.setMatrix(r);NGL.debug&&NGL.timeEnd("NGL.EDTSurface.getVolume");return a}};
NGL.getSurfaceGrid=function(a,b,c,d){var e;e=1/c*3+b;b=(new THREE.Vector3).copy(a.min);a=(new THREE.Vector3).copy(a.max);b.subScalar(d+e);a.addScalar(d+e);b.multiplyScalar(c).floor().divideScalar(c);a.multiplyScalar(c).ceil().divideScalar(c);d=(new THREE.Vector3).subVectors(a,b).multiplyScalar(c).ceil().addScalar(1);e=256*Math.pow(10,6);var f=d.x*d.y*d.z*3;e<=f&&(c*=Math.pow(e/f,1/3),b.multiplyScalar(c).floor().divideScalar(c),a.multiplyScalar(c).ceil().divideScalar(c),d.subVectors(a,b).multiplyScalar(c).ceil().addScalar(1));
b=(new THREE.Vector3).copy(b).negate();a=new THREE.Matrix4;a.multiply((new THREE.Matrix4).makeRotationY(THREE.Math.degToRad(90)));a.multiply((new THREE.Matrix4).makeScale(-1/c,1/c,1/c));a.multiply((new THREE.Matrix4).makeTranslation(-c*b.z,-c*b.y,-c*b.x));return{dim:d,tran:b,matrix:a,scaleFactor:c}};
NGL.Script=function(a,b,c){var d=signals;this.signals={elementAdded:new d.Signal,elementRemoved:new d.Signal,nameChanged:new d.Signal};this.name=b;this.path=c;this.dir=c.substring(0,c.lastIndexOf("/")+1);try{this.fn=new Function("stage","panel","__name__","__path__","__dir__",Object.keys(NGL.makeScriptHelper()).join(","),a)}catch(e){NGL.error("NGL.Script compilation failed",e),this.fn=null}};
NGL.Script.prototype={constructor:NGL.Script,call:function(a,b){function c(){"function"===typeof b&&b()}var d={add:function(a){this.signals.elementAdded.dispatch(arguments)}.bind(this),remove:function(a){this.signals.elementRemoved.dispatch(arguments)}.bind(this),setName:function(a){this.signals.nameChanged.dispatch(a)}.bind(this)},e=new NGL.ScriptQueue(a,this.dir,b),f=NGL.makeScriptHelper(a,e,d);if(this.fn){var g=[a,d,this.name,this.path,this.dir];try{var h=[];Object.keys(f).forEach(function(a){h.push(f[a])});
this.fn.apply(null,g.concat(h))}catch(k){NGL.error("NGL.Script.fn",k)}}else NGL.log("NGL.Script.call no function available");e.then(c,function(){d.add(new UI.Text("ERROR"));c()})}};NGL.ScriptQueue=function(a,b,c){this.stage=a;this.dir=b||"";this.onFinish=c;this.promise=new Promise(function(a,b){a()})};
NGL.ScriptQueue.prototype={constructor:NGL.ScriptQueue,load:function(a,b){var c={},d=this.dir+a,e,f=b||{};"function"===typeof b?(e=b,f={}):e=f.onLoad;f.onLoad=function(a){a.requestGuiVisibility(!1);"function"===typeof e&&e(a);c.resolve?c.resolve():c.success=!0};f.onError=function(a){c.reject?c.reject(a):c.error=a||"error"};this.stage.loadFile(d,f);var g=function(a,b){!0===c.success?a():void 0!==c.error?b(c.error):(c.resolve=a,c.reject=b)};this.promise=this.promise.then(function(){return new Promise(g)})},
then:function(a,b){this.promise=this.promise.then(a,function(a){NGL.error("NGL.ScriptQueue.then",a);"function"===typeof b&&b()})}};
NGL.makeScriptHelper=function(a,b,c){function d(a){a.setVisibility(!1)}function e(a,b){b&&d();a.setVisibility(!0)}function f(a){a=void 0===a?1:a;for(var b=0;b<a;++b)c.add(new UI.Break)}var g=NGL.unicodeHelper;return{load:function(){b.load.apply(b,arguments)},then:function(){b.then.apply(b,arguments)},components:function(b){return a.getComponentsByName(b)},representations:function(b){return a.getRepresentationsByName(b)},structures:function(b){return a.getComponentsByName(b,NGL.StructureComponent)},
color:function(a,b){b.setColor(a)},visibility:function(a,b){b.setVisibility(a)},hide:d,show:e,superpose:function(a,b,c,d,e,f,g){a.superpose(b,c,d,e,f,g)},uiText:function(a,b){var d=new UI.Text(g(a));c.add(d);b&&f(1);return d},uiHtml:function(a,b){var d=new UI.Html(g(a));c.add(d);b&&f(1);return d},uiBreak:f,uiSelect:function(a,b){if(Array.isArray(a)){var d={};a.forEach(function(a){d[a]=a});a=d}var e=(new UI.Select).setOptions(a).onChange(function(){b(e)});c.add(e);return e},uiButton:function(a,b){var d=
(new UI.Button(g(a))).onClick(function(){b(d)});c.add(d);return d},uiOpenButton:function(a,b,d){a=(new UI.Button(g(a))).onClick(function(){NGL.open(b,d)});c.add(a);return a},uiDownloadButton:function(a,b,d){a=(new UI.Button(g(a))).onClick(function(){NGL.download(b(),d)});c.add(a);return a},uiVisibilitySelect:function(b){function f(){var a=[];g.forEach(function(b){b.visible&&a.push(b.name)});return a}var g=b.list,m={"":"[show]"};g.forEach(function(a){m[a.name]=a.name;a.signals.visibilityChanged.add(function(){var b=
f();b.length===g.length?n.setValue(""):a.visible?n.setValue(a.name):n.setValue(b[0])})});var n=(new UI.Select).setOptions(m).onChange(function(){var c=n.getValue();""===c?e(b):(d(b),e(a.getAnythingByName(c)))});c.add(n);return n},uiVisibilityButton:function(a,b){function c(){var a=!1;d.forEach(function(b){b.visible&&(a=!0)});return a}a=g(a?a:"all");b=b||new NGL.Collection;b instanceof NGL.Collection||b instanceof NGL.ComponentCollection||b instanceof NGL.RepresentationCollection||(b=new NGL.Collection([b]));
var d=b.list;d.forEach(function(b){b.signals.visibilityChanged.add(function(){e.setLabel((c()?"hide ":"show ")+a)})});var e=(new UI.Button((c()?"hide ":"show ")+a)).onClick(function(){var a=!c();b.setVisibility(a)});return e},uiPlayButton:function(a,b,d,e,f,q){b=b.trajectory;a=g(a);var p=new NGL.TrajectoryPlayer(b,d,e,f,q);p.mode="once";var r=(new UI.Button("play "+a)).onClick(function(){p.toggle()});p.signals.startedRunning.add(function(){r.setLabel("pause "+a)});p.signals.haltedRunning.add(function(){r.setLabel("play "+
a)});c.add(r);return r}}};NGL.Streamer=function(a,b){var c=b||{};this.compressed=void 0!==c.compressed?c.compressed:!1;this.binary=void 0!==c.binary?c.binary:!1;this.src=a;this.chunkSize=10485760;this.newline="\n";this.__pointer=0;this.__partialLine="";this.__srcName&&(this[this.__srcName]=a)};NGL.Streamer.prototype.constructor=NGL.Streamer;
NGL.Streamer.prototype={constructor:NGL.Streamer,type:"",__srcName:void 0,onload:function(){},onprogress:function(){},onerror:function(){},read:function(a){this._read(function(b){if(this.compressed)NGL.decompressWorker(b,"foo."+this.compressed,!0,function(b){this.data=b;if("function"===typeof this.onload)this.onload(this.data);a()}.bind(this));else{this.binary&&b instanceof ArrayBuffer&&(b=new Uint8Array(b));this.data=b;if("function"===typeof this.onload)this.onload(this.data);a()}}.bind(this))},
_read:function(a){a(this.src)},_chunk:function(a,b){b=Math.min(this.data.length,b);return 0===a&&this.data.length===b?this.data:this.binary||this.compressed?this.data.subarray(a,b):this.data.substring(a,b)},chunk:function(a){return this._chunk(a,a+this.chunkSize)},peekLines:function(a){var b=this.data,c=b.length,d=this.binary||this.compressed?this.newline.charCodeAt(0):this.newline,e,f=0;for(e=0;e<c&&(b[e]===d&&++f,f!==a);++e);a=this._chunk(0,e+1);return this.chunkToLines(a,"",e>c).lines},lineCount:function(){console.warn("lineCount");
for(var a=this.data,b=a.length,c=this.binary||this.compressed?this.newline.charCodeAt(0):this.newline,d=0,e=0;e<b;++e)a[e]===c&&++d;a[b-1]!==c&&++d;return d},chunkCount:function(){return Math.floor(this.data.length/this.chunkSize)+1},asText:function(){return this.binary||this.compressed?NGL.Uint8ToString(this.data):this.data},chunkToLines:function(a,b,c){var d=this.newline;if(!this.binary&&!this.compressed&&a.length===this.data.length)return{lines:a.split(d),partialLine:""};a=this.binary||this.compressed?
NGL.Uint8ToString(a):a;var e=[],f=a.lastIndexOf(d);-1===f?b+=a:(b+=a.substr(0,f),e=e.concat(b.split(d)),b=f===a.length-d.length?"":a.substr(f+d.length));c&&""!==b&&e.push(b);return{lines:e,partialLine:b}},nextChunk:function(){var a=this.__pointer;if(!(a>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(a)},nextChunkOfLines:function(){var a=this.nextChunk();if(void 0!==a)return a=this.chunkToLines(a,this.__partialLine,this.__pointer>this.data.length),this.__partialLine=a.partialLine,
a.lines},eachChunk:function(a){for(var b=this.chunkSize,c=this.data.length,d=this.chunkCount(),e=0;e<c;e+=b){var f=this.chunk(e),g=Math.round(e/b);a(f,g,d)}},eachChunkOfLines:function(a){this.eachChunk(function(b,c,d){b=this.chunkToLines(b,this.__partialLine,c===d+1);this.__partialLine=b.partialLine;a(b.lines,c,d)}.bind(this))},eachChunkOfLinesAsync:function(a,b){function c(){++f;NGL.processArray(d.nextChunkOfLines(),a,function(){f>=e?b():setTimeout(c)})}console.warn("eachChunkOfLinesAsync");var d=
this,e=d.chunkCount(),f=0;c()},toJSON:function(){var a=this.type.substr(0,1).toUpperCase()+this.type.substr(1),a={metadata:{version:.1,type:a+"Streamer",generator:a+"StreamerExporter"},src:this.src,compressed:this.compressed,binary:this.binary,chunkSize:this.chunkSize,newline:this.newline};this.__srcName&&(a[this.__srcName]=this[this.__srcName]);return a},fromJSON:function(a){this.src=a.src;this.compressed=a.compressed;this.binary=a.binary;this.chunkSize=a.chunkSize;this.newline=a.newline;this.__srcName&&
(this[this.__srcName]=a[this.__srcName]);return this},getTransferable:function(){return[]},dispose:function(){delete this.src;this.__srcName&&delete this[this.__srcName]}};NGL.NetworkStreamer=function(a,b){NGL.Streamer.call(this,a,b)};
NGL.NetworkStreamer.prototype=NGL.createObject(NGL.Streamer.prototype,{constructor:NGL.NetworkStreamer,type:"network",__srcName:"url",_read:function(a){var b=this.src;"function"===typeof importScripts&&"../"===b.substr(0,3)&&(b="../"+b);var c=new XMLHttpRequest;c.open("GET",b,!0);c.addEventListener("load",function(b){if(200===c.status||304===c.status||0===c.status)a(c.response);else{if("function"===typeof this.onerror)this.onerror(c.status);throw"NGL.NetworkStreamer._read: status code "+c.status;
}}.bind(this),!1);"function"===typeof this.onerror&&c.addEventListener("error",function(a){this.onerror(a)}.bind(this),!1);if(this.compressed||this.binary)c.responseType="arraybuffer";c.send(null)}});NGL.FileStreamer=function(a,b){NGL.Streamer.call(this,a,b)};
NGL.FileStreamer.prototype=NGL.createObject(NGL.Streamer.prototype,{constructor:NGL.FileStreamer,type:"file",__srcName:"file",_read:function(a){if("function"===typeof importScripts){var b=new FileReaderSync,b=this.binary||this.compressed?b.readAsArrayBuffer(this.file):b.readAsText(this.file);a(b)}else b=new FileReader,b.onload=function(b){a(b.target.result)}.bind(this),"function"===typeof this.onprogress&&(b.onprogress=function(a){this.onprogress(a)}.bind(this)),"function"===typeof this.onerror&&
(b.onerror=function(a){this.onerror(a)}.bind(this)),this.binary||this.compressed?b.readAsArrayBuffer(this.file):b.readAsText(this.file)}});NGL.StringStreamer=function(a,b){NGL.Streamer.call(this,a,b)};NGL.StringStreamer.prototype=NGL.createObject(NGL.Streamer.prototype,{constructor:NGL.StringStreamer,type:"string",__srcName:"str",_chunk:function(a,b){return this.data.substr(a,b)}});NGL.BinaryStreamer=function(a,b){a instanceof ArrayBuffer&&(a=new Uint8Array(a));NGL.Streamer.call(this,a,b)};
NGL.BinaryStreamer.prototype=NGL.createObject(NGL.Streamer.prototype,{constructor:NGL.BinaryStreamer,type:"binary",__srcName:"bin",getTransferable:function(){var a=NGL.Streamer.prototype.getTransferable.call(this);this.bin instanceof Uint8Array&&a.push(this.bin.buffer);return a}});
NGL.reorderAtoms=function(a){NGL.debug&&NGL.time("NGL.reorderAtoms");var b=a.getAtomProxy(),c=a.getAtomProxy();a.atomStore.sort(function(a,e){b.index=a;c.index=e;return b.modelindex<c.modelindex?-1:b.modelindex>c.modelindex?1:b.chainname<c.chainname?-1:b.chainname>c.chainname?1:b.resno<c.resno?-1:b.resno>c.resno?1:0});NGL.debug&&NGL.timeEnd("NGL.reorderAtoms")};
NGL.StructureBuilder=function(a){function b(a){for(var b=m.atomCount[a],c=m.atomOffset[a],d=Array(b),e=0;e<b;++e)d[e]=l.atomTypeId[c+e];m.residueTypeId[a]=p.add(h,d,k)}var c=null,d=null,e=null,f=null,g=null,h,k,l=a.atomStore,m=a.residueStore,n=a.chainStore,q=a.modelStore,p=a.residueMap,r=-1,s=-1,u=-1,v=-1;this.addAtom=function(a,p,t,z,y,A){var B=!1,L=!1,C=!1;if(c!==a)C=L=B=!0,v+=1,u+=1,s+=1;else if(d!==p)C=L=!0,u+=1,s+=1;else if(f!==z||e!==t)C=!0,s+=1;r+=1;B&&(q.growIfFull(),q.chainOffset[v]=u,q.chainCount[v]=
0,q.count+=1,n.modelIndex[u]=v);L&&(n.growIfFull(),n.setChainname(u,p),n.residueOffset[u]=s,n.residueCount[u]=0,n.count+=1,n.modelIndex[u]=v,q.chainCount[v]+=1,m.chainIndex[s]=u);C&&(h=e,k=g,0<s&&b(s-1),m.growIfFull(),m.resno[s]=z,void 0!==A&&(m.sstruc[s]=A.charCodeAt(0)),m.atomOffset[s]=r,m.atomCount[s]=0,m.count+=1,m.chainIndex[s]=u,n.residueCount[u]+=1);l.count+=1;l.residueIndex[r]=s;m.atomCount[s]+=1;c=a;d=p;e=t;f=z;g=y};this.finalize=function(){h=e;k=g;b(s)}};
NGL.assignSecondaryStructure=function(a){NGL.debug&&NGL.time("NGL.assignSecondaryStructure");var b=[];a.eachModel(function(a){a.eachChain(function(a){b.push(a.chainname)})});var c=b.slice().sort(),d=[];c.forEach(function(a){d.push(b.indexOf(a))});var e=a.helices||[],e=e.filter(function(a){return 0<=NGL.binarySearchIndexOf(c,a[0])}),f=a.residueStore;a.eachModel(function(a){var b=0,c=e.length;if(0!==c){var d=e[b],g=!1,q=!1;a.eachChain(function(a){var h=!1;if(a.chainname===d[0])for(var s=a.residueOffset,
u=s+a.residueCount;s<u&&(f.resno[s]===d[1]&&(g=!0),g&&(f.sstruc[s]=d[4],f.resno[s]===d[3]&&(g=!1,b+=1,b<c?(--s,d=e[b],h=a.chainname!==d[0]):q=!0)),!h&&!q);++s);})}});var g=a.sheets||[],g=g.filter(function(a){return 0<=NGL.binarySearchIndexOf(c,a[0])});g.sort(function(a,b){var e=a[0],f=b[0];if(e===f)return 0;e=NGL.binarySearchIndexOf(c,e);f=NGL.binarySearchIndexOf(c,f);return d[e]<d[f]?-1:1});a.eachModel(function(a){var b=0,c=g.length;if(0!==c){var d=g[b],e=!1,q=!1;a.eachChain(function(a){var h=!1;
if(a.chainname===d[0])for(var s=a.residueOffset,u=s+a.residueCount,v=s;v<u&&(f.resno[v]===d[1]&&(e=!0),e&&(f.sstruc[v]=101,f.resno[v]===d[3]&&(e=!1,b+=1,b<c?(v=s-1,d=g[b],h=a.chainname!==d[0]):q=!0)),!h&&!q);++v);})}});NGL.debug&&NGL.timeEnd("NGL.assignSecondaryStructure")};
NGL.calculateSecondaryStructure=function(){var a=function(a,b,c,g){for(var h=a.structure,k=a.residueIndexStart,l=h.getResidueProxy(),m=h.getResidueProxy(),n=h.getAtomProxy(),h=h.getAtomProxy(),q=Math.max(0,b-2);q<=b;++q)for(var p=2;5>p;++p)if(!(q+p>=a.residueCount)){l.index=k+q;m.index=k+q+p;n.index=l.traceAtomIndex;h.index=m.traceAtomIndex;var r=n.distanceTo(h);if(Math.abs(r-c[p-2])>g)return!1}return!0},b=function(b){for(var c=b.residueStore,f=b.residueIndexStart,g=0,h=b.residueCount;g<h;++g){var k=
"c";a(b,g,[5.45,5.18,6.37],2.1)?k="h":a(b,g,[6.1,10.4,13],1.42)&&(k="s");c.sstruc[f+g]=k.charCodeAt(0)}},c=function(a){var b=a.residueStore,c=a.residueIndexStart,g=(new NGL.Helixbundle(a)).position,h=new THREE.Vector3,k=new THREE.Vector3,l=0;for(a=a.residueCount;l<a;++l){h.fromArray(g.center,3*l);k.fromArray(g.center,3*l+3);var m=h.distanceTo(k);2>m&&1<m&&20>g.bending[l]&&(b.sstruc[c+l]=104,b.sstruc[c+l+1]=104)}};return function(a){NGL.debug&&NGL.time("NGL.Structure.autoSS");a.eachPolymer(function(a){if(!(4>
a.residueCount)){if(a.isCg())c(a);else if(a.isProtein())b(a);else return;var d=void 0,g=0;a.eachResidue(function(a){a.sstruc===d?g+=1:(1===g&&(--a.index,a.sstruc="c"),g=1,d=a.sstruc)})}});NGL.debug&&NGL.timeEnd("NGL.Structure.autoSS")}}();
NGL.calculateChainnames=function(a){NGL.debug&&NGL.time("NGL.calculateChainnames");var b=!0;a.eachChain(function(a){a.chainname&&(b=!1)});if(b){var c=a.modelStore,d=a.chainStore,e=a.residueStore,f=a.getAtomProxy(),g=a.getAtomProxy(),h=0,k=0,l=0,m=0,n=[];a.eachResidueN(2,function(a,b){var c=!1,d=a.backboneType,q=b.backboneType,w=NGL.UnknownBackboneType;m=a.index;a.modelIndex!==b.modelIndex?c=!0:a.moleculeType!==b.moleculeType?c=!0:d!==w&&d===q&&(f.index=a.backboneEndAtomIndex,g.index=b.backboneStartAtomIndex,
f.connectedTo(g)||(c=!0));b.index===e.count-1&&(c=!0,m=b.index);if(c){c=h;d=0;for(q="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[c%26];26<=c;)c=Math.floor(c/26),q+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[c%26],d+=1;n.push({mIndex:k,chainname:q,rStart:l,rCount:m-l+1});h+=1;a.modelIndex!==b.modelIndex&&(h=0,k+=1);5<=d&&(NGL.warn("out of chain names"),h=0);m=l=b.index}});d.count=0;n.forEach(function(a){var b=a.mIndex,f=a.chainname,g=a.rStart;a=a.rCount;for(var h=d.count,k=0;k<a;++k)e.chainIndex[g+k]=h;d.growIfFull();d.modelIndex[h]=
b;d.setChainname(h,f);d.residueOffset[h]=g;d.residueCount[h]=a;d.count+=1;c.chainCount[b]+=1});var q=0;a.eachModel(function(a){c.chainOffset[a.index]=q;q+=c.chainCount[a.index]})}NGL.debug&&NGL.timeEnd("NGL.calculateChainnames")};NGL.calculateBonds=function(a){NGL.debug&&NGL.time("NGL.calculateBonds");NGL.calculateBondsWithin(a);NGL.calculateBondsBetween(a);NGL.debug&&NGL.timeEnd("NGL.calculateBonds")};
NGL.calculateResidueBonds=function(a){var b=a.structure,c=b.getAtomProxy(),b=b.getAtomProxy(),d=a.atomCount,e=a.atomOffset,f=e+d-1;if(500<d)NGL.debug&&NGL.warn("more than 500 atoms, skip residue for auto-bonding",a.qualifiedName());else{var g=[],h=[];if(50<d){d=new NGL.Kdtree(a,!0);a=a.isCg()?1.2:2.3;for(var k=e;k<f;++k){c.index=k;for(var l=c.covalent+a+.3,l=d.nearest(c,Infinity,l*l),m=l.length,n=0;n<m;++n)b.index=l[n].index,c.index<b.index&&c.connectedTo(b)&&(g.push(c.index-e),h.push(b.index-e))}}else for(k=
e;k<f;++k)for(c.index=k,n=k+1;n<=f;++n)b.index=n,c.connectedTo(b)&&(g.push(k-e),h.push(n-e));return{atomIndices1:g,atomIndices2:h}}};
NGL.calculateBondsWithin=function(a,b){NGL.debug&&NGL.time("NGL.calculateBondsWithin");var c=a.bondStore,d=a.rungBondStore,e=a.getAtomSet(!1),f=a.getAtomProxy(),g=a.getAtomProxy();a.eachResidue(function(a){if(!b){var k=a.atomOffset;if(500<a.atomCount){NGL.warn("more than 500 atoms, skip residue for auto-bonding",a.qualifiedName());return}for(var l=a.getBonds(),m=l.atomIndices1,l=l.atomIndices2,n=m.length,q=0;q<n;++q)f.index=m[q]+k,g.index=l[q]+k,c.addBond(f,g)}k=a.residueType.rungEndAtomIndex;-1!==
a.residueType.traceAtomIndex&&-1!==k&&(f.index=a.traceAtomIndex,g.index=a.rungEndAtomIndex,d.addBond(f,g),e.add_unsafe(f.index),e.add_unsafe(g.index))});a.atomSetDict.rung=e;NGL.debug&&NGL.timeEnd("NGL.calculateBondsWithin")};
NGL.calculateBondsBetween=function(a,b){function c(a,c){var k=a.backboneType,l=c.backboneType;k!==NGL.UnknownBackboneType&&k===l&&(g.index=a.backboneEndAtomIndex,h.index=c.backboneStartAtomIndex,g.connectedTo(h)&&(b||d.addBond(g,h),g.index=a.traceAtomIndex,h.index=c.traceAtomIndex,e.addBond(g,h),f.add_unsafe(g.index),f.add_unsafe(h.index)))}NGL.debug&&NGL.time("NGL.calculateBondsBetween");var d=a.bondStore,e=a.backboneBondStore,f=a.getAtomSet(!1),g=a.getAtomProxy(),h=a.getAtomProxy();0===e.count&&
e.resize(a.residueStore.count);a.eachResidueN(2,c);var k=a.getResidueProxy(),l=a.getResidueProxy();a.eachChain(function(a){k.index=a.residueOffset;l.index=a.residueOffset+a.residueCount-1;c(l,k)});a.atomSetDict.backbone=f;NGL.debug&&NGL.timeEnd("NGL.calculateBondsBetween")};
NGL.buildUnitcellAssembly=function(a){function b(a){var b=[];Object.keys(e).forEach(function(k){k=e[k].clone();g.copy(d).applyMatrix4(k);h.setFromMatrixPosition(k);h.sub(f);1<g.x&&--h.x;0>g.x&&(h.x+=1);1<g.y&&--h.y;0>g.y&&(h.y+=1);1<g.z&&--h.z;0>g.z&&(h.z+=1);a&&h.add(a);k.setPosition(h);k.multiplyMatrices(c.fracToCart,k);k.multiply(c.cartToFrac);b.push(k)});return b}NGL.debug&&NGL.time("NGL.buildUnitcellAssembly");var c=a.unitcell,d=a.center.clone().applyMatrix4(c.cartToFrac),e=NGL.getSymmetryOperations(c.spacegroup),
f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;1<d.x&&--f.x;0>d.x&&(f.x+=1);1<d.y&&--f.y;0>d.y&&(f.y+=1);1<d.z&&--f.z;0>d.z&&(f.z+=1);var k=new NGL.Assembly("UNITCELL");k.addPart(b());var l=new THREE.Vector3,m=new NGL.Assembly("SUPERCELL"),l=Array.prototype.concat.call(b(),b(l.set(1,1,1)),b(l.set(-1,-1,-1)),b(l.set(1,0,0)),b(l.set(1,1,0)),b(l.set(1,0,1)),b(l.set(0,1,0)),b(l.set(0,1,1)),b(l.set(0,0,1)),b(l.set(-1,0,0)),b(l.set(-1,-1,0)),b(l.set(-1,0,-1)),b(l.set(0,-1,0)),b(l.set(0,-1,
-1)),b(l.set(0,0,-1)),b(l.set(1,-1,-1)),b(l.set(1,1,-1)),b(l.set(1,-1,1)),b(l.set(-1,1,1)),b(l.set(-1,-1,1)),b(l.set(-1,1,-1)),b(l.set(0,1,-1)),b(l.set(0,-1,1)),b(l.set(1,0,-1)),b(l.set(-1,0,1)),b(l.set(1,-1,0)),b(l.set(-1,1,0)));m.addPart(l);a.biomolDict.UNITCELL=k;a.biomolDict.SUPERCELL=m;NGL.debug&&NGL.timeEnd("NGL.buildUnitcellAssembly")};NGL.Assembly=function(a){this.name=a||"";this.partList=[]};
NGL.Assembly.prototype={constructor:NGL.Assembly,type:"Assembly",addPart:function(a,b){var c=new NGL.AssemblyPart(a,b);this.partList.push(c);return c},toJSON:function(){var a={name:this.name,partList:Array(this.partList.length)};this.partList.forEach(function(b,c){a.partList[c]=b.toJSON()});return a},fromJSON:function(a){this.name=a.name;this.partList=a.partList;this.partList.forEach(function(a,c){this.partList[c]=(new NGL.AssemblyPart).fromJSON(a)}.bind(this));return this}};
NGL.AssemblyPart=function(a,b){this.matrixList=a||[];this.chainList=b||[]};
NGL.AssemblyPart.prototype={constructor:NGL.AssemblyPart,type:"AssemblyPart",getSelection:function(){if(0<this.chainList.length){var a=":"+this.chainList.join(" OR :");return new NGL.Selection(a)}return new NGL.Selection("")},getView:function(a){var b=this.getSelection();return b?a.getView(b):a},getInstanceList:function(){for(var a=[],b=0,c=this.matrixList.length;b<c;++b)a.push({id:b+1,name:b,matrix:this.matrixList[b]});return a},toJSON:function(){return{matrixList:this.matrixList,chainList:this.chainList}},
fromJSON:function(a){this.matrixList=a.matrixList;this.chainList=a.chainList;return this}};NGL.WorkerRegistry.add("parse",function(a,b){NGL.debug&&NGL.time("WORKER parse");var c=NGL.fromJSON(a.data);c.parse(function(){NGL.debug&&NGL.timeEnd("WORKER parse");c.streamer.dispose();b(c.toJSON(),c.getTransferable())})});NGL.Parser=function(a,b){var c=b||{};this.streamer=a;this.name=c.name;this.path=c.path};
NGL.Parser.prototype={constructor:NGL.Parser,type:"",__objName:"",parse:function(a){var b=this;this.streamer.read(function(){b._beforeParse();b._parse(function(){b._afterParse();a(b[b.__objName])})});return this[this.__objName]},parseWorker:function(a){if(NGL.useWorker&&"undefined"!==typeof Worker&&"function"!==typeof importScripts)var b=(new NGL.Worker("parse")).post(this.toJSON(),this.getTransferable(),function(c){b.terminate();this.fromJSON(c.data);this._afterWorker(a)}.bind(this),function(c){console.warn("NGL.Parser.parseWorker error - trying without worker",
c);b.terminate();this.parse(a)}.bind(this));else this.parse(a);return this[this.__objName]},_parse:function(a){NGL.warn("NGL.Parser._parse not implemented");a()},_beforeParse:function(){},_afterParse:function(){NGL.debug&&NGL.log(this[this.__objName])},_afterWorker:function(a){NGL.debug&&NGL.log(this[this.__objName]);a(this[this.__objName])},toJSON:function(){var a=this.type.substr(0,1).toUpperCase()+this.type.substr(1),a={metadata:{version:.1,type:a+"Parser",generator:a+"ParserExporter"},streamer:this.streamer.toJSON(),
name:this.name,path:this.path};a[this.__objName]="function"===typeof this[this.__objName].toJSON?this[this.__objName].toJSON():this[this.__objName];return a},fromJSON:function(a){this.streamer=NGL.fromJSON(a.streamer);this.name=a.name;this.path=a.path;"function"===typeof this[this.__objName].toJSON?this[this.__objName].fromJSON(a[this.__objName]):this[this.__objName]=a[this.__objName];return this},getTransferable:function(){var a=[],a=a.concat(this.streamer.getTransferable());"function"===typeof this[this.__objName].toJSON&&
(a=a.concat(this[this.__objName].getTransferable()));return a}};NGL.StructureParser=function(a,b){var c=b||{};this.firstModelOnly=c.firstModelOnly||!1;this.asTrajectory=c.asTrajectory||!1;this.cAlphaOnly=c.cAlphaOnly||!1;this.reorderAtoms=c.reorderAtoms||!1;this.dontAutoBond=c.dontAutoBond||!1;this.doAutoSS=!0;NGL.Parser.call(this,a,c);this.structure=new NGL.Structure(this.name,this.path);this.structureBuilder=new NGL.StructureBuilder(this.structure)};
NGL.StructureParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.StructureParser,type:"structure",__objName:"structure",_afterParse:function(){NGL.debug&&NGL.time("NGL.StructureParser._afterParse");var a=this.structure;a.refresh();this.reorderAtoms&&NGL.reorderAtoms(a);NGL.calculateChainnames(a);this.dontAutoBond?this.autoBondBetween&&NGL.calculateBondsBetween(a):NGL.calculateBonds(a);this.doAutoSS&&0===a.helices.length&&0===a.sheets.length&&NGL.calculateSecondaryStructure(a);
(0<a.helices.length||0<a.sheets.length)&&NGL.assignSecondaryStructure(a);this._postProcess();if(void 0===a.unitcell){var b=a.boundingBox.size();a.unitcell=new NGL.Unitcell(b.x,b.y,b.z,90,90,90,"P 1")}NGL.buildUnitcellAssembly(a);NGL.debug&&NGL.timeEnd("NGL.StructureParser._afterParse");NGL.debug&&NGL.log(this[this.__objName])},_postProcess:function(){},toJSON:function(){var a=NGL.Parser.prototype.toJSON.call(this);a.firstModelOnly=this.firstModelOnly;a.asTrajectory=this.asTrajectory;a.cAlphaOnly=
this.cAlphaOnly;a.reorderAtoms=this.reorderAtoms;a.dontAutoBond=this.dontAutoBond;a.doAutoSS=this.doAutoSS;return a},fromJSON:function(a){NGL.Parser.prototype.fromJSON.call(this,a);this.firstModelOnly=a.firstModelOnly;this.asTrajectory=a.asTrajectory;this.cAlphaOnly=a.cAlphaOnly;this.reorderAtoms=a.reorderAtoms;this.dontAutoBond=a.dontAutoBond;this.doAutoSS=a.doAutoSS;return this}});NGL.PdbParser=function(a,b){NGL.StructureParser.call(this,a,b)};
NGL.PdbParser.prototype=NGL.createObject(NGL.StructureParser.prototype,{constructor:NGL.PdbParser,type:"pdb",_parse:function(a){function b(a,b,U){for(;a<b;++a)if(y=U[a],A=y.substr(0,6),"ATOM  "===A||"HETATM"===A){if(J&&(h?(n?(q=new Float32Array(3*Y.count),l.push(q)):q=[],p=0):g||(I={})),J=!1,!(g&&0<$)){if(c){var S=y.split(d),ca=10===S.length?1:0;M=S[2];if(k&&"CA"!==M)continue;var H=parseFloat(S[6-ca]),G=parseFloat(S[7-ca]),D=parseFloat(S[8-ca])}else{M=y.substr(12,4).trim();if(k&&"CA"!==M)continue;
H=parseFloat(y.substr(30,8));G=parseFloat(y.substr(38,8));D=parseFloat(y.substr(46,8))}if(h){var F=3*p;q[F+0]=H;q[F+1]=G;q[F+2]=D;p+=1;if(n)continue}var Q;c?(B=parseInt(S[1]),W="H"===y[0]?1:0,L=ca?"":S[4],C=parseInt(S[5-ca]),P=S[3],K=parseFloat(S[9-ca]),aa=""):(B=parseInt(y.substr(6,5)),Q=y.substr(76,2).trim(),W="H"===y[0]?1:0,L=y[21].trim(),C=parseInt(y.substr(22,4)),P=y.substr(17,4).trim(),K=parseFloat(y.substr(60,8)),aa=y[16].trim());Y.growIfFull();Y.atomTypeId[Z]=E.add(M,Q);Y.x[Z]=H;Y.y[Z]=G;
Y.z[Z]=D;Y.serial[Z]=B;Y.bfactor[Z]=K;Y.altloc[Z]=aa.charCodeAt(0);f.addAtom($,L,P,C,W);I[B]=Z;Z+=1}}else if("CONECT"===A){if(D=I[parseInt(y.substr(6,5))],H=[11,16,21,26],void 0!==D){for(F=0;4>F;++F)G=parseInt(y.substr(H[F],5)),Number.isNaN(G)||(G=I[G],void 0!==G&&(X.index=D,O.index=G,e.bondStore.addBond(X,O)));e.hasConnect=!0}}else if("HELIX "===A){var D=y[19].trim(),F=parseInt(y.substr(21,4)),H=y[31].trim(),G=parseInt(y.substr(33,4)),V=parseInt(y.substr(39,1)),V=(z[V]||z[""]).charCodeAt(0);s.push([D,
F,H,G,V])}else if("SHEET "===A)D=y[21].trim(),F=parseInt(y.substr(22,4)),H=y[32].trim(),G=parseInt(y.substr(33,4)),u.push([D,F,H,G]);else if("REMARK"===A&&"350"===y.substr(7,3))if("BIOMOLECULE:"===y.substr(11,12))D=y.substr(23).trim(),/^(0|[1-9][0-9]*)$/.test(D)&&(D="BU"+D),w=new NGL.Assembly(D),v[D]=w;else if("BIOMT"===y.substr(13,5))S=y.split(/\s+/),D=parseInt(y[18])-1,F=S[3].trim(),0===D&&(t=new THREE.Matrix4,x.matrixList.push(t)),F=t.elements,F[0+D]=parseFloat(S[4]),F[4+D]=parseFloat(S[5]),F[8+
D]=parseFloat(S[6]),F[12+D]=parseFloat(S[7]);else{if("APPLY THE FOLLOWING TO CHAINS:"===y.substr(11,30)||"                   AND CHAINS:"===y.substr(11,30))"APPLY"===y.substr(11,5)&&(x=w.addPart()),y.substr(41,30).split(",").forEach(function(a){(a=a.trim())&&x.chainList.push(a)})}else if("HEADER"===A)y.substr(62,4);else if("TITLE "===A)r+=y.substr(10,70)+"\n";else if("MODEL "===A)J=!0;else if("ENDMDL"===A||"END"===y.substr(0,3))J||(h&&!n&&(l.push(new Float32Array(q)),n=!0),$+=1,J=!0);else if("MTRIX "===
A)S=y.split(/\s+/),F=S[1].trim(),"1"===y[5]&&"1"===F&&(v.NCS={matrixDict:{},chainList:void 0},w=v.NCS),D=parseInt(y[5])-1,0===D&&(w.matrixDict[F]=new THREE.Matrix4),F=w.matrixDict[F].elements,F[0+D]=parseFloat(S[2]),F[4+D]=parseFloat(S[3]),F[8+D]=parseFloat(S[4]),F[12+D]=parseFloat(S[5]);else if("ORIGX"===y.substr(0,5))R.origx||(R.origx=new THREE.Matrix4),S=y.split(/\s+/),D=parseInt(y[5])-1,F=R.origx.elements,F[0+D]=parseFloat(S[1]),F[4+D]=parseFloat(S[2]),F[8+D]=parseFloat(S[3]),F[12+D]=parseFloat(S[4]);
else if("SCALE"===y.substr(0,5))R.scale||(R.scale=new THREE.Matrix4),S=y.split(/\s+/),D=parseInt(y[5])-1,F=R.scale.elements,F[0+D]=parseFloat(S[1]),F[4+D]=parseFloat(S[2]),F[8+D]=parseFloat(S[3]),F[12+D]=parseFloat(S[4]);else if("CRYST1"===A){var F=parseFloat(y.substr(6,9)),H=parseFloat(y.substr(15,9)),G=parseFloat(y.substr(24,9)),V=parseFloat(y.substr(33,7)),ba=parseFloat(y.substr(40,7)),ea=parseFloat(y.substr(47,7)),fa=y.substr(55,11).trim(),D=parseInt(y.substr(66,4)),D=new Float32Array(9);D[0]=
F;D[4]=H;D[8]=G;m.push(D);0===$&&(R.a=F,R.b=H,R.c=G,R.alpha=V,R.beta=ba,R.gamma=ea,R.spacegroup=fa)}}NGL.debug&&NGL.time("NGL.PdbParser._parse "+this.name);var c="pqr"===this.type,d=/\s+/,e=this.structure,f=this.structureBuilder,g=this.firstModelOnly,h=this.asTrajectory,k=this.cAlphaOnly,l=e.frames,m=e.boxes,n=!1,q,p,r=e.title,s=e.helices,u=e.sheets,v=e.biomolDict,w,x,t,z=NGL.HelixTypes,y,A,B,L,C,P,M,W,K,aa,I={},R={};e.hasConnect=!1;var E=e.atomMap,Y=e.atomStore;Y.resize(Math.round(this.streamer.data.length/
80));var X=e.getAtomProxy(),O=e.getAtomProxy(),Z=0,$=0,J=!0;this.streamer.eachChunkOfLines(function(a,c,d){b(0,a.length,a)});f.finalize();e.unitcell=void 0!==R.a?new NGL.Unitcell(R.a,R.b,R.c,R.alpha,R.beta,R.gamma,R.spacegroup,R.scale):void 0;NGL.debug&&NGL.timeEnd("NGL.PdbParser._parse "+this.name);a()}});NGL.PqrParser=function(a,b){NGL.StructureParser.call(this,a,b)};NGL.PqrParser.prototype=NGL.createObject(NGL.PdbParser.prototype,{constructor:NGL.PqrParser,type:"pqr"});
NGL.GroParser=function(a,b){NGL.StructureParser.call(this,a,b);this.structure._doAutoSS=!0;this.structure._doAutoChainName=!0};
NGL.GroParser.prototype=NGL.createObject(NGL.StructureParser.prototype,{constructor:NGL.GroParser,type:"gro",_parse:function(a){NGL.debug&&NGL.time("NGL.GroParser._parse "+this.name);var b=this.structure,c=this.structureBuilder,d=this.firstModelOnly,e=this.asTrajectory,f=this.cAlphaOnly,g=b.frames,h=b.boxes,k,l,m=this.streamer.peekLines(3);b.title=m[0].trim();var n=5+(m[2].length-m[2].lastIndexOf(".")-1),q=20+n,p=20+2*n,r,s,u,v,w=parseInt(m[1]),x=w+3,t=b.atomMap,z=b.atomStore;z.resize(w);var y=0,
A=0,B=0;this.streamer.eachChunkOfLines(function(a,b,m){a:for(b=a.length,m=0;m<b;++m){++B;var M=B-1,W=a[m];if(W)if(0===M%x)e&&(k=new Float32Array(3*w),g.push(k),l=0);else if(1!==M%x)if(M%x===x-1){M=W.trim().split(/\s+/);W=new Float32Array(9);W[0]=10*parseFloat(M[0]);W[4]=10*parseFloat(M[1]);W[8]=10*parseFloat(M[2]);h.push(W);if(d)break a;A+=1}else if(r=W.substr(10,5).trim(),!f||"CA"===r){var K=10*parseFloat(W.substr(20,n)),aa=10*parseFloat(W.substr(q,n)),I=10*parseFloat(W.substr(p,n));if(e){var R=
3*l;k[R+0]=K;k[R+1]=aa;k[R+2]=I;l+=1;if(M>x)continue}s=W.substr(5,5).trim();u=parseInt(W.substr(0,5));v=parseInt(W.substr(15,5));z.growIfFull();z.atomTypeId[y]=t.add(r);z.x[y]=K;z.y[y]=aa;z.z[y]=I;z.serial[y]=v;c.addAtom(A,"",s,u,0,"l");y+=1}}});c.finalize();b.unitcell=new NGL.Unitcell(h[0][0],h[0][4],h[0][8],90,90,90,"P 1");NGL.debug&&NGL.timeEnd("NGL.GroParser._parse "+this.name);a()}});NGL.CifParser=function(a,b){NGL.StructureParser.call(this,a,b)};
NGL.CifParser.prototype=NGL.createObject(NGL.StructureParser.prototype,{constructor:NGL.CifParser,type:"cif",_parse:function(a){NGL.time("NGL.CifParser._parse "+this.name);var b=this.structure,c=this.structureBuilder,d=this.firstModelOnly,e=this.asTrajectory,f=this.cAlphaOnly,g=b.frames,h,k,l;b.hasConnect=!1;var m=/\s+/,n=/'(.*?)'|"(.*?)"|(\S+)/g,q=/"/g,p={};this.cif=p;var r=!1,s=null,u=!1,v=!1,w=[],x=null,t=null,z=null,y=null,A=[],B,L,C,P,M,W,K,aa,I,R,E,Y,X,O,Z={};this.asymIdDict=Z;var $=b.atomMap,
J=b.atomStore;J.resize(this.streamer.data.length/100);var N=0,T=0,U;this.streamer.eachChunkOfLines(function(a,b,H){b=a.length;for(H=0;H<b;++H)if(l=a[H].trim(),!l&&!r||"#"===l[0])u=v=r=!1,w.length=0,y=z=t=x=null,A.length=0;else if("data_"===l.substring(0,5))l.substring(5);else if(";"===l[0])r?(v?(x===w.length&&(x=0),w[x].push(s),x+=1):p[t][z]=s,r=!1,s=null):(r=!0,s=l.substring(1));else if("loop_"===l)v=!0,w.length=0,x=A.length=0;else if("_"===l[0])if(v){var G=l.split("."),D=G[0].substring(1),F=G[1];
1===G.length?(F=!1,p[D]||(p[D]=[]),w.push(p[D])):(p[D]||(p[D]={}),p[D][F]?NGL.warn(D,F,"already exists"):(p[D][F]=[],w.push(p[D][F]),A.push(F)));t=D;z=F;y=!0}else{var G=l.match(n),Q=G[1],G=G[0].split("."),D=G[0].substring(1),F=G[1];1===G.length?(F=!1,p[D]||(p[D]=[]),p[D]=Q):(p[D]||(p[D]={}),p[D][F]?NGL.warn(D,F,"already exists"):p[D][F]=Q);Q||(u=!0);t=D;z=F}else if(r)s+=" "+l;else if(v)if("atom_site"===t){if(Q=A.length,G=l.split(m),y&&(B=A.indexOf("auth_asym_id"),L=A.indexOf("auth_seq_id"),C=A.indexOf("label_atom_id"),
P=A.indexOf("label_comp_id"),M=A.indexOf("label_asym_id"),W=A.indexOf("label_alt_id"),E=A.indexOf("Cartn_x"),Y=A.indexOf("Cartn_y"),X=A.indexOf("Cartn_z"),aa=A.indexOf("id"),I=A.indexOf("type_symbol"),K=A.indexOf("group_PDB"),O=A.indexOf("B_iso_or_equiv"),R=A.indexOf("pdbx_PDB_model_num"),y=!1,U=parseInt(G[R]),e&&(h=[],k=0)),Q=parseInt(G[R]),U!==Q&&(e&&(0===T&&g.push(new Float32Array(h)),h=new Float32Array(3*J.count),g.push(h),k=0),T+=1),U=Q,!(d&&0<T||(Q=G[C].replace(q,""),f&&"CA"!==Q))){var D=parseFloat(G[E]),
F=parseFloat(G[Y]),V=parseFloat(G[X]);if(e){var ba=3*k;h[ba+0]=D;h[ba+1]=F;h[ba+2]=V;k+=1;if(0<T)continue}var ea=G[P],fa=parseInt(G[L]),ba=G[B],ga="H"===G[K][0]?1:0,ha=G[I],da=G[W],da="."===da?"":da;J.growIfFull();J.atomTypeId[N]=$.add(Q,ha);J.x[N]=D;J.y[N]=F;J.z[N]=V;J.serial[N]=parseInt(G[aa]);J.bfactor[N]=parseFloat(G[O]);J.altloc[N]=da.charCodeAt(0);c.addAtom(T,ba,ea,fa,ga);NGL.debug&&(Q=Z[G[M]],void 0!==Q&&Q!==ba&&NGL.warn(Q,ba));Z[G[M]]=ba;N+=1}}else{G=l.match(n);Q=G.length;x===w.length&&(x=
0);for(ba=0;ba<Q;++ba)w[x+ba].push(G[ba]);x+=Q}else"'"===l[0]&&"'"===l.substring(l.length-1)?(G=l.substring(1,l.length-2),!1===z?p[t]=G:p[t][z]=G):u?!1===z?p[t]=l.trim():p[t][z]=l.trim():NGL.debug&&NGL.log("NGL.CifParser._parse: unknown state",l)});c.finalize();p.struct&&p.struct.title&&(b.title=p.struct.title.trim().replace(/^['"]+|['"]+$/g,""));(function(){function a(b,c){Array.isArray(b[c])||Object.keys(b).forEach(function(a){b[a]=[b[a]]})}var c=p.struct_conf;if(c){var d=b.helices,e=NGL.HelixTypes;
a(c,"id");for(var f=0,g=c.beg_auth_seq_id.length;f<g;++f){var h=parseInt(c.pdbx_PDB_helix_class[f]);Number.isNaN(h)||d.push([Z[c.beg_label_asym_id[f]],parseInt(c.beg_auth_seq_id[f]),Z[c.end_label_asym_id[f]],parseInt(c.end_auth_seq_id[f]),(e[h]||e[""]).charCodeAt(0)])}}if(c=p.struct_sheet_range)for(d=b.sheets,a(c,"id"),f=0,g=c.beg_auth_seq_id.length;f<g;++f)d.push([Z[c.beg_label_asym_id[f]],parseInt(c.beg_auth_seq_id[f]),Z[c.end_label_asym_id[f]],parseInt(c.end_auth_seq_id[f])])})();NGL.debug&&NGL.timeEnd("NGL.CifParser._parse "+
this.name);a()},_postProcess:function(){function a(a,b){Array.isArray(a[b])||Object.keys(a).forEach(function(b){a[b]=[a[b]]})}NGL.debug&&NGL.time("NGL.CifParser._postProcess");var b=this.structure,c=this.structure,d=this.cif,e=this.asymIdDict,f={},g=b.biomolDict;if(d.pdbx_struct_oper_list){var h=d.pdbx_struct_oper_list;a(h,"id");h.id.forEach(function(a,b){var c=new THREE.Matrix4,d=c.elements;d[0]=parseFloat(h["matrix[1][1]"][b]);d[1]=parseFloat(h["matrix[1][2]"][b]);d[2]=parseFloat(h["matrix[1][3]"][b]);
d[4]=parseFloat(h["matrix[2][1]"][b]);d[5]=parseFloat(h["matrix[2][2]"][b]);d[6]=parseFloat(h["matrix[2][3]"][b]);d[8]=parseFloat(h["matrix[3][1]"][b]);d[9]=parseFloat(h["matrix[3][2]"][b]);d[10]=parseFloat(h["matrix[3][3]"][b]);d[3]=parseFloat(h["vector[1]"][b]);d[7]=parseFloat(h["vector[2]"][b]);d[11]=parseFloat(h["vector[3]"][b]);c.transpose();f[a]=c})}if(d.pdbx_struct_assembly_gen){var k=d.pdbx_struct_assembly_gen;a(k,"assembly_id");var l=function(a){var b={};a.replace(/[\(\)']/g,"").split(",").forEach(function(a){if(-1!==
a.indexOf("-")){var c=a.split("-");a=parseInt(c[0]);for(c=parseInt(c[1]);a<=c;++a)b[a]=f[a]}else b[a]=f[a]});return b};k.assembly_id.forEach(function(a,b){var c={},d=k.oper_expression[b];if(-1!==d.indexOf(")(")){var d=d.split(")("),f=l(d[0]),h=l(d[1]);Object.keys(f).forEach(function(a){Object.keys(h).forEach(function(b){var d=new THREE.Matrix4;d.multiplyMatrices(f[a],h[b]);c[a+"x"+b]=d})})}else c=l(d);var d=[],m;for(m in c)d.push(c[m]);m=a;/^(0|[1-9][0-9]*)$/.test(m)&&(m="BU"+m);for(var n=k.asym_id_list[b].split(","),
p=0,q=n.length;p<q;++p)n[p]=e[n[p]];void 0===g[m]&&(g[m]=new NGL.Assembly(m));g[m].addPart(d,n)})}if(d.struct_ncs_oper){h=d.struct_ncs_oper;a(h,"id");var m={};g.NCS={matrixDict:m,chainList:void 0};h.id.forEach(function(a,b){var c=new THREE.Matrix4,d=c.elements;d[0]=parseFloat(h["matrix[1][1]"][b]);d[1]=parseFloat(h["matrix[1][2]"][b]);d[2]=parseFloat(h["matrix[1][3]"][b]);d[4]=parseFloat(h["matrix[2][1]"][b]);d[5]=parseFloat(h["matrix[2][2]"][b]);d[6]=parseFloat(h["matrix[2][3]"][b]);d[8]=parseFloat(h["matrix[3][1]"][b]);
d[9]=parseFloat(h["matrix[3][2]"][b]);d[10]=parseFloat(h["matrix[3][3]"][b]);d[3]=parseFloat(h["vector[1]"][b]);d[7]=parseFloat(h["vector[2]"][b]);d[11]=parseFloat(h["vector[3]"][b]);c.transpose();m[a]=c})}var n,q,p,r,s,u,v,w;if(d.cell){var x=d.cell;v=d.symmetry||{};n=parseFloat(x.length_a);q=parseFloat(x.length_b);p=parseFloat(x.length_c);r=parseFloat(x.angle_alpha);s=parseFloat(x.angle_beta);u=parseFloat(x.angle_gamma);v=v["space_group_name_H-M"];v[0]!==v[v.length-1]||"'"!==v[0]&&'"'!==v[0]||(v=
v.substring(1,v.length-1));parseInt(x.Z_PDB);x=new Float32Array(9);x[0]=n;x[4]=q;x[8]=p;c.boxes.push(x)}var t=new THREE.Matrix4;d.database_PDB_matrix&&(c=d.database_PDB_matrix,x=t.elements,x[0]=parseFloat(c["origx[1][1]"]),x[1]=parseFloat(c["origx[1][2]"]),x[2]=parseFloat(c["origx[1][3]"]),x[4]=parseFloat(c["origx[2][1]"]),x[5]=parseFloat(c["origx[2][2]"]),x[6]=parseFloat(c["origx[2][3]"]),x[8]=parseFloat(c["origx[3][1]"]),x[9]=parseFloat(c["origx[3][2]"]),x[10]=parseFloat(c["origx[3][3]"]),x[3]=
parseFloat(c["origx_vector[1]"]),x[7]=parseFloat(c["origx_vector[2]"]),x[11]=parseFloat(c["origx_vector[3]"]),t.transpose());t=new THREE.Matrix4;d.atom_sites&&(c=d.atom_sites,x=t.elements,x[0]=parseFloat(c["fract_transf_matrix[1][1]"]),x[1]=parseFloat(c["fract_transf_matrix[1][2]"]),x[2]=parseFloat(c["fract_transf_matrix[1][3]"]),x[4]=parseFloat(c["fract_transf_matrix[2][1]"]),x[5]=parseFloat(c["fract_transf_matrix[2][2]"]),x[6]=parseFloat(c["fract_transf_matrix[2][3]"]),x[8]=parseFloat(c["fract_transf_matrix[3][1]"]),
x[9]=parseFloat(c["fract_transf_matrix[3][2]"]),x[10]=parseFloat(c["fract_transf_matrix[3][3]"]),x[3]=parseFloat(c["fract_transf_vector[1]"]),x[7]=parseFloat(c["fract_transf_vector[2]"]),x[11]=parseFloat(c["fract_transf_vector[3]"]),t.transpose(),w=t);b.unitcell=void 0!==n?new NGL.Unitcell(n,q,p,r,s,u,v,w):void 0;if(d=d.struct_conn)for(a(d,"id"),w=/"/g,c=b.getAtomProxy(),n=b.getAtomProxy(),q={},p=0,u=d.id.length;p<u;++p)if(v=d.conn_type_id[p],"hydrog"!==v&&"mismat"!==v&&"saltbr"!==v&&"1_555"===d.ptnr1_symmetry[p]&&
"1_555"===d.ptnr2_symmetry[p]){v=d.ptnr1_auth_seq_id[p]+":"+e[d.ptnr1_label_asym_id[p]]+"."+d.ptnr1_label_atom_id[p].replace(w,"");r=q[v];if(!r){r=new NGL.Selection(v);if(r.selection.error){NGL.warn("invalid selection for connection",v);continue}r=b.getAtomIndices(r);q[v]=r}s=d.ptnr2_auth_seq_id[p]+":"+e[d.ptnr2_label_asym_id[p]]+"."+d.ptnr2_label_atom_id[p].replace(w,"");x=q[s];if(!x){x=new NGL.Selection(s);if(x.selection.error){NGL.warn("invalid selection for connection",s);continue}x=b.getAtomIndices(x);
q[s]=x}var t=r.length,z=x.length;if(t>z){var y=t,t=z,z=y,y=r;r=x;x=y}if(0===t||0===z)NGL.warn("no atoms found for",v,s);else for(v=0;v<z;++v)c.index=r[v%t],n.index=x[v],c&&n?b.bondStore.addBond(c,n):NGL.log("atoms for connection not found")}NGL.debug&&NGL.timeEnd("NGL.CifParser._postProcess")}});NGL.SdfParser=function(a,b){NGL.StructureParser.call(this,a,b)};
NGL.SdfParser.prototype=NGL.createObject(NGL.StructureParser.prototype,{constructor:NGL.SdfParser,type:"sdf",_parse:function(a){NGL.debug&&NGL.time("NGL.SdfParser._parse "+this.name);var b=this.structure,c=this.structureBuilder,d=this.firstModelOnly,e=this.asTrajectory,f=this.streamer.peekLines(2);b.id=f[0].trim();b.title=f[1].trim();var g=b.frames,h=!1,k,l,m=b.atomMap,n=b.atomStore;n.resize(Math.round(this.streamer.data.length/50));var q=b.getAtomProxy(),p=b.getAtomProxy(),r=0,s=0,u=0,v=0,w,x,t,
z,y,A;this.streamer.eachChunkOfLines(function(a,f,C){f=a.length;for(C=0;C<f;++C){var P=a[C];"$$$$"===P.substr(0,4)&&(s=-1,++u,v=n.count);3===s&&(w=parseInt(P.substr(0,3)),x=parseInt(P.substr(3,3)),t=4,y=z=t+w,A=y+x,e&&(l=0,k=new Float32Array(3*w),g.push(k),0<u&&(h=!0)));if(s>=t&&s<z){if(d&&0<u)continue;var M=parseFloat(P.substr(0,10)),W=parseFloat(P.substr(10,10)),K=parseFloat(P.substr(20,10));if(e){var aa=3*l;k[aa+0]=M;k[aa+1]=W;k[aa+2]=K;l+=1;if(h)continue}var aa=P.substr(31,3).trim(),I=aa+(r+1);
n.growIfFull();n.atomTypeId[r]=m.add(I,aa);n.x[r]=M;n.y[r]=W;n.z[r]=K;n.serial[r]=r;c.addAtom(u,"","HET",1,1);r+=1}if(s>=y&&s<A){if(d&&0<u)continue;if(e&&0<u)continue;q.index=parseInt(P.substr(0,3))-1+v;p.index=parseInt(P.substr(3,3))-1+v;P=parseInt(P.substr(6,3));b.bondStore.addBond(q,p,P)}++s}});c.finalize();b._dontAutoBond=!0;b.unitcell=void 0;NGL.debug&&NGL.timeEnd("NGL.SdfParser._parse "+this.name);a()}});NGL.Mol2Parser=function(a,b){NGL.StructureParser.call(this,a,b)};
NGL.Mol2Parser.prototype=NGL.createObject(NGL.StructureParser.prototype,{constructor:NGL.Mol2Parser,type:"mol2",_parse:function(a){NGL.debug&&NGL.time("NGL.Mol2Parser._parse "+this.name);var b=/\s+/,c=this.structure,d=this.structureBuilder,e=this.firstModelOnly,f=this.asTrajectory,g=c.frames,h=!1,k,l,m=c.atomMap,n=c.atomStore;n.resize(Math.round(this.streamer.data.length/60));var q=0,p=0,r=0,s=-1,u=0,v=0,w=c.getAtomProxy(),x=c.getAtomProxy(),t={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};this.streamer.eachChunkOfLines(function(a,
y,A){y=a.length;for(A=0;A<y;++A){var B=a[A].trim();if(""!==B&&"#"!==B[0])if("@"===B[0])"@<TRIPOS>MOLECULE"===B?(v=1,p=0,++s):"@<TRIPOS>ATOM"===B?(v=2,r=n.count,f&&(l=0,k=new Float32Array(3*u),g.push(k),0<s&&(h=!0))):v="@<TRIPOS>BOND"===B?3:0;else if(1===v){if(0===p)c.title=B,c.id=B;else if(1===p){var L=B.split(b);u=parseInt(L[0])}++p}else if(2===v){if(L=B.split(b),!(e&&0<s)){var B=parseFloat(L[2]),C=parseFloat(L[3]),P=parseFloat(L[4]);if(f){var M=3*l;k[M+0]=B;k[M+1]=C;k[M+2]=P;l+=1;if(h)continue}var M=
L[0],W=L[1],K=L[5].split(".")[0],aa=L[6]?parseInt(L[6]):1,I=L[7]?L[7]:"",L=L[8]?parseFloat(L[8]):0;n.growIfFull();n.atomTypeId[q]=m.add(W,K);n.x[q]=B;n.y[q]=C;n.z[q]=P;n.serial[q]=M;n.bfactor[q]=L;d.addAtom(s,"",I,aa,1);q+=1}}else 3!==v||e&&0<s||f&&0<s||(L=B.split(b),w.index=parseInt(L[1])-1+r,x.index=parseInt(L[2])-1+r,c.bondStore.addBond(w,x,t[L[3]]))}});d.finalize();c._dontAutoBond=!0;c.unitcell=void 0;NGL.debug&&NGL.timeEnd("NGL.Mol2Parser._parse "+this.name);a()}});
NGL.MmtfParser=function(a,b){NGL.StructureParser.call(this,a,b);this.dontAutoBond=!0;this.doAutoSS=this.autoBondBetween=!1};
NGL.MmtfParser.prototype=NGL.createObject(NGL.StructureParser.prototype,{constructor:NGL.MmtfParser,type:"mmtf",_parse:function(a){NGL.debug&&NGL.time("NGL.MmtfParser._parse "+this.name);var b=this.structure,c=decodeMmtf(this.streamer.data);void 0===c.numBonds&&(c.numBonds=0);b.bondStore.length=c.bondStore.bondOrder.length;b.bondStore.count=c.numBonds;b.bondStore.atomIndex1=c.bondStore.atomIndex1;b.bondStore.atomIndex2=c.bondStore.atomIndex2;b.bondStore.bondOrder=c.bondStore.bondOrder;b.atomStore.length=
c.numAtoms;b.atomStore.count=c.numAtoms;b.atomStore.residueIndex=c.atomStore.groupIndex;b.atomStore.atomTypeId=new Uint16Array(c.numAtoms);b.atomStore.x=c.atomStore.xCoord;b.atomStore.y=c.atomStore.yCoord;b.atomStore.z=c.atomStore.zCoord;b.atomStore.serial=c.atomStore.atomId;b.atomStore.bfactor=c.atomStore.bFactor;b.atomStore.altloc=c.atomStore.altLabel;b.residueStore.length=c.numGroups;b.residueStore.count=c.numGroups;b.residueStore.chainIndex=c.groupStore.chainIndex;b.residueStore.residueTypeId=
c.groupStore.groupTypeId;b.residueStore.atomOffset=c.groupStore.atomOffset;b.residueStore.atomCount=c.groupStore.atomCount;b.residueStore.resno=c.groupStore.groupId;b.residueStore.sstruc=c.groupStore.secStruct;b.chainStore.length=c.numChains;b.chainStore.count=c.numChains;b.chainStore.modelIndex=c.chainStore.modelIndex;b.chainStore.residueOffset=c.chainStore.groupOffset;b.chainStore.residueCount=c.chainStore.groupCount;b.chainStore.chainname=c.chainStore.chainName;b.modelStore.length=c.numModels;
b.modelStore.count=c.numModels;b.modelStore.chainOffset=c.modelStore.chainOffset;b.modelStore.chainCount=c.modelStore.chainCount;NGL.debug&&console.time("process map data");for(var d={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":"".charCodeAt(0)},e=Object.keys(c.groupMap).map(function(a){return parseInt(a)}).sort(function(a,b){return a-b}),f=0,g=e.length;f<g;++f){for(var h=c.groupMap[e[f]],k=[],l=0,m=h.atomInfo.length;l<m;l+=2){var n=h.atomInfo[l].toUpperCase();k.push(b.atomMap.add(h.atomInfo[l+
1],n))}b.residueMap.add(h.groupName,k,h.hetFlag)}f=0;for(g=b.atomStore.count;f<g;++f)e=b.atomStore.residueIndex[f],b.atomStore.atomTypeId[f]=b.residueMap.list[b.residueStore.residueTypeId[e]].atomTypeIdList[f-b.residueStore.atomOffset[e]];NGL.debug&&console.timeEnd("process map data");f=0;for(g=b.residueStore.count;f<g;++f)e=d[b.residueStore.sstruc[f]],void 0!==e&&(b.residueStore.sstruc[f]=e);if(c.bioAssembly)for(var q in c.bioAssembly){var f={},d=c.bioAssembly[q],p;for(p in d.transforms)g=d.transforms[p],
(e=f[g.transformation])?e.chainList=e.chainList.concat(g.chainId):(e={matrix:(new THREE.Matrix4).fromArray(g.transformation).transpose(),chainList:g.chainId},f[g.transformation]=e);var g={},r;for(r in f)h=f[r],(e=g[h.chainList])?e.push(h.matrix):(e=[h.matrix],g[h.chainList]=e);if(0<Object.keys(g).length){f=new NGL.Assembly(d.id);b.biomolDict["BU"+d.id]=f;for(var s in g)e=g[s],d=s.split(","),f.addPart(e,d)}}c.unitCell&&Array.isArray(c.unitCell)&&c.unitCell[0]?b.unitcell=new NGL.Unitcell(c.unitCell[0],
c.unitCell[1],c.unitCell[2],c.unitCell[3],c.unitCell[4],c.unitCell[5],c.spaceGroup):b.unitcell=void 0;NGL.debug&&NGL.timeEnd("NGL.MmtfParser._parse "+this.name);NGL.calculateBondsBetween(b,!0);NGL.calculateBondsWithin(b,!0);a()}});NGL.TrajectoryParser=function(a,b){NGL.Parser.call(this,a,b||{});this.frames=new NGL.Frames(this.name,this.path)};NGL.TrajectoryParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.TrajectoryParser,type:"trajectory",__objName:"frames"});
NGL.DcdParser=function(a,b){NGL.TrajectoryParser.call(this,a,b||{})};
NGL.DcdParser.prototype=NGL.createObject(NGL.TrajectoryParser.prototype,{constructor:NGL.DcdParser,type:"dcd",_parse:function(a){NGL.debug&&NGL.time("NGL.DcdParser._parse "+this.name);var b=this.streamer.data;b instanceof Uint8Array&&(b=b.buffer);var c=new DataView(b),d=this.frames,e=d.coordinates,d=d.boxes,f,g,h,k=0;h=new Int32Array(b,0,23);var l=h[0]!==c.getInt32(0);if(84!==h[0])for(f=b.byteLength,g=0;g<f;g+=4)c.setFloat32(g,c.getFloat32(g),!0);84!==h[0]&&NGL.error("dcd bad format, header block start");
"CORD"!==String.fromCharCode(c.getUint8(4),c.getUint8(5),c.getUint8(6),c.getUint8(7))&&NGL.error("dcd bad format, format string");var m=!1,n=!1,q=!1;0!==h[22]&&(m=!0,0!==h[12]&&(n=!0),1===h[13]&&(q=!0));f=h[2];g=h[10];m?c.getFloat32(44,l):c.getFloat64(44,l);84!==h[22]&&NGL.error("dcd bad format, header block end");k=k+84+8;h=c.getInt32(k,l);m=k+1;0!==(h-4)%80&&NGL.error("dcd bad format, title block start");NGL.Uint8ToString(new Uint8Array(b,m,h));c.getInt32(m+h+4-1,l)!==h&&NGL.error("dcd bad format, title block end");
k=k+h+8;4!==c.getInt32(k,l)&&NGL.error("dcd bad format, natom block start");h=c.getInt32(k+4,l);4!==c.getInt32(k+8,l)&&NGL.error("dcd bad format, natom block end");k=k+4+8;if(0<g)NGL.error("dcd format with fixed atoms unsupported, aborting");else{m=4*h;for(g=0;g<f;++g){if(n){var k=k+4,p=new Float32Array(9);p[0]=c.getFloat64(k,l);p[4]=c.getFloat64(k+16,l);p[8]=c.getFloat64(k+40,l);d.push(p);k+=48;k+=4}for(var p=new Float32Array(3*h),r=0;3>r;++r){c.getInt32(k,l)!==m&&NGL.error("dcd bad format, coord block start",
g,r);for(var k=k+4,s=new Float32Array(b,k,h),u=0;u<h;++u)p[3*u+r]=s[u];k+=m;c.getInt32(k,l)!==m&&NGL.error("dcd bad format, coord block end",g,r);k+=4}e.push(p);q&&(p=c.getInt32(k,l),k+=4+p+4)}NGL.debug&&NGL.timeEnd("NGL.DcdParser._parse "+this.name)}a()}});NGL.VolumeParser=function(a,b){NGL.Parser.call(this,a,b||{});this.volume=new NGL.Volume(this.name,this.path)};
NGL.VolumeParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.VolumeParser,type:"volume",__objName:"volume",_afterParse:function(){this.volume.setMatrix(this.getMatrix())},getMatrix:function(){return new THREE.Matrix4}});NGL.MrcParser=function(a,b){NGL.VolumeParser.call(this,a,b)};
NGL.MrcParser.prototype=NGL.createObject(NGL.VolumeParser.prototype,{constructor:NGL.MrcParser,type:"mrc",_parse:function(a){NGL.debug&&NGL.time("NGL.MrcParser._parse "+this.name);var b=this.streamer.data;b instanceof Uint8Array&&(b=b.buffer);var c=this.volume,d={},e=new Int32Array(b,0,56),f=new Float32Array(b,0,56),g=new DataView(b);d.MAP=String.fromCharCode(g.getUint8(208),g.getUint8(209),g.getUint8(210),g.getUint8(211));d.MACHST=[g.getUint8(212),g.getUint8(213)];if(17===d.MACHST[0]&&17===d.MACHST[1])for(var h=
b.byteLength,k=0;k<h;k+=4)g.setFloat32(k,g.getFloat32(k),!0);d.NX=e[0];d.NY=e[1];d.NZ=e[2];d.MODE=e[3];d.NXSTART=e[4];d.NYSTART=e[5];d.NZSTART=e[6];d.MX=e[7];d.MY=e[8];d.MZ=e[9];d.xlen=f[10];d.ylen=f[11];d.zlen=f[12];d.alpha=f[13];d.beta=f[14];d.gamma=f[15];d.MAPC=e[16];d.MAPR=e[17];d.MAPS=e[18];d.DMIN=f[19];d.DMAX=f[20];d.DMEAN=f[21];d.ISPG=e[22];d.NSYMBT=e[23];d.LSKFLG=e[24];d.originX=f[49];d.originY=f[50];d.originZ=f[51];d.ARMS=f[54];c.header=d;b=new Float32Array(b,1024+d.NSYMBT,d.NX*d.NY*d.NZ);
c.setData(b,d.NX,d.NY,d.NZ);NGL.debug&&NGL.timeEnd("NGL.MrcParser._parse "+this.name);a()},getMatrix:function(){var a=this.volume.header,b=[a.xlen,0,0],c=[a.ylen*Math.cos(Math.PI/180*a.gamma),a.ylen*Math.sin(Math.PI/180*a.gamma),0],d=[a.zlen*Math.cos(Math.PI/180*a.beta),a.zlen*(Math.cos(Math.PI/180*a.alpha)-Math.cos(Math.PI/180*a.gamma)*Math.cos(Math.PI/180*a.beta))/Math.sin(Math.PI/180*a.gamma),0];d[2]=Math.sqrt(a.zlen*a.zlen*Math.sin(Math.PI/180*a.beta)*Math.sin(Math.PI/180*a.beta)-d[1]*d[1]);var b=
[0,b,c,d],c=[0,a.MX,a.MY,a.MZ],d=[0,a.MAPC,a.MAPR,a.MAPS],e=new THREE.Matrix4;e.set(b[d[1]][0]/c[d[1]],b[d[2]][0]/c[d[2]],b[d[3]][0]/c[d[3]],0,b[d[1]][1]/c[d[1]],b[d[2]][1]/c[d[2]],b[d[3]][1]/c[d[3]],0,b[d[1]][2]/c[d[1]],b[d[2]][2]/c[d[2]],b[d[3]][2]/c[d[3]],0,0,0,0,1);e.multiply((new THREE.Matrix4).makeTranslation(a.NXSTART+a.originX,a.NYSTART+a.originY,a.NZSTART+a.originZ));return e}});NGL.CubeParser=function(a,b){NGL.VolumeParser.call(this,a,b)};
NGL.CubeParser.prototype=NGL.createObject(NGL.VolumeParser.prototype,{constructor:NGL.CubeParser,type:"cube",_parse:function(a){function b(a,b){var c=d[a].trim().split(f)[b];return parseFloat(c)}NGL.debug&&NGL.time("NGL.CubeParser._parse "+this.name);var c=this.volume,d=this.streamer.peekLines(6),e={},f=/\s+/;e.atomCount=Math.abs(b(2,0));e.originX=.529177210859*b(2,1);e.originY=.529177210859*b(2,2);e.originZ=.529177210859*b(2,3);e.NVX=b(3,0);e.NVY=b(4,0);e.NVZ=b(5,0);e.AVX=.529177210859*b(3,1);e.AVY=
.529177210859*b(4,2);e.AVZ=.529177210859*b(5,3);var g=new Float32Array(e.NVX*e.NVY*e.NVZ),h=0,k=0;this.streamer.eachChunkOfLines(function(a,b,c){b=a.length;for(c=0;c<b;++c){var d=a[c].trim();if(""!==d&&k>=e.atomCount+6)for(var d=d.split(f),p=0,r=d.length;p<r;++p)1!==d.length&&(g[h]=parseFloat(d[p]),++h);++k}});c.header=e;c.setData(g,e.NVZ,e.NVY,e.NVX);NGL.debug&&NGL.timeEnd("NGL.CubeParser._parse "+this.name);a()},getMatrix:function(){var a=this.volume.header,b=new THREE.Matrix4;b.multiply((new THREE.Matrix4).makeRotationY(THREE.Math.degToRad(90)));
b.multiply((new THREE.Matrix4).makeTranslation(-a.originZ,a.originY,a.originX));b.multiply((new THREE.Matrix4).makeScale(-a.AVZ,a.AVY,a.AVX));return b}});NGL.DxParser=function(a,b){NGL.VolumeParser.call(this,a,b)};
NGL.DxParser.prototype=NGL.createObject(NGL.VolumeParser.prototype,{constructor:NGL.DxParser,type:"dx",_parse:function(a){NGL.debug&&NGL.time("NGL.DxParser._parse "+this.name);var b=this.volume,c=this.streamer.peekLines(30),c=this.parseHeaderLines(c),d=this.volume.header,e=c.dataLineStart,f=/\s+/,g=d.nx*d.ny*d.nz,h=new Float32Array(g),k=0,l=0;this.streamer.eachChunkOfLines(function(a,b,c){b=a.length;for(c=0;c<b;++c){if(k<g&&l>e){var d=a[c].trim();if(""!==d)for(var d=d.split(f),r=0,s=d.length;r<s;++r)h[k]=
parseFloat(d[r]),++k}++l}});b.setData(h,d.nz,d.ny,d.nx);NGL.debug&&NGL.timeEnd("NGL.DxParser._parse "+this.name);a()},parseHeaderLines:function(a){for(var b={},c=/\s+/,d=a.length,e=0,f=0,g=0,h=0;h<d;++h){var k=a[h];if(k.startsWith("object 1")){var l=k.split(c);b.nx=parseInt(l[5]);b.ny=parseInt(l[6]);b.nz=parseInt(l[7])}else if(k.startsWith("origin"))l=k.split(c),b.xmin=parseFloat(l[1]),b.ymin=parseFloat(l[2]),b.zmin=parseFloat(l[3]);else if(k.startsWith("delta"))l=k.split(c),0===g?b.hx=parseFloat(l[1]):
1===g?b.hy=parseFloat(l[2]):2===g&&(b.hz=parseFloat(l[3])),g+=1;else if(k.startsWith("object 3")){e=h;f+=k.length+1;break}f+=k.length+1}this.volume.header=b;return{dataLineStart:e,headerByteCount:f}},getMatrix:function(){var a=this.volume.header,b=new THREE.Matrix4;b.multiply((new THREE.Matrix4).makeRotationY(THREE.Math.degToRad(90)));b.multiply((new THREE.Matrix4).makeTranslation(-a.zmin,a.ymin,a.xmin));b.multiply((new THREE.Matrix4).makeScale(-a.hz,a.hy,a.hx));return b}});
NGL.DxbinParser=function(a,b){NGL.DxParser.call(this,a,b)};
NGL.DxbinParser.prototype=NGL.createObject(NGL.DxParser.prototype,{constructor:NGL.DxbinParser,type:"dxbin",_parse:function(a){NGL.debug&&NGL.time("NGL.DxbinParser._parse "+this.name);var b=this.streamer.data;b instanceof Uint8Array&&(b=b.buffer);for(var c=NGL.Uint8ToLines(new Uint8Array(b,0,1E3)),d=this.parseHeaderLines(c),c=this.volume.header,d=d.headerByteCount,e=c.nx*c.ny*c.nz,b=new DataView(b),f=new Float32Array(e),g=0;g<e;++g)f[g]=b.getFloat64(8*g+d,!0);this.volume.setData(f,c.nz,c.ny,c.nx);
NGL.debug&&NGL.timeEnd("NGL.DxbinParser._parse "+this.name);a()}});NGL.SurfaceParser=function(a,b){NGL.Parser.call(this,a,b||{});this.loader=void 0;this.surface=new NGL.Surface(this.name,this.path)};NGL.SurfaceParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.SurfaceParser,type:"surface",__objName:"surface",_parse:function(a){var b=NGL.Uint8ToString(this.streamer.data),b=this.loader.parse(b);this.surface.fromGeometry(b);a()}});
NGL.PlyParser=function(a,b){NGL.SurfaceParser.call(this,a,b||{});this.loader=new THREE.PLYLoader};NGL.PlyParser.prototype=NGL.createObject(NGL.SurfaceParser.prototype,{constructor:NGL.PlyParser,type:"ply"});NGL.ObjParser=function(a,b){NGL.SurfaceParser.call(this,a,b||{});this.loader=new THREE.OBJLoader};NGL.ObjParser.prototype=NGL.createObject(NGL.SurfaceParser.prototype,{constructor:NGL.ObjParser,type:"obj"});
NGL.TextParser=function(a,b){NGL.Parser.call(this,a,b||{});this.text={name:this.name,path:this.path,data:""}};NGL.TextParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.TextParser,type:"text",__objName:"text",_parse:function(a){this.text.data=this.streamer.asText();a()}});NGL.CsvParser=function(a,b){NGL.Parser.call(this,a,b||{});this.table={name:this.name,path:this.path,colNames:[],data:[]}};
NGL.CsvParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.CsvParser,type:"csv",__objName:"table",_parse:function(a){var b=this.table.data,c=/\s*,\s*/;this.streamer.eachChunkOfLines(function(a,e,f){f=a.length;for(var g=0;g<f;++g){var h=a[g].trim(),k=h.split(c);0===e&&0===g?this.table.colNames=k:h&&b.push(k)}}.bind(this));a()}});NGL.JsonParser=function(a,b){NGL.Parser.call(this,a,b||{});this.json={name:this.name,path:this.path,data:{}}};
NGL.JsonParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.JsonParser,type:"json",__objName:"json",_parse:function(a){this.json.data=JSON.parse(this.streamer.asText());a()}});NGL.XmlParser=function(a,b){NGL.Parser.call(this,a,b||{});this.xml={name:this.name,path:this.path,data:{}}};
NGL.XmlParser.prototype=NGL.createObject(NGL.Parser.prototype,{constructor:NGL.XmlParser,type:"xml",__objName:"xml",_parse:function(a){this.xml.data=function(a){function c(){var f=e(/^<([\w-:.]+)\s*/);if(f){for(f={name:f[1],attributes:{},children:[]};0!=a.length&&0!=a.indexOf(">")&&0!=a.indexOf("?>")&&0!=a.indexOf("/>");){var g=d();if(!g)return f;f.attributes[g.name]=g.value}if(e(/^\s*\/>\s*/))return f;e(/\??>\s*/);g=(g=e(/^([^<]*)/))?g[1]:"";for(f.content=g;g=c();)f.children.push(g);e(/^<\/[\w-:.]+>\s*/);
return f}}function d(){var a=e(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);if(a)return{name:a[1],value:a[2].replace(/^['"]|['"]$/g,"")}}function e(c){if(c=a.match(c))return a=a.slice(c[0].length),c}a=a.trim();a=a.replace(/\x3c!--[\s\S]*?--\x3e/g,"");return{declaration:function(){if(e(/^<\?xml\s*/)){for(var c={attributes:{}};0!=a.length&&0!=a.indexOf("?>");){var g=d();if(!g)return c;c.attributes[g.name]=g.value}e(/\?>\s*/);return c}}(),root:c()}}(this.streamer.asText());a()}});
NGL.PdbWriter=function(a,b){function c(a,b){return void 0!==a?a:b}function d(){l.forEach(function(a){m.push(sprintf("REMARK %-73s",a))});a.trajectory&&(m.push(sprintf("REMARK %-73s","Trajectory '"+a.trajectory.name+"'")),m.push(sprintf("REMARK %-73s","Frame "+a.trajectory.frame+"")))}function e(){var b=1,d=1;a.eachModel(function(a){m.push(sprintf("MODEL %-74d",d++));a.eachAtom(function(a){var d=a.hetero?q:n,e=k?b:a.serial,f=a.atomname;1===f.length&&(f=" "+f);m.push(sprintf(d,e,f,a.resname,c(a.chainname,
" "),a.resno,a.x,a.y,a.z,c(a.occurence,1),c(a.bfactor,0),c(a.segid,""),c(a.element,"")));b+=1});m.push(sprintf("%-80s","ENDMDL"));d+=1});m.push(sprintf("%-80s","END"))}function f(){m=[];m.push(sprintf("TITEL %-74s",a.name));d();e();return m.join("\n")}function g(){return new Blob([f()],{type:"text/plain"})}var h=Object.assign({},b),k=void 0!==h.renumberSerial?h.renumberSerial:!0,l=h.remarks||[];Array.isArray(l)||(l=[l]);var m,n="ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s",
q="HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s";this.getString=f;this.getBlob=g;this.download=function(a,b){var c=(a||"structure")+"."+(b||"pdb"),d=g();NGL.download(d,c)}};
NGL.DatasourceRegistry={sourceDict:{},listing:void 0,trajectory:void 0,__passThrough:{getUrl:function(a){return a}},add:function(a,b){a=a.toLowerCase();a in this.sourceDict&&NGL.warn("overwriting datasource named '"+a+"'");this.sourceDict[a]=b},get:function(a){a=(a||"").toLowerCase();if(a in this.sourceDict)return this.sourceDict[a];if(-1===["http","https","ftp"].indexOf(a)&&a)NGL.error("no datasource named '"+a+"' found");else return this.__passThrough}};
NGL.getDataInfo=function(a){var b=NGL.getFileInfo(a),c=NGL.DatasourceRegistry.get(b.protocol),b=c.getUrl(b.src),b=NGL.getFileInfo(b);!b.ext&&c.getExt&&(b.ext=c.getExt(a));return b};NGL.StaticDatasource=function(a){a=a||"";this.getUrl=function(b){b=NGL.getFileInfo(b);return NGL.getAbsolutePath(a+b.path)}};
NGL.RcsbDatasource=function(){this.getUrl=function(a){a=NGL.getFileInfo(a);return-1===["pdb","cif"].indexOf(a.ext)||!1!==a.compressed&&"gz"!==a.compressed?"mmtf"===a.ext?a.base.endsWith(".bb")?"http://mmtf.rcsb.org/backbone/"+a.name:"http://mmtf.rcsb.org/full/"+a.name:a.ext?(console.warn("unsupported ext",a.ext),"http://mmtf.rcsb.org/full/"+a.name):"http://mmtf.rcsb.org/full/"+a.name+".mmtf":"http://www.rcsb.org/pdb/files/"+a.path};this.getExt=function(a){a=NGL.getFileInfo(a);if("mmtf"===a.ext||!a.ext)return"mmtf"}};
NGL.DatasourceRegistry.add("rcsb",new NGL.RcsbDatasource);
NGL.Loader=function(a,b){var c=Object.assign({},b),d=-1!=="mmtf dcd mrc ccp4 map dxbin".split(" ").indexOf(c.ext);this.compressed=c.compressed||!1;this.binary=void 0!==c.binary?c.binary:d;this.name=c.name||"";this.ext=c.ext||"";this.dir=c.dir||"";this.path=c.path||"";this.protocol=c.protocol||"";this.params=b;d={compressed:this.compressed,binary:this.binary};this.streamer=a instanceof File||a instanceof Blob?new NGL.FileStreamer(a,d):new NGL.NetworkStreamer(a,d);"function"===typeof c.onProgress&&
(this.streamer.onprogress=c.onprogress)};NGL.Loader.prototype={constructor:NGL.Loader,load:function(){return new Promise(function(a,b){this.streamer.onerror=b;try{this._load(a,b)}catch(c){b(c)}}.bind(this))},_load:function(a,b){b("not implemented")}};NGL.ParserLoader=function(a,b){NGL.Loader.call(this,a,b);this.noWorker=this.params.noWorker||!1};
NGL.ParserLoader.prototype=NGL.createObject(NGL.Loader.prototype,{constructor:NGL.ParserLoader,_load:function(a,b){var c=new {gro:NGL.GroParser,pdb:NGL.PdbParser,pdb1:NGL.PdbParser,ent:NGL.PdbParser,pqr:NGL.PqrParser,cif:NGL.CifParser,mcif:NGL.CifParser,mmcif:NGL.CifParser,sdf:NGL.SdfParser,mol2:NGL.Mol2Parser,mmtf:NGL.MmtfParser,dcd:NGL.DcdParser,mrc:NGL.MrcParser,ccp4:NGL.MrcParser,map:NGL.MrcParser,cube:NGL.CubeParser,dx:NGL.DxParser,dxbin:NGL.DxbinParser,ply:NGL.PlyParser,obj:NGL.ObjParser,txt:NGL.TextParser,
text:NGL.TextParser,csv:NGL.CsvParser,json:NGL.JsonParser,xml:NGL.XmlParser}[this.ext](this.streamer,this.params);this.noWorker?c.parse(a):c.parseWorker(a)}});NGL.ScriptLoader=function(a,b){NGL.Loader.call(this,a,b)};NGL.ScriptLoader.prototype=NGL.createObject(NGL.Loader.prototype,{constructor:NGL.ScriptLoader,_load:function(a,b){this.streamer.read(function(){var b=this.streamer.asText(),b=new NGL.Script(b,this.name,this.path);a(b)}.bind(this))}});
NGL.PluginLoader=function(a,b){NGL.Loader.call(this,a,b)};
NGL.PluginLoader.prototype=NGL.createObject(NGL.Loader.prototype,{constructor:NGL.PluginLoader,_load:function(a,b){var c;c=this.protocol?this.protocol+"://"+this.dir:this.dir;this.streamer.read(function(){var b=JSON.parse(this.streamer.asText()),e=[];b.files.map(function(a){e.push(NGL.autoLoad(c+a,{ext:"text",noWorker:!0}))});Promise.all(e).then(function(c){c=c.reduce(function(a,b){return a+"\n\n"+b.data},"");c+=b.source||"";c=new NGL.Script(c,this.name,this.path);a(c)}.bind(this))}.bind(this))}});
NGL.loaderMap={gro:NGL.ParserLoader,pdb:NGL.ParserLoader,pdb1:NGL.ParserLoader,ent:NGL.ParserLoader,pqr:NGL.ParserLoader,cif:NGL.ParserLoader,mcif:NGL.ParserLoader,mmcif:NGL.ParserLoader,sdf:NGL.ParserLoader,mol2:NGL.ParserLoader,mmtf:NGL.ParserLoader,dcd:NGL.ParserLoader,mrc:NGL.ParserLoader,ccp4:NGL.ParserLoader,map:NGL.ParserLoader,cube:NGL.ParserLoader,dx:NGL.ParserLoader,dxbin:NGL.ParserLoader,obj:NGL.ParserLoader,ply:NGL.ParserLoader,txt:NGL.ParserLoader,text:NGL.ParserLoader,csv:NGL.ParserLoader,
json:NGL.ParserLoader,xml:NGL.ParserLoader,ngl:NGL.ScriptLoader,plugin:NGL.PluginLoader};NGL.autoLoad=function(a,b){var c=Object.assign(NGL.getDataInfo(a),b),d=new NGL.loaderMap[c.ext](c.src,c);return d?d.load():Promise.reject("NGL.autoLoading: ext '"+c.ext+"' unknown")};
NGL.Resources={"shader/CylinderImpostor.vert":null,"shader/CylinderImpostor.frag":null,"shader/HyperballStickImpostor.vert":null,"shader/HyperballStickImpostor.frag":null,"shader/Line.vert":null,"shader/Line.frag":null,"shader/Mesh.vert":null,"shader/Mesh.frag":null,"shader/Point.vert":null,"shader/Point.frag":null,"shader/Quad.vert":null,"shader/Quad.frag":null,"shader/Ribbon.vert":null,"shader/SDFFont.vert":null,"shader/SDFFont.frag":null,"shader/SphereImpostor.vert":null,"shader/SphereImpostor.frag":null,
"shader/chunk/dull_interior_fragment.glsl":null,"shader/chunk/fog_fragment.glsl":null,"shader/chunk/nearclip_fragment.glsl":null,"shader/chunk/nearclip_vertex.glsl":null,"shader/chunk/opaque_back_fragment.glsl":null};
NGL.Utils={lineLineIntersect:function(a,b,c,d){var e=NGL.EPS,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,k,l;f.x=a.x-c.x;f.y=a.y-c.y;f.z=a.z-c.z;g.x=d.x-c.x;g.y=d.y-c.y;g.z=d.z-c.z;if(Math.abs(g.x)<e&&Math.abs(g.y)<e&&Math.abs(g.z)<e)return null;h.x=b.x-a.x;h.y=b.y-a.y;h.z=b.z-a.z;if(Math.abs(h.x)<e&&Math.abs(h.y)<e&&Math.abs(h.z)<e)return null;b=f.x*g.x+f.y*g.y+f.z*g.z;d=g.x*h.x+g.y*h.y+g.z*h.z;k=f.x*h.x+f.y*h.y+f.z*h.z;f=g.x*g.x+g.y*g.y+g.z*g.z;l=(h.x*h.x+h.y*h.y+h.z*h.z)*f-d*d;
if(Math.abs(l)<e)return null;e=(b*d-k*f)/l;b=(b+d*e)/f;a=new THREE.Vector3(a.x+e*h.x,a.y+e*h.y,a.z+e*h.z);c=new THREE.Vector3(c.x+b*g.x,c.y+b*g.y,c.z+b*g.z);return[a,c]},circularMean:function(){var a=2*Math.PI;return function(b,c,d,e,f){d=d||1;e=e||0;var g=f?f.length:b.length,h,k,l=0,m=0;if(f)for(k=0;k<g;++k)h=(b[f[k]*d+e]+c)%c,h=h/c*a-Math.PI,l+=Math.cos(h),m+=Math.sin(h);else for(k=e;k<g;k+=d)h=(b[k]+c)%c,h=h/c*a-Math.PI,l+=Math.cos(h),m+=Math.sin(h);return(Math.atan2(m/g,l/g)+Math.PI)/a*c}}(),
calculateCenterArray:function(a,b,c,d){var e=a.length;c=c||new Float32Array(e);d=d||0;for(var f=0;f<e;f+=3)c[d+f+0]=(a[f+0]+b[f+0])/2,c[d+f+1]=(a[f+1]+b[f+1])/2,c[d+f+2]=(a[f+2]+b[f+2])/2;return c},calculateDirectionArray:function(a,b){for(var c=a.length,d=new Float32Array(c),e=0;e<c;e+=3)d[e+0]=b[e+0]-a[e+0],d[e+1]=b[e+1]-a[e+1],d[e+2]=b[e+2]-a[e+2];return d},positionFromGeometry:function(a){a=a.vertices;for(var b,c,d=a.length,e=new Float32Array(3*d),f=0;f<d;f++)b=3*f,c=a[f],e[b+0]=c.x,e[b+1]=c.y,
e[b+2]=c.z;return e},colorFromGeometry:function(a){for(var b=a.faces,c,d,e=b.length,f=new Float32Array(3*a.vertices.length),g=0;g<e;g++)c=b[g],d=c.color,a=3*c.a,f[a+0]=d.r,f[a+1]=d.g,f[a+2]=d.b,a=3*c.b,f[a+0]=d.r,f[a+1]=d.g,f[a+2]=d.b,a=3*c.c,f[a+0]=d.r,f[a+1]=d.g,f[a+2]=d.b;return f},indexFromGeometry:function(a){a=a.faces;for(var b,c,d=a.length,e=new (65535<3*d?Uint32Array:Uint16Array)(3*d),f=0;f<d;f++)b=3*f,c=a[f],e[b+0]=c.a,e[b+1]=c.b,e[b+2]=c.c;return e},normalFromGeometry:function(a){for(var b=
a.faces,c,d,e,f,g=b.length,h=new Float32Array(3*a.vertices.length),k=0;k<g;k++)a=b[k],c=a.vertexNormals,d=c[0],e=c[1],f=c[2],c=3*a.a,h[c+0]=d.x,h[c+1]=d.y,h[c+2]=d.z,c=3*a.b,h[c+0]=e.x,h[c+1]=e.y,h[c+2]=e.z,c=3*a.c,h[c+0]=f.x,h[c+1]=f.y,h[c+2]=f.z;return h},uniformArray:function(a,b){for(var c=new Float32Array(a),d=0;d<a;++d)c[d]=b;return c},uniformArray3:function(a,b,c,d){for(var e=new Float32Array(3*a),f,g=0;g<a;++g)f=3*g,e[f+0]=b,e[f+1]=c,e[f+2]=d;return e},randomColorArray:function(a){for(var b=
new Float32Array(3*a),c,d=0;d<a;++d)c=3*d,b[c+0]=Math.random(),b[c+1]=Math.random(),b[c+2]=Math.random();return b},replicateArray3Entries:function(a,b){for(var c=a.length/3,d=new Float32Array(c*b*3),e=0;e<c;++e)for(var f=3*e,g=e*b*3,h=a[f+0],k=a[f+1],f=a[f+2],l=0;l<b;++l){var m=g+3*l;d[m+0]=h;d[m+1]=k;d[m+2]=f}return d},calculateMeanArray:function(a,b){for(var c=a.length,d=new Float32Array(c),e=0;e<c;e++)d[e]=(a[e]+b[e])/2;return d},calculateMinArray:function(a,b){for(var c=a.length,d=new Float32Array(c),
e=0;e<c;e++)d[e]=Math.min(a[e],b[e]);return d},calculateMeanVector3:function(a){var b=a.length,c=a.length/3,d=0,e=0,f=0,g;for(g=0;g<b;g+=3)d+=a[g+0],e+=a[g+1],f+=a[g+2];return new THREE.Vector3(d/c,e/c,f/c)},isPointOnSegment:function(a,b,c){var d=b.distanceTo(c);return a.distanceTo(b)<=d&&a.distanceTo(c)<=d},pointVectorIntersection:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){a.copy(e);b.subVectors(c,d);c=Math.cos(a.angleTo(b))*b.length();c=a.normalize().multiplyScalar(c);
return(new THREE.Vector3).addVectors(c,d)}}(),copyArray:function(a,b,c,d,e){var f;for(f=0;f<e;++f)b[d+f]=a[c+f]}};
NGL.getShader=function(){function a(a){if(void 0===a)return"";var b=[],c;for(c in a){var g=a[c];!1!==g&&b.push("#define "+c+" "+g)}return b.join("\n")+"\n"}var b=/^(?!\/\/)\s*#include\s+(\S+)/gmi,c={};return function(d,e){e=e||{};var f=d+"|",g;for(g in e)f+=g+":"+e[g];if(!c[f]){g=a(e);var h=NGL.Resources["shader/"+d];if(!h)throw"empty shader, '"+d+"'";h=h.replace(b,function(a,b){var c=NGL.Resources["shader/chunk/"+b+".glsl"]||THREE.ShaderChunk[b];return c?c:""});c[f]=g+h}return c[f]}}();
NGL.trimCanvas=function(a,b,c,d,e){var f=a.height,g=a.width,h=a.getContext("2d").getImageData(0,0,g,f).data,k,l,m;m=!1;for(l=0;l<f;l++){for(k=0;k<g;k++){var n=4*(l*g+k);if(h[n]!==b||h[n+1]!==c||h[n+2]!==d||h[n+3]!==e){m=!0;break}}if(m)break}var q=l;m=!1;for(k=0;k<g;k++){for(l=0;l<f;l++)if(n=4*(l*g+k),h[n]!==b||h[n+1]!==c||h[n+2]!==d||h[n+3]!==e){m=!0;break}if(m)break}var p=k;m=!1;for(l=f-1;0<=l;l--){for(k=g-1;0<=k;k--)if(n=4*(l*g+k),h[n]!==b||h[n+1]!==c||h[n+2]!==d||h[n+3]!==e){m=!0;break}if(m)break}var r=
l;m=!1;for(k=g-1;0<=k;k--){for(l=f-1;0<=l;l--)if(n=4*(l*g+k),h[n]!==b||h[n+1]!==c||h[n+2]!==d||h[n+3]!==e){m=!0;break}if(m)break}b=k;c=document.createElement("canvas");c.style.display="hidden";document.body.appendChild(c);c.width=b-p;c.height=r-q;c.getContext("2d").drawImage(a,p,q,c.width,c.height,0,0,c.width,c.height);return c};
NGL.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];
NGL.JitterVectors.forEach(function(a){a.forEach(function(a){a[0]*=.0625;a[1]*=.0625})});NGL.Stats=function(){this.signals={updated:new signals.Signal};this.begin();this.maxDuration=-Infinity;this.minDuration=Infinity;this.avgDuration=14;this.lastDuration=Infinity;this.prevFpsTime=0;this.lastFps=Infinity;this.lastFrames=1;this.count=this.frames=0};
NGL.Stats.prototype={update:function(){this.startTime=this.end();this.signals.updated.dispatch()},begin:function(){this.startTime=performance.now();this.lastFrames=this.frames},end:function(){var a=performance.now();this.count+=1;this.frames+=1;this.lastDuration=a-this.startTime;this.minDuration=Math.min(this.minDuration,this.lastDuration);this.maxDuration=Math.max(this.maxDuration,this.lastDuration);this.avgDuration-=this.avgDuration/30;this.avgDuration+=this.lastDuration/30;a>this.prevFpsTime+1E3&&
(this.lastFps=this.frames,this.prevFpsTime=a,this.frames=0);return a}};
NGL.Viewer=function(a,b){this.signals={orientationChanged:new signals.Signal};this.container=a?document.getElementById(a):document.createElement("div");if(this.container===document)this.width=window.innerWidth,this.height=window.innerHeight;else{var c=this.container.getBoundingClientRect();this.width=c.width;this.height=c.height}this.aspect=this.width/this.height;this.initParams();this.initCamera();this.initScene();this.initRenderer();this.initControls();this.initStats();this.initHelper();this._render=
this.render.bind(this);this._animate=this.animate.bind(this);this.setBackground();this.setFog();this.boundingBox=new THREE.Box3;this.distVector=new THREE.Vector3;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}}};
NGL.Viewer.prototype={constructor:NGL.Viewer,initParams:function(){this.params={fogColor:new THREE.Color(0),fogNear:50,fogFar:100,backgroundColor:new THREE.Color(0),cameraType:1,cameraFov:40,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,spinAxis:null,spinAngle:.01,lightColor:new THREE.Color(14540253),lightIntensity:1,ambientColor:new THREE.Color(14540253),ambientIntensity:.2,holdRendering:!1,sampleLevel:0}},initCamera:function(){var a=this.params,b=new THREE.Vector3(0,0,0);this.perspectiveCamera=
new THREE.PerspectiveCamera(a.cameraFov,this.aspect,.1,1E4);this.perspectiveCamera.position.z=a.cameraZ;this.perspectiveCamera.lookAt(b);this.camera=this.perspectiveCamera;this.camera.updateProjectionMatrix()},initRenderer:function(){this.renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0,antialias:!0});this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(this.width,this.height);this.renderer.autoClear=!1;this.renderer.sortObjects=!0;NGL.extensionFragDepth=this.renderer.extensions.get("EXT_frag_depth");
NGL.indexUint16=!this.renderer.extensions.get("OES_element_index_uint");NGL.supportsReadPixelsFloat="Chrome"===NGL.browser&&this.renderer.extensions.get("OES_texture_float")||this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float");this.container.appendChild(this.renderer.domElement);this.renderer.extensions.get("OES_texture_float");this.renderer.extensions.get("OES_texture_half_float");this.renderer.extensions.get("WEBGL_color_buffer_float");this.pickingTarget=
new THREE.WebGLRenderTarget(this.width*window.devicePixelRatio,this.height*window.devicePixelRatio,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,stencilBuffer:!1,format:THREE.RGBAFormat,type:NGL.supportsReadPixelsFloat?THREE.FloatType:THREE.UnsignedByteType});this.pickingTarget.texture.generateMipmaps=!1;this.sampleLevel=0;this.sampleTarget=new THREE.WebGLRenderTarget(this.width*window.devicePixelRatio,this.height*window.devicePixelRatio,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,
format:THREE.RGBAFormat});this.holdTarget=new THREE.WebGLRenderTarget(this.width*window.devicePixelRatio,this.height*window.devicePixelRatio,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloatType});this.compositeUniforms={tForeground:{type:"t",value:null},scale:{type:"f",value:1}};this.compositeMaterial=new THREE.ShaderMaterial({uniforms:this.compositeUniforms,vertexShader:NGL.getShader("Quad.vert"),fragmentShader:NGL.getShader("Quad.frag"),transparent:!0,
blending:THREE.CustomBlending,blendSrc:THREE.OneFactor,blendDst:THREE.OneFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor,blendEquation:THREE.AddEquation,depthTest:!1,depthWrite:!1});this.compositeCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.compositeScene=(new THREE.Scene).add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),this.compositeMaterial))},initScene:function(){this.scene||(this.scene=new THREE.Scene);this.rotationGroup=new THREE.Group;this.rotationGroup.name="rotationGroup";
this.scene.add(this.rotationGroup);this.modelGroup=new THREE.Group;this.modelGroup.name="modelGroup";this.rotationGroup.add(this.modelGroup);this.pickingGroup=new THREE.Group;this.pickingGroup.name="pickingGroup";this.rotationGroup.add(this.pickingGroup);this.backgroundGroup=new THREE.Group;this.backgroundGroup.name="backgroundGroup";this.rotationGroup.add(this.backgroundGroup);this.helperGroup=new THREE.Group;this.helperGroup.name="helperGroup";this.rotationGroup.add(this.helperGroup);this.modelGroup.fog=
new THREE.Fog;this.pointLight=new THREE.SpotLight(this.params.lightColor,this.params.lightIntensity,0,1);this.modelGroup.add(this.pointLight);this.ambientLight=new THREE.AmbientLight(this.params.ambientLight,this.params.ambientIntensity);this.modelGroup.add(this.ambientLight)},initHelper:function(){var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=new Float32Array(24),c=new THREE.BufferGeometry;c.setIndex(new THREE.BufferAttribute(a,1));c.addAttribute("position",new THREE.BufferAttribute(b,
3));a=new THREE.LineBasicMaterial({color:"skyblue",linewidth:2});this.boundingBoxMesh=new THREE.LineSegments(c,a);this.helperGroup.add(this.boundingBoxMesh)},updateHelper:function(){var a=this.boundingBoxMesh.geometry.attributes.position,b=a.array,c=this.boundingBox,d=c.min,e=c.max;b[0]=e.x;b[1]=e.y;b[2]=e.z;b[3]=d.x;b[4]=e.y;b[5]=e.z;b[6]=d.x;b[7]=d.y;b[8]=e.z;b[9]=e.x;b[10]=d.y;b[11]=e.z;b[12]=e.x;b[13]=e.y;b[14]=d.z;b[15]=d.x;b[16]=e.y;b[17]=d.z;b[18]=d.x;b[19]=d.y;b[20]=d.z;b[21]=e.x;b[22]=d.y;
b[23]=d.z;a.needsUpdate=!0;c.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()},initControls:function(){function a(a){a.preventDefault()}this.renderer.domElement.addEventListener("mousewheel",a,!1);this.renderer.domElement.addEventListener("MozMousePixelScroll",a,!1);this.controls=new THREE.TrackballControls(this.camera,this.renderer.domElement);this.controls.rotateSpeed=2;this.controls.zoomSpeed=1.2;this.controls.panSpeed=.8;this.controls.staticMoving=!0;this.controls.keys=[65,83,
68];this.controls.addEventListener("change",this.requestRender.bind(this));document.addEventListener("mousemove",this.controls.update.bind(this.controls),!1);document.addEventListener("touchmove",this.controls.update.bind(this.controls),!1);this.controls.addEventListener("change",function(){this.signals.orientationChanged.dispatch()}.bind(this),!1)},initStats:function(){this.stats=new NGL.Stats},add:function(a,b){b?b.forEach(function(b){this.addBuffer(a,b)},this):this.addBuffer(a);a.background?(this.backgroundGroup.add(a.group),
this.backgroundGroup.add(a.wireframeGroup)):(this.modelGroup.add(a.group),this.modelGroup.add(a.wireframeGroup));a.pickable&&this.pickingGroup.add(a.pickingGroup);this.rotationGroup.updateMatrixWorld();NGL.debug&&this.updateHelper()},addBuffer:function(a,b){var c=a.getMesh();c.userData.buffer=a;b&&(c.applyMatrix(b.matrix),c.userData.instance=b);a.group.add(c);var d=a.getWireframeMesh();d.userData.buffer=a;b&&(d.matrix.copy(c.matrix),d.position.copy(c.position),d.quaternion.copy(c.quaternion),d.scale.copy(c.scale),
d.userData.instance=b);a.wireframeGroup.add(d);a.pickable&&(d=a.getPickingMesh(),d.userData.buffer=a,b&&(d.matrix.copy(c.matrix),d.position.copy(c.position),d.quaternion.copy(c.quaternion),d.scale.copy(c.scale),d.userData.instance=b),a.pickingGroup.add(d));b?this.updateBoundingBox(a.geometry,b.matrix):this.updateBoundingBox(a.geometry)},remove:function(a){this.rotationGroup.children.forEach(function(b){b.remove(a.group);b.remove(a.wireframeGroup)});a.pickable&&this.pickingGroup.remove(a.pickingGroup);
this.updateBoundingBox();NGL.debug&&this.updateHelper()},updateBoundingBox:function(a,b){function c(a,b){a.boundingBox||a.computeBoundingBox();b?(e=a.boundingBox.clone(),e.applyMatrix4(b)):e=a.boundingBox;e.min.equals(e.max)&&e.expandByScalar(5);f.expandByPoint(e.min);f.expandByPoint(e.max)}function d(a){if(void 0!==a.geometry){var b=void 0;a.userData.instance&&(b=a.userData.instance.matrix);c(a.geometry,b)}}var e,f=this.boundingBox;a?c(a,b):(f.makeEmpty(),this.modelGroup.traverse(d),this.backgroundGroup.traverse(d));
this.controls.maxDistance=10*f.size().length()},getImage:function(a,b){return this.renderer.domElement.toBlob(a,b)},setLight:function(a,b,c,d){var e=this.params;void 0!==a&&e.lightColor.set(a);void 0!==b&&(e.lightIntensity=b);void 0!==c&&e.ambientColor.set(c);void 0!==d&&(e.ambientIntensity=d);this.requestRender()},setFog:function(a,b,c){var d=this.params;void 0!==a&&d.fogColor.set(a);void 0!==b&&(d.fogNear=b);void 0!==c&&(d.fogFar=c);this.requestRender()},setBackground:function(a){var b=this.params;
a&&b.backgroundColor.set(a);this.setFog(b.backgroundColor);this.renderer.setClearColor(b.backgroundColor,0);this.renderer.domElement.style.backgroundColor=b.backgroundColor.getStyle();this.requestRender()},setSampling:function(a){void 0!==a&&(this.sampleLevel=this.params.sampleLevel=a);this.requestRender()},setCamera:function(a,b){var c=this.params;null!==a&&(c.cameraType=a);b&&(c.cameraFov=b);this.camera=this.perspectiveCamera;this.perspectiveCamera.fov=c.cameraFov;this.controls.object=this.camera;
this.camera.updateProjectionMatrix();this.requestRender()},setClip:function(a,b,c){var d=this.params;void 0!==a&&(d.clipNear=a);void 0!==b&&(d.clipFar=b);void 0!==c&&(d.clipDist=c);this.requestRender()},setSpin:function(a,b){var c=this.params;void 0!==a&&(c.spinAxis=a);void 0!==b&&(c.spinAngle=b)},setSize:function(a,b){this.width=a;this.height=b;this.aspect=this.width/this.height;this.perspectiveCamera.aspect=this.aspect;this.camera.updateProjectionMatrix();this.renderer.setPixelRatio(window.devicePixelRatio);
this.renderer.setSize(this.width,this.height);this.pickingTarget.setSize(this.width*window.devicePixelRatio,this.height*window.devicePixelRatio);this.sampleTarget.setSize(this.width*window.devicePixelRatio,this.height*window.devicePixelRatio);this.holdTarget.setSize(this.width*window.devicePixelRatio,this.height*window.devicePixelRatio);this.controls.handleResize();-1===this.params.sampleLevel&&(this.sampleLevel=0);this.requestRender()},handleResize:function(){if(this.container===document)this.setSize(window.innerWidth,
window.innerHeight);else{var a=this.container.getBoundingClientRect();this.setSize(a.width,a.height)}},updateInfo:function(a){var b=this.info,c=b.memory,b=b.render;if(a)c.programs=0,c.geometries=0,c.textures=0,b.calls=0,b.vertices=0,b.faces=0,b.points=0;else{var d=this.renderer.info;a=d.memory;d=d.render;c.programs=a.programs;c.geometries=a.geometries;c.textures=a.textures;b.calls+=d.calls;b.vertices+=d.vertices;b.faces+=d.faces;b.points+=d.points}},rotate:function(){var a=new THREE.Vector3,b=new THREE.Quaternion,
c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3;return function(g,h){a.copy(this.camera.position).sub(this.controls.target);c.copy(a).normalize();d.copy(this.camera.up).normalize();e.crossVectors(d,c).normalize();c.setLength(g.z);d.setLength(g.y);e.setLength(g.x);f.copy(e.sub(d).add(c));b.setFromAxisAngle(f.normalize(),h);a.applyQuaternion(b);this.camera.up.applyQuaternion(b);this.camera.position.addVectors(this.controls.target,a);this.camera.lookAt(this.controls.target)}}(),
zoom:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){a.copy(this.camera.position).sub(this.controls.target);b.copy(a).normalize();b.setLength(c);a.add(b);this.camera.position.addVectors(this.controls.target,a);this.camera.lookAt(this.controls.target)}}(),animate:function(){this.controls.update();if(200<performance.now()-this.stats.startTime&&!this.still&&3>this.sampleLevel){var a=this.sampleLevel;this.sampleLevel=3;this._renderPending=!0;this.render();this.still=!0;this.sampleLevel=
a;NGL.debug&&NGL.log("rendered still frame")}else-1===this.params.sampleLevel&&(30<this.stats.avgDuration?(this.sampleLevel=Math.max(0,this.sampleLevel-1),NGL.debug&&NGL.log("sample level down",this.sampleLevel),this.stats.count=0):17>this.stats.avgDuration&&60<this.stats.count&&(this.sampleLevel=Math.min(5,this.sampleLevel+1),NGL.debug&&NGL.log("sample level up",this.sampleLevel),this.stats.count=0));a=this.params;a.spinAxis&&a.spinAngle&&(this.rotate(a.spinAxis,a.spinAngle*this.stats.lastDuration/
16),this.requestRender());requestAnimationFrame(this._animate)},screenshot:function(a){NGL.screenshot(this,a)},pick:function(){var a=new Float32Array(4),b=new Uint8Array(4);return function(c,d){c*=window.devicePixelRatio;d*=window.devicePixelRatio;var e,f,g,h=NGL.supportsReadPixelsFloat?a:b;this.render(null,!0);this.renderer.readRenderTargetPixels(this.pickingTarget,c,d,1,1,h);e=NGL.supportsReadPixelsFloat?Math.round(255*h[0])<<16&16711680|Math.round(255*h[1])<<8&65280|Math.round(255*h[2])&255:h[0]<<
16|h[1]<<8|h[2];(f=this.pickingGroup.getObjectById(Math.round(h[3])))&&f.userData.instance&&(g=f.userData.instance);NGL.debug&&(f=Array.apply([],h),NGL.log(h),NGL.log("picked color",[f[0].toPrecision(2),f[1].toPrecision(2),f[2].toPrecision(2),f[3].toPrecision(2)]),NGL.log("picked gid",e),NGL.log("picked instance",g),NGL.log("picked position",c,d),NGL.log("devicePixelRatio",window.devicePixelRatio));return{gid:e,instance:g}}}(),requestRender:function(){this._renderPending||this.holdRendering||(22<
performance.now()-this.stats.startTime&&(this.stats.begin(),this.still=!1),this._renderPending=!0,requestAnimationFrame(function(){this.render();this.stats.update()}.bind(this)))},__updateClipping:function(){var a=this.params,b=this.camera,c=this.distVector.copy(b.position).sub(this.controls.target).length();c||(b.position.set(0,0,a.cameraZ),c=Math.abs(a.cameraZ));this.cDist=c;var d=Math.max(10,.5*this.boundingBox.size(this.distVector).length());if(Infinity===d||-Infinity===d||isNaN(d))d=50;this.bRadius=
d+=this.boundingBox.center(this.distVector).add(this.rotationGroup.position).length();var e=-(50-a.clipFar)/50;b.near=Math.max(.1,a.clipDist,c-(50-a.clipNear)/50*d);b.far=Math.max(1,c+d*e);var b=(50-a.fogNear)/50,e=-(50-a.fogFar)/50,f=this.modelGroup.fog;f.color.set(a.fogColor);f.near=Math.max(.1,c-d*b);f.far=Math.max(1,c+d*e)},__updateCamera:function(a){var b=this.camera;b.updateMatrix();b.updateMatrixWorld(!0);b.matrixWorldInverse.getInverse(b.matrixWorld);a||this.camera.updateProjectionMatrix();
this.updateMaterialUniforms(this.scene,b);this.sortProjectedPosition(this.scene,b)},__updateLights:function(){var a=this.params,b=this.pointLight;b.position.copy(this.camera.position).multiplyScalar(100);b.updateMatrixWorld();b.color.set(a.lightColor);b.intensity=a.lightIntensity;b=this.ambientLight;b.color.set(a.ambientColor);b.intensity=a.ambientIntensity},__renderPickingGroup:function(){this.renderer.clearTarget(this.pickingTarget);this.renderer.render(this.pickingGroup,this.camera,this.pickingTarget);
this.updateInfo();this.renderer.setRenderTarget(null);NGL.debug&&(this.renderer.clear(),this.renderer.render(this.pickingGroup,this.camera),this.renderer.render(this.helperGroup,this.camera))},__renderModelGroup:function(a){a?this.renderer.clearTarget(a):this.renderer.clear();this.renderer.render(this.backgroundGroup,this.camera,a);a?this.renderer.clearTarget(a,void 0,!0,void 0):this.renderer.clearDepth();this.updateInfo();this.renderer.render(this.modelGroup,this.camera,a);this.updateInfo();NGL.debug&&
this.renderer.render(this.helperGroup,this.camera,a)},__renderMultiSample:function(){var a=this.camera,b=NGL.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))];this.compositeUniforms.scale.value=1/b.length;this.compositeUniforms.tForeground.value=this.sampleTarget;this.compositeUniforms.tForeground.needsUpdate=!0;this.compositeMaterial.needsUpdate=!0;for(var c=this.sampleTarget.width,d=this.sampleTarget.height,e=0;e<b.length;++e){var f=b[e];a.setViewOffset&&a.setViewOffset(c,d,f[0],f[1],c,d);
this.__updateCamera();this.__renderModelGroup(this.sampleTarget);this.renderer.render(this.compositeScene,this.compositeCamera,this.holdTarget,0===e)}this.renderer.setRenderTarget(null);this.compositeUniforms.scale.value=1;this.compositeUniforms.tForeground.value=this.holdTarget;this.compositeUniforms.tForeground.needsUpdate=!0;this.compositeMaterial.needsUpdate=!0;this.renderer.clear();this.renderer.render(this.compositeScene,this.compositeCamera);a.setViewOffset&&a.setViewOffset(void 0,void 0,void 0,
void 0,void 0,void 0)},render:function(a,b,c){this._rendering?NGL.warn("tried to call 'render' from within 'render'"):(this._rendering=!0,this.__updateClipping(),this.__updateCamera(c),this.__updateLights(),this.updateInfo(!0),b?this.__renderPickingGroup():0<this.sampleLevel&&!c?this.__renderMultiSample():this.__renderModelGroup(),this._renderPending=this._rendering=!1)},updateMaterialUniforms:function(){var a=new THREE.Matrix4,b=new THREE.Matrix4;return function(c,d){var e=this.cDist,f=this.bRadius,
g=this.height,h=this.renderer.getPixelRatio();a.getInverse(d.projectionMatrix);b.copy(d.projectionMatrix).transpose();c.traverse(function(c){var d=c.material;d&&(c=c.material.uniforms)&&(d.clipNear&&(c.nearClip.value=e-(50-d.clipNear)/50*f),c.canvasHeight&&(c.canvasHeight.value=g),c.pixelRatio&&(c.pixelRatio.value=h),c.projectionMatrixInverse&&c.projectionMatrixInverse.value.copy(a),c.projectionMatrixTranspose&&c.projectionMatrixTranspose.value.copy(b))})}}(),sortProjectedPosition:function(){var a=
new THREE.Vector3,b=new THREE.Matrix4,c=new THREE.Matrix4;return function(d,e){d.traverseVisible(function(d){if(d instanceof THREE.Points&&d.sortParticles){b.multiplyMatrices(e.matrixWorldInverse,d.matrixWorld);c.multiplyMatrices(e.projectionMatrix,b);var g=d.geometry.attributes,h=g.position.count;d.userData.sortData||(d.userData.sortData={});d=d.userData.sortData;d.__sortArray||(d.__sortArray=new Float32Array(2*h));for(var k=d.__sortArray,l=0;l<h;++l){var m=2*l;a.fromArray(g.position.array,3*l);
a.applyProjection(c);k[m]=-a.z;k[m+1]=l}THREE.TypedArrayUtils.quicksortIP(k,2,0);var n,q,p,r,s;for(s in g){var l=g[s],m=l.array,u=l.itemSize;d[s]||(d[s]=new Float32Array(u*h));r=d[s];d[s]=m;for(l=0;l<h;++l){n=k[2*l+1];for(var v=0;v<u;++v)q=n*u+v,p=l*u+v,r[p]=m[q]}g[s].array=r;g[s].needsUpdate=!0}}})}}(),clear:function(){NGL.log("scene cleared");this.scene.remove(this.rotationGroup);this.initScene();this.renderer.clear()},centerView:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,
d=new THREE.Vector3;return function(e,f){f=f||this.boundingBox.center();this.controls.object.position.sub(this.controls.target);this.controls.target.copy(this.controls.target0);a.copy(f).multiplyScalar(-1);this.rotationGroup.position.copy(a);this.rotationGroup.updateMatrixWorld();if(e){if(!0===e){this.boundingBox.size(d);var g=Math.max(d.x,d.y,d.z),h=Math.min(d.x,d.y,d.z),g=g+h/2,h=THREE.Math.degToRad(this.camera.fov);e=g/2/this.camera.aspect/Math.tan(h/2)}e=Math.max(e,1.2*this.params.clipDist);b.copy(this.camera.position).sub(this.controls.target);
c.copy(b).normalize();c.setLength(e);b.copy(c);this.camera.position.addVectors(this.controls.target,b)}this.requestRender();this.signals.orientationChanged.dispatch()}}(),getOrientation:function(){return[this.camera.position.toArray(),this.camera.up.toArray(),this.rotationGroup.position.toArray(),this.controls.target.toArray()]},setOrientation:function(a){console.log("setOrientation");this.controls.object.position.sub(this.controls.target);this.controls.target.copy(this.controls.target0);this.controls.target.fromArray(a[3]);
this.rotationGroup.position.fromArray(a[2]);this.rotationGroup.updateMatrixWorld();this.camera.up.fromArray(a[1]);this.camera.position.fromArray(a[0]);this.requestRender();this.signals.orientationChanged.dispatch()}};NGL.TiledRenderer=function(a,b,c,d){d=d||{};this.renderer=a;this.camera=b;this.viewer=c;this.factor=void 0!==d.factor?d.factor:2;this.antialias=void 0!==d.antialias?d.antialias:!1;this.onProgress=d.onProgress;this.onFinish=d.onFinish;this.init()};
NGL.TiledRenderer.prototype={init:function(){this.antialias&&(this.factor*=2);this.n=this.factor*this.factor;var a=document.createElement("canvas");a.style.display="hidden";document.body.appendChild(a);this.antialias?(a.width=this.viewer.width*this.factor/2,a.height=this.viewer.height*this.factor/2):(a.width=this.viewer.width*this.factor,a.height=this.viewer.height*this.factor);this.ctx=a.getContext("2d");this.canvas=a;this.shearMatrix=new THREE.Matrix4;this.scaleMatrix=new THREE.Matrix4;a=THREE.Math.degToRad(.5*
this.camera.fov);this.near=this.camera.near;this.top=Math.tan(a)*this.near;this.bottom=-this.top;this.left=this.camera.aspect*this.bottom;this.right=this.camera.aspect*this.top;this.width=Math.abs(this.right-this.left);this.height=Math.abs(this.top-this.bottom)},makeAsymmetricFrustum:function(a,b){var c=this.factor,d=this.near;this.shearMatrix.set(1,0,(b%c-.5*(c-1))*this.width/d,0,0,1,-(Math.floor(b/c)-.5*(c-1))*this.height/d,0,0,0,1,0,0,0,0,1);this.scaleMatrix.set(c,0,0,0,0,c,0,0,0,0,1,0,0,0,0,1);
a.multiply(this.shearMatrix).multiply(this.scaleMatrix);return a},renderTile:function(a){this.makeAsymmetricFrustum(this.camera.projectionMatrix,a);this.viewer.render(null,null,!0);var b=a%this.factor*this.viewer.width,c=Math.floor(a/this.factor)*this.viewer.height;this.antialias?this.ctx.drawImage(this.renderer.domElement,Math.floor(b/2),Math.floor(c/2),Math.ceil(this.viewer.width/2),Math.ceil(this.viewer.height/2)):this.ctx.drawImage(this.renderer.domElement,Math.floor(b),Math.floor(c),Math.ceil(this.viewer.width),
Math.ceil(this.viewer.height));this.camera.updateProjectionMatrix();if("function"===typeof this.onProgress)this.onProgress(a+1,this.n,!1)},render:function(){for(var a=this.n,b=0;b<=a;++b)if(b===a){if("function"===typeof this.onFinish)this.onFinish(b+1,a,!1)}else this.renderTile(b)},renderAsync:function(){for(var a=this.n,b=this.renderTile.bind(this),c=this.onFinish,d=0;d<=a;++d)setTimeout(function(d){d===a?"function"===typeof c&&c(d+1,a,!1):b(d)},0,d)},dispose:function(){document.body.removeChild(this.canvas)}};
NGL.screenshot=function(a,b){function c(b){var c=h;k&&(c*=2);b&&(c=1/c);a.scene.traverse(function(a){(a=a.material)&&a.linewidth&&(a.linewidth*=c);a&&a.uniforms&&a.uniforms.size&&void 0===a.uniforms.size.__seen&&(a.uniforms.size.value*=c,a.uniforms.size.__seen=!0)});a.scene.traverse(function(a){(a=a.material)&&a.uniforms&&a.uniforms.size&&delete a.uniforms.size.__seen})}function d(a,b,c){if("function"===typeof f.onProgress)f.onProgress(a,b,c)}function e(a){var b;g?(b=p,b=NGL.trimCanvas(r.canvas,(l?
0:255*b.r)|0,(l?0:255*b.g)|0,(l?0:255*b.b)|0,(l?0:255)|0)):b=r.canvas;b.toBlob(function(b){NGL.download(b,"screenshot.png");d(a,a,!0);r.dispose()},"image/png")}var f=b||{},g=void 0!==f.trim?f.trim:!1,h=void 0!==f.factor?f.factor:!1,k=void 0!==f.antialias?f.antialias:!1,l=void 0!==f.transparent?f.transparent:!1,m=a.renderer,n=a.camera,q=m.getClearAlpha(),p=m.getClearColor(),r=new NGL.TiledRenderer(m,n,a,{factor:h,antialias:k,onProgress:d,onFinish:function(b,d){e(d);m.setClearAlpha(q);c(!0);a.requestRender()}});
m.setClearAlpha(l?0:1);c();r.renderAsync()};
NGL.DoubleSidedBuffer=function(a){this.size=a.size;this.side=a.side;this.wireframe=a.wireframe;this.visible=a.visible;this.geometry=a.geometry;this.pickable=a.pickable;this.background=a.background;this.group=new THREE.Group;this.wireframeGroup=new THREE.Group;this.pickingGroup=new THREE.Group;var b=[],c=[],d=new a.constructor;a.makeMaterial();d.makeMaterial();d.geometry=a.geometry;d.wireframeGeometry=a.wireframeGeometry;d.size=a.size;d.attributeSize=a.attributeSize;d.pickable=a.pickable;d.setParameters(a.getParameters());
d.updateShader();a.setParameters({side:THREE.FrontSide});d.setParameters({side:THREE.BackSide,opacity:d.opacity});this.getMesh=function(e){var f;e?(f=d.getPickingMesh(),e=a.getPickingMesh()):(f=d.getMesh(),e=a.getMesh());b.push(e);c.push(f);this.setParameters({side:this.side});return(new THREE.Group).add(f,e)};this.getWireframeMesh=function(){return a.getWireframeMesh()};this.getPickingMesh=function(){return this.getMesh(!0)};this.setAttributes=function(b){a.setAttributes(b)};this.setParameters=function(e){e=
Object.assign({},e);e.side===THREE.FrontSide?(b.forEach(function(a){a.visible=!0}),c.forEach(function(a){a.visible=!1})):e.side===THREE.BackSide?(b.forEach(function(a){a.visible=!1}),c.forEach(function(a){a.visible=!0})):e.side===THREE.DoubleSide&&(b.forEach(function(a){a.visible=!0}),c.forEach(function(a){a.visible=!0}));void 0!==e.side&&(this.side=e.side);delete e.side;a.setParameters(e);void 0!==e.wireframe&&(this.wireframe=e.wireframe,this.setVisibility(this.visible));delete e.wireframe;d.setParameters(e)};
this.setVisibility=NGL.Buffer.prototype.setVisibility;this.dispose=function(){a.dispose();d.dispose()}};
NGL.Buffer=function(a,b,c,d,e){e=e||{};this.pickable=!1;this.dynamic=!0;this.opaqueBack=void 0!==e.opaqueBack?e.opaqueBack:!1;this.dullInterior=void 0!==e.dullInterior?e.dullInterior:!1;this.side=void 0!==e.side?e.side:THREE.DoubleSide;this.opacity=void 0!==e.opacity?e.opacity:1;this.clipNear=void 0!==e.clipNear?e.clipNear:0;this.flatShaded=void 0!==e.flatShaded?e.flatShaded:!1;this.background=void 0!==e.background?e.background:!1;this.linewidth=void 0!==e.linewidth?e.linewidth:1;this.wireframe=void 0!==
e.wireframe?e.wireframe:!1;this.wireframeLinewidth=e.wireframeLinewidth||1;this.roughness=void 0!==e.roughness?e.roughness:.4;this.metalness=void 0!==e.metalness?e.metalness:0;this.diffuse=void 0!==e.diffuse?e.diffuse:16777215;this.forceTransparent=void 0!==e.forceTransparent?e.forceTransparent:!1;this.geometry=new THREE.BufferGeometry;this.addAttributes({position:{type:"v3",value:a},color:{type:"c",value:b}});this.indexVersion=0;this.wireframeIndexVersion=-1;c&&(this.geometry.setIndex(new THREE.BufferAttribute(c,
1)),this.geometry.getIndex().setDynamic(this.dynamic));d&&(this.addAttributes({pickingColor:{type:"c",value:d}}),this.pickable=!0);this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{fogColor:{type:"c",value:null},fogNear:{type:"f",value:0},fogFar:{type:"f",value:0},opacity:{type:"f",value:this.opacity},nearClip:{type:"f",value:0}},{emissive:{type:"c",value:new THREE.Color(0)},roughness:{type:"f",value:this.roughness},metalness:{type:"f",value:this.metalness},envMapIntensity:{type:"f",
value:1}},THREE.UniformsLib.ambient,THREE.UniformsLib.lights]);this.uniforms.diffuse.value.set(this.diffuse);this.pickingUniforms={nearClip:{type:"f",value:0},objectId:(new THREE.Uniform("f",0)).onUpdate(function(a,b){this.value=NGL.supportsReadPixelsFloat?a.id:a.id/255})};this.group=new THREE.Group;this.wireframeGroup=new THREE.Group;this.pickingGroup=new THREE.Group;this.makeWireframeGeometry()};
NGL.Buffer.prototype={constructor:NGL.Buffer,parameters:{opaqueBack:{updateShader:!0},dullInterior:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},clipNear:{updateShader:!0,property:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},linewidth:{property:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0}},get transparent(){return 1>this.opacity||this.forceTransparent},makeMaterial:function(){this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,
vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:!0,lights:!0,fog:!0,side:this.side,linewidth:this.linewidth});this.material.vertexColors=THREE.VertexColors;this.material.extensions.derivatives=this.flatShaded;this.material.extensions.fragDepth=this.impostor;this.material.clipNear=this.clipNear;this.wireframeMaterial=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:"Line.vert",fragmentShader:"Line.frag",depthTest:!0,transparent:this.transparent,depthWrite:!0,
lights:!1,fog:!0,side:this.side,linewidth:this.linewidth});this.wireframeMaterial.vertexColors=THREE.VertexColors;this.wireframeMaterial.clipNear=this.clipNear;this.pickingMaterial=new THREE.ShaderMaterial({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:!0,lights:!1,fog:!1,side:this.side,linewidth:this.linewidth});this.pickingMaterial.vertexColors=THREE.VertexColors;this.pickingMaterial.extensions.fragDepth=this.impostor;this.pickingMaterial.clipNear=
this.clipNear;this.updateShader()},makeWireframeGeometry:function(){this.makeWireframeIndex();var a=this.geometry,b=this.wireframeIndex,c=new THREE.BufferGeometry;c.attributes=a.attributes;b&&(c.setIndex((new THREE.BufferAttribute(b,1)).setDynamic(this.dynamic)),c.setDrawRange(0,this.wireframeIndexCount));this.wireframeGeometry=c},makeWireframeIndex:function(){function a(a,d){if(a>d){var e=a;a=d;d=e}e=b[a];return void 0===e?(b[a]=[d],!0):-1===e.indexOf(d)?(e.push(d),!0):!1}var b=[];return function(){var c=
this.geometry.index;if(!this.wireframe)this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0;else if(c){var c=c.array,d=c.length;Infinity!==this.geometry.drawRange.count&&(d=this.geometry.drawRange.count);var e;e=this.wireframeIndex&&this.wireframeIndex.length>2*d?this.wireframeIndex:new (65535<this.geometry.attributes.position.count?Uint32Array:Uint16Array)(2*d);for(var f=0,g=b.length=0;g<d;g+=3){var h=c[g+0],k=c[g+1],l=c[g+2];a(h,k)&&(e[f+0]=h,e[f+1]=k,f+=2);a(k,l)&&(e[f+0]=k,e[f+1]=
l,f+=2);a(l,h)&&(e[f+0]=l,e[f+1]=h,f+=2)}this.wireframeIndex=e;this.wireframeIndexCount=f;this.wireframeIndexVersion=this.indexVersion}}}(),updateWireframeIndex:function(){this.wireframeGeometry.setDrawRange(0,Infinity);this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex();if(this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex((new THREE.BufferAttribute(this.wireframeIndex,1)).setDynamic(this.dynamic));else{var a=this.wireframeGeometry.getIndex();
a.set(this.wireframeIndex);a.needsUpdate=0<this.wireframeIndexCount;a.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)},getRenderOrder:function(){var a=0;this instanceof NGL.TextBuffer?a=1:this.transparent&&(a=this instanceof NGL.SurfaceBuffer?3:2);return a},getMesh:function(){var a;this.material||this.makeMaterial();this.line?a=new THREE.LineSegments(this.geometry,this.material):this.point?(a=new THREE.Points(this.geometry,this.material),
this.sortParticles&&(a.sortParticles=!0)):a=new THREE.Mesh(this.geometry,this.material);a.frustumCulled=!1;a.renderOrder=this.getRenderOrder();return a},getWireframeMesh:function(){var a;this.material||this.makeMaterial();this.wireframeGeometry||this.makeWireframeGeometry();a=new THREE.LineSegments(this.wireframeGeometry,this.wireframeMaterial);a.frustumCulled=!1;a.renderOrder=this.getRenderOrder();return a},getPickingMesh:function(){var a;this.material||this.makeMaterial();a=new THREE.Mesh(this.geometry,
this.pickingMaterial);a.frustumCulled=!1;a.renderOrder=this.getRenderOrder();return a},getShader:function(a,b){return NGL.getShader(a,this.getDefines(b))},getVertexShader:function(a){return this.getShader(this.vertexShader,a)},getFragmentShader:function(a){return this.getShader(this.fragmentShader,a)},getDefines:function(a){var b={};this.clipNear&&(b.NEAR_CLIP=1);if("picking"===a)b.PICKING=1;else{if("background"===a||this.background)b.NOLIGHT=1;this.flatShaded&&(b.FLAT_SHADED=1);this.opaqueBack&&
(b.OPAQUE_BACK=1);this.dullInterior&&(b.DULL_INTERIOR=1)}return b},getParameters:function(){var a={},b;for(b in this.parameters)a[b]=this[b];return a},addUniforms:function(a){this.uniforms=THREE.UniformsUtils.merge([this.uniforms,a]);this.pickingUniforms=THREE.UniformsUtils.merge([this.pickingUniforms,a])},addAttributes:function(a){var b={f:1,v2:2,v3:3,c:3},c;for(c in a){var d,e=a[c];e.value?(this.attributeSize*b[e.type]!==e.value.length&&NGL.error("attribute value has wrong length",c),d=e.value):
d=new Float32Array(this.attributeSize*b[e.type]);this.geometry.addAttribute(c,(new THREE.BufferAttribute(d,b[e.type])).setDynamic(this.dynamic))}},updateRenderOrder:function(){function a(a){a.renderOrder=b}var b=this.getRenderOrder();this.group.children.forEach(a);this.pickingGroup&&this.pickingGroup.children.forEach(a)},updateShader:function(){var a=this.material,b=this.wireframeMaterial,c=this.pickingMaterial;a.vertexShader=this.getVertexShader();a.fragmentShader=this.getFragmentShader();a.needsUpdate=
!0;b.vertexShader=this.getShader("Line.vert");b.fragmentShader=this.getShader("Line.frag");b.needsUpdate=!0;c.vertexShader=this.getVertexShader("picking");c.fragmentShader=this.getFragmentShader("picking");c.needsUpdate=!0},setParameters:function(a){if(a){var b=this.parameters,c={},d={},e=!1,f=!1,g;for(g in a)void 0!==a[g]&&void 0!==b[g]&&(this[g]=a[g],b[g].property&&(!0!==b[g].property?c[b[g].property]=a[g]:c[g]=a[g]),b[g].uniform&&(!0!==b[g].uniform?d[b[g].uniform]=a[g]:d[g]=a[g]),b[g].updateShader&&
(e=!0),b[g].updateVisibility&&(f=!0),this.dynamic&&"wireframe"===g&&!0===a[g]&&this.updateWireframeIndex(),"flatShaded"===g&&(this.material.extensions.derivatives=this.flatShaded),"forceTransparent"===g&&(c.transparent=this.transparent));this.setProperties(c);this.setUniforms(d);e&&this.updateShader();f&&this.setVisibility(this.visible)}},setAttributes:function(a){var b=this.geometry,c=b.attributes,d;for(d in a){var e=a[d],f=e.length;if("index"===d){var g=b.getIndex();b.setDrawRange(0,Infinity);f>
g.array.length?b.setIndex((new THREE.BufferAttribute(e,1)).setDynamic(this.dynamic)):(g.set(e),g.needsUpdate=0<f,g.updateRange.count=f,b.setDrawRange(0,f));this.indexVersion++;this.wireframe&&this.updateWireframeIndex()}else g=c[d],f>g.array.length?b.addAttribute(d,(new THREE.BufferAttribute(e,g.itemSize)).setDynamic(this.dynamic)):(c[d].set(e),c[d].needsUpdate=0<f,c[d].updateRange.count=f)}},setUniforms:function(a){if(a){var b=this.material.uniforms,c=this.wireframeMaterial.uniforms,d=this.pickingMaterial.uniforms,
e;for(e in a)"opacity"===e&&this.setProperties({transparent:this.transparent}),void 0!==b[e]&&("c"===b[e].type?b[e].value.set(a[e]):b[e].value=a[e]),void 0!==c[e]&&("c"===c[e].type?c[e].value.set(a[e]):c[e].value=a[e]),void 0!==d[e]&&("c"===d[e].type?d[e].value.set(a[e]):d[e].value=a[e])}},setProperties:function(a){if(a){var b=this.material,c=this.wireframeMaterial,d=this.pickingMaterial,e;for(e in a)"transparent"===e&&this.updateRenderOrder(),void 0!==b[e]&&(b[e]=a[e]),void 0!==c[e]&&(c[e]=a[e]),
void 0!==d[e]&&(d[e]=a[e]);b.needsUpdate=!0;c.needsUpdate=!0;d.needsUpdate=!0}},setVisibility:function(a){this.visible=a;this.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=a,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=a,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=a))},dispose:function(){this.material&&this.material.dispose();this.wireframeMaterial&&this.wireframeMaterial.dispose();this.pickingMaterial&&this.pickingMaterial.dispose();
this.geometry.dispose();this.wireframeGeometry&&this.wireframeGeometry.dispose()}};NGL.MeshBuffer=function(a,b,c,d,e,f){f=f||{};this.attributeSize=this.size=a?a.length/3:0;this.vertexShader="Mesh.vert";this.fragmentShader="Mesh.frag";NGL.Buffer.call(this,a,b,c,e,f);this.addAttributes({normal:{type:"v3",value:d}});void 0===d&&this.geometry.computeVertexNormals()};NGL.MeshBuffer.prototype=Object.create(NGL.Buffer.prototype);NGL.MeshBuffer.prototype.constructor=NGL.MeshBuffer;
NGL.MappedBuffer=function(a){this.size=this.count;this.attributeSize=this.count*this.mappingSize;this.index=new (65535<this.attributeSize?Uint32Array:Uint16Array)(this.count*this.mappingIndicesSize);this.makeIndex();NGL.Buffer.call(this,null,null,this.index,null,a);this.addAttributes({mapping:{type:this.mappingType,value:null}})};NGL.MappedBuffer.prototype=Object.create(NGL.Buffer.prototype);NGL.MappedBuffer.prototype.constructor=NGL.MappedBuffer;
NGL.MappedBuffer.prototype.setAttributes=function(a){var b=this.count,c=this.mappingSize,d=this.geometry.attributes,e,f,g,h,k,l,m,n;for(n in a){f=a[n];e=d[n];g=e.itemSize;h=e.array;for(var q=0;q<b;++q){k=q*g;l=k*c;for(var p=0;p<c;++p){m=l+g*p;for(var r=0;r<g;++r)h[m+r]=f[k+r]}}e.needsUpdate=!0}};NGL.MappedBuffer.prototype.makeMapping=function(){for(var a=this.count,b=this.mapping,c=this.mappingSize,d=this.mappingItemSize,e=this.geometry.attributes.mapping.array,f=0;f<a;f++)e.set(b,f*d*c)};
NGL.MappedBuffer.prototype.makeIndex=function(){for(var a=this.count,b=this.mappingSize,c=this.mappingIndices,d=this.mappingIndicesSize,e=this.index,f,g,h=0;h<a;h++){f=h*d;g=h*b;e.set(c,f);for(var k=0;k<d;++k)e[f+k]+=g}};NGL.QuadBuffer=function(a){this.mapping=new Float32Array([-1,1,-1,-1,1,1,1,-1]);this.mappingIndices=new Uint16Array([0,1,2,1,3,2]);this.mappingIndicesSize=6;this.mappingType="v2";this.mappingSize=4;this.mappingItemSize=2;NGL.MappedBuffer.call(this,a)};NGL.QuadBuffer.prototype=Object.create(NGL.MappedBuffer.prototype);
NGL.QuadBuffer.prototype.constructor=NGL.QuadBuffer;NGL.BoxBuffer=function(a){this.mapping=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]);this.mappingIndices=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);this.mappingIndicesSize=36;this.mappingType="v3";this.mappingSize=8;this.mappingItemSize=3;NGL.MappedBuffer.call(this,a)};NGL.BoxBuffer.prototype=Object.create(NGL.MappedBuffer.prototype);
NGL.BoxBuffer.prototype.constructor=NGL.BoxBuffer;NGL.AlignedBoxBuffer=function(a){this.mapping=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]);this.mappingIndices=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);this.mappingIndicesSize=12;this.mappingType="v3";this.mappingSize=6;this.mappingItemSize=3;NGL.MappedBuffer.call(this,a)};NGL.AlignedBoxBuffer.prototype=Object.create(NGL.MappedBuffer.prototype);NGL.AlignedBoxBuffer.prototype.constructor=NGL.AlignedBoxBuffer;
NGL.SphereImpostorBuffer=function(a,b,c,d,e){this.impostor=!0;this.count=a.length/3;this.vertexShader="SphereImpostor.vert";this.fragmentShader="SphereImpostor.frag";NGL.QuadBuffer.call(this,e);this.addUniforms({projectionMatrixInverse:{type:"m4",value:new THREE.Matrix4}});this.addAttributes({radius:{type:"f",value:null}});this.setAttributes({position:a,color:b,radius:c});d&&(this.addAttributes({pickingColor:{type:"c",value:null}}),this.setAttributes({pickingColor:d}),this.pickable=!0);this.makeMapping()};
NGL.SphereImpostorBuffer.prototype=Object.create(NGL.QuadBuffer.prototype);NGL.SphereImpostorBuffer.prototype.constructor=NGL.SphereImpostorBuffer;
NGL.CylinderImpostorBuffer=function(a,b,c,d,e,f,g,h){var k=h||k;this.shift=void 0!==k.shift?k.shift:0;this.cap=void 0!==k.cap?k.cap:!0;this.impostor=!0;this.count=a.length/3;this.vertexShader="CylinderImpostor.vert";this.fragmentShader="CylinderImpostor.frag";NGL.AlignedBoxBuffer.call(this,k);h=(new THREE.Uniform("m4",new THREE.Matrix4)).onUpdate(function(a,b){this.value.getInverse(a.modelViewMatrix)});this.addUniforms({modelViewMatrixInverse:h,shift:{type:"f",value:this.shift}});this.addAttributes({position1:{type:"v3",
value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}});this.setAttributes({position:NGL.Utils.calculateCenterArray(a,b),position1:a,position2:b,color:c,color2:d,radius:e});f&&(this.addAttributes({pickingColor:{type:"c",value:null},pickingColor2:{type:"c",value:null}}),this.setAttributes({pickingColor:f,pickingColor2:g}),this.pickable=!0);this.makeMapping()};NGL.CylinderImpostorBuffer.prototype=Object.create(NGL.AlignedBoxBuffer.prototype);
NGL.CylinderImpostorBuffer.prototype.constructor=NGL.CylinderImpostorBuffer;NGL.CylinderImpostorBuffer.prototype.getMaterial=function(a){a=NGL.Buffer.prototype.getMaterial.call(this,a);this.cap&&(a.defines.CAP=1);return a};
NGL.HyperballStickImpostorBuffer=function(a,b,c,d,e,f,g,h,k){function l(a,b){var c=a.material.uniforms;c.modelViewMatrixInverse&&c.modelViewMatrixInverse.value.getInverse(a.modelViewMatrix);c.modelViewMatrixInverseTranspose&&(c.modelViewMatrixInverse?c.modelViewMatrixInverseTranspose.value.copy(c.modelViewMatrixInverse.value).transpose():c.modelViewMatrixInverseTranspose.value.getInverse(a.modelViewMatrix).transpose());c.modelViewProjectionMatrix&&c.modelViewProjectionMatrix.value.multiplyMatrices(b.projectionMatrix,
a.modelViewMatrix);c.modelViewProjectionMatrixInverse&&(c.modelViewProjectionMatrix?n.copy(c.modelViewProjectionMatrix.value):n.multiplyMatrices(b.projectionMatrix,a.modelViewMatrix),c.modelViewProjectionMatrixInverse.value.getInverse(n))}var m=k||m;k=void 0!==m.shrink?m.shrink:.14;this.impostor=!0;this.count=a.length/3;this.vertexShader="HyperballStickImpostor.vert";this.fragmentShader="HyperballStickImpostor.frag";NGL.BoxBuffer.call(this,m);var n=new THREE.Matrix4,m=(new THREE.Uniform("m4",new THREE.Matrix4)).onUpdate(l),
q=(new THREE.Uniform("m4",new THREE.Matrix4)).onUpdate(l),p=(new THREE.Uniform("m4",new THREE.Matrix4)).onUpdate(l);this.addUniforms({modelViewProjectionMatrix:m,modelViewProjectionMatrixInverse:q,modelViewMatrixInverseTranspose:p,shrink:{type:"f",value:k}});this.addAttributes({color:{type:"c",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null},position1:{type:"v3",value:null},position2:{type:"v3",value:null}});this.setAttributes({color:c,color2:d,radius:e,
radius2:f,position1:a,position2:b,position:NGL.Utils.calculateCenterArray(a,b)});g&&(this.addAttributes({pickingColor:{type:"c",value:null},pickingColor2:{type:"c",value:null}}),this.setAttributes({pickingColor:g,pickingColor2:h}),this.pickable=!0);this.makeMapping()};NGL.HyperballStickImpostorBuffer.prototype=Object.create(NGL.BoxBuffer.prototype);NGL.HyperballStickImpostorBuffer.prototype.constructor=NGL.HyperballStickImpostorBuffer;
NGL.HyperballStickImpostorBuffer.prototype.parameters=Object.assign({shrink:{uniform:!0}},NGL.BoxBuffer.prototype.parameters);
NGL.GeometryBuffer=function(a,b,c,d){d=d||{};var e=this.geo,f=a.length/3,g=e.vertices.length,h=e.faces.length;this.size=f*g;this.positionCount=f;this.geoPosition=NGL.Utils.positionFromGeometry(e);this.geoNormal=NGL.Utils.normalFromGeometry(e);this.geoIndex=NGL.Utils.indexFromGeometry(e);this.transformedGeoPosition=new Float32Array(3*g);this.transformedGeoNormal=new Float32Array(3*g);this.meshPosition=new Float32Array(3*this.size);this.meshNormal=new Float32Array(3*this.size);this.meshColor=new Float32Array(3*
this.size);this.meshPickingColor=new Float32Array(3*this.size);this.meshIndex=new (65535<this.meshPosition.length/3?Uint32Array:Uint16Array)(f*h*3);this.makeIndex();NGL.MeshBuffer.call(this,this.meshPosition,this.meshColor,this.meshIndex,this.meshNormal,this.meshPickingColor,d);this.initNormals=!0;this.setAttributes({position:a,color:b,pickingColor:c});this.initNormals=!1};NGL.GeometryBuffer.prototype=Object.create(NGL.MeshBuffer.prototype);NGL.GeometryBuffer.prototype.constructor=NGL.GeometryBuffer;
NGL.GeometryBuffer.prototype.applyPositionTransform=function(){};
NGL.GeometryBuffer.prototype.setAttributes=function(){var a=new THREE.Matrix4,b=new THREE.Matrix3;return function(c){var d=this.geometry.attributes,e,f,g,h,k,l,m,n,q,p,r;c.position&&(e=c.position,h=this.geoPosition,n=this.meshPosition,l=this.transformedGeoPosition,d.position.needsUpdate=!0);c.color&&(f=c.color,q=this.meshColor,d.color.needsUpdate=!0);c.pickingColor&&(g=c.pickingColor,p=this.meshPickingColor,d.pickingColor.needsUpdate=!0);c=!(!this.updateNormals||!e);var s=!(!this.initNormals||!e);
if(c||s)k=this.geoNormal,r=this.meshNormal,m=this.transformedGeoNormal,d.normal.needsUpdate=!0;for(var d=this.positionCount,u=this.geo.vertices.length,v=0;v<d;++v){var w=v*u*3,x=3*v;e&&(l.set(h),a.makeTranslation(e[x],e[x+1],e[x+2]),this.applyPositionTransform(a,v,x),a.applyToVector3Array(l),n.set(l,w));c?(m.set(k),b.getNormalMatrix(a),b.applyToVector3Array(m),r.set(m,w)):s&&r.set(k,w);if(f)for(var t=0;t<u;++t){var z=w+3*t;q[z]=f[x];q[z+1]=f[x+1];q[z+2]=f[x+2]}if(g)for(t=0;t<u;++t)z=w+3*t,p[z]=g[x],
p[z+1]=g[x+1],p[z+2]=g[x+2]}}}();NGL.GeometryBuffer.prototype.makeIndex=function(){var a=this.geoIndex,b=this.meshIndex,c=this.positionCount,d=this.geo.vertices.length,e,f,g,h=3*this.geo.faces.length;for(f=0;f<c;++f)for(e=f*h,g=e+h,b.set(a,e);e<g;++e)b[e]+=f*d};NGL.SphereGeometryBuffer=function(a,b,c,d,e){this.geo=new THREE.IcosahedronGeometry(1,void 0!==e.sphereDetail?e.sphereDetail:1);this.setPositionTransform(c);NGL.GeometryBuffer.call(this,a,b,d,e)};NGL.SphereGeometryBuffer.prototype=Object.create(NGL.GeometryBuffer.prototype);
NGL.SphereGeometryBuffer.prototype.constructor=NGL.SphereGeometryBuffer;NGL.SphereGeometryBuffer.prototype.setPositionTransform=function(a){var b,c=new THREE.Vector3;this.applyPositionTransform=function(d,e){b=a[e];c.set(b,b,b);d.scale(c)}};NGL.SphereGeometryBuffer.prototype.setAttributes=function(a){a.radius&&this.setPositionTransform(a.radius);NGL.GeometryBuffer.prototype.setAttributes.call(this,a)};
NGL.CylinderGeometryBuffer=function(a,b,c,d,e,f,g,h){var k=void 0!==h.radiusSegments?h.radiusSegments:10;this.updateNormals=!0;var l=(new THREE.Matrix4).makeRotationX(Math.PI/2);this.geo=new THREE.CylinderGeometry(1,1,1,k,1,!0);this.geo.applyMatrix(l);k=a.length;l=e.length;this._position=new Float32Array(2*k);this._color=new Float32Array(2*k);this._pickingColor=new Float32Array(2*k);this._from=new Float32Array(2*k);this._to=new Float32Array(2*k);this._radius=new Float32Array(2*l);this.__center=new Float32Array(k);
NGL.GeometryBuffer.call(this,this._position,this._color,this._pickingColor,h);this.setPositionTransform(this._from,this._to,this._radius);this.setAttributes({position1:a,position2:b,color:c,color2:d,radius:e,pickingColor:f,pickingColor2:g})};NGL.CylinderGeometryBuffer.prototype=Object.create(NGL.GeometryBuffer.prototype);NGL.CylinderImpostorBuffer.prototype.constructor=NGL.CylinderImpostorBuffer;
NGL.CylinderGeometryBuffer.prototype.setPositionTransform=function(a,b,c){var d,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3(0,1,0);this.applyPositionTransform=function(k,l,m){f.fromArray(a,m);g.fromArray(b,m);k.lookAt(f,g,h);d=c[l];e.set(d,d,f.distanceTo(g));k.scale(e)}};
NGL.CylinderGeometryBuffer.prototype.setAttributes=function(a){var b=this._position.length/2,c=this._radius.length/2,d={};a.position1&&a.position2&&(NGL.Utils.calculateCenterArray(a.position1,a.position2,this.__center),NGL.Utils.calculateCenterArray(a.position1,this.__center,this._position),NGL.Utils.calculateCenterArray(this.__center,a.position2,this._position,b),this._from.set(a.position1),this._from.set(this.__center,b),this._to.set(this.__center),this._to.set(a.position2,b),d.position=this._position);
a.color&&a.color2&&(this._color.set(a.color),this._color.set(a.color2,b),d.color=this._color);a.pickingColor&&a.pickingColor2&&(this._pickingColor.set(a.pickingColor),this._pickingColor.set(a.pickingColor2,b),d.pickingColor=this._pickingColor);a.radius&&(this._radius.set(a.radius),this._radius.set(a.radius,c));(a.position1&&a.position2||a.radius)&&this.setPositionTransform(this._from,this._to,this._radius);NGL.GeometryBuffer.prototype.setAttributes.call(this,d)};
NGL.makePointTexture=function(a){function b(a,b,c,d){a=c-a;b=d-b;return Math.sqrt(a*a+b*b)}function c(a,b,c){c=Math.min(Math.max((c-a)/(b-a),0),1);return c*c*(3-2*c)}var d=Object.assign({},a);a=NGL.defaults(d.width,256);for(var e=NGL.defaults(d.height,256),f=[a/2,e/2],g=Math.min(a/2,e/2),d=NGL.defaults(d.delta,1/(g+1))*g,h=0,k=0,l=new Uint8Array(a*e*4),m=0,n=l.length;m<n;m+=4){var q=b(h,k,f[0],f[1]),q=1-c(g-d,g,q);l[m]=255*q;l[m+1]=255*q;l[m+2]=255*q;l[m+3]=255*q;++h===a&&(h=0,k++)}a=new THREE.DataTexture(l,
a,e);a.needsUpdate=!0;return a};
NGL.PointBuffer=function(a,b,c){c=c||{};this.point=!0;this.pointSize=void 0!==c.pointSize?c.pointSize:1;this.sizeAttenuation=void 0!==c.sizeAttenuation?c.sizeAttenuation:!0;this.sortParticles=void 0!==c.sortParticles?c.sortParticles:!1;this.alphaTest=void 0!==c.alphaTest?c.alphaTest:.5;this.useTexture=void 0!==c.useTexture?c.useTexture:!1;this.forceTransparent=void 0!==c.forceTransparent?c.forceTransparent:!1;this.edgeBleach=void 0!==c.edgeBleach?c.edgeBleach:0;this.attributeSize=this.size=a.length/
3;this.vertexShader="Point.vert";this.fragmentShader="Point.frag";NGL.Buffer.call(this,a,b,void 0,void 0,c);this.addUniforms({size:{type:"f",value:this.pointSize},canvasHeight:{type:"f",value:1},pixelRatio:{type:"f",value:1},map:{type:"t",value:null}})};NGL.PointBuffer.prototype=Object.create(NGL.Buffer.prototype);NGL.PointBuffer.prototype.constructor=NGL.PointBuffer;
NGL.PointBuffer.prototype.parameters=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{updateShader:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},NGL.Buffer.prototype.parameters);NGL.PointBuffer.prototype.makeMaterial=function(){NGL.Buffer.prototype.makeMaterial.call(this);this.makeTexture();this.material.uniforms.map.value=this.tex;this.material.blending=THREE.NormalBlending;this.material.needsUpdate=!0};
NGL.PointBuffer.prototype.makeTexture=function(){this.tex&&this.tex.dispose();this.tex=NGL.makePointTexture({delta:this.edgeBleach})};NGL.PointBuffer.prototype.getDefines=function(a){a=NGL.Buffer.prototype.getDefines.call(this,a);this.sizeAttenuation&&(a.USE_SIZEATTENUATION=1);this.useTexture&&(a.USE_MAP=1);0<this.alphaTest&&1>=this.alphaTest&&(a.ALPHATEST=this.alphaTest.toPrecision(2));return a};
NGL.PointBuffer.prototype.setUniforms=function(a){a&&void 0!==a.edgeBleach&&(this.makeTexture(),a.map=this.tex);NGL.Buffer.prototype.setUniforms.call(this,a)};NGL.PointBuffer.prototype.dispose=function(){NGL.Buffer.prototype.dispose.call(this);this.tex&&this.tex.dispose()};
NGL.LineBuffer=function(a,b,c,d,e){e=e||{};this.size=a.length/3;this.vertexShader="Line.vert";this.fragmentShader="Line.frag";this.line=!0;var f=4*this.size;this.attributeSize=f;this.linePosition=new Float32Array(3*f);this.lineColor=new Float32Array(3*f);NGL.Buffer.call(this,this.linePosition,this.lineColor,void 0,void 0,e);this.setAttributes({from:a,to:b,color:c,color2:d})};NGL.LineBuffer.prototype=Object.create(NGL.Buffer.prototype);NGL.LineBuffer.prototype.constructor=NGL.LineBuffer;
NGL.LineBuffer.prototype.setAttributes=function(a){var b,c,d,e,f,g,h=this.geometry.attributes;a.from&&a.to&&(b=a.from,c=a.to,f=h.position.array,h.position.needsUpdate=!0);a.color&&a.color2&&(d=a.color,e=a.color2,g=h.color.array,h.color.needsUpdate=!0);a=this.size;for(var h=6*a,k,l,m,n,q,p,r,s,u,v,w,x,t=0;t<a;t++)l=3*t,k=6*t,m=k+h,b&&c&&(r=b[l],s=b[l+1],u=b[l+2],v=c[l],w=c[l+1],x=c[l+2],n=(r+v)/2,q=(s+w)/2,p=(u+x)/2,f[k]=r,f[k+1]=s,f[k+2]=u,f[k+3]=n,f[k+4]=q,f[k+5]=p,f[m]=n,f[m+1]=q,f[m+2]=p,f[m+3]=
v,f[m+4]=w,f[m+5]=x),d&&e&&(g[k]=g[k+3]=d[l],g[k+1]=g[k+4]=d[l+1],g[k+2]=g[k+5]=d[l+2],g[m]=g[m+3]=e[l],g[m+1]=g[m+4]=e[l+1],g[m+2]=g[m+5]=e[l+2])};
NGL.TraceBuffer=function(a,b,c){c=c||{};this.size=a.length/3;this.vertexShader="Line.vert";this.fragmentShader="Line.frag";this.line=!0;var d=this.size-1;this.attributeSize=2*d;this.linePosition=new Float32Array(6*d);this.lineColor=new Float32Array(6*d);NGL.Buffer.call(this,this.linePosition,this.lineColor,void 0,void 0,c);this.setAttributes({position:a,color:b})};NGL.TraceBuffer.prototype=Object.create(NGL.Buffer.prototype);NGL.TraceBuffer.prototype.constructor=NGL.TraceBuffer;
NGL.TraceBuffer.prototype.setAttributes=function(a){var b,c,d,e,f=this.geometry.attributes;a.position&&(b=a.position,d=f.position.array,f.position.needsUpdate=!0);a.color&&(c=a.color,e=f.color.array,f.color.needsUpdate=!0);if(b||c)for(var g=this.size-1,h=0;h<g;++h)a=3*h,f=6*h,b&&(d[f]=b[a],d[f+1]=b[a+1],d[f+2]=b[a+2],d[f+3]=b[a+3],d[f+4]=b[a+4],d[f+5]=b[a+5]),c&&(e[f]=c[a],e[f+1]=c[a+1],e[f+2]=c[a+2],e[f+3]=c[a+3],e[f+4]=c[a+4],e[f+5]=c[a+5]);else NGL.warn("NGL.TraceBuffer.prototype.setAttributes no data")};
NGL.RibbonBuffer=function(a,b,c,d,e,f,g){g=g||{};var h=4*(a.length/3-1),k=3*h;this.meshPosition=new Float32Array(k);this.meshColor=new Float32Array(k);this.meshNormal=new Float32Array(k);this.meshPickingColor=f?new Float32Array(k):void 0;this.meshIndex=new (65535<this.meshPosition.length/3?Uint32Array:Uint16Array)(k);this.makeIndex();NGL.MeshBuffer.call(this,this.meshPosition,this.meshColor,this.meshIndex,this.meshNormal,this.meshPickingColor,g);this.vertexShader="Ribbon.vert";this.fragmentShader=
"Mesh.frag";this.geometry.addAttribute("dir",new THREE.BufferAttribute(new Float32Array(k),3));this.geometry.addAttribute("size",new THREE.BufferAttribute(new Float32Array(h),1));this.setAttributes({position:a,normal:b,dir:c,color:d,size:e,pickingColor:f})};NGL.RibbonBuffer.prototype=Object.create(NGL.MeshBuffer.prototype);NGL.RibbonBuffer.prototype.constructor=NGL.RibbonBuffer;
NGL.RibbonBuffer.prototype.setAttributes=function(a){var b=this.size/4,c=this.geometry.attributes,d,e,f,g,h,k,l,m,n,q,p,r;a.position&&(d=a.position,l=c.position.array,c.position.needsUpdate=!0);a.normal&&(e=a.normal,m=c.normal.array,c.normal.needsUpdate=!0);a.size&&(f=a.size,n=c.size.array,c.size.needsUpdate=!0);a.dir&&(g=a.dir,q=c.dir.array,c.dir.needsUpdate=!0);a.color&&(h=a.color,p=c.color.array,c.color.needsUpdate=!0);a.pickingColor&&(k=a.pickingColor,r=c.pickingColor.array,c.pickingColor.needsUpdate=
!0);var s,u,v,w,x=f?f[0]:null;for(a=0;a<b;++a){w=3*a;c=12*a;v=4*a;d&&(l[c]=l[c+3]=d[w],l[c+1]=l[c+4]=d[w+1],l[c+2]=l[c+5]=d[w+2],l[c+6]=l[c+9]=d[w+3],l[c+7]=l[c+10]=d[w+4],l[c+8]=l[c+11]=d[w+5]);e&&(m[c]=m[c+3]=-e[w],m[c+1]=m[c+4]=-e[w+1],m[c+2]=m[c+5]=-e[w+2],m[c+6]=m[c+9]=-e[w+3],m[c+7]=m[c+10]=-e[w+4],m[c+8]=m[c+11]=-e[w+5]);for(s=0;4>s;++s)u=c+3*s,h&&(p[u]=h[w],p[u+1]=h[w+1],p[u+2]=h[w+2]),k&&(r[u]=k[w],r[u+1]=k[w+1],r[u+2]=k[w+2]);f&&(s=f[a],x!==f[a]?(n[v]=x,n[v+1]=x):(n[v]=s,n[v+1]=s),n[v+2]=
s,x=n[v+3]=s);g&&(q[c]=g[w],q[c+1]=g[w+1],q[c+2]=g[w+2],q[c+3]=-g[w],q[c+4]=-g[w+1],q[c+5]=-g[w+2],q[c+6]=g[w+3],q[c+7]=g[w+4],q[c+8]=g[w+5],q[c+9]=-g[w+3],q[c+10]=-g[w+4],q[c+11]=-g[w+5])}};NGL.RibbonBuffer.prototype.makeIndex=function(){var a=this.meshIndex,b=a.length/4/3,c=new Uint16Array([0,1,2,1,3,2]),d,e,f,g;for(e=0;e<b;++e)for(f=6*e,g=4*e,a.set(c,f),d=0;6>d;++d)a[f+d]+=g};
NGL.TubeMeshBuffer=function(a,b,c,d,e,f,g,h){h=h||{};this.rx=void 0!==h.rx?h.rx:1.5;this.ry=void 0!==h.ry?h.ry:.5;this.radialSegments=void 0!==h.radialSegments?h.radialSegments:4;this.capVertices=(this.capped=void 0!==h.capped?h.capped:!1)?this.radialSegments:0;this.capTriangles=this.capped?this.radialSegments-2:0;var k=a.length/3,l=k-1,m=k*this.radialSegments*3+6*this.capVertices;this.size2=k;this.meshPosition=new Float32Array(m);this.meshColor=new Float32Array(m);this.meshNormal=new Float32Array(m);
this.meshPickingColor=g?new Float32Array(m):void 0;this.meshIndex=new (65535<this.meshPosition.length/3?Uint32Array:Uint16Array)(2*l*this.radialSegments*3+6*this.capTriangles);this.makeIndex();NGL.MeshBuffer.call(this,this.meshPosition,this.meshColor,this.meshIndex,this.meshNormal,this.meshPickingColor,h);this.setAttributes({position:a,normal:b,binormal:c,tangent:d,color:e,size:f,pickingColor:g})};NGL.TubeMeshBuffer.prototype=Object.create(NGL.MeshBuffer.prototype);
NGL.TubeMeshBuffer.prototype.constructor=NGL.TubeMeshBuffer;
NGL.TubeMeshBuffer.prototype.setAttributes=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){var d=this.rx,e=this.ry,f=this.size2,g=f-1,h=this.radialSegments,k=this.geometry.attributes,l,m,n,q,p,r,s,u,v,w,x;c.position&&(l=c.position,m=c.normal,n=c.binormal,q=c.tangent,r=c.size,u=k.position.array,w=k.normal.array,k.position.needsUpdate=!0,k.normal.needsUpdate=!0);c.color&&(p=c.color,v=k.color.array,k.color.needsUpdate=!0);c.pickingColor&&(s=c.pickingColor,x=k.pickingColor.array,
k.pickingColor.needsUpdate=!0);var t,z,y,A,B,L,C,P,M,W,K,aa,I,R,E,Y,X,O,k=[],Z=[],$=[],J=[],N=[],T=[];if(l)for(c=0;c<h;++c)z=c/h*2*Math.PI,k[c]=d*Math.cos(z),Z[c]=e*Math.sin(z),$[c]=d*Math.cos(z-.01),J[c]=e*Math.sin(z-.01),N[c]=d*Math.cos(z+.01),T[c]=e*Math.sin(z+.01);for(t=0;t<f;++t)for(d=3*t,e=d*h,l&&(a.set(q[d],q[d+1],q[d+2]),W=m[d],K=m[d+1],aa=m[d+2],I=n[d],R=n[d+1],E=n[d+2],Y=l[d],X=l[d+1],O=l[d+2],M=r[t]),c=0;c<h;++c)z=e+3*c,l&&(y=-M*k[c],A=M*Z[c],B=-M*$[c],L=M*J[c],C=-M*N[c],P=M*T[c],u[z]=
Y+y*W+A*I,u[z+1]=X+y*K+A*R,u[z+2]=O+y*aa+A*E,b.set(C*W+P*I-(B*W+L*I),C*K+P*R-(B*K+L*R),C*aa+P*E-(B*aa+L*E)).cross(a),w[z]=b.x,w[z+1]=b.y,w[z+2]=b.z),p&&(v[z]=p[d],v[z+1]=p[d+1],v[z+2]=p[d+2]),s&&(x[z]=s[d],x[z+1]=s[d+1],x[z+2]=s[d+2]);d=0;e=3*f*h;for(c=0;c<h;++c)z=d+3*c,m=e+3*c,l&&(u[m]=u[z],u[m+1]=u[z+1],u[m+2]=u[z+2],w[m]=q[d],w[m+1]=q[d+1],w[m+2]=q[d+2]),p&&(v[m]=v[z],v[m+1]=v[z+1],v[m+2]=v[z+2]),s&&(x[m]=x[z],x[m+1]=x[z+1],x[m+2]=x[z+2]);d=3*(f-1)*h;e=3*(f+1)*h;for(c=0;c<h;++c)z=d+3*c,m=e+3*c,
l&&(u[m]=u[z],u[m+1]=u[z+1],u[m+2]=u[z+2],w[m]=q[3*g],w[m+1]=q[3*g+1],w[m+2]=q[3*g+2]),p&&(v[m]=v[z],v[m+1]=v[z+1],v[m+2]=v[z+2]),s&&(x[m]=x[z],x[m+1]=x[z+1],x[m+2]=x[z+2])}}();
NGL.TubeMeshBuffer.prototype.makeIndex=function(){var a=this.meshIndex,b=this.size2,c=b-1,d=this.capTriangles,e=this.radialSegments,f=this.radialSegments+1,g,h,k,l,m,n;for(g=0;g<c;++g)for(h=g*e*6,k=g*e,l=(g+1)*e,n=0;n<e;++n)m=h+6*n,a[m]=k+n,a[m+1]=k+(n+1)%e,a[m+2]=l+n,a[m+3]=l+n,a[m+4]=k+(n+1)%e,a[m+5]=l+(n+1)%e;g=[0];for(n=1;n<f/2;++n)g.push(n),e-n!==n&&g.push(e-n);m=c*e*6;h=b*e;for(n=0;n<g.length-2;++n)0===n%2?(a[m+3*n+0]=h+g[n+0],a[m+3*n+1]=h+g[n+1],a[m+3*n+2]=h+g[n+2]):(a[m+3*n+0]=h+g[n+2],a[m+
3*n+1]=h+g[n+1],a[m+3*n+2]=h+g[n+0]);m=c*e*6+3*d;h=b*e+e;for(n=0;n<g.length-2;++n)0===n%2?(a[m+3*n+0]=h+g[n+0],a[m+3*n+1]=h+g[n+1],a[m+3*n+2]=h+g[n+2]):(a[m+3*n+0]=h+g[n+2],a[m+3*n+1]=h+g[n+1],a[m+3*n+2]=h+g[n+0])};NGL.SurfaceBuffer=function(){NGL.MeshBuffer.apply(this,arguments)};NGL.SurfaceBuffer.prototype=Object.create(NGL.MeshBuffer.prototype);NGL.SurfaceBuffer.prototype.constructor=NGL.SurfaceBuffer;
NGL.SphereBuffer=function(a,b,c,d,e,f){return!NGL.extensionFragDepth||f?new NGL.SphereGeometryBuffer(a,b,c,d,e):new NGL.SphereImpostorBuffer(a,b,c,d,e)};NGL.CylinderBuffer=function(a,b,c,d,e,f,g,h,k){return!NGL.extensionFragDepth||k?new NGL.CylinderGeometryBuffer(a,b,c,d,e,f,g,h):new NGL.CylinderImpostorBuffer(a,b,c,d,e,f,g,h)};
NGL.HyperballStickBuffer=function(a,b,c,d,e,f,g,h,k,l){return!NGL.extensionFragDepth||l?new NGL.CylinderGeometryBuffer(a,b,c,d,NGL.Utils.calculateMinArray(e,f),g,h,k):new NGL.HyperballStickImpostorBuffer(a,b,c,d,e,f,g,h,k)};
NGL.TextAtlas=function(a){a=Object.assign({},a);this.font=void 0!==a.font?a.font:["sans-serif"];this.size=a.size||36;this.style=void 0!==a.style?a.style:"normal";this.variant=void 0!==a.variant?a.variant:"normal";this.weight=void 0!==a.weight?a.weight:"normal";this.outline=void 0!==a.outline?a.outline:0;this.width=a.width||1024;this.height=a.height||1024;this.gamma=1;if("undefined"!==typeof navigator){var b=navigator.userAgent;b.match(/Chrome/)&&b.match(/OS X/)&&(this.gamma=.5)}this.mapped={};this.currentY=
this.currentX=this.scratchH=this.scratchW=0;this.build(a)};
NGL.TextAtlas.prototype={build:function(a){a=this.size+2*this.outline+Math.round(this.size/4);var b=this.width/4,c=document.createElement("canvas");c.width=b;c.height=a;this.font.map(function(a){return'"'+a.replace(/(['"\\])/g,"\\$1")+'"'}).join(", ");var d=c.getContext("2d");d.font=this.style+" "+this.variant+" "+this.weight+" "+this.size+"px "+this.font;d.fillStyle="#FF0000";d.textAlign="left";d.textBaseline="bottom";d.lineJoin="round";for(var e=[],f=3*this.outline,g=0;g<f;++g){var h=("00"+Math.max(0,
8*-g+128-8*!g).toString(16)).slice(-2);e.push("#"+h+h+h)}f=new Uint8Array(b*a*2);this.canvas=c;this.context=d;this.lineHeight=a;this.maxWidth=b;this.colors=e;this.scratch=f;this.data=new Uint8Array(this.width*this.height*4);this.canvas2=document.createElement("canvas");this.canvas2.width=this.width;this.canvas2.height=this.height;this.context2=this.canvas2.getContext("2d")},map:function(a){void 0===this.mapped[a]&&(this.draw(a),this.currentX+this.scratchW>this.width&&(this.currentX=0,this.currentY+=
this.scratchH),this.currentY+this.scratchH>this.height&&console.warn("canvas to small"),this.mapped[a]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW);return this.mapped[a]},draw:function(a){var b=this.lineHeight,c=this.outline,d=this.context,e=this.scratch,f=this.maxWidth,g=this.colors,h=b-this.outline,k=d.measureText(a),f=Math.min(f,
Math.ceil(k.width+2*c+1));d.clearRect(0,0,f,b);if(0===this.outline){d.fillText(a,c,h);a=d.getImageData(0,0,f,b);for(var c=a.data,k=3,l=0,g=c.length/4;l<g;++l)e[l]=c[k],k+=4}else{d.globalCompositeOperation="source-over";for(l=c+1;0<l;--l)k=1<l?2*l-2:l,d.strokeStyle=g[k-1],d.lineWidth=k,d.strokeText(a,c,h);d.globalCompositeOperation="multiply";d.fillStyle="#FF00FF";d.fillText(a,c,h);a=d.getImageData(0,0,f,b);c=a.data;k=0;h=this.gamma;l=0;for(g=c.length/4;l<g;++l){var m=c[k],n=m?c[k+1]/m:1;.5===h&&(n=
Math.sqrt(n));var n=Math.min(1,Math.max(0,n)),q=256-m;e[l]=Math.max(0,Math.min(255,q+(m-q)*n+2));c[k+3]=e[l];k+=4}}d.putImageData(a,0,0);this.scratchW=f;this.scratchH=b},dispose:function(){}};
NGL.TextBuffer=function(a,b,c,d,e){e=e||{};e.forceTransparent=!0;this.fontFamily=void 0!==e.fontFamily?e.fontFamily:"sans-serif";this.fontStyle=void 0!==e.fontStyle?e.fontStyle:"normal";this.fontWeight=void 0!==e.fontWeight?e.fontWeight:"bold";this.fontSize=void 0!==e.fontSize?e.fontSize:48;this.sdf=void 0!==e.sdf?e.sdf:!0;for(var f=a.length/3,g=0,h=0;h<f;++h)g+=d[h].length;this.text=d;this.count=g;this.positionCount=f;this.vertexShader="SDFFont.vert";this.fragmentShader="SDFFont.frag";NGL.QuadBuffer.call(this,
e);this.addUniforms({fontTexture:{type:"t",value:null}});this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}});this.setAttributes({position:a,size:b,color:c});this.makeTexture();this.makeMapping()};NGL.TextBuffer.prototype=Object.create(NGL.QuadBuffer.prototype);NGL.TextBuffer.prototype.constructor=NGL.TextBuffer;
NGL.TextBuffer.prototype.parameters=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},sdf:{updateShader:!0,uniform:!0}},NGL.Buffer.prototype.parameters);NGL.TextBuffer.prototype.makeMaterial=function(){NGL.Buffer.prototype.makeMaterial.call(this);this.material.extensions.derivatives=!0;this.material.lights=!1;this.material.uniforms.fontTexture.value=this.tex;this.material.needsUpdate=!0};
NGL.TextBuffer.prototype.setAttributes=function(a){var b,c,d,e,f,g,h=this.text,k=this.geometry.attributes;a.position&&(b=a.position,e=k.position.array,k.position.needsUpdate=!0);a.size&&(c=a.size,f=k.inputSize.array,k.inputSize.needsUpdate=!0);a.color&&(d=a.color,g=k.color.array,k.color.needsUpdate=!0);a=this.positionCount;for(var l,m=0,n,q,p=0;p<a;p++)for(k=3*p,l=h[p],q=l.length,n=0;n<q;n++,m++)for(var r=0;4>r;r++)l=12*m+3*r,b&&(e[l]=b[k],e[l+1]=b[k+1],e[l+2]=b[k+2]),c&&(f[4*m+r]=c[p]),d&&(g[l]=
d[k],g[l+1]=d[k+1],g[l+2]=d[k+2])};NGL.TextBuffer.prototype.makeTexture=function(){this.tex&&this.tex.dispose();this.ta&&this.ta.dispose();for(var a=new NGL.TextAtlas({font:[this.fontFamily],style:this.fontStyle,weight:this.fontWeight,size:this.fontSize,outline:this.sdf?5:0}),b=0;256>b;++b)a.map(String.fromCharCode(b));this.ta=a;this.tex=new THREE.CanvasTexture(a.canvas2);this.tex.flipY=!1;this.tex.needsUpdate=!0};
NGL.TextBuffer.prototype.makeMapping=function(){for(var a=this.ta,b=this.text,c=this.geometry.attributes.inputTexCoord.array,d=this.geometry.attributes.mapping.array,e=this.positionCount,f,g,h=0,k,l,m,n,q=0;q<e;q++)for(k=b[q],l=0,n=k.length,m=0;m<n;m++,h++){f=a.mapped[k[m]];g=8*h;d[g+0]=l-a.outline;d[g+1]=f.h-a.outline;d[g+2]=l-a.outline;d[g+3]=0-a.outline;d[g+4]=l+f.w-a.outline;d[g+5]=f.h-a.outline;d[g+6]=l+f.w-a.outline;d[g+7]=0-a.outline;var p=a.width,r=a.height;c.set([f.x/p,f.y/r,f.x/p,(f.y+f.h)/
r,(f.x+f.w)/p,f.y/r,(f.x+f.w)/p,(f.y+f.h)/r],g);l+=f.w-2*a.outline}this.geometry.attributes.inputTexCoord.needsUpdate=!0;this.geometry.attributes.mapping.needsUpdate=!0};NGL.TextBuffer.prototype.getDefines=function(a){a=NGL.Buffer.prototype.getDefines.call(this,a);this.sdf&&(a.SDF=1);return a};
NGL.TextBuffer.prototype.setUniforms=function(a){!a||void 0===a.fontFamily&&void 0===a.fontStyle&&void 0===a.fontWeight&&void 0===a.fontSize&&void 0===a.sdf||(this.makeTexture(),this.makeMapping(),a.fontTexture=this.tex);NGL.Buffer.prototype.setUniforms.call(this,a)};NGL.TextBuffer.prototype.dispose=function(){NGL.Buffer.prototype.dispose.call(this);this.tex&&this.tex.dispose();this.ta&&this.ta.dispose()};
NGL.VectorBuffer=function(a,b,c){c=c||{};this.size=a.length/3;this.vertexShader="Line.vert";this.fragmentShader="Line.frag";this.line=!0;var d=2*this.size;this.attributeSize=d;this.scale=c.scale||1;var e=new THREE.Color(c.color||"grey");this.linePosition=new Float32Array(3*d);this.lineColor=NGL.Utils.uniformArray3(d,e.r,e.g,e.b);NGL.Buffer.call(this,this.linePosition,this.lineColor,void 0,void 0,c);this.setAttributes({position:a,vector:b})};NGL.VectorBuffer.prototype=Object.create(NGL.Buffer.prototype);
NGL.VectorBuffer.prototype.constructor=NGL.VectorBuffer;NGL.VectorBuffer.prototype.setAttributes=function(a){var b=this.geometry.attributes,c,d,e;a.position&&a.vector&&(c=a.position,d=a.vector,e=b.position.array,b.position.needsUpdate=!0);var b=this.size,f=this.scale,g;if(a.position&&a.vector)for(var h=0;h<b;h++)a=6*h,g=3*h,e[a+0]=c[g+0],e[a+1]=c[g+1],e[a+2]=c[g+2],e[a+3]=c[g+0]+d[g+0]*f,e[a+4]=c[g+1]+d[g+1]*f,e[a+5]=c[g+2]+d[g+2]*f};NGL.SideTypes={};NGL.SideTypes[THREE.FrontSide]="front";
NGL.SideTypes[THREE.BackSide]="back";NGL.SideTypes[THREE.DoubleSide]="double";
NGL.makeRepresentation=function(a,b,c,d){NGL.debug&&NGL.time("NGL.makeRepresentation "+a);var e;if("buffer"===a)e=NGL.BufferRepresentation;else if(b instanceof NGL.Structure){if(e=NGL.representationTypes[a],!e){NGL.error("NGL.makeRepresentation: representation type "+a+" unknown");return}}else if(b instanceof NGL.Surface||b instanceof NGL.Volume)if("surface"===a)e=NGL.SurfaceRepresentation;else if("dot"===a)e=NGL.DotRepresentation;else{NGL.error("NGL.makeRepresentation: representation type "+a+" unknown");
return}else if(b instanceof NGL.Trajectory)e=NGL.TrajectoryRepresentation;else{NGL.error("NGL.makeRepresentation: object "+b+" unknown");return}b=new e(b,c,d);NGL.debug&&NGL.timeEnd("NGL.makeRepresentation "+a);return b};NGL.Representation=function(a,b,c){this.viewer=b;this.queue=new NGL.Queue(this.make.bind(this));this.tasks=new NGL.Counter;this.bufferList=[];this.init(c)};
NGL.Representation.prototype={constructor:NGL.Representation,type:"",parameters:{clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},side:{type:"select",options:NGL.SideTypes,buffer:!0,int:!0},wireframe:{type:"boolean",buffer:!0},linewidth:{type:"integer",max:50,min:1,buffer:!0},colorScheme:{type:"select",update:"color",options:NGL.ColorMakerRegistry.getTypes()},colorScale:{type:"select",update:"color",
options:NGL.ColorMakerRegistry.getScales()},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:NGL.ColorMakerRegistry.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0}},init:function(a){a=a||{};this.clipNear=void 0!==a.clipNear?a.clipNear:0;this.flatShaded=a.flatShaded||!1;this.side=void 0!==a.side?a.side:THREE.DoubleSide;
this.opacity=void 0!==a.opacity?a.opacity:1;this.wireframe=a.wireframe||!1;this.linewidth=a.linewidth||2;this.setColor(a.color,a);this.colorScheme=a.colorScheme||"uniform";this.colorScale=a.colorScale||"";this.colorValue=a.colorValue||9474192;this.colorDomain=a.colorDomain||"";this.colorMode=a.colorMode||"hcl";this.visible=void 0!==a.visible?a.visible:!0;this.quality=a.quality;this.roughness=void 0!==a.roughness?a.roughness:.4;this.metalness=void 0!==a.metalness?a.metalness:0;this.diffuse=void 0!==
a.diffuse?a.diffuse:16777215},getColorParams:function(){return{scheme:this.colorScheme,scale:this.colorScale,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode}},getBufferParams:function(a){return Object.assign({clipNear:this.clipNear,flatShaded:this.flatShaded,opacity:this.opacity,side:this.side,wireframe:this.wireframe,linewidth:this.linewidth,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse},a)},setColor:function(a,b){-1!==Object.keys(NGL.ColorMakerRegistry.getTypes()).indexOf(a)?
b?b.colorScheme=a:this.setParameters({colorScheme:a}):void 0!==a&&(a=(new THREE.Color(a)).getHex(),b?(b.colorScheme="uniform",b.colorValue=a):this.setParameters({colorScheme:"uniform",colorValue:a}));return this},prepare:!1,create:function(){},update:function(){this.build()},build:function(a){this.prepare?(0<this.queue.length()?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),a||(a=this.getParameters(),delete a.quality),this.queue.push(a)):(a||(a=this.getParameters(),
delete a.quality),this.tasks.increment(),this.make(a,function(){}))},make:function(a,b){NGL.debug&&NGL.time("NGL.Representation.make "+this.type);a&&!a.__update&&this.init(a);var c=function(){a.__update?(this.update(a.__update),this.viewer.requestRender(),this.tasks.decrement(),b()):(this.clear(),this.create(),this.manualAttach||this.disposed||(NGL.debug&&NGL.time("NGL.Representation.attach "+this.type),this.attach(function(){NGL.debug&&NGL.timeEnd("NGL.Representation.attach "+this.type);this.tasks.decrement();
b()}.bind(this))));NGL.debug&&NGL.timeEnd("NGL.Representation.make "+this.type)}.bind(this);this.prepare?this.prepare(c):c()},attach:function(a){this.setVisibility(this.visible);a()},setVisibility:function(a,b){this.visible=a;this.bufferList.forEach(function(b){b.setVisibility(a)});b||this.viewer.requestRender();return this},setParameters:function(a,b,c){a=a||{};var d=this.parameters;b=b||{};c=c||!1;var e={},f;for(f in a)void 0!==a[f]&&void 0!==d[f]&&(d[f].int&&(a[f]=parseInt(a[f])),d[f].float&&(a[f]=
parseFloat(a[f])),a[f]!==this[f]&&(this[f]=a[f],d[f].buffer&&(!0===d[f].buffer?e[f]=a[f]:e[d[f].buffer]=a[f]),d[f].update&&(b[d[f].update]=!0),!d[f].rebuild||"impostor"===d[f].rebuild&&NGL.extensionFragDepth&&!this.disableImpostor||(c=!0)));c?this.build():(this.bufferList.forEach(function(a){a.setParameters(e)}),Object.keys(b).length&&this.update(b),this.viewer.requestRender());return this},getParameters:function(){var a={visible:this.visible,sele:this.selection?this.selection.string:void 0,disableImpostor:this.disableImpostor,
quality:this.quality};Object.keys(this.parameters).forEach(function(b){a[b]=this[b]},this);return a},clear:function(){this.bufferList.forEach(function(a){this.viewer.remove(a);a.dispose()},this);this.bufferList.length=0;this.viewer.requestRender()},dispose:function(){this.disposed=!0;this.queue.kill();this.tasks.dispose();this.clear()}};NGL.BufferRepresentation=function(a,b,c){NGL.Representation.call(this,a,b,c);this.buffer=a;this.build()};
NGL.BufferRepresentation.prototype=NGL.createObject(NGL.Representation.prototype,{constructor:NGL.BufferRepresentation,type:"buffer",parameters:Object.assign({},NGL.Representation.prototype.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),create:function(){this.bufferList.push(this.buffer)},attach:function(a){this.bufferList.forEach(function(a){this.viewer.add(a)},this);this.setVisibility(this.visible);a()}});
NGL.StructureRepresentation=function(a,b,c){this.dataList=[];this.structure=a;this.selection=new NGL.Selection(c.sele);this.structureView=this.structure.getView(this.selection);NGL.Representation.call(this,a,b,c);if(a.biomolDict){var d={__AU:"AU"};Object.keys(a.biomolDict).forEach(function(a){d[a]=a});d[""]="";this.parameters.assembly={type:"select",options:d,rebuild:!0}}else this.parameters.assembly=null;this.selection.signals.stringChanged.add(function(){this.build()}.bind(this));this.build()};
NGL.StructureRepresentation.prototype=NGL.createObject(NGL.Representation.prototype,{constructor:NGL.StructureRepresentation,type:"structure",parameters:Object.assign({radiusType:{type:"select",options:NGL.RadiusFactory.types},radius:{type:"number",precision:3,max:10,min:.001},scale:{type:"number",precision:3,max:10,min:.001},assembly:null},NGL.Representation.prototype.parameters),defaultScale:{vdw:1,covalent:1,bfactor:.01,sstruc:1},defaultSize:1,init:function(a){a=a||{};a.colorScheme=a.colorScheme||
"element";this.radius=a.radius||"vdw";this.scale=a.scale||1;this.assembly=a.assembly||"";NGL.Representation.prototype.init.call(this,a)},create:function(){if(0!==this.structureView.atomCount){var a=this.structure.biomolDict[this.assembly||this.structure.defaultAssembly];if(a)a.partList.forEach(function(a,c){var d=a.getView(this.structureView);if(0!==d.atomCount){var e=this.createData(d,c);e&&(e.sview=d,e.instanceList=a.getInstanceList(),this.dataList.push(e))}},this);else if(a=this.createData(this.structureView,
0))a.sview=this.structureView,this.dataList.push(a)}},createData:function(a){console.error("createData not implemented")},update:function(a){this.dataList.forEach(function(b){0<b.bufferList.length&&this.updateData(a,b)},this)},updateData:function(a,b){console.error("updateData not implemented")},getColorParams:function(){var a=NGL.Representation.prototype.getColorParams.call(this);a.structure=this.structure;return a},getAtomParams:function(a,b){return Object.assign({what:a,colorParams:this.getColorParams(),
radiusParams:{radius:this.radius,scale:this.scale}},b)},getBondParams:function(a,b){return Object.assign({what:a,colorParams:this.getColorParams(),radiusParams:{radius:this.radius,scale:this.scale}},b)},setSelection:function(a,b){this.selection.setString(a,b);return this},setParameters:function(a,b,c){b=b||{};a&&void 0!==a.radiusType&&(this.radius="size"===a.radiusType?this.defaultSize:a.radiusType,b.radius=!0,!NGL.extensionFragDepth||this.disableImpostor)&&(c=!0);a&&void 0!==a.radius&&(b.radius=
!0,!NGL.extensionFragDepth||this.disableImpostor)&&(c=!0);a&&void 0!==a.scale&&(b.radius=!0,!NGL.extensionFragDepth||this.disableImpostor)&&(c=!0);NGL.Representation.prototype.setParameters.call(this,a,b,c);return this},attach:function(a){var b=this.viewer,c=this.bufferList;this.dataList.forEach(function(a){a.bufferList.forEach(function(e){c.push(e);b.add(e,a.instanceList)})});this.setVisibility(this.visible);a()},clear:function(){this.dataList.length=0;NGL.Representation.prototype.clear.call(this)},
dispose:function(){this.structureView.dispose();delete this.structure;delete this.structureView;NGL.Representation.prototype.dispose.call(this)}});NGL.SpacefillRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.SpacefillRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.SpacefillRepresentation,type:"spacefill",parameters:Object.assign({sphereDetail:{type:"integer",max:3,min:0,rebuild:"impostor"}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};this.disableImpostor=a.disableImpostor||!1;this.sphereDetail="low"===a.quality?0:"medium"===a.quality?1:"high"===a.quality?2:void 0!==a.sphereDetail?a.sphereDetail:1;NGL.StructureRepresentation.prototype.init.call(this,
a)},createData:function(a){a=a.getAtomData(this.getAtomParams());return{bufferList:[new NGL.SphereBuffer(a.position,a.color,a.radius,a.pickingColor,this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0}),this.disableImpostor)]}},updateData:function(a,b){var c=b.sview.getAtomData(this.getAtomParams(a)),d={};if(!a||a.position)d.position=c.position;if(!a||a.color)d.color=c.color;if(!a||a.radius)d.radius=c.radius;b.bufferList[0].setAttributes(d)}});
NGL.PointRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.PointRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.PointRepresentation,type:"point",parameters:Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},
NGL.Representation.prototype.parameters,{flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null}),init:function(a){a=a||{};this.pointSize=a.pointSize||1;this.sizeAttenuation=void 0!==a.sizeAttenuation?a.sizeAttenuation:!0;this.sortParticles=void 0!==a.sortParticles?a.sortParticles:!1;this.useTexture=void 0!==a.useTexture?a.useTexture:!1;this.alphaTest=void 0!==a.alphaTest?a.alphaTest:.5;this.forceTransparent=void 0!==a.forceTransparent?a.forceTransparent:!1;this.edgeBleach=void 0!==
a.edgeBleach?a.edgeBleach:0;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){a=a.getAtomData(this.getAtomParams({position:!0,color:!0}));return{bufferList:[new NGL.PointBuffer(a.position,a.color,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}},updateData:function(a,b){var c=b.sview.getAtomData(this.getAtomParams(a)),
d={};if(!a||a.position)d.position=c.position;if(!a||a.color)d.color=c.color;b.bufferList[0].setAttributes(d)}});NGL.LabelRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.LabelRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.LabelRepresentation,type:"label",parameters:Object.assign({labelType:{type:"select",options:NGL.LabelFactory.types,rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},sdf:{type:"boolean",
buffer:!0}},NGL.StructureRepresentation.prototype.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),init:function(a){a=a||{};this.labelType=a.labelType||"res";this.labelText=a.labelText||{};this.fontFamily=a.fontFamily||"sans-serif";this.fontStyle=a.fontStyle||"normal";this.fontWeight=a.fontWeight||"bold";this.sdf=void 0!==a.sdf?a.sdf:"Firefox"!==NGL.browser;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){var b=
a.getAtomData(this.getAtomParams({position:!0,color:!0,radius:!0})),c=[],d=new NGL.LabelFactory(this.labelType,this.labelText);a.eachAtom(function(a){c.push(d.atomLabel(a))});return{bufferList:[new NGL.TextBuffer(b.position,b.radius,b.color,c,this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,sdf:this.sdf}))]}},updateData:function(a,b){var c=b.sview.getAtomData(this.getAtomParams(a)),d={};if(!a||a.position)d.position=c.position;if(!a||a.radius)d.size=
c.radius;if(!a||a.color)d.color=c.color;b.bufferList[0].setAttributes(d)}});NGL.BallAndStickRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.BallAndStickRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.BallAndStickRepresentation,type:"ball+stick",defaultSize:.15,parameters:Object.assign({sphereDetail:{type:"integer",max:3,min:0,rebuild:"impostor"},radiusSegments:{type:"integer",max:25,min:5,rebuild:"impostor"},aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};a.radius=a.radius||
this.defaultSize;this.disableImpostor=a.disableImpostor||!1;"low"===a.quality?(this.sphereDetail=0,this.radiusSegments=5):"medium"===a.quality?(this.sphereDetail=1,this.radiusSegments=10):"high"===a.quality?(this.sphereDetail=2,this.radiusSegments=20):(this.sphereDetail=void 0!==a.sphereDetail?a.sphereDetail:1,this.radiusSegments=void 0!==a.radiusSegments?a.radiusSegments:10);this.aspectRatio=a.aspectRatio||2;this.lineOnly=a.lineOnly||!1;NGL.StructureRepresentation.prototype.init.call(this,a)},getAtomParams:function(a,
b){b=Object.assign({radiusParams:{radius:this.radius,scale:this.scale*this.aspectRatio}},b);return NGL.StructureRepresentation.prototype.getAtomParams.call(this,a,b)},getAtomData:function(a,b,c){return a.getAtomData(this.getAtomParams(b,c))},getBondData:function(a,b,c){return a.getBondData(this.getBondParams(b,c))},createData:function(a){var b=[];if(this.lineOnly){var c=this.getBondData(a);this.lineBuffer=new NGL.LineBuffer(c.position1,c.position2,c.color1,c.color2,this.getBufferParams());b.push(this.lineBuffer)}else{var d=
this.getAtomData(a),c=this.getBondData(a),d=new NGL.SphereBuffer(d.position,d.color,d.radius,d.pickingColor,this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0}),this.disableImpostor);this.__center=new Float32Array(3*a.bondCount);a=new NGL.CylinderBuffer(c.position1,c.position2,c.color1,c.color2,c.radius,c.pickingColor1,c.pickingColor2,this.getBufferParams({shift:0,cap:!0,radiusSegments:this.radiusSegments,dullInterior:!0}),this.disableImpostor);b.push(d,a)}return{bufferList:b}},
updateData:function(a,b){if(this.lineOnly){var c=this.getBondData(b.sview,a),d={};if(!a||a.position)d.from=c.position1,d.to=c.position2;if(!a||a.color)d.color=c.color1,d.color2=c.color2;b.bufferList[0].setAttributes(d)}else{var d=this.getAtomData(b.sview,a),c=this.getBondData(b.sview,a),e={},f={};if(!a||a.position){e.position=d.position;var g=c.position1,h=c.position2;f.position=NGL.Utils.calculateCenterArray(g,h,this.__center);f.position1=g;f.position2=h}if(!a||a.color)e.color=d.color,f.color=c.color1,
f.color2=c.color2;if(!a||a.radius)e.radius=d.radius,f.radius=c.radius;b.bufferList[0].setAttributes(e);b.bufferList[1].setAttributes(f)}},setParameters:function(a){var b=!1,c={};a&&a.aspectRatio&&(c.radius=!0,!NGL.extensionFragDepth||this.disableImpostor)&&(b=!0);NGL.StructureRepresentation.prototype.setParameters.call(this,a,c,b);return this}});NGL.LicoriceRepresentation=function(a,b,c){NGL.BallAndStickRepresentation.call(this,a,b,c)};
NGL.LicoriceRepresentation.prototype=NGL.createObject(NGL.BallAndStickRepresentation.prototype,{constructor:NGL.LicoriceRepresentation,type:"licorice",parameters:Object.assign({},NGL.BallAndStickRepresentation.prototype.parameters,{aspectRatio:null}),init:function(a){a=a||{};a.aspectRatio=1;NGL.BallAndStickRepresentation.prototype.init.call(this,a)}});NGL.LineRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.LineRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.LineRepresentation,type:"line",parameters:Object.assign({},NGL.Representation.prototype.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null,diffuse:null}),init:function(a){a=a||{};this.linewidth=a.linewidth||1;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){a=a.getBondData(this.getBondParams({position:!0,color:!0}));return{bufferList:[new NGL.LineBuffer(a.position1,
a.position2,a.color1,a.color2,this.getBufferParams())]}},updateData:function(a,b){var c=b.sview.getBondData(this.getBondParams(a)),d={};if(!a||a.position)d.from=c.position1,d.to=c.position2;if(!a||a.color)d.color=c.color1,d.color2=c.color2;b.bufferList[0].setAttributes(d)}});NGL.HyperballRepresentation=function(a,b,c){NGL.LicoriceRepresentation.call(this,a,b,c);this.defaultScale.vdw=.2};
NGL.HyperballRepresentation.prototype=NGL.createObject(NGL.LicoriceRepresentation.prototype,{constructor:NGL.HyperballRepresentation,type:"hyperball",defaultSize:1,parameters:Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},NGL.LicoriceRepresentation.prototype.parameters),init:function(a){a=a||{};a.scale=a.scale||.2;a.radius=a.radius||"vdw";this.shrink=a.shrink||.12;NGL.LicoriceRepresentation.prototype.init.call(this,a)},getBondParams:function(a,b){if(!a||a.radius)b=Object.assign({radius2:!0},
b);return NGL.LicoriceRepresentation.prototype.getBondParams.call(this,a,b)},createData:function(a){var b=a.getAtomData(this.getAtomParams()),c=a.getBondData(this.getBondParams()),b=new NGL.SphereBuffer(b.position,b.color,b.radius,b.pickingColor,this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0}),this.disableImpostor);this.__center=new Float32Array(3*a.bondCount);a=new NGL.HyperballStickBuffer(c.position1,c.position2,c.color1,c.color2,c.radius1,c.radius2,c.pickingColor1,c.pickingColor2,
this.getBufferParams({shrink:this.shrink,radiusSegments:this.radiusSegments,dullInterior:!0}),this.disableImpostor);return{bufferList:[b,a]}},updateData:function(a,b){var c=b.sview.getAtomData(this.getAtomParams()),d=b.sview.getBondData(this.getBondParams()),e={},f={};if(!a||a.position){e.position=c.position;var g=d.position1,h=d.position2;f.position=NGL.Utils.calculateCenterArray(g,h,this.__center);f.position1=g;f.position2=h}if(!a||a.color)e.color=c.color,f.color=d.color1,f.color2=d.color2;if(!a||
a.radius)e.radius=c.radius,f.radius=d.radius1,f.radius2=d.radius2;b.bufferList[0].setAttributes(e);b.bufferList[1].setAttributes(f)}});NGL.BackboneRepresentation=function(a,b,c){NGL.BallAndStickRepresentation.call(this,a,b,c)};
NGL.BackboneRepresentation.prototype=NGL.createObject(NGL.BallAndStickRepresentation.prototype,{constructor:NGL.BackboneRepresentation,type:"backbone",defaultSize:.25,parameters:Object.assign({},NGL.BallAndStickRepresentation.prototype.parameters),init:function(a){a=a||{};a.aspectRatio=a.aspectRatio||1;NGL.BallAndStickRepresentation.prototype.init.call(this,a)},getAtomData:function(a,b,c){return a.getBackboneAtomData(this.getAtomParams(b,c))},getBondData:function(a,b,c){b=this.getBondParams(b,c);
b.colorParams.backbone=!0;return a.getBackboneBondData(b)}});NGL.BaseRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.BaseRepresentation.prototype=NGL.createObject(NGL.BallAndStickRepresentation.prototype,{constructor:NGL.BaseRepresentation,type:"base",defaultSize:.3,parameters:Object.assign({},NGL.BallAndStickRepresentation.prototype.parameters),init:function(a){a=a||{};a.aspectRatio=a.aspectRatio||1;NGL.BallAndStickRepresentation.prototype.init.call(this,a)},getAtomData:function(a,b,c){return a.getRungAtomData(this.getAtomParams(b,c))},getBondData:function(a,b,c){b=this.getBondParams(b,c);b.colorParams.rung=
!0;return a.getRungBondData(b)}});NGL.CartoonRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.CartoonRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.CartoonRepresentation,type:"cartoon",parameters:Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},arrows:{type:"boolean",rebuild:!0}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=
a||{};a.colorScheme=a.colorScheme||"sstruc";a.radius=a.radius||"sstruc";"low"===a.quality?(this.subdiv=3,this.radialSegments=6):"medium"===a.quality?(this.subdiv=6,this.radialSegments=10):"high"===a.quality?(this.subdiv=12,this.radialSegments=20):(this.subdiv=a.subdiv||6,this.radialSegments=a.radialSegments||10);this.aspectRatio=a.aspectRatio||3;this.tension=a.tension||NaN;this.capped=a.capped||!0;this.arrows=a.arrows||!1;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){var b=
[],c=[];this.structure.eachPolymer(function(a){if(!(4>a.residueCount)){c.push(a);var e=new NGL.Spline(a,this.arrows),f=e.getSubdividedPosition(this.subdiv,this.tension),g=e.getSubdividedOrientation(this.subdiv,this.tension),h=e.getSubdividedColor(this.subdiv,this.getColorParams()),e=e.getSubdividedSize(this.subdiv,this.radius,this.scale);a.structure.getResidueProxy().index=a.residueIndexStart;var k=1*this.aspectRatio,l=1;a.isCg()&&(l=k);b.push(new NGL.TubeMeshBuffer(f.position,g.normal,g.binormal,
g.tangent,h.color,e.size,h.pickingColor,this.getBufferParams({radialSegments:this.radialSegments,rx:k,ry:l,capped:this.capped,dullInterior:!0})))}}.bind(this),a.getSelection());return{bufferList:b,polymerList:c}},updateData:function(a,b){NGL.debug&&NGL.time(this.type+" repr update");a=a||{};for(var c=0,d=b.polymerList.length;c<d;++c){var e={},f=new NGL.Spline(b.polymerList[c],this.arrows);b.bufferList[c].rx=this.aspectRatio;if(a.position||a.radius){var g=f.getSubdividedPosition(this.subdiv,this.tension),
h=f.getSubdividedOrientation(this.subdiv,this.tension),k=f.getSubdividedSize(this.subdiv,this.radius,this.scale);e.position=g.position;e.normal=h.normal;e.binormal=h.binormal;e.tangent=h.tangent;e.size=k.size}a.color&&(f=f.getSubdividedColor(this.subdiv,this.getColorParams()),e.color=f.color,e.pickingColor=f.pickingColor);b.bufferList[c].setAttributes(e)}NGL.debug&&NGL.timeEnd(this.type+" repr update")},setParameters:function(a){var b={};a&&a.aspectRatio&&(b.radius=!0);a&&a.tension&&(b.position=!0);
NGL.StructureRepresentation.prototype.setParameters.call(this,a,b,!1);return this}});NGL.TubeRepresentation=function(a,b,c){NGL.CartoonRepresentation.call(this,a,b,c)};NGL.TubeRepresentation.prototype=NGL.createObject(NGL.CartoonRepresentation.prototype,{constructor:NGL.TubeRepresentation,type:"tube",parameters:Object.assign({},NGL.CartoonRepresentation.prototype.parameters,{aspectRatio:null}),init:function(a){a=a||{};a.aspectRatio=1;NGL.CartoonRepresentation.prototype.init.call(this,a)}});
NGL.RibbonRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c);this.defaultScale.sstruc*=3};
NGL.RibbonRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.RibbonRepresentation,type:"ribbon",parameters:Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1}},NGL.StructureRepresentation.prototype.parameters,{side:null,wireframe:null,linewidth:null}),init:function(a){a=a||{};a.colorScheme=a.colorScheme||"sstruc";a.radius=a.radius||"sstruc";a.scale=a.scale||3;this.subdiv="low"===a.quality?3:"medium"===
a.quality?6:"high"===a.quality?12:a.subdiv||6;this.tension=a.tension||NaN;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){var b=[],c=[];this.structure.eachPolymer(function(a){if(!(4>a.residueCount)){c.push(a);var e=new NGL.Spline(a);a=e.getSubdividedPosition(this.subdiv,this.tension);var f=e.getSubdividedOrientation(this.subdiv,this.tension),g=e.getSubdividedColor(this.subdiv,this.getColorParams()),e=e.getSubdividedSize(this.subdiv,this.radius,this.scale);b.push(new NGL.RibbonBuffer(a.position,
f.binormal,f.normal,g.color,e.size,g.pickingColor,this.getBufferParams()))}}.bind(this),a.getSelection());return{bufferList:b,polymerList:c}},updateData:function(a,b){a=a||{};for(var c=0,d=b.polymerList.length,c=0;c<d;++c){var e={},f=new NGL.Spline(b.polymerList[c]);if(a.position){var g=f.getSubdividedPosition(this.subdiv,this.tension),h=f.getSubdividedOrientation(this.subdiv,this.tension);e.position=g.position;e.normal=h.binormal;e.dir=h.normal}if(a.radius||a.scale)g=f.getSubdividedSize(this.subdiv,
this.radius,this.scale),e.size=g.size;a.color&&(f=f.getSubdividedColor(this.subdiv,this.getColorParams()),e.color=f.color);b.bufferList[c].setAttributes(e)}},setParameters:function(a){var b={};a&&a.tension&&(b.position=!0);NGL.StructureRepresentation.prototype.setParameters.call(this,a,b,!1);return this}});NGL.TraceRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.TraceRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.TraceRepresentation,type:"trace",parameters:Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1}},NGL.Representation.prototype.parameters,{flatShaded:null,side:null,wireframe:null}),init:function(a){a=a||{};a.colorScheme=a.colorScheme||"sstruc";this.subdiv="low"===a.quality?3:"medium"===a.quality?6:"high"===a.quality?12:a.subdiv||6;this.tension=
a.tension||NaN;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){var b=[],c=[];this.structure.eachPolymer(function(a){if(!(4>a.residueCount)){c.push(a);var e=new NGL.Spline(a);a=e.getSubdividedPosition(this.subdiv,this.tension);e=e.getSubdividedColor(this.subdiv,this.getColorParams());b.push(new NGL.TraceBuffer(a.position,e.color,this.getBufferParams()))}}.bind(this),a.getSelection());return{bufferList:b,polymerList:c}},updateData:function(a,b){a=a||{};for(var c=0,d=
b.polymerList.length,c=0;c<d;++c){var e={},f=new NGL.Spline(b.polymerList[c]);if(a.position){var g=f.getSubdividedPosition(this.subdiv,this.tension);e.position=g.position}a.color&&(f=f.getSubdividedColor(this.subdiv,this.getColorParams()),e.color=f.color);b.bufferList[c].setAttributes(e)}},setParameters:function(a){var b={};a&&a.tension&&(b.position=!0);NGL.StructureRepresentation.prototype.setParameters.call(this,a,b,!1);return this}});
NGL.HelixorientRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.HelixorientRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.HelixorientRepresentation,type:"helixorient",parameters:Object.assign({},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};a.colorScheme=a.colorScheme||"sstruc";a.radius=a.radius||.15;a.scale=a.scale||1;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){var b=[],c=[];this.structure.eachPolymer(function(a){if(!(4>a.residueCount)){c.push(a);
var e=new NGL.Helixorient(a);a=e.getPosition();var f=e.getColor(this.getColorParams()),e=e.getSize(this.radius,this.scale);b.push(new NGL.SphereBuffer(a.center,f.color,e.size,f.pickingColor,this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0}),this.disableImpostor),new NGL.VectorBuffer(a.center,a.axis,{color:"skyblue",scale:1}),new NGL.VectorBuffer(a.center,a.resdir,{color:"lightgreen",scale:1}))}}.bind(this),a.getSelection());return{bufferList:b,polymerList:c}},updateData:function(a,
b){NGL.debug&&NGL.time(this.type+" repr update");a=a||{};for(var c=0,d=b.polymerList.length;c<d;++c){var e=3*c,f={},g=new NGL.Helixorient(b.polymerList[c]);a.position&&(g=g.getPosition(),f.position=g.center,b.bufferList[e+1].setAttributes({position:g.center,vector:g.axis}),b.bufferList[e+2].setAttributes({position:g.center,vector:g.resdir}));b.bufferList[e].setAttributes(f)}NGL.debug&&NGL.timeEnd(this.type+" repr update")}});
NGL.RocketRepresentation=function(a,b,c){this.helixbundleList=[];NGL.StructureRepresentation.call(this,a,b,c)};
NGL.RocketRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.RocketRepresentation,type:"rocket",parameters:Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radiusSegments:{type:"integer",max:25,min:5,rebuild:"impostor"}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};a.colorScheme=a.colorScheme||"sstruc";a.radius=
a.radius||1.5;a.scale=a.scale||1;this.disableImpostor=a.disableImpostor||!1;this.radiusSegments="low"===a.quality?5:"medium"===a.quality?10:"high"===a.quality?20:void 0!==a.radiusSegments?a.radiusSegments:10;this.localAngle=a.localAngle||30;this.centerDist=a.centerDist||2.5;this.ssBorder=void 0===a.ssBorder?!1:a.ssBorder;NGL.StructureRepresentation.prototype.init.call(this,a)},createData:function(a){var b=0,c=[],d=[];this.structure.eachPolymer(function(a){if(!(4>a.residueCount||a.isNucleic())){a=
new NGL.Helixbundle(a);var e=a.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.radius,this.scale);b+=e.size.length;c.push(e);d.push(a)}}.bind(this),a.getSelection());var e={begin:new Float32Array(3*b),end:new Float32Array(3*b),size:new Float32Array(b),color:new Float32Array(3*b),pickingColor:new Float32Array(3*b)},f=0;c.forEach(function(a){e.begin.set(a.begin,3*f);e.end.set(a.end,3*f);e.size.set(a.size,f);e.color.set(a.color,3*f);e.pickingColor.set(a.pickingColor,
3*f);f+=a.size.length});return{bufferList:[new NGL.CylinderBuffer(e.begin,e.end,e.color,e.color,e.size,e.pickingColor,e.pickingColor,this.getBufferParams({shift:0,cap:!0,radiusSegments:this.radiusSegments,dullInterior:!0}),this.disableImpostor)],axisList:c,helixbundleList:d,axisData:e}},updateData:function(a,b){a=a||{};if(a.position)this.build();else{var c={};if(a.color||a.radius){var d=0;b.helixbundleList.forEach(function(c){c=c.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),
this.radius,this.scale);a.color&&b.axisData.color.set(c.color,3*d);(a.radius||a.scale)&&b.axisData.size.set(c.size,d);d+=c.size.length}.bind(this));a.color&&(c.color=b.axisData.color,c.color2=b.axisData.color);if(a.radius||a.scale)c.radius=b.axisData.size}b.bufferList[0].setAttributes(c)}}});NGL.RopeRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.RopeRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.RopeRepresentation,type:"rope",parameters:Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smooth:{type:"integer",max:15,min:0,rebuild:!0}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};a.colorScheme=a.colorScheme||
"sstruc";a.radius=a.radius||this.defaultSize;"low"===a.quality?(this.subdiv=3,this.radialSegments=5):"medium"===a.quality?(this.subdiv=6,this.radialSegments=10):"high"===a.quality?(this.subdiv=12,this.radialSegments=20):(this.subdiv=a.subdiv||6,this.radialSegments=a.radialSegments||10);this.tension=a.tension||.5;this.capped=a.capped||!0;this.smooth=void 0===a.smooth?2:a.smooth;NGL.StructureRepresentation.prototype.init.call(this,a);this.__polymerList=[];this.__bufferList=[]},prepare:function(a){this.__polymerList.length=
0;this.__bufferList.length=0;if(0===this.structureView.atomCount)a();else{var b=this;this.structure.eachPolymer(function(a){4>a.residueCount||a.isNucleic()||b.__polymerList.push(a)},this.selection,!0);NGL.processArray(this.__polymerList,function(a,d,e){for(;a<d;++a){var f=new NGL.Helixorient(e[a]),g=new NGL.Spline(f.getFiber(b.smooth,!0)),f=g.getSubdividedPosition(b.subdiv,b.tension),h=g.getSubdividedOrientation(b.subdiv,b.tension),k=g.getSubdividedColor(b.subdiv,b.getColorParams()),g=g.getSubdividedSize(b.subdiv,
b.radius,b.scale);b.__bufferList.push(new NGL.TubeMeshBuffer(f.position,h.normal,h.binormal,h.tangent,k.color,g.size,k.pickingColor,b.getBufferParams({radialSegments:b.radialSegments,rx:1,ry:1,capped:b.capped,dullInterior:!0})))}},a,50)}},create:function(){for(var a=this.__polymerList.length,b=0;b<a;++b)this.polymerList.push(this.__polymerList[b]),this.bufferList.push(this.__bufferList[b])},update:function(a){if(0!==this.structureView.atomCount&&0!==this.bufferList.length){a=a||{};for(var b=0,c=this.polymerList.length,
b=0;b<c;++b){var d=this.polymerList[b];if(4>d.residueCount)break;var e={},d=new NGL.Helixorient(d),d=new NGL.Spline(d.getPolymer(this.smooth,!0));if(a.position||a.radius||a.scale){var f=d.getSubdividedPosition(this.subdiv,this.tension),g=d.getSubdividedOrientation(this.subdiv,this.tension),h=d.getSubdividedSize(this.subdiv,this.radius,this.scale);e.position=f.position;e.normal=g.normal;e.binormal=g.binormal;e.tangent=g.tangent;e.size=h.size}a.color&&(d=d.getSubdividedColor(this.subdiv,this.getColorParams()),
e.color=d.color,e.pickingColor=d.pickingColor);this.bufferList[b].setAttributes(e)}}},setParameters:function(a){var b={};a&&a.tension&&(b.radius=!0);NGL.StructureRepresentation.prototype.setParameters.call(this,a,b,!1);return this}});NGL.CrossingRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.CrossingRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.CrossingRepresentation,type:"crossing",parameters:Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radiusSegments:{type:"integer",max:25,min:5,rebuild:"impostor"},helixDist:{type:"number",precision:1,max:30,min:0,rebuild:!0},displayLabel:{type:"boolean",rebuild:!0},download:{type:"button",
methodName:"download"}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};a.colorScheme=a.colorScheme||"sstruc";a.radius=a.radius||.7;a.scale=a.scale||1;this.disableImpostor=a.disableImpostor||!1;this.radiusSegments="low"===a.quality?5:"medium"===a.quality?10:"high"===a.quality?20:void 0!==a.radiusSegments?a.radiusSegments:10;this.localAngle=a.localAngle||30;this.centerDist=a.centerDist||2.5;this.ssBorder=void 0===a.ssBorder?!1:a.ssBorder;this.helixDist=a.helixDist||12;this.displayLabel=
void 0===a.displayLabel?!0:a.displayLabel;NGL.StructureRepresentation.prototype.init.call(this,a)},create:function(){if(0!==this.atomSet.atomCount){var a=this,b=[];this.structure.eachFiber(function(c){if(!(4>c.residueCount||c.isNucleic())){var d=(new NGL.Helixbundle(c)).getAxis(a.localAngle,a.centerDist,a.ssBorder,a.getColorParams(),a.radius,a.scale);a.bufferList.push(new NGL.CylinderBuffer(d.begin,d.end,d.color,d.color,d.size,d.pickingColor,d.pickingColor,a.getBufferParams({shift:0,cap:!0,radiusSegments:a.radiusSegments,
dullInterior:!0}),a.disableImpostor));a.fiberList.push(c);for(c=0;c<d.residue.length;++c){var g=new NGL.Helix;g.fromHelixbundleAxis(d,c);b.push(g)}}},this.selection);var c=(new NGL.HelixCrossing(b)).getCrossing(this.helixDist);this.crossing=c;var d=c.end.length/3;this.bufferList.push(new NGL.CylinderBuffer(new Float32Array(c.begin),new Float32Array(c.end),NGL.Utils.uniformArray3(d,.2,.2,.9),NGL.Utils.uniformArray3(d,.2,.2,.9),NGL.Utils.uniformArray(d,.1),NGL.Utils.uniformArray3(d,0,0,0),NGL.Utils.uniformArray3(d,
0,0,0),{shift:0,cap:!0,radiusSegments:this.radiusSegments,side:this.side,opacity:this.opacity,clipNear:this.clipNear,flatShaded:this.flatShaded,dullInterior:!0},this.disableImpostor));this.displayLabel&&(d=c.helixLabel.length,this.bufferList.push(new NGL.TextBuffer(c.helixCenter,NGL.Utils.uniformArray(d,2.5),NGL.Utils.uniformArray3(d,1,1,1),c.helixLabel,{clipNear:this.clipNear})))}},update:function(a){this.build()},download:function(){var a=JSON.stringify(this.crossing.info,null,"\t");NGL.download(new Blob([a],
{type:"text/plain"}),"helixCrossing.json")}});NGL.ContactRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.ContactRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.ContactRepresentation,type:"contact",defaultSize:.25,parameters:Object.assign({contactType:{type:"select",rebuild:!0,options:{polar:"polar",polarBackbone:"polar backbone"}},maxDistance:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxAngle:{type:"integer",max:180,min:0,rebuild:!0}},NGL.StructureRepresentation.prototype.parameters),init:function(a){a=a||{};a.radius=a.radius||this.defaultSize;
this.disableImpostor=a.disableImpostor||!1;this.sphereDetail="low"===a.quality?0:"medium"===a.quality?1:"high"===a.quality?2:void 0!==a.sphereDetail?a.sphereDetail:1;this.contactType=a.contactType||"polar";this.maxDistance=a.maxDistance||3.5;this.maxAngle=a.maxAngle||40;NGL.StructureRepresentation.prototype.init.call(this,a)},create:function(){if(0!==this.structureView.atomCount){var a=new NGL.StructureSubset(this.structure,this.selection),b={polar:NGL.polarContacts,polarBackbone:NGL.polarBackboneContacts}[this.contactType](a,
this.maxDistance,this.maxAngle);this.contactAtomSet=b.atomSet;b=this.contactBondSet=b.bondSet;0!==this.contactAtomSet.atomCount&&(this.cylinderBuffer=new NGL.CylinderBuffer(b.bondPosition(null,0),b.bondPosition(null,1),b.bondColor(null,0,this.getColorParams()),b.bondColor(null,1,this.getColorParams()),b.bondRadius(null,0,this.radius,this.scale),b.bondPickingColor(null,0),b.bondPickingColor(null,1),this.getBufferParams({shift:0,cap:!0,radiusSegments:this.radiusSegments,dullInterior:!0}),this.disableImpostor),
this.bufferList.push(this.cylinderBuffer),a.dispose())}},update:function(a){if(a.position)this.build();else if(0!==this.structureView.atomCount&&0!==this.bufferList.length){a=a||{};var b=this.contactBondSet;if(0!==this.contactAtomSet.atomCount){var c={};if(a.position){var d=b.bondPosition(null,0),e=b.bondPosition(null,1);c.position=NGL.Utils.calculateCenterArray(d,e);c.position1=d;c.position2=e}a.color&&(c.color=b.bondColor(null,0,this.getColorParams()),c.color2=b.bondColor(null,1,this.getColorParams()));
if(a.radius||a.scale)c.radius=b.bondRadius(null,0,this.radius,this.scale);this.cylinderBuffer.setAttributes(c)}}},clear:function(){this.contactAtomSet&&this.contactAtomSet.dispose();this.contactBondSet&&this.contactBondSet.dispose();NGL.StructureRepresentation.prototype.clear.call(this)}});NGL.MolecularSurfaceRepresentation=function(a,b,c){this.__infoList=[];NGL.StructureRepresentation.call(this,a,b,c);this.structure.signals.refreshed.add(function(){this.__forceNewMolsurf=!0},this)};
NGL.MolecularSurfaceRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.MolecularSurfaceRepresentation,type:"surface",parameters:Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,
min:0,rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},lowResolution:{type:"boolean",rebuild:!0},filterSele:{type:"text"},volume:{type:"hidden"}},NGL.StructureRepresentation.prototype.parameters,{radiusType:null,radius:null,scale:null}),init:function(a){var b=a||{};b.colorScheme=b.colorScheme||"uniform";b.colorValue=void 0!==b.colorValue?b.colorValue:14540253;this.surfaceType=void 0!==b.surfaceType?b.surfaceType:"ms";this.probeRadius=void 0!==b.probeRadius?
b.probeRadius:1.4;this.smooth=void 0!==b.smooth?b.smooth:2;this.scaleFactor=void 0!==b.scaleFactor?b.scaleFactor:2;this.cutoff=b.cutoff||0;this.background=b.background||!1;this.opaqueBack=void 0!==b.opaqueBack?b.opaqueBack:!0;this.lowResolution=void 0!==b.lowResolution?b.lowResolution:!1;this.filterSele=void 0!==b.filterSele?b.filterSele:"";this.volume=b.volume||void 0;NGL.StructureRepresentation.prototype.init.call(this,a)},prepareData:function(a,b,c){var d=this.__infoList[b];d||(d={},this.__infoList[b]=
d);d.molsurf&&d.sele===a.selection.string?c(b):(d.sele=a.selection.string,d.molsurf=new NGL.MolecularSurface(a),a=this.getSurfaceParams(),d.molsurf.getSurfaceWorker(a,function(a){d.surface=a;c(b)}))},prepare:function(a){if(this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))this.__infoList.forEach(function(a,b){a.molsurf.dispose()}.bind(this)),this.__infoList.length=0;if(0===this.structureView.atomCount)a();else{var b=function(){this.__sele=
this.selection.string;this.__surfaceParams=JSON.stringify(this.getSurfaceParams());this.__forceNewMolsurf=!1;a()}.bind(this),c=this.structure.biomolDict[this.assembly||this.structure.defaultAssembly];c?c.partList.forEach(function(a,e){var f=a.getView(this.structureView);this.prepareData(f,e,function(a){a===c.partList.length-1&&b()}.bind(this))},this):this.prepareData(this.structureView,0,b)}},createData:function(a,b){var c=this.__infoList[b],d=new NGL.SurfaceBuffer(c.surface.getPosition(),c.surface.getColor(this.getColorParams()),
c.surface.getFilteredIndex(this.filterSele,a),c.surface.getNormal(),c.surface.getPickingColor(this.getColorParams()),this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));return{bufferList:[new NGL.DoubleSidedBuffer(d)],info:c}},updateData:function(a,b){var c={};a.position?(this.__forceNewMolsurf=!0,this.build()):(a.color&&(c.color=b.info.surface.getColor(this.getColorParams())),a.index&&(c.index=b.info.surface.getFilteredIndex(this.filterSele,b.sview)),b.bufferList[0].setAttributes(c))},
setParameters:function(a,b,c){b=b||{};a&&a.filterSele&&(b.index=!0);a&&void 0!==a.volume&&(b.color=!0);NGL.StructureRepresentation.prototype.setParameters.call(this,a,b,c);return this},getSurfaceParams:function(a){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth,lowRes:this.lowResolution,cutoff:this.cutoff},a)},getColorParams:function(){var a=NGL.StructureRepresentation.prototype.getColorParams.call(this);a.volume=this.volume;
return a},clear:function(){NGL.StructureRepresentation.prototype.clear.call(this)},dispose:function(){this.__infoList.forEach(function(a,b){a.molsurf.dispose()}.bind(this));this.__infoList.length=0;NGL.StructureRepresentation.prototype.dispose.call(this)}});NGL.DistanceRepresentation=function(a,b,c){NGL.StructureRepresentation.call(this,a,b,c)};
NGL.DistanceRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.DistanceRepresentation,type:"distance",defaultSize:.15,parameters:Object.assign({font:{type:"select",options:{LatoBlack:"LatoBlack"},rebuild:!0},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelVisible:{type:"boolean"},atomPair:{type:"hidden",rebuild:!0},radiusSegments:{type:"integer",max:25,min:5,rebuild:"impostor"}},NGL.StructureRepresentation.prototype.parameters),
init:function(a){a=a||{};a.radius=a.radius||this.defaultSize;this.disableImpostor=a.disableImpostor||!1;this.radiusSegments="low"===a.quality?5:"medium"===a.quality?10:"high"===a.quality?20:void 0!==a.radiusSegments?a.radiusSegments:10;this.font=a.font||"LatoBlack";this.labelSize=a.labelSize||1;this.labelColor=a.labelColor||16777215;this.labelVisible=void 0!==a.labelVisible?a.labelVisible:!0;this.antialias=void 0!==a.antialias?a.antialias:!0;this.atomPair=a.atomPair||[];NGL.StructureRepresentation.prototype.init.call(this,
a)},create:function(){if(0!==this.atomSet.atomCount){var a=this.atomPair.length;if(0!==a){var b=Array(a),c=new Float32Array(3*a),d=new NGL.Selection,e=new NGL.Selection;this.bondSet=new NGL.BondSet;this.bondSet.structure=this.structure;var f=this.bondSet,g=0;this.atomPair.forEach(function(a,h){h-=g;var m=3*h;d.setString(a[0]);e.setString(a[1]);var n=this.atomSet.getAtoms(d,!0),q=this.atomSet.getAtoms(e,!0);n&&q?(f.addBond(n,q,!0),b[h]=n.distanceTo(q).toFixed(2),c[m+0]=(n.x+q.x)/2,c[m+1]=(n.y+q.y)/
2,c[m+2]=(n.z+q.z)/2):g+=1},this);0<g&&(a-=g,c=c.subarray(0,3*a));var h=new THREE.Color(this.labelColor);this.textBuffer=new NGL.TextBuffer(c,NGL.Utils.uniformArray(a,this.labelSize),NGL.Utils.uniformArray3(a,h.r,h.g,h.b),b,this.getBufferParams({font:this.font,antialias:this.antialias,opacity:1,visible:this.labelVisible}));this.__center=new Float32Array(3*f.bondCount);this.cylinderBuffer=new NGL.CylinderBuffer(f.bondPosition(null,0),f.bondPosition(null,1),f.bondColor(null,0,this.getColorParams()),
f.bondColor(null,1,this.getColorParams()),f.bondRadius(null,null,this.radius,this.scale),f.bondPickingColor(null,0),f.bondPickingColor(null,1),this.getBufferParams({shift:0,cap:!0,radiusSegments:this.radiusSegments,dullInterior:!0}),this.disableImpostor);this.bufferList.push(this.textBuffer,this.cylinderBuffer)}}},update:function(a){if(0!==this.atomSet.atomCount&&0!==this.bufferList.length){var b=this.atomPair.length;if(0!==b){a=a||{};var c=this.bondSet,d={},e={};if(a.position){var f=new Float32Array(3*
b),g=new NGL.Selection,h=new NGL.Selection;this.atomPair.forEach(function(a,b){var c=3*b;g.setString(a[0]);h.setString(a[1]);var d=this.atomSet.getAtoms(g,!0),e=this.atomSet.getAtoms(h,!0);f[c+0]=(d.x+e.x)/2;f[c+1]=(d.y+e.y)/2;f[c+2]=(d.z+e.z)/2},this);d.position=f;var k=c.bondPosition(null,0),l=c.bondPosition(null,1);e.position=NGL.Utils.calculateCenterArray(k,l);e.position1=k;e.position2=l}a.labelSize&&(d.size=NGL.Utils.uniformArray(b,this.labelSize));a.labelColor&&(k=new THREE.Color(this.labelColor),
d.color=NGL.Utils.uniformArray3(b,k.r,k.g,k.b));a.color&&(e.color=c.bondColor(null,0,this.getColorParams()),e.color2=c.bondColor(null,1,this.getColorParams()));if(a.radius||a.scale)e.radius=c.bondRadius(null,0,this.radius,this.scale);this.textBuffer.setAttributes(d);this.cylinderBuffer.setAttributes(e)}}},setVisibility:function(a,b){NGL.StructureRepresentation.prototype.setVisibility.call(this,a,!0);this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible);b||this.viewer.requestRender();
return this},setParameters:function(a){var b={};a&&a.labelSize&&(b.labelSize=!0);a&&a.labelColor&&(b.labelColor=!0);NGL.StructureRepresentation.prototype.setParameters.call(this,a,b,!1);a&&void 0!==a.labelVisible&&this.setVisibility(this.visible);return this},clear:function(){this.bondSet&&this.bondSet.dispose();NGL.StructureRepresentation.prototype.clear.call(this)}});
NGL.TrajectoryRepresentation=function(a,b,c){this.manualAttach=!0;this.trajectory=a;NGL.StructureRepresentation.call(this,a.structure,b,c)};
NGL.TrajectoryRepresentation.prototype=NGL.createObject(NGL.StructureRepresentation.prototype,{constructor:NGL.TrajectoryRepresentation,type:"",parameters:Object.assign({drawLine:{type:"boolean",rebuild:!0},drawCylinder:{type:"boolean",rebuild:!0},drawPoint:{type:"boolean",rebuild:!0},drawSphere:{type:"boolean",rebuild:!0},linewidth:{type:"integer",max:20,min:1,rebuild:!0},pointSize:{type:"integer",max:20,min:1,rebuild:!0},sizeAttenuation:{type:"boolean",rebuild:!0},sort:{type:"boolean",rebuild:!0}},
NGL.Representation.prototype.parameters),init:function(a){a=a||{};a.colorScheme=a.colorScheme||"uniform";a.colorValue=a.colorValue||14540253;this.drawLine=a.drawLine||!0;this.drawCylinder=a.drawCylinder||!1;this.drawPoint=a.drawPoint||!1;this.drawSphere=a.drawSphere||!1;this.pointSize=a.pointSize||1;this.sizeAttenuation=void 0!==a.sizeAttenuation?a.sizeAttenuation:!1;this.sort=void 0!==a.sort?a.sort:!0;NGL.StructureRepresentation.prototype.init.call(this,a)},attach:function(a){this.bufferList.forEach(function(a){this.viewer.add(a)},
this);this.setVisibility(this.visible);a()},prepare:function(a){a()},create:function(){if(0!==this.atomSet.atomCount){var a=this;this.trajectory.getPath(this.atomSet.atoms[0].index,function(b){var c=b.length/3,d=new THREE.Color(a.colorValue);if(a.drawSphere){var e=new NGL.SphereBuffer(b,NGL.Utils.uniformArray3(c,d.r,d.g,d.b),NGL.Utils.uniformArray(c,.2),NGL.Utils.uniformArray3(c,d.r,d.g,d.b),a.getBufferParams({sphereDetail:a.sphereDetail,dullInterior:!0}),a.disableImpostor);a.bufferList.push(e)}a.drawCylinder&&
(e=new NGL.CylinderBuffer(b.subarray(0,-3),b.subarray(3),NGL.Utils.uniformArray3(c-1,d.r,d.g,d.b),NGL.Utils.uniformArray3(c-1,d.r,d.g,d.b),NGL.Utils.uniformArray(c,.05),NGL.Utils.uniformArray3(c-1,d.r,d.g,d.b),NGL.Utils.uniformArray3(c-1,d.r,d.g,d.b),a.getBufferParams({shift:0,cap:!0,radiusSegments:a.radiusSegments,dullInterior:!0}),a.disableImpostor),a.bufferList.push(e));a.drawPoint&&(e=new NGL.PointBuffer(b,NGL.Utils.uniformArray3(c,d.r,d.g,d.b),a.getBufferParams({pointSize:a.pointSize,sizeAttenuation:a.sizeAttenuation,
sort:a.sort})),a.bufferList.push(e));a.drawLine&&(b=new NGL.LineBuffer(b.subarray(0,-3),b.subarray(3),NGL.Utils.uniformArray3(c-1,d.r,d.g,d.b),NGL.Utils.uniformArray3(c-1,d.r,d.g,d.b),a.getBufferParams()),a.bufferList.push(b));a.attach()})}}});
NGL.SurfaceRepresentation=function(a,b,c){NGL.Representation.call(this,a,b,c);a instanceof NGL.Volume?(this.surface=void 0,this.volume=a):(this.surface=a,this.volume=void 0);this.boxCenter=new THREE.Vector3;this.__boxCenter=new THREE.Vector3;this.box=new THREE.Box3;this.__box=new THREE.Box3;this.setBox=function(){var a=new THREE.Vector3;return function(){var c=b.controls.target;a.copy(b.rotationGroup.position).negate().add(c);this.setParameters({boxCenter:a})}.bind(this)}.call(this);this.viewer.signals.orientationChanged.add(this.setBox);
this.build()};
NGL.SurfaceRepresentation.prototype=NGL.createObject(NGL.Representation.prototype,{constructor:NGL.SurfaceRepresentation,type:"surface",parameters:Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1E3,min:-1E3},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0}},NGL.Representation.prototype.parameters),init:function(a){a=
a||{};a.colorScheme=a.colorScheme||"uniform";a.colorValue=void 0!==a.colorValue?a.colorValue:14540253;this.isolevelType=void 0!==a.isolevelType?a.isolevelType:"sigma";this.isolevel=void 0!==a.isolevel?a.isolevel:2;this.smooth=void 0!==a.smooth?a.smooth:0;this.background=a.background||!1;this.opaqueBack=void 0!==a.opaqueBack?a.opaqueBack:!0;this.boxSize=void 0!==a.boxSize?a.boxSize:0;NGL.Representation.prototype.init.call(this,a)},attach:function(a){this.bufferList.forEach(function(a){this.viewer.add(a)},
this);this.setVisibility(this.visible);a()},prepare:function(a){if(this.volume){var b;b="sigma"===this.isolevelType?this.volume.getValueForSigma(this.isolevel):this.isolevel;!this.surface||this.__isolevel!==b||this.__smooth!==this.smooth||this.__boxSize!==this.boxSize||0<this.boxSize&&!this.__boxCenter.equals(this.boxCenter)?(this.__isolevel=b,this.__smooth=this.smooth,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box),this.volume.getSurfaceWorker(b,this.smooth,
this.boxCenter,this.boxSize,function(b){this.surface=b;a()}.bind(this))):a()}else a()},create:function(){var a=new NGL.SurfaceBuffer(this.surface.getPosition(),this.surface.getColor(this.getColorParams()),this.surface.getIndex(),this.surface.getNormal(),void 0,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1})),a=new NGL.DoubleSidedBuffer(a);this.bufferList.push(a)},update:function(a){if(0!==this.bufferList.length){a=a||{};var b={};a.position&&(b.position=
this.surface.getPosition());a.color&&(b.color=this.surface.getColor(this.getColorParams()));a.index&&(b.index=this.surface.getIndex());a.normal&&(b.normal=this.surface.getNormal());this.bufferList.forEach(function(a){a.setAttributes(b)})}},setParameters:function(a,b,c){a&&void 0!==a.isolevelType&&this.volume&&("value"===this.isolevelType&&"sigma"===a.isolevelType?this.isolevel=this.volume.getSigmaForValue(this.isolevel):"sigma"===this.isolevelType&&"value"===a.isolevelType&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),
this.isolevelType=a.isolevelType);a&&a.boxCenter&&(this.boxCenter.copy(a.boxCenter),delete a.boxCenter);NGL.Representation.prototype.setParameters.call(this,a,b,c);this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box);this.surface&&(void 0!==a.isolevel||void 0!==a.smooth||void 0!==a.boxSize||0<this.boxSize&&!this.__box.equals(this.box))&&this.build({__update:{position:!0,color:!0,index:!0,normal:!0}});return this},dispose:function(){this.viewer.signals.orientationChanged.remove(this.setBox);
NGL.Representation.prototype.dispose.call(this)}});NGL.DotRepresentation=function(a,b,c){NGL.Representation.call(this,a,b,c);a instanceof NGL.Volume?(this.surface=void 0,this.volume=a):(this.surface=a,this.volume=void 0);this.build()};
NGL.DotRepresentation.prototype=NGL.createObject(NGL.Representation.prototype,{constructor:NGL.DotRepresentation,type:"dot",parameters:Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:Infinity,min:-Infinity,rebuild:!0},thresholdMax:{type:"number",precision:3,max:Infinity,min:-Infinity,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},
radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:{type:"integer",max:3,min:0,rebuild:"impostor"},pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},
alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},NGL.Representation.prototype.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform"}}}),defaultSize:.1,init:function(a){a=a||{};a.colorScheme=a.colorScheme||"uniform";a.colorValue=a.colorValue||14540253;this.disableImpostor=a.disableImpostor||!1;this.sphereDetail="low"===a.quality?0:"medium"===
a.quality?1:"high"===a.quality?2:a.sphereDetail||1;this.thresholdType=void 0!==a.thresholdType?a.thresholdType:"sigma";this.thresholdMin=void 0!==a.thresholdMin?a.thresholdMin:2;this.thresholdMax=void 0!==a.thresholdMax?a.thresholdMax:Infinity;this.thresholdOut=void 0!==a.thresholdOut?a.thresholdOut:!1;this.dotType=void 0!==a.dotType?a.dotType:"point";this.radius=void 0!==a.radius?a.radius:.1;this.scale=void 0!==a.scale?a.scale:1;this.pointSize=a.pointSize||1;this.sizeAttenuation=void 0!==a.sizeAttenuation?
a.sizeAttenuation:!0;this.sortParticles=void 0!==a.sortParticles?a.sortParticles:!1;this.useTexture=void 0!==a.useTexture?a.useTexture:!1;this.alphaTest=void 0!==a.alphaTest?a.alphaTest:.5;this.forceTransparent=void 0!==a.forceTransparent?a.forceTransparent:!1;this.edgeBleach=void 0!==a.edgeBleach?a.edgeBleach:0;NGL.Representation.prototype.init.call(this,a)},attach:function(a){this.bufferList.forEach(function(a){this.viewer.add(a)},this);this.setVisibility(this.visible);a()},create:function(){var a,
b,c,d;this.volume?("sigma"===this.thresholdType?(a=this.volume.getValueForSigma(this.thresholdMin),b=this.volume.getValueForSigma(this.thresholdMax)):(a=this.thresholdMin,b=this.thresholdMax),this.volume.filterData(a,b,this.thresholdOut),a=this.volume.getDataPosition(),b=this.volume.getDataColor(this.getColorParams()),c=this.volume.getDataSize(this.radius,this.scale),d=this.volume.getPickingDataColor(this.getColorParams())):(a=this.surface.getPosition(),b=this.surface.getColor(this.getColorParams()),
c=this.surface.getSize(this.radius,this.scale),d=this.surface.getPickingColor(this.getColorParams()));this.dotBuffer="sphere"===this.dotType?new NGL.SphereBuffer(a,b,c,d,this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!1}),this.disableImpostor):new NGL.PointBuffer(a,b,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}));
this.bufferList.push(this.dotBuffer)},update:function(a){if(0!==this.bufferList.length){a=a||{};var b={};a.color&&(b.color=this.volume?this.volume.getDataColor(this.getColorParams()):this.surface.getColor(this.getColorParams()));"sphere"===this.dotType&&(a.radius||a.scale)&&(b.radius=this.volume?this.volume.getDataSize(this.radius,this.scale):this.surface.getSize(this.radius,this.scale));this.dotBuffer.setAttributes(b)}},setParameters:function(a,b,c){b=b||{};a&&void 0!==a.thresholdType&&this.volume instanceof
NGL.Volume&&("value"===this.thresholdType&&"sigma"===a.thresholdType?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):"sigma"===this.thresholdType&&"value"===a.thresholdType&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=a.thresholdType);a&&void 0!==a.radiusType&&(this.radius="radius"===a.radiusType?this.defaultSize:
a.radiusType,b.radius=!0,"sphere"!==this.dotType||NGL.extensionFragDepth&&!this.disableImpostor||(c=!0));a&&void 0!==a.radius&&(b.radius=!0,"sphere"!==this.dotType||NGL.extensionFragDepth&&!this.disableImpostor||(c=!0));a&&void 0!==a.scale&&(b.scale=!0,"sphere"!==this.dotType||NGL.extensionFragDepth&&!this.disableImpostor||(c=!0));NGL.Representation.prototype.setParameters.call(this,a,b,c);return this}});
(function(){NGL.representationTypes={};var a=[],b;for(b in NGL){var c=NGL[b];c.prototype instanceof NGL.StructureRepresentation&&c.prototype.type&&a.push(c)}a.sort(function(a,b){return a.prototype.type.localeCompare(b.prototype.type)}).forEach(function(a){NGL.representationTypes[a.prototype.type]=a})})();
NGL.Stage=function(a,b){var c=Object.assign({},b),d=c.preferencesId||"ngl-stage";this.parameters=NGL.deepCopy(NGL.Stage.prototype.parameters);this.preferences=new NGL.Preferences(d,c);for(var e in this.parameters)c[e]=this.preferences.getKey(e),c.overwritePreferences&&void 0!==b[e]&&(c[e]=b[e]);this.preferences.signals.keyChanged.add(function(a,b){var c={};c[a]=b;this.setParameters(c)},this);d=signals;this.signals={themeChanged:new d.Signal,parametersChanged:new d.Signal,fullscreenChanged:new d.Signal,
componentAdded:new d.Signal,componentRemoved:new d.Signal,atomPicked:new d.Signal,bondPicked:new d.Signal,volumePicked:new d.Signal,nothingPicked:new d.Signal,onPicking:new d.Signal};this.tasks=new NGL.Counter;this.compList=[];this.defaultFileParams={};this.viewer=new NGL.Viewer(a);this.setParameters(c);this.initFileDragDrop();this.viewer.animate();this.pickingControls=new NGL.PickingControls(this.viewer,this)};
NGL.Stage.prototype={constructor:NGL.Stage,parameters:{theme:{type:"select",options:{light:"light",dark:"dark"}},quality:{type:"select",options:{low:"low",medium:"medium",high:"high"}},sampleLevel:{type:"range",step:1,max:5,min:-1},impostor:{type:"boolean"},overview:{type:"boolean"},rotateSpeed:{type:"number",precision:1,max:10,min:0},zoomSpeed:{type:"number",precision:1,max:10,min:0},panSpeed:{type:"number",precision:1,max:10,min:0},clipNear:{type:"range",step:1,max:100,min:0},clipFar:{type:"range",
step:1,max:100,min:0},clipDist:{type:"number",precision:0,max:200,min:0},fogNear:{type:"range",step:1,max:100,min:0},fogFar:{type:"range",step:1,max:100,min:0},cameraFov:{type:"range",step:1,max:120,min:15},lightColor:{type:"color"},lightIntensity:{type:"number",precision:2,max:10,min:0},ambientColor:{type:"color"},ambientIntensity:{type:"number",precision:2,max:10,min:0}},setParameters:function(a){a=Object.assign({},a);var b=this.parameters,c=this.viewer,d=c.controls,e;for(e in a)void 0!==a[e]&&
b[e]&&(b[e].int&&(a[e]=parseInt(a[e])),b[e].float&&(a[e]=parseFloat(a[e])),b[e].value=a[e]);void 0!==a.theme&&this.setTheme(a.theme);void 0!==a.quality&&this.setQuality(a.quality);void 0!==a.impostor&&this.setImpostor(a.impostor);void 0!==a.rotateSpeed&&(d.rotateSpeed=a.rotateSpeed);void 0!==a.zoomSpeed&&(d.zoomSpeed=a.zoomSpeed);void 0!==a.panSpeed&&(d.panSpeed=a.panSpeed);c.setClip(a.clipNear,a.clipFar,a.clipDist);c.setFog(void 0,a.fogNear,a.fogFar);c.setCamera(void 0,a.cameraFov);c.setSampling(a.sampleLevel);
c.setLight(a.lightColor,a.lightIntensity,a.ambientColor,a.ambientIntensity);this.signals.parametersChanged.dispatch(this.getParameters());return this},getParameters:function(){var a={},b;for(b in this.parameters)a[b]=this.parameters[b].value;return a},defaultFileRepresentation:function(a){a instanceof NGL.StructureComponent?(a.setSelection("/0"),1E5<a.structure.atomStore.count?a.addRepresentation("line"):(a.addRepresentation("cartoon"),a.addRepresentation("licorice",{sele:"hetero"})),this.centerView(),
a.structure.frames.length&&a.addTrajectory()):a instanceof NGL.SurfaceComponent&&(a.addRepresentation("surface"),this.centerView())},initFileDragDrop:function(){this.viewer.container.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);this.viewer.container.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();a=a.dataTransfer.files;for(var b=a.length,c=0;c<b;++c)this.loadFile(a[c])}.bind(this),!1)},loadFile:function(a,
b){var c=Object.assign({},this.defaultFileParams,b),d=new NGL.Component(this,c);d.name=NGL.getFileInfo(a).name;this.addComponent(d);var e=function(a){this.removeComponent(d);d=this.addComponentFromObject(a,c);d instanceof NGL.ScriptComponent&&d.run();c.defaultRepresentation&&this.defaultFileRepresentation(d);return d}.bind(this);return NGL.autoLoad(a,c).then(e,function(a){d.setStatus(a);throw a;})},addComponent:function(a){a?(this.compList.push(a),this.signals.componentAdded.dispatch(a)):NGL.warn("NGL.Stage.addComponent: no component given")},
addComponentFromObject:function(a,b){var c=NGL.makeComponent(this,a,b);this.addComponent(c);return c},removeComponent:function(a){var b=this.compList.indexOf(a);-1!==b&&this.compList.splice(b,1);a.dispose();this.signals.componentRemoved.dispatch(a)},removeAllComponents:function(a){this.compList.slice().forEach(function(b,c){(!a||b instanceof a)&&this.removeComponent(b)},this)},handleResize:function(){this.viewer.handleResize()},toggleFullscreen:function(a){function b(){if(!(document.fullscreenElement||
document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)&&c.lastFullscreenElement){var a=c.lastFullscreenElement;a.style.width=a.dataset.normalWidth;a.style.height=a.dataset.normalHeight;document.removeEventListener("fullscreenchange",b);document.removeEventListener("mozfullscreenchange",b);document.removeEventListener("webkitfullscreenchange",b);document.removeEventListener("msfullscreenchange",b);c.handleResize();c.signals.fullscreenChanged.dispatch(!1)}}if(document.fullscreenEnabled||
document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled){var c=this;this.lastFullscreenElement=a=a||this.viewer.container;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():
(a.dataset.normalWidth=a.style.width,a.dataset.normalHeight=a.style.height,a.style.width=screen.width+"px",a.style.height=screen.height+"px",a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",b),document.addEventListener("mozfullscreenchange",b),document.addEventListener("webkitfullscreenchange",b),document.addEventListener("msfullscreenchange",
b),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout(function(){c.handleResize()},100))}else console.log("fullscreen mode (currently) not possible")},centerView:function(){if(0<this.tasks.count){var a=function(b,c){0===c&&this.tasks.signals.countChanged.remove(a,this);this.viewer.centerView(!0)};this.tasks.signals.countChanged.add(a,this)}this.viewer.centerView(!0)},setSpin:function(a,b){Array.isArray(a)&&(a=(new THREE.Vector3).fromArray(a));this.viewer.setSpin(a,b)},setOrientation:function(a){this.tasks.onZeroOnce(function(){this.viewer.setOrientation(a)},
this)},getOrientation:function(){return this.viewer.getOrientation()},exportImage:function(a,b,c,d,e){var f=[];this.tasks.onZeroOnce(function(){this.viewer.screenshot({factor:a,antialias:b,trim:c,transparent:d,onProgress:function(a,b,c){"function"===typeof e&&e(a,b,c);c&&f.forEach(function(a){a.repr.setParameters(a.params)})}})},this)},setTheme:function(a){this.parameters.theme.value=a;var b;b="light"===a?"white":"black";this.signals.themeChanged.dispatch(a);this.viewer.setBackground(b)},setImpostor:function(a){this.parameters.impostor.value=
a;var b="spacefill ball+stick licorice hyperball backbone rocket crossing contact dot".split(" ");this.eachRepresentation(function(c){if(!(c instanceof NGL.ScriptComponent)&&-1!==b.indexOf(c.getType())){var d=c.getParameters();d.disableImpostor=!a;c.build(d)}})},setQuality:function(a){this.parameters.quality.value=a;var b=["tube","cartoon","ribbon","trace","rope"],c="spacefill ball+stick licorice hyperball backbone rocket crossing contact dot".split(" ");this.eachRepresentation(function(d){if(!(d instanceof
NGL.ScriptComponent)){var e=d.getParameters();if(-1===b.indexOf(d.getType())){if(-1===c.indexOf(d.getType()))return;if(NGL.extensionFragDepth&&!e.disableImpostor){d.repr.quality=a;return}}e.quality=a;d.build(e)}})},eachComponent:function(a,b){this.compList.forEach(function(c,d){(!b||c instanceof b)&&a(c,d)})},eachRepresentation:function(a,b){this.eachComponent(function(b){b.reprList.forEach(function(d){a(d,b)})},b)},getComponentsByName:function(a,b){var c=[];this.eachComponent(function(b){void 0!==
a&&null===b.name.match(a)||c.push(b)},b);return new NGL.ComponentCollection(c)},getRepresentationsByName:function(a,b){var c,d;"object"!==typeof a?(c=void 0,d=a):(c=a.comp,d=a.repr);var e=[];this.eachRepresentation(function(a,b){if(void 0===c||null!==b.name.match(c))void 0!==d&&null===a.name.match(d)||e.push(a)},b);return new NGL.RepresentationCollection(e)},getAnythingByName:function(a){var b=this.getComponentsByName(a).list;a=this.getRepresentationsByName(a).list;return new NGL.Collection(b.concat(a))},
dispose:function(){this.tasks.dispose()}};
NGL.PickingControls=function(a,b){var c=new THREE.Vector3,d={position:new THREE.Vector2,down:new THREE.Vector2,moving:!1,distance:function(){return d.position.distanceTo(d.down)}};a.renderer.domElement.addEventListener("mousemove",function(a){a.preventDefault();d.moving=!0;d.position.x=a.layerX;d.position.y=a.layerY});a.renderer.domElement.addEventListener("mousedown",function(a){a.preventDefault();d.moving=!1;d.down.x=a.layerX;d.down.y=a.layerY});a.renderer.domElement.addEventListener("mouseup",function(e){e.preventDefault();
if(!(3<d.distance()||e.which===NGL.RightMouseButton)){var f=a.renderer.domElement.getBoundingClientRect(),g=a.pick(e.clientX-f.left,f.height-(e.clientY-f.top)),f=g.instance,h=void 0,k=void 0,l=void 0;(g=NGL.GidPool.getByGid(g.gid))&&"AtomProxy"===g.type?h=g:g&&"BondProxy"===g.type?k=g:g&&g&&"Volume"===g.volume.type&&(l=g);(h||k||l)&&e.which===NGL.MiddleMouseButton&&(h?c.copy(h):k?c.set(0,0,0).addVectors(k.atom1,k.atom2).multiplyScalar(.5):l&&c.copy(l),f&&c.applyProjection(f.matrix),a.centerView(!1,
c));h?b.signals.atomPicked.dispatch(h):k?b.signals.bondPicked.dispatch(k):l?b.signals.volumePicked.dispatch(l):b.signals.nothingPicked.dispatch();b.signals.onPicking.dispatch({atom:h,bond:k,volume:l,instance:f});NGL.debug&&(NGL.log("picked atom",h),NGL.log("picked bond",k),NGL.log("picked volume",l))}})};
NGL.Preferences=function(a,b){this.signals={keyChanged:new signals.Signal};this.id=a||"ngl-stage";var c=Object.assign({},b);this.storage={impostor:!0,quality:"medium",sampleLevel:0,theme:"dark",overview:!0,rotateSpeed:2,zoomSpeed:1.2,panSpeed:.8,clipNear:0,clipFar:100,clipDist:10,fogNear:50,fogFar:100,cameraFov:40,lightColor:14540253,lightIntensity:1,ambientColor:14540253,ambientIntensity:.2};for(var d in this.storage)void 0!==c[d]&&(this.storage[d]=c[d]);try{if(void 0===window.localStorage[this.id])window.localStorage[this.id]=
JSON.stringify(this.storage);else{var e=JSON.parse(window.localStorage[this.id]);for(d in e)this.storage[d]=e[d]}}catch(f){NGL.error("localStorage not accessible/available")}};
NGL.Preferences.prototype={constructor:NGL.Preferences,getKey:function(a){return this.storage[a]},setKey:function(a,b){this.storage[a]=b;try{window.localStorage[this.id]=JSON.stringify(this.storage),this.signals.keyChanged.dispatch(a,b)}catch(c){22===c.code||1014===c.code?NGL.error("localStorage full"):NGL.error("localStorage not accessible/available",c)}},clear:function(){try{delete window.localStorage[this.id]}catch(a){NGL.error("localStorage not accessible/available")}}};
NGL.makeComponent=function(a,b,c){var d;b instanceof NGL.Structure?d=new NGL.StructureComponent(a,b,c):b instanceof NGL.Surface||b instanceof NGL.Volume?d=new NGL.SurfaceComponent(a,b,c):b instanceof NGL.Script?d=new NGL.ScriptComponent(a,b,c):NGL.warn("NGL.makeComponent: object type unknown",b);return d};NGL.nextComponentId=0;
NGL.Component=function(a,b){Object.defineProperty(this,"id",{value:NGL.nextComponentId++});var c=b||{};this.name=c.name;this.uuid=THREE.Math.generateUUID();this.visible=void 0!==c.visible?c.visible:!0;c=Object.keys(this.signals);this.signals={};c.forEach(function(a){this.signals[a]=new signals.Signal},this);this.stage=a;this.viewer=a.viewer;this.reprList=[]};
NGL.Component.prototype={constructor:NGL.Component,type:"component",signals:{representationAdded:null,representationRemoved:null,visibilityChanged:null,requestGuiVisibility:null,statusChanged:null,nameChanged:null,disposed:null},addRepresentation:function(a,b,c){c=c||{};var d=this.stage.getParameters();c.quality=c.quality||d.quality;c.disableImpostor=NGL.defaults(c.disableImpostor,!d.impostor);c.visible=NGL.defaults(c.visible,!0);d=Object.assign({},c,{visible:this.visible&&c.visible});a=NGL.makeRepresentation(a,
b,this.viewer,d);a=new NGL.RepresentationComponent(this.stage,a,c,this);this.reprList.push(a);this.signals.representationAdded.dispatch(a);return a},addBufferRepresentation:function(a,b){return NGL.Component.prototype.addRepresentation.call(this,"buffer",a,b)},removeRepresentation:function(a){var b=this.reprList.indexOf(a);-1!==b&&this.reprList.splice(b,1);this.signals.representationRemoved.dispatch(a)},updateRepresentations:function(a){this.reprList.forEach(function(b){b.update(a)});this.stage.viewer.requestRender()},
clearRepresentations:function(){this.reprList.slice().forEach(function(a){a.dispose()})},dispose:function(){this.clearRepresentations();delete this.reprList;this.signals.disposed.dispatch()},setVisibility:function(a){this.visible=a;this.eachRepresentation(function(a){a.updateVisibility()});this.signals.visibilityChanged.dispatch(a);return this},setStatus:function(a){this.status=a;this.signals.statusChanged.dispatch(a);return this},setName:function(a){this.name=a;this.signals.nameChanged.dispatch(a);
return this},getCenter:function(){},requestGuiVisibility:function(a){this.signals.requestGuiVisibility.dispatch(a);return this},eachRepresentation:function(a){this.reprList.forEach(a)}};NGL.StructureComponent=function(a,b,c){c=c||{};c.name=void 0!==c.name?c.name:b.name;NGL.Component.call(this,a,c);this.structure=b;this.trajList=[];this.initSelection(c.sele);void 0!==c.assembly&&this.structure.setDefaultAssembly(c.assembly)};
NGL.StructureComponent.prototype=NGL.createObject(NGL.Component.prototype,{constructor:NGL.StructureComponent,type:"structure",signals:Object.assign({trajectoryAdded:null,trajectoryRemoved:null},NGL.Component.prototype.signals),initSelection:function(a){this.selection=new NGL.Selection(a);this.selection.signals.stringChanged.add(function(a){this.applySelection();this.rebuildRepresentations();this.rebuildTrajectories()},this);this.applySelection()},applySelection:function(){this.structure.setSelection(this.selection)},
setSelection:function(a){this.selection.setString(a);return this},rebuildRepresentations:function(){this.reprList.forEach(function(a){a.build(a.getParameters())},this)},rebuildTrajectories:function(){this.trajList.slice(0).forEach(function(a){a.trajectory.setStructure(this.structure)},this)},addRepresentation:function(a,b){return NGL.Component.prototype.addRepresentation.call(this,a,this.structure,b)},addTrajectory:function(a,b,c){c={i:c};a=NGL.makeTrajectory(a,this.structure,b);a.signals.frameChanged.add(function(a){this.updateRepresentations({position:!0})},
this);a=new NGL.TrajectoryComponent(this.stage,a,c,this);this.trajList.push(a);this.signals.trajectoryAdded.dispatch(a);return a},removeTrajectory:function(a){var b=this.trajList.indexOf(a);-1!==b&&this.trajList.splice(b,1);a.dispose();this.signals.trajectoryRemoved.dispatch(a)},dispose:function(){this.trajList.slice().forEach(function(a){a.dispose()});this.trajList=[];this.structure.dispose();NGL.Component.prototype.dispose.call(this)},centerView:function(a,b){var c;if(b){var d=new NGL.Selection(b);
c=this.structure.atomCenter(d);a&&(a=this.structure.getBoundingBox(d).size().length())}else c=this.structure.center,a&&(a=this.structure.boundingBox.size().length());this.viewer.centerView(a,c);return this},getCenter:function(){return this.structure.center},superpose:function(a,b,c,d,e,f){NGL.superpose(this.structure,a.structure,b,c,d,e,f);this.updateRepresentations({position:!0});return this},setVisibility:function(a){NGL.Component.prototype.setVisibility.call(this,a);this.trajList.forEach(function(b){b.setVisibility(a)});
return this}});NGL.SurfaceComponent=function(a,b,c){c=c||{};c.name=void 0!==c.name?c.name:b.name;NGL.Component.call(this,a,c);this.surface=b};
NGL.SurfaceComponent.prototype=NGL.createObject(NGL.Component.prototype,{constructor:NGL.SurfaceComponent,type:"surface",addRepresentation:function(a,b){return NGL.Component.prototype.addRepresentation.call(this,a,this.surface,b)},dispose:function(){this.surface.dispose();NGL.Component.prototype.dispose.call(this)},centerView:function(a){var b=this.surface.center;a&&(a=this.surface.boundingBox.size().length());this.viewer.centerView(a,b)}});
NGL.TrajectoryComponent=function(a,b,c,d){c=c||{};c.name=void 0!==c.name?c.name:b.name;NGL.Component.call(this,a,c);this.trajectory=b;this.parent=d;this.status="loaded";b.signals.frameChanged.add(function(a){this.signals.frameChanged.dispatch(a)},this);b.signals.playerChanged.add(function(a){this.signals.playerChanged.dispatch(a)},this);b.signals.gotNumframes.add(function(a){this.signals.gotNumframes.dispatch(a)},this);void 0!==c.i&&this.setFrame(c.i)};
NGL.TrajectoryComponent.prototype=NGL.createObject(NGL.Component.prototype,{constructor:NGL.TrajectoryComponent,type:"trajectory",signals:Object.assign({frameChanged:null,playerChanged:null,gotNumframes:null,parametersChanged:null},NGL.Component.prototype.signals),addRepresentation:function(a,b){return NGL.Component.prototype.addRepresentation.call(this,a,this.trajectory,b)},setFrame:function(a){this.trajectory.setFrame(a)},setParameters:function(a){this.trajectory.setParameters(a);this.signals.parametersChanged.dispatch(a);
return this},dispose:function(){this.trajectory.dispose();NGL.Component.prototype.dispose.call(this)},getCenter:function(){}});NGL.ScriptComponent=function(a,b,c){c=c||{};c.name=void 0!==c.name?c.name:b.name;NGL.Component.call(this,a,c);this.script=b;this.status="loaded";this.script.signals.nameChanged.add(function(a){this.setName(a)},this)};
NGL.ScriptComponent.prototype=NGL.createObject(NGL.Component.prototype,{constructor:NGL.ScriptComponent,type:"script",addRepresentation:function(a){},removeRepresentation:function(a){},run:function(){var a=this;this.setStatus("running");this.script.call(this.stage,function(){a.setStatus("finished")});this.setStatus("called")},dispose:function(){this.signals.disposed.dispatch()},setVisibility:function(a){},getCenter:function(){}});
NGL.RepresentationComponent=function(a,b,c,d){c=c||{};c.name=void 0!==c.name?c.name:b.type;NGL.Component.call(this,a,c);this.parent=d;this.setRepresentation(b)};
NGL.RepresentationComponent.prototype=NGL.createObject(NGL.Component.prototype,{constructor:NGL.RepresentationComponent,type:"representation",signals:Object.assign({parametersChanged:null},NGL.Component.prototype.signals),getType:function(){return this.repr.type},setRepresentation:function(a){this.repr&&this.repr.dispose();this.repr=a;this.stage.tasks.listen(this.repr.tasks);this.updateVisibility()},addRepresentation:function(a){},removeRepresentation:function(a){},dispose:function(){this.parent&&
this.parent.removeRepresentation(this);this.repr.dispose();this.signals.disposed.dispatch()},setVisibility:function(a){this.visible=a;this.updateVisibility();this.signals.visibilityChanged.dispatch(this.visible);return this},updateVisibility:function(){this.parent?this.repr.setVisibility(this.parent.visible&&this.visible):this.repr.setVisibility(this.visible)},update:function(a){this.repr.update(a);return this},build:function(a){this.repr.build(a);return this},setSelection:function(a){this.repr.setSelection(a);
return this},setParameters:function(a){this.repr.setParameters(a);this.signals.parametersChanged.dispatch(this.repr.getParameters());return this},getParameters:function(){return this.repr.getParameters()},setColor:function(a){this.repr.setColor(a);return this},getCenter:function(){}});NGL.Collection=function(a){this.list=a||[];a=this.list.length;for(var b=0;b<a;++b){var c=this.list[b];c.signals.disposed.add(function(){this._remove(c)},this)}};
NGL.Collection.prototype={constructor:NGL.Collection,_remove:function(a){a=this.list.indexOf(a);-1!==a&&this.list.splice(a,1)},_invoke:function(a,b){for(var c=this.list.length,d=0;d<c;++d){var e=this.list[d],f=e[a];"function"===typeof f&&f.apply(e,b)}return this},setVisibility:function(a){return this._invoke("setVisibility",[a])},setSelection:function(a){return this._invoke("setSelection",[a])},requestGuiVisibility:function(a){return this._invoke("requestGuiVisibility",[a])},dispose:function(){return this._invoke("dispose")}};
NGL.ComponentCollection=function(a){NGL.Collection.call(this,a)};NGL.ComponentCollection.prototype=NGL.createObject(NGL.Collection.prototype,{constructor:NGL.ComponentCollection,addRepresentation:function(a,b){return this._invoke("addRepresentation",[a,b])},centerView:function(a,b){return this._invoke("centerView",[a,b])}});NGL.RepresentationCollection=function(a){NGL.Collection.call(this,a)};
NGL.RepresentationCollection.prototype=NGL.createObject(NGL.Collection.prototype,{constructor:NGL.RepresentationCollection,setParameters:function(a){return this._invoke("setParameters",[a])},setColor:function(a){return this._invoke("setColor",[a])}});NGL.Resources["shader/CylinderImpostor.vert"]="// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.\n//\n//  All Rights Reserved\n//\n//  Permission to use, copy, modify, distribute, and distribute modified\n//  versions of this software and its built-in documentation for any\n//  purpose and without fee is hereby granted, provided that the above\n//  copyright notice appears in all copies and that both the copyright\n//  notice and this permission notice appear in supporting documentation,\n//  and that the name of Schrodinger, LLC not be used in advertising or\n//  publicity pertaining to distribution of the software without specific,\n//  written prior permission.\n//\n//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,\n//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN\n//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR\n//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE\n//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE\n//  USE OR PERFORMANCE OF THIS SOFTWARE.\n\n// Contributions by Alexander Rose\n// - ported to WebGL\n// - dual color\n// - picking color\n// - shift\n\nattribute vec3 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\nattribute float radius;\n\nvarying vec3 axis;\nvarying vec4 base_radius;\nvarying vec4 end_b;\nvarying vec3 U;\nvarying vec3 V;\nvarying vec4 w;\n\n#ifdef PICKING\n    attribute vec3 pickingColor;\n    attribute vec3 pickingColor2;\n    varying vec3 vPickingColor;\n    varying vec3 vPickingColor2;\n#else\n    // attribute vec3 color;\n    attribute vec3 color2;\n    varying vec3 vColor1;\n    varying vec3 vColor2;\n#endif\n\nuniform mat4 modelViewMatrixInverse;\nuniform float shift;\n\nvoid main(){\n\n    #ifdef PICKING\n        vPickingColor = pickingColor;\n        vPickingColor2 = pickingColor2;\n    #else\n        vColor1 = color;\n        vColor2 = color2;\n    #endif\n\n    // vRadius = radius;\n    base_radius.w = radius;\n\n    vec3 center = position;\n    vec3 dir = normalize( position2 - position1 );\n    float ext = length( position2 - position1 ) / 2.0;\n\n    vec3 cam_dir = normalize(\n        ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center\n    );\n\n    vec3 ldir;\n\n    float b = dot( cam_dir, dir );\n    end_b.w = b;\n    if( b < 0.0 ) // direction vector looks away, so flip\n        ldir = -ext * dir;\n    else // direction vector already looks in my direction\n        ldir = ext * dir;\n\n    vec3 left = normalize( cross( cam_dir, ldir ) );\n    vec3 leftShift = shift * left * radius;\n    if( b < 0.0 )\n        leftShift *= -1.0;\n    left = radius * left;\n    vec3 up = radius * normalize( cross( left, ldir ) );\n\n    // transform to modelview coordinates\n    axis = normalize( normalMatrix * ldir );\n    U = normalize( normalMatrix * up );\n    V = normalize( normalMatrix * left );\n\n    vec4 base4 = modelViewMatrix * vec4( center - ldir + leftShift, 1.0 );\n    base_radius.xyz = base4.xyz / base4.w;\n\n    vec4 top_position = modelViewMatrix * vec4( center + ldir + leftShift, 1.0 );\n    vec4 end4 = top_position;\n    end_b.xyz = end4.xyz / end4.w;\n\n    w = modelViewMatrix * vec4(\n        center + leftShift + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0\n    );\n\n    gl_Position = projectionMatrix * w;\n\n    // avoid clipping\n    gl_Position.z = 1.0;\n\n}";
NGL.Resources["shader/CylinderImpostor.frag"]="#define STANDARD\n#define IMPOSTOR\n\n// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.\n//\n//  All Rights Reserved\n//\n//  Permission to use, copy, modify, distribute, and distribute modified\n//  versions of this software and its built-in documentation for any\n//  purpose and without fee is hereby granted, provided that the above\n//  copyright notice appears in all copies and that both the copyright\n//  notice and this permission notice appear in supporting documentation,\n//  and that the name of Schrodinger, LLC not be used in advertising or\n//  publicity pertaining to distribution of the software without specific,\n//  written prior permission.\n//\n//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,\n//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN\n//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR\n//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE\n//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE\n//  USE OR PERFORMANCE OF THIS SOFTWARE.\n\n// Contributions by Alexander Rose\n// - ported to WebGL\n// - dual color\n// - picking color\n// - custom clipping\n// - three.js lighting\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float nearClip;\nuniform mat4 projectionMatrix;\n\nvarying vec3 axis;\nvarying vec4 base_radius;\nvarying vec4 end_b;\nvarying vec3 U;\nvarying vec3 V;\nvarying vec4 w;\n\n#ifdef PICKING\n    uniform float objectId;\n    varying vec3 vPickingColor;\n    varying vec3 vPickingColor2;\n#else\n    varying vec3 vColor1;\n    varying vec3 vColor2;\n    #include common\n    #include fog_pars_fragment\n    #include bsdfs\n    #include ambient_pars\n    #include lights_pars\n    #include lights_standard_pars_fragment\n#endif\n\nbool interior = false;\n\nfloat distSq3( vec3 v3a, vec3 v3b ){\n\n    return (\n        ( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +\n        ( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +\n        ( v3a.z - v3b.z ) * ( v3a.z - v3b.z )\n    );\n\n}\n\n// round caps\n// http://sourceforge.net/p/pymol/code/HEAD/tree/trunk/pymol/data/shaders/cylinder.fs\n\n// void main2(void)\n// {\n//     #ifdef PICKING\n//         gl_FragColor = vec4( vPickingColor, 1.0 );\n//     #else\n//         gl_FragColor = vec4( vColor, 1.0 );\n//     #endif\n// }\n\n// Calculate depth based on the given camera position.\nfloat calcDepth( in vec3 cameraPos ){\n    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat calcClip( vec3 cameraPos ){\n    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );\n}\n\nvoid main(){\n\n    vec3 point = w.xyz / w.w;\n\n    // unpacking\n    vec3 base = base_radius.xyz;\n    float vRadius = base_radius.w;\n    vec3 end = end_b.xyz;\n    float b = end_b.w;\n\n    vec3 end_cyl = end;\n    vec3 surface_point = point;\n\n    const float ortho=0.0;\n\n    vec3 ray_target = surface_point;\n    vec3 ray_origin = vec3(0.0);\n    vec3 ray_direction = mix(normalize(ray_origin - ray_target), vec3(0.0, 0.0, 1.0), ortho);\n    mat3 basis = mat3( U, V, axis );\n\n    vec3 diff = ray_target - 0.5 * (base + end_cyl);\n    vec3 P = diff * basis;\n\n    // angle (cos) between cylinder cylinder_axis and ray direction\n    float dz = dot( axis, ray_direction );\n\n    float radius2 = vRadius*vRadius;\n\n    // calculate distance to the cylinder from ray origin\n    vec3 D = vec3(dot(U, ray_direction),\n                dot(V, ray_direction),\n                dz);\n    float a0 = P.x*P.x + P.y*P.y - radius2;\n    float a1 = P.x*D.x + P.y*D.y;\n    float a2 = D.x*D.x + D.y*D.y;\n\n    // calculate a dicriminant of the above quadratic equation\n    float d = a1*a1 - a0*a2;\n    if (d < 0.0)\n        // outside of the cylinder\n        discard;\n\n    float dist = (-a1 + sqrt(d)) / a2;\n\n    // point of intersection on cylinder surface\n    vec3 new_point = ray_target + dist * ray_direction;\n\n    vec3 tmp_point = new_point - base;\n    vec3 _normal = normalize( tmp_point - axis * dot(tmp_point, axis) );\n\n    ray_origin = mix( ray_origin, surface_point, ortho );\n\n    // test front cap\n    float cap_test = dot( new_point - base, axis );\n\n    // to calculate caps, simply check the angle between\n    // the point of intersection - cylinder end vector\n    // and a cap plane normal (which is the cylinder cylinder_axis)\n    // if the angle < 0, the point is outside of cylinder\n    // test front cap\n\n    #ifndef CAP\n        vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\n        vec3 tmp_point2 = new_point2 - base;\n    #endif\n\n    // flat\n    if (cap_test < 0.0)\n    {\n        // ray-plane intersection\n        float dNV = dot(-axis, ray_direction);\n        if (dNV < 0.0)\n            discard;\n        float near = dot(-axis, (base)) / dNV;\n        new_point = ray_direction * near + ray_origin;\n        // within the cap radius?\n        if (dot(new_point - base, new_point-base) > radius2)\n            discard;\n\n        #ifdef CAP\n            _normal = axis;\n        #else\n            _normal = -normalize( tmp_point2 - axis * dot(tmp_point2, axis) );\n        #endif\n    }\n\n    // test end cap\n    cap_test = dot((new_point - end_cyl), axis);\n\n    // flat\n    if( cap_test > 0.0 )\n    {\n        // ray-plane intersection\n        float dNV = dot(axis, ray_direction);\n        if (dNV < 0.0)\n            discard;\n        float near = dot(axis, end_cyl) / dNV;\n        new_point = ray_direction * near + ray_origin;\n        // within the cap radius?\n        if( dot(new_point - end_cyl, new_point-base) > radius2 )\n            discard;\n\n        #ifdef CAP\n            _normal = axis;\n        #else\n            _normal = -normalize( tmp_point2 - axis * dot(tmp_point2, axis) );\n        #endif\n    }\n\n    gl_FragDepthEXT = calcDepth( new_point );\n\n    #ifdef NEAR_CLIP\n        if( calcClip( new_point ) > 0.0 ){\n            dist = (-a1 - sqrt(d)) / a2;\n            new_point = ray_target + dist * ray_direction;\n            if( calcClip( new_point ) > 0.0 )\n                discard;\n            interior = true;\n            gl_FragDepthEXT = calcDepth( new_point );\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n            }\n        }else if( gl_FragDepthEXT <= 0.0 ){\n            dist = (-a1 - sqrt(d)) / a2;\n            new_point = ray_target + dist * ray_direction;\n            interior = true;\n            gl_FragDepthEXT = calcDepth( new_point );\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n            }\n        }\n    #else\n        if( gl_FragDepthEXT <= 0.0 ){\n            dist = (-a1 - sqrt(d)) / a2;\n            new_point = ray_target + dist * ray_direction;\n            interior = true;\n            gl_FragDepthEXT = calcDepth( new_point );\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n            }\n        }\n    #endif\n\n    // this is a workaround necessary for Mac\n    // otherwise the modified fragment won't clip properly\n    if (gl_FragDepthEXT < 0.0)\n        discard;\n    if (gl_FragDepthEXT > 1.0)\n        discard;\n\n    #ifdef PICKING\n\n        if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){\n            if( b < 0.0 ){\n                gl_FragColor = vec4( vPickingColor, objectId );\n            }else{\n                gl_FragColor = vec4( vPickingColor2, objectId );\n            }\n        }else{\n            if( b > 0.0 ){\n                gl_FragColor = vec4( vPickingColor, objectId );\n            }else{\n                gl_FragColor = vec4( vPickingColor2, objectId );\n            }\n        }\n\n    #else\n\n        vec3 vViewPosition = -new_point;\n        vec3 vNormal = _normal;\n        vec3 vColor;\n\n        if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){\n            if( b < 0.0 ){\n                vColor = vColor1;\n            }else{\n                vColor = vColor2;\n            }\n        }else{\n            if( b > 0.0 ){\n                vColor = vColor1;\n            }else{\n                vColor = vColor2;\n            }\n        }\n\n        vec4 diffuseColor = vec4( diffuse, opacity );\n        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n        vec3 totalEmissiveLight = emissive;\n\n        #include color_fragment\n        #include roughnessmap_fragment\n        #include metalnessmap_fragment\n        #include normal_fragment\n        if( interior ){\n            normal = vec3( 0.0, 0.0, 0.4 );\n        }\n\n        #include lights_standard_fragment\n        #include lights_template\n\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n        #include premultiplied_alpha_fragment\n        #include tonemapping_fragment\n        #include encodings_fragment\n        #include fog_fragment\n\n    #endif\n\n}";
NGL.Resources["shader/HyperballStickImpostor.vert"]="// Copyright (C) 2010-2011 by\n// Laboratoire de Biochimie Theorique (CNRS),\n// Laboratoire d'Informatique Fondamentale d'Orleans (Universite d'Orleans), (INRIA) and\n// Departement des Sciences de la Simulation et de l'Information (CEA).\n//\n// License: CeCILL-C license (http://www.cecill.info/)\n//\n// Contact: Marc Baaden\n// E-mail: baaden@smplinux.de\n// Webpage: http://hyperballs.sourceforge.net\n\n// Contributions by Alexander Rose\n// - ported to WebGL\n// - dual color\n// - picking color\n\nattribute vec3 mapping;\nattribute float radius;\nattribute float radius2;\nattribute vec3 position1;\nattribute vec3 position2;\n\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n\n#ifdef PICKING\n    attribute vec3 pickingColor;\n    attribute vec3 pickingColor2;\n    varying vec3 vPickingColor;\n    varying vec3 vPickingColor2;\n#else\n    // attribute vec3 color;\n    attribute vec3 color2;\n    varying vec3 vColor1;\n    varying vec3 vColor2;\n#endif\n\nuniform float shrink;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrixInverse;\n\nvoid main(){\n\n    vRadius = radius;\n    vRadius2 = radius2;\n\n    vec4 spaceposition;\n    vec3 position_atom1;\n    vec3 position_atom2;\n    vec4 vertex_position;\n\n    #ifdef PICKING\n        vPickingColor = pickingColor;\n        vPickingColor2 = pickingColor2;\n    #else\n        vColor1 = color;\n        vColor2 = color2;\n    #endif\n\n    float radius1 = radius;\n\n    position_atom1 = position1;\n    position_atom2 = position2;\n\n    float distance = distance( position_atom1, position_atom2 );\n\n    spaceposition.z = mapping.z * distance;\n\n    if (radius1 > radius2) {\n        spaceposition.y = mapping.y * 1.5 * radius1;\n        spaceposition.x = mapping.x * 1.5 * radius1;\n    } else {\n        spaceposition.y = mapping.y * 1.5 * radius2;\n        spaceposition.x = mapping.x * 1.5 * radius2;\n    }\n    spaceposition.w = 1.0;\n\n    vec4 e3 = vec4( 1.0 );\n    vec3 e1, e1_temp, e2, e2_temp;\n\n    // Calculation of bond direction: e3\n    e3.xyz = normalize(position_atom1-position_atom2);\n\n    // little hack to avoid some problems of precision due to graphic card limitation using float: To improve soon\n    if (e3.z == 0.0) { e3.z = 0.0000000000001;}\n    if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}\n    if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}\n    if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}\n\n    // Focus calculation\n    vec4 focus = vec4( 1.0 );\n    focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +\n        ( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));\n    focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +\n        ( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));\n    focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +\n        ( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));\n\n    // e1 calculation\n    e1.x = 1.0;\n    e1.y = 1.0;\n    e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\n    e1_temp = e1 - focus.xyz;\n    e1 = normalize(e1_temp);\n\n    // e2 calculation\n    e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;\n    e2 = normalize(e2_temp);\n\n    //ROTATION:\n    // final form of change of basis matrix:\n    mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );\n    // Apply rotation and translation to the bond primitive\n    vertex_position.xyz = R * spaceposition.xyz;\n    vertex_position.w = 1.0;\n\n    // TRANSLATION:\n    vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;\n    vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;\n    vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;\n\n    // New position\n    gl_Position = modelViewProjectionMatrix * vertex_position;\n\n    vec4 i_near, i_far;\n\n    // Calculate near from position\n    vec4 near = gl_Position;\n    near.z = 0.0 ;\n    near = modelViewProjectionMatrixInverse * near;\n    i_near = near;\n\n    // Calculate far from position\n    vec4 far = gl_Position;\n    far.z = far.w ;\n    i_far = modelViewProjectionMatrixInverse * far;\n\n    prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );\n    prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );\n\n    float Rsquare = (radius1*radius1/shrink) - (\n                        (position_atom1.x - focus.x)*(position_atom1.x - focus.x) +\n                        (position_atom1.y - focus.y)*(position_atom1.y - focus.y) +\n                        (position_atom1.z - focus.z)*(position_atom1.z - focus.z)\n                    );\n\n    focus.w = Rsquare;\n\n    matrix_near = mat4( i_near, i_far, focus, e3 );\n\n    // avoid clipping\n    gl_Position.z = 1.0;\n\n}";
NGL.Resources["shader/HyperballStickImpostor.frag"]="#define STANDARD\n#define IMPOSTOR\n\n// Copyright (C) 2010-2011 by\n// Laboratoire de Biochimie Theorique (CNRS),\n// Laboratoire d'Informatique Fondamentale d'Orleans (Universite d'Orleans), (INRIA) and\n// Departement des Sciences de la Simulation et de l'Information (CEA).\n//\n// License: CeCILL-C license (http://www.cecill.info/)\n//\n// Contact: Marc Baaden\n// E-mail: baaden@smplinux.de\n// Webpage: http://hyperballs.sourceforge.net\n\n// Contributions by Alexander Rose\n// - ported to WebGL\n// - dual color\n// - picking color\n// - custom clipping\n// - three.js lighting\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float nearClip;\nuniform float shrink;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrixInverseTranspose;\nuniform mat4 projectionMatrix;\n\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n\n#ifdef PICKING\n    uniform float objectId;\n    varying vec3 vPickingColor;\n    varying vec3 vPickingColor2;\n#else\n    varying vec3 vColor1;\n    varying vec3 vColor2;\n    #include common\n    #include fog_pars_fragment\n    #include bsdfs\n    #include ambient_pars\n    #include lights_pars\n    #include lights_standard_pars_fragment\n#endif\n\nbool interior = false;\n\nfloat calcClip( vec4 cameraPos ){\n    return dot( cameraPos, vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );\n}\n\nfloat calcClip( vec3 cameraPos ){\n    return calcClip( vec4( cameraPos, 1.0 ) );\n}\n\nfloat calcDepth( in vec3 cameraPos ){\n    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nstruct Ray {\n    vec3 origin ;\n    vec3 direction ;\n};\n\nbool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){\n    float a = x3.x;\n    float b = x3.y;\n    float c = x3.z;\n    float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;\n    float l = a*M.x+b*M.y+c*M.z+d;\n    if (l<0.0) {return true;}\n    else{return false;}\n}\n\nvec3 isect_surf(Ray r, mat4 matrix_coef){\n    vec4 direction = vec4(r.direction, 0.0);\n    vec4 origin = vec4(r.origin, 1.0);\n    float a = dot(direction,(matrix_coef*direction));\n    float b = dot(origin,(matrix_coef*direction));\n    float c = dot(origin,(matrix_coef*origin));\n    float delta =b*b-a*c;\n    gl_FragColor.a = 1.0;\n    if (delta<0.0){\n        discard;\n        // gl_FragColor.a = 0.5;\n    }\n    float t1 =(-b-sqrt(delta))/a;\n\n    // Second solution not necessary if you don't want\n    // to see inside spheres and cylinders, save some fps\n    //float t2 = (-b+sqrt(delta)) / a  ;\n    //float t =(t1<t2) ? t1 : t2;\n\n    return r.origin+t1*r.direction;\n}\n\nvec3 isect_surf2(Ray r, mat4 matrix_coef){\n    vec4 direction = vec4(r.direction, 0.0);\n    vec4 origin = vec4(r.origin, 1.0);\n    float a = dot(direction,(matrix_coef*direction));\n    float b = dot(origin,(matrix_coef*direction));\n    float c = dot(origin,(matrix_coef*origin));\n    float delta =b*b-a*c;\n    gl_FragColor.a = 1.0;\n    if (delta<0.0){\n        discard;\n        // gl_FragColor.a = 0.5;\n    }\n    float t2 =(-b+sqrt(delta))/a;\n\n    return r.origin+t2*r.direction;\n}\n\nRay primary_ray(vec4 near1, vec4 far1){\n    vec3 near=near1.xyz/near1.w;\n    vec3 far=far1.xyz/far1.w;\n    return Ray(near,far-near);\n}\n\nfloat update_z_buffer(vec3 M, mat4 ModelViewP){\n    float  depth1;\n    vec4 Ms=(ModelViewP*vec4(M,1.0));\n    return depth1=(1.0+Ms.z/Ms.w)/2.0;\n}\n\nvoid main(){\n\n    float radius = max( vRadius, vRadius2 );\n\n    vec4 i_near, i_far, focus;\n    vec3 e3, e1, e1_temp, e2;\n\n    i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);\n    i_far  = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);\n    focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);\n    e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);\n\n    e1.x = 1.0;\n    e1.y = 1.0;\n    e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\n    e1_temp = e1 - focus.xyz;\n    e1 = normalize(e1_temp);\n\n    e2 = normalize(cross(e1,e3));\n\n    vec4 equation = focus;\n\n    float shrinkfactor = shrink;\n    float t1 = -1.0/(1.0-shrinkfactor);\n    float t2 = 1.0/(shrinkfactor);\n    // float t3 = 2.0/(shrinkfactor);\n\n    vec4 colonne1, colonne2, colonne3, colonne4;\n    mat4 mat;\n\n    vec3 equation1 = vec3(t2,t2,t1);\n\n    float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;\n    float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;\n    float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;\n\n    float A11 = equation1.x*e1.x*e1.x +  equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;\n    float A21 = equation1.x*e1.x*e1.y +  equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;\n    float A31 = equation1.x*e1.x*e1.z +  equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;\n    float A41 = equation1.x*e1.x*A1   +  equation1.y*e2.x*A2   + equation1.z*e3.x*A3;\n\n    float A22 = equation1.x*e1.y*e1.y +  equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;\n    float A32 = equation1.x*e1.y*e1.z +  equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;\n    float A42 = equation1.x*e1.y*A1   +  equation1.y*e2.y*A2   + equation1.z*e3.y*A3;\n\n    float A33 = equation1.x*e1.z*e1.z +  equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;\n    float A43 = equation1.x*e1.z*A1   +  equation1.y*e2.z*A2   + equation1.z*e3.z*A3;\n\n    float A44 = equation1.x*A1*A1 +  equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;\n\n    colonne1 = vec4(A11,A21,A31,A41);\n    colonne2 = vec4(A21,A22,A32,A42);\n    colonne3 = vec4(A31,A32,A33,A43);\n    colonne4 = vec4(A41,A42,A43,A44);\n\n    mat = mat4(colonne1,colonne2,colonne3,colonne4);\n\n    // Ray calculation using near and far\n    Ray ray = primary_ray(i_near,i_far) ;\n\n    // Intersection between ray and surface for each pixel\n    vec3 M;\n    M = isect_surf(ray, mat);\n\n    // cut the extremities of bonds to superimpose bond and spheres surfaces\n    if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\n\n    // Transform normal to model space to view-space\n    vec4 M1 = vec4(M,1.0);\n    vec4 M2 =  mat*M1;\n    // vec3 _normal = normalize( ( modelViewMatrixInverseTranspose * M2 ).xyz );\n    vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;\n\n    // Recalculate the depth in function of the new pixel position\n    gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n\n    #ifdef NEAR_CLIP\n        if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){\n            M = isect_surf2(ray, mat);\n            if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )\n                discard;\n            interior = true;\n            gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / radius ) );\n            }\n        }else if( gl_FragDepthEXT <= 0.0 ){\n            M = isect_surf2(ray, mat);\n            interior = true;\n            gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n            }\n        }\n    #else\n        if( gl_FragDepthEXT <= 0.0 ){\n            M = isect_surf2(ray, mat);\n            interior = true;\n            gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n            }\n        }\n    #endif\n\n    // cut the extremities of bonds to superimpose bond and spheres surfaces\n    if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\n\n    if (gl_FragDepthEXT < 0.0)\n        discard;\n    if (gl_FragDepthEXT > 1.0)\n        discard;\n\n    // Mix the color bond in function of the two atom colors\n    float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /\n                                distance(prime2.xyz,prime1.xyz);\n\n    #ifdef PICKING\n\n        if( distance_ratio > 0.5 ){\n            gl_FragColor = vec4( vPickingColor, objectId );\n        }else{\n            gl_FragColor = vec4( vPickingColor2, objectId );\n        }\n\n    #else\n\n        vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;\n        vec3 vNormal = _normal;\n        vec3 vColor;\n\n        if( distance_ratio>0.5 ){\n            vColor = vColor1;\n        }else{\n            vColor = vColor2;\n        }\n\n        vec4 diffuseColor = vec4( diffuse, opacity );\n        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.01 ), vec3( 0.01 ), vec3( 0.01 ), vec3( 0.0 ) );\n        vec3 totalEmissiveLight = emissive;\n\n        #include color_fragment\n        #include roughnessmap_fragment\n        #include metalnessmap_fragment\n        //#include normal_fragment\n        vec3 normal = normalize( vNormal );\n        if( interior ){\n            normal = vec3( 0.0, 0.0, 0.4 );\n        }\n\n        #include lights_standard_fragment\n        #include lights_template\n\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n        #include premultiplied_alpha_fragment\n        #include tonemapping_fragment\n        #include encodings_fragment\n        #include fog_fragment\n\n    #endif\n\n}";
NGL.Resources["shader/Line.vert"]="varying vec3 vViewPosition;\n\n#include color_pars_vertex\n\nvoid main(){\n\n    #include color_vertex\n    #include begin_vertex\n    #include project_vertex\n\n    vViewPosition = -mvPosition.xyz;\n\n}";NGL.Resources["shader/Line.frag"]="uniform float opacity;\nuniform float nearClip;\n\nvarying vec3 vViewPosition;\n\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n\nvoid main(){\n\n    #include nearclip_fragment\n\n    gl_FragColor = vec4( vColor, opacity );\n\n    #include premultiplied_alpha_fragment\n    #include tonemapping_fragment\n    #include encodings_fragment\n    #include fog_fragment\n\n}";
NGL.Resources["shader/Mesh.vert"]="#define STANDARD\n\n#if defined( PICKING )\n    attribute vec3 pickingColor;\n    varying vec3 vPickingColor;\n#elif defined( NOLIGHT )\n    varying vec3 vColor;\n#else\n    varying vec3 vViewPosition;\n    #include color_pars_vertex\n    #ifndef FLAT_SHADED\n        varying vec3 vNormal;\n    #endif\n#endif\n\n#include common\n\nvoid main(){\n\n    #if defined( PICKING )\n        vPickingColor = pickingColor;\n    #elif defined( NOLIGHT )\n        vColor = color;\n    #else\n        #include color_vertex\n        #include beginnormal_vertex\n        #include defaultnormal_vertex\n        #ifndef FLAT_SHADED  // Normal computed with derivatives when FLAT_SHADED\n            vNormal = normalize( transformedNormal );\n        #endif\n    #endif\n\n    #include begin_vertex\n    #include project_vertex\n\n    #if !defined( PICKING ) && !defined( NOLIGHT )\n        vViewPosition = -mvPosition.xyz;\n    #endif\n}";
NGL.Resources["shader/Mesh.frag"]="#define STANDARD\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float nearClip;\n\n#if defined( PICKING )\n    uniform float objectId;\n    varying vec3 vPickingColor;\n#elif defined( NOLIGHT )\n    varying vec3 vColor;\n#else\n    varying vec3 vViewPosition;\n    #ifndef FLAT_SHADED\n        varying vec3 vNormal;\n    #endif\n    #include common\n    #include color_pars_fragment\n    #include fog_pars_fragment\n    #include bsdfs\n    #include ambient_pars\n    #include lights_pars\n    #include lights_standard_pars_fragment\n#endif\n\nvoid main(){\n\n    #include nearclip_fragment\n\n    #if defined( PICKING )\n\n        gl_FragColor = vec4( vPickingColor, objectId );\n\n    #elif defined( NOLIGHT )\n\n        gl_FragColor = vec4( vColor, opacity );\n\n    #else\n\n        vec4 diffuseColor = vec4( diffuse, opacity );\n        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n        vec3 totalEmissiveLight = emissive;\n\n        #include color_fragment\n        #include roughnessmap_fragment\n        #include metalnessmap_fragment\n        #include normal_fragment\n\n        #include dull_interior_fragment\n\n        #include lights_standard_fragment\n        #include lights_template\n\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n        #include premultiplied_alpha_fragment\n        #include tonemapping_fragment\n        #include encodings_fragment\n        #include fog_fragment\n\n        #include opaque_back_fragment\n\n    #endif\n\n}";
NGL.Resources["shader/Point.vert"]="uniform float nearClip;\nuniform float size;\nuniform float canvasHeight;\nuniform float pixelRatio;\n\nvarying vec3 vViewPosition;\n\n#include color_pars_vertex\n#include common\n\nvoid main(){\n\n    #include color_vertex\n    #include begin_vertex\n    #include project_vertex\n\n    #ifdef USE_SIZEATTENUATION\n        gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );\n    #else\n        gl_PointSize = size * pixelRatio;\n    #endif\n\n    vViewPosition = -mvPosition.xyz;\n\n    #include nearclip_vertex\n\n}";
NGL.Resources["shader/Point.frag"]="uniform vec3 diffuse;\nuniform float opacity;\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_MAP\n    uniform sampler2D map;\n#endif\n\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n\nvoid main(){\n\n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vec4( diffuse, 1.0 );\n\n    #ifdef USE_MAP\n        diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n    #endif\n\n    #include color_fragment\n    #include alphatest_fragment\n\n    outgoingLight = diffuseColor.rgb;\n\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n\n    #include premultiplied_alpha_fragment\n    #include tonemapping_fragment\n    #include encodings_fragment\n    #include fog_fragment\n\n}";
NGL.Resources["shader/Quad.vert"]="varying vec2 vUv;\n\nvoid main() {\n\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}";NGL.Resources["shader/Quad.frag"]="varying vec2 vUv;\n\nuniform sampler2D tForeground;\nuniform float scale;\n\nvoid main() {\n\n    vec4 foreground = texture2D( tForeground, vUv );\n    gl_FragColor = foreground * scale;\n\n}";NGL.Resources["shader/Ribbon.vert"]="#define STANDARD\n\nvarying vec3 vViewPosition;\n\nattribute vec3 dir;\nattribute float size;\n\n#ifdef PICKING\n    attribute vec3 pickingColor;\n    varying vec3 vPickingColor;\n#else\n    #include color_pars_vertex\n    #ifndef FLAT_SHADED\n        varying vec3 vNormal;\n    #endif\n#endif\n\n#include common\n\nvoid main(void){\n\n    #ifdef PICKING\n        vPickingColor = pickingColor;\n    #else\n        #include color_vertex\n        #include beginnormal_vertex\n        #include defaultnormal_vertex\n        #ifndef FLAT_SHADED  // Normal computed with derivatives when FLAT_SHADED\n            vNormal = normalize( transformedNormal );\n        #endif\n    #endif\n\n    #include begin_vertex\n    transformed += normalize( dir ) * size;\n    #include project_vertex\n    vViewPosition = -mvPosition.xyz;\n\n}";
NGL.Resources["shader/SDFFont.vert"]="uniform float nearClip;\n\nvarying vec3 vViewPosition;\nvarying vec2 texCoord;\n\nattribute vec2 mapping;\nattribute vec2 inputTexCoord;\nattribute float inputSize;\n\n#include color_pars_vertex\n#include common\n\nvoid main(void){\n\n    #include color_vertex\n    texCoord = inputTexCoord;\n\n    vec4 cameraPos = ( modelViewMatrix * vec4( position, 1.0 ) );\n    vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );\n    cameraCornerPos.xy += mapping * inputSize * 0.01;\n    cameraCornerPos.z += 0.5;\n\n    gl_Position = projectionMatrix * cameraCornerPos;\n\n    vViewPosition = -cameraCornerPos.xyz;\n\n    #include nearclip_vertex\n\n}";
NGL.Resources["shader/SDFFont.frag"]="uniform sampler2D fontTexture;\nuniform float opacity;\n\nvarying vec3 vViewPosition;\nvarying vec2 texCoord;\n\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n\n#ifdef SDF\n    const float smoothness = 16.0;\n#else\n    const float smoothness = 256.0;\n#endif\nconst float gamma = 2.2;\n\nvoid main(){\n\n    // retrieve signed distance\n    float sdf = texture2D( fontTexture, texCoord ).a;\n\n    // perform adaptive anti-aliasing of the edges\n    float w = clamp(\n        smoothness * ( abs( dFdx( texCoord.x ) ) + abs( dFdy( texCoord.y ) ) ),\n        0.0,\n        0.5\n    );\n    float a = smoothstep( 0.5 - w, 0.5 + w, sdf );\n\n    // gamma correction for linear attenuation\n    a = pow( a, 1.0 / gamma );\n    if( a < 0.2 ) discard;\n    a *= opacity;\n\n    vec3 outgoingLight = vColor;\n\n    gl_FragColor = vec4( outgoingLight, a );\n\n    #include premultiplied_alpha_fragment\n    #include tonemapping_fragment\n    #include encodings_fragment\n    #include fog_fragment\n\n}";
NGL.Resources["shader/SphereImpostor.vert"]='uniform mat4 projectionMatrixInverse;\nuniform float nearClip;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vViewPosition;\n\nattribute vec2 mapping;\nattribute float radius;\n\n#ifdef PICKING\n    attribute vec3 pickingColor;\n    varying vec3 vPickingColor;\n#else\n    #include color_pars_vertex\n#endif\n\nconst mat4 D = mat4(\n    1.0, 0.0, 0.0, 0.0,\n    0.0, 1.0, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.0, 0.0, 0.0, -1.0\n);\n\nmat4 transpose( in mat4 inMatrix ) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}\n\n//------------------------------------------------------------------------------\n// Compute point size and center using the technique described in:\n// "GPU-Based Ray-Casting of Quadratic Surfaces"\n// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.\n//\n// Code based on\n/*=========================================================================\n\n Program:   Visualization Toolkit\n Module:    Quadrics_fs.glsl and Quadrics_vs.glsl\n\n Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n All rights reserved.\n See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n This software is distributed WITHOUT ANY WARRANTY; without even\n the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n PURPOSE.  See the above copyright notice for more information.\n\n =========================================================================*/\n\n// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl\n// .SECTION Thanks\n// <verbatim>\n//\n//  This file is part of the PointSprites plugin developed and contributed by\n//\n//  Copyright (c) CSCS - Swiss National Supercomputing Centre\n//                EDF - Electricite de France\n//\n//  John Biddiscombe, Ugo Varetto (CSCS)\n//  Stephane Ploix (EDF)\n//\n// </verbatim>\n//\n// Contributions by Alexander Rose\n// - ported to WebGL\n// - adapted to work with quads\nvoid ComputePointSizeAndPositionInClipCoordSphere(){\n\n    vec2 xbc;\n    vec2 ybc;\n\n    mat4 T = mat4(\n        radius, 0.0, 0.0, 0.0,\n        0.0, radius, 0.0, 0.0,\n        0.0, 0.0, radius, 0.0,\n        position.x, position.y, position.z, 1.0\n    );\n\n    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );\n    float A = dot( R[ 3 ], D * R[ 3 ] );\n    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );\n    float C = dot( R[ 0 ], D * R[ 0 ] );\n    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;\n\n    A = dot( R[ 3 ], D * R[ 3 ] );\n    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );\n    C = dot( R[ 1 ], D * R[ 1 ] );\n    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;\n\n    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );\n    gl_Position.xy -= mapping * vec2( sx, sy );\n    gl_Position.xy *= gl_Position.w;\n\n}\n\nvoid main(void){\n\n    #ifdef PICKING\n        vPickingColor = pickingColor;\n    #else\n        #include color_vertex\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    mvPosition.z -= radius;  // avoid clipping, added again in fragment shader\n\n    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );\n    ComputePointSizeAndPositionInClipCoordSphere();\n\n    vRadius = radius;\n    vPoint = ( projectionMatrixInverse * gl_Position ).xyz;\n    vViewPosition = -mvPosition.xyz;\n\n}';
NGL.Resources["shader/SphereImpostor.frag"]='#define STANDARD\n#define IMPOSTOR\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float nearClip;\nuniform mat4 projectionMatrix;\n\n// uniform vec3 specular;\n// uniform float shininess;\n\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vViewPosition;\n\n#ifdef PICKING\n    uniform float objectId;\n    varying vec3 vPickingColor;\n#else\n    #include common\n    #include color_pars_fragment\n    #include fog_pars_fragment\n    #include bsdfs\n    #include ambient_pars\n    #include lights_pars\n    // #include lights_phong_pars_fragment\n    #include lights_standard_pars_fragment\n#endif\n\nbool flag2 = false;\nbool interior = false;\nvec3 cameraPos;\nvec3 cameraNormal;\n\n// vec4 poly_color = gl_Color;\n//   if(uf_use_border_hinting == 1.0)\n//   {\n//     vec3 wc_eye_dir = normalize(wc_sp_pt);\n//     float n_dot_e   = abs(dot(wc_sp_nrml,wc_eye_dir));\n//     float alpha     = max(uf_border_color_start_cosine - n_dot_e,0.0)/uf_border_color_start_cosine;\n//     poly_color      = mix(gl_Color,uf_border_color,0.75*alpha);\n//   }\n//   color += (diff + amb)*poly_color + spec*gl_FrontMaterial.specular;\n\n// Calculate depth based on the given camera position.\nfloat calcDepth( in vec3 cameraPos ){\n    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat calcClip( vec3 cameraPos ){\n    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );\n}\n\nbool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){\n\n    vec3 cameraSpherePos2 = -vViewPosition;\n    cameraSpherePos2.z += vRadius;\n\n    vec3 rayDirection = normalize( vPoint );\n\n    float B = -2.0 * dot( rayDirection, cameraSpherePos2 );\n    float C = dot( cameraSpherePos2, cameraSpherePos2 ) - ( vRadius * vRadius );\n\n    float det = ( B * B ) - ( 4.0 * C );\n    if( det < 0.0 ){\n        discard;\n        return false;\n    }else{\n        float sqrtDet = sqrt( det );\n        float posT = ( -B + sqrtDet ) / 2.0;\n        float negT = ( -B - sqrtDet ) / 2.0;\n\n        float intersectT = min(posT, negT);\n        cameraPos = rayDirection * intersectT;\n\n        #ifdef NEAR_CLIP\n            if( calcDepth( cameraPos ) <= 0.0 ){\n                cameraPos = rayDirection * max( posT, negT );\n                interior = true;\n                return false;\n            }else if( calcClip( cameraPos ) > 0.0 ){\n                cameraPos = rayDirection * max( posT, negT );\n                interior = true;\n                flag2 = true;\n                return false;\n            }else{\n                cameraNormal = normalize( cameraPos - cameraSpherePos2 );\n            }\n        #else\n            if( calcDepth( cameraPos ) <= 0.0 ){\n                cameraPos = rayDirection * max( posT, negT );\n                interior = true;\n                return false;\n            }else{\n                cameraNormal = normalize( cameraPos - cameraSpherePos2 );\n            }\n        #endif\n\n        return true;\n    }\n\n    return false; // ensure that each control flow has a return\n\n}\n\nvoid main(void){\n\n    // vec3 specular = vec3( 1.0, 1.0, 1.0 );\n    // float specularStrength = 1.0;\n    // float shininess = 1.0;\n\n    bool flag = Impostor( cameraPos, cameraNormal );\n\n    #ifdef NEAR_CLIP\n        if( calcClip( cameraPos ) > 0.0 )\n            discard;\n    #endif\n\n    // FIXME not compatible with custom clipping plane\n    //Set the depth based on the new cameraPos.\n    gl_FragDepthEXT = calcDepth( cameraPos );\n    if( !flag ){\n\n        // clamp to near clipping plane and add a tiny value to\n        // make spheres with a greater radius occlude smaller ones\n        #ifdef NEAR_CLIP\n            if( flag2 ){\n                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n            }else if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n            }\n        #else\n            if( gl_FragDepthEXT >= 0.0 ){\n                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n            }\n        #endif\n\n    }\n\n    // bugfix (mac only?)\n    if (gl_FragDepthEXT < 0.0)\n        discard;\n    if (gl_FragDepthEXT > 1.0)\n        discard;\n\n    #ifdef PICKING\n\n        gl_FragColor = vec4( vPickingColor, objectId );\n\n    #else\n\n        // vec3 specColor = vColor;  // vec3( 1.0, 1.0, 1.0 );\n        // vec3 lightDir = vec3( 0.0, 0.0, 1.0 );\n        // vec3 vNormal = cameraNormal;\n\n        // float lambertian = max(dot(lightDir,vNormal), 0.0);\n        // float specular = 0.0;\n\n        // if(lambertian > 0.0) {\n\n        //     vec3 reflectDir = reflect(-lightDir, vNormal);\n        //     vec3 viewDir = normalize(-cameraPos);\n\n        //     float specAngle = max(dot(reflectDir, viewDir), 0.0);\n        //     specular = pow(specAngle, 4.0);\n\n        //     // the exponent controls the shininess (try mode 2)\n        //     specular = pow(specAngle, 16.0);\n\n        //     // according to the rendering equation we would need to multiply\n        //     // with the the "lambertian", but this has little visual effect\n        //     specular *= lambertian;\n\n\n        // }\n\n        // gl_FragColor = vec4( lambertian*vColor + specular*specColor, opacity );\n\n        //\n\n        vec3 vNormal = cameraNormal;\n\n        vec4 diffuseColor = vec4( diffuse, opacity );\n        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n        vec3 totalEmissiveLight = emissive;\n\n        #include color_fragment\n        #include roughnessmap_fragment\n        #include metalnessmap_fragment\n        #include normal_fragment\n        if( interior ){\n            normal = vec3( 0.0, 0.0, 0.4 );\n        }\n\n        // #include lights_phong_fragment\n        #include lights_standard_fragment\n        #include lights_template\n\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n        #include premultiplied_alpha_fragment\n        #include tonemapping_fragment\n        #include encodings_fragment\n        #include fog_fragment\n\n    #endif\n\n}';
NGL.Resources["shader/chunk/dull_interior_fragment.glsl"]="#ifdef DULL_INTERIOR\n    if( gl_FrontFacing == false ){\n        normal = vec3( 0.0, 0.0, 0.4 );\n    }\n#endif";NGL.Resources["shader/chunk/fog_fragment.glsl"]="#ifdef USE_FOG\n\n\t// #if defined( USE_LOGDEPTHBUF_EXT ) || defined( IMPOSTOR )\n\t//\n\t// \tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t//\n\t// #else\n\t//\n\t// \tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t//\n\t// #endif\n\n\tfloat depth = length( vViewPosition );\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif";
NGL.Resources["shader/chunk/nearclip_fragment.glsl"]="#ifdef NEAR_CLIP\n    if( dot( vec4( vViewPosition, 1.0 ), vec4( 0.0, 0.0, -1.0, nearClip ) ) > 0.0 )\n        discard;\n#endif";NGL.Resources["shader/chunk/nearclip_vertex.glsl"]="#ifdef NEAR_CLIP\n    // move out of viewing frustum for custom clipping\n    if( dot( vec4( vViewPosition, 1.0 ), vec4( 0.0, 0.0, -1.0, nearClip ) ) > 0.0 )\n        gl_Position.w = -10.0;\n#endif";NGL.Resources["shader/chunk/opaque_back_fragment.glsl"]="#ifdef OPAQUE_BACK\n    #ifdef FLIP_SIDED\n        if( gl_FrontFacing == true ){\n            gl_FragColor.a = 1.0;\n        }\n    #else\n        if( gl_FrontFacing == false ){\n            gl_FragColor.a = 1.0;\n        }\n    #endif\n#endif";
